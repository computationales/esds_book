<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 3 Data variety | Environmental Systems Data Science</title>
  <meta name="description" content="Tutorial and exercises for Environmental System Data Science, ETH Zürich." />
  <meta name="generator" content="bookdown 0.24 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 3 Data variety | Environmental Systems Data Science" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="Tutorial and exercises for Environmental System Data Science, ETH Zürich." />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 3 Data variety | Environmental Systems Data Science" />
  
  <meta name="twitter:description" content="Tutorial and exercises for Environmental System Data Science, ETH Zürich." />
  

<meta name="author" content="Loïc Pellissier, Joshua Payne, Benjamin Stocker" />


<meta name="date" content="2021-12-30" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="ch-02.html"/>
<link rel="next" href="ch-04.html"/>
<script src="libs/header-attrs-2.11/header-attrs.js"></script>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.0.1/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0.1/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Prerequisites</a>
<ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#course-description"><i class="fa fa-check"></i>Course Description</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#course-objectives"><i class="fa fa-check"></i>Course Objectives</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#content"><i class="fa fa-check"></i>Content</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#useful-prerequisites"><i class="fa fa-check"></i>Useful Prerequisites</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="ch-01.html"><a href="ch-01.html"><i class="fa fa-check"></i><b>1</b> Primers</a>
<ul>
<li class="chapter" data-level="1.1" data-path="ch-01.html"><a href="ch-01.html#introduction"><i class="fa fa-check"></i><b>1.1</b> Introduction</a>
<ul>
<li class="chapter" data-level="1.1.1" data-path="ch-01.html"><a href="ch-01.html#key-points-from-the-lecture"><i class="fa fa-check"></i><b>1.1.1</b> Key Points from the lecture</a></li>
</ul></li>
<li class="chapter" data-level="1.2" data-path="ch-01.html"><a href="ch-01.html#tutorial"><i class="fa fa-check"></i><b>1.2</b> Tutorial</a>
<ul>
<li class="chapter" data-level="1.2.1" data-path="ch-01.html"><a href="ch-01.html#working-with-rstudio-on-renku"><i class="fa fa-check"></i><b>1.2.1</b> Working with RStudio on Renku</a></li>
<li class="chapter" data-level="1.2.2" data-path="ch-01.html"><a href="ch-01.html#git"><i class="fa fa-check"></i><b>1.2.2</b> Git</a></li>
<li class="chapter" data-level="1.2.3" data-path="ch-01.html"><a href="ch-01.html#libraries"><i class="fa fa-check"></i><b>1.2.3</b> Libraries</a></li>
<li class="chapter" data-level="1.2.4" data-path="ch-01.html"><a href="ch-01.html#r-scripts"><i class="fa fa-check"></i><b>1.2.4</b> R scripts</a></li>
<li class="chapter" data-level="1.2.5" data-path="ch-01.html"><a href="ch-01.html#rmarkdown"><i class="fa fa-check"></i><b>1.2.5</b> RMarkdown</a></li>
<li class="chapter" data-level="1.2.6" data-path="ch-01.html"><a href="ch-01.html#functions"><i class="fa fa-check"></i><b>1.2.6</b> Functions</a></li>
<li class="chapter" data-level="1.2.7" data-path="ch-01.html"><a href="ch-01.html#tidy-data"><i class="fa fa-check"></i><b>1.2.7</b> Tidy data</a></li>
<li class="chapter" data-level="1.2.8" data-path="ch-01.html"><a href="ch-01.html#r-projects"><i class="fa fa-check"></i><b>1.2.8</b> R projects</a></li>
<li class="chapter" data-level="1.2.9" data-path="ch-01.html"><a href="ch-01.html#working-with-data-frames"><i class="fa fa-check"></i><b>1.2.9</b> Working with data frames</a></li>
<li class="chapter" data-level="1.2.10" data-path="ch-01.html"><a href="ch-01.html#r-objects"><i class="fa fa-check"></i><b>1.2.10</b> R objects</a></li>
<li class="chapter" data-level="1.2.11" data-path="ch-01.html"><a href="ch-01.html#data-visualisation"><i class="fa fa-check"></i><b>1.2.11</b> Data visualisation</a></li>
<li class="chapter" data-level="1.2.12" data-path="ch-01.html"><a href="ch-01.html#conditionals"><i class="fa fa-check"></i><b>1.2.12</b> Conditionals</a></li>
<li class="chapter" data-level="1.2.13" data-path="ch-01.html"><a href="ch-01.html#loops"><i class="fa fa-check"></i><b>1.2.13</b> Loops</a></li>
<li class="chapter" data-level="1.2.14" data-path="ch-01.html"><a href="ch-01.html#where-to-find-help"><i class="fa fa-check"></i><b>1.2.14</b> Where to find help</a></li>
<li class="chapter" data-level="1.2.15" data-path="ch-01.html"><a href="ch-01.html#key-points-from-the-tutorial"><i class="fa fa-check"></i><b>1.2.15</b> Key points from the tutorial</a></li>
<li class="chapter" data-level="1.2.16" data-path="ch-01.html"><a href="ch-01.html#further-reading"><i class="fa fa-check"></i><b>1.2.16</b> Further reading</a></li>
</ul></li>
<li class="chapter" data-level="1.3" data-path="ch-01.html"><a href="ch-01.html#exercise"><i class="fa fa-check"></i><b>1.3</b> Exercise</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="ch-02.html"><a href="ch-02.html"><i class="fa fa-check"></i><b>2</b> Data wrangling</a>
<ul>
<li class="chapter" data-level="2.1" data-path="ch-02.html"><a href="ch-02.html#introduction-1"><i class="fa fa-check"></i><b>2.1</b> Introduction</a>
<ul>
<li class="chapter" data-level="2.1.1" data-path="ch-02.html"><a href="ch-02.html#learning-objectives"><i class="fa fa-check"></i><b>2.1.1</b> Learning objectives</a></li>
<li class="chapter" data-level="2.1.2" data-path="ch-02.html"><a href="ch-02.html#key-points-from-the-lecture-1"><i class="fa fa-check"></i><b>2.1.2</b> Key points from the lecture</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="ch-02.html"><a href="ch-02.html#tutorial-1"><i class="fa fa-check"></i><b>2.2</b> Tutorial</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="ch-02.html"><a href="ch-02.html#libraries-1"><i class="fa fa-check"></i><b>2.2.1</b> Libraries</a></li>
<li class="chapter" data-level="2.2.2" data-path="ch-02.html"><a href="ch-02.html#variables-in-a-data-frame"><i class="fa fa-check"></i><b>2.2.2</b> Variables in a data frame</a></li>
<li class="chapter" data-level="2.2.3" data-path="ch-02.html"><a href="ch-02.html#time-objects"><i class="fa fa-check"></i><b>2.2.3</b> Time objects</a></li>
<li class="chapter" data-level="2.2.4" data-path="ch-02.html"><a href="ch-02.html#variable-re--definition"><i class="fa fa-check"></i><b>2.2.4</b> Variable (re-) definition</a></li>
<li class="chapter" data-level="2.2.5" data-path="ch-02.html"><a href="ch-02.html#selecting-cleaning-and-gap-filling"><i class="fa fa-check"></i><b>2.2.5</b> Selecting, cleaning and gap-filling</a></li>
<li class="chapter" data-level="2.2.6" data-path="ch-02.html"><a href="ch-02.html#functions-1"><i class="fa fa-check"></i><b>2.2.6</b> Functions</a></li>
<li class="chapter" data-level="2.2.7" data-path="ch-02.html"><a href="ch-02.html#data-overview"><i class="fa fa-check"></i><b>2.2.7</b> Data overview</a></li>
<li class="chapter" data-level="2.2.8" data-path="ch-02.html"><a href="ch-02.html#data-visualisation-i"><i class="fa fa-check"></i><b>2.2.8</b> Data visualisation I</a></li>
<li class="chapter" data-level="2.2.9" data-path="ch-02.html"><a href="ch-02.html#aggregating"><i class="fa fa-check"></i><b>2.2.9</b> Aggregating</a></li>
<li class="chapter" data-level="2.2.10" data-path="ch-02.html"><a href="ch-02.html#data-visualisation-ii"><i class="fa fa-check"></i><b>2.2.10</b> Data visualisation II</a></li>
<li class="chapter" data-level="2.2.11" data-path="ch-02.html"><a href="ch-02.html#functional-programming-i"><i class="fa fa-check"></i><b>2.2.11</b> Functional programming I</a></li>
<li class="chapter" data-level="2.2.12" data-path="ch-02.html"><a href="ch-02.html#strings"><i class="fa fa-check"></i><b>2.2.12</b> Strings</a></li>
<li class="chapter" data-level="2.2.13" data-path="ch-02.html"><a href="ch-02.html#combining-relational-data"><i class="fa fa-check"></i><b>2.2.13</b> Combining relational data</a></li>
<li class="chapter" data-level="2.2.14" data-path="ch-02.html"><a href="ch-02.html#key-points-from-the-tutorial-1"><i class="fa fa-check"></i><b>2.2.14</b> Key points from the tutorial</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="ch-02.html"><a href="ch-02.html#exercise-1"><i class="fa fa-check"></i><b>2.3</b> Exercise</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="ch-03.html"><a href="ch-03.html"><i class="fa fa-check"></i><b>3</b> Data variety</a>
<ul>
<li class="chapter" data-level="3.1" data-path="ch-03.html"><a href="ch-03.html#introduction-2"><i class="fa fa-check"></i><b>3.1</b> Introduction</a>
<ul>
<li class="chapter" data-level="3.1.1" data-path="ch-03.html"><a href="ch-03.html#overview"><i class="fa fa-check"></i><b>3.1.1</b> Overview</a></li>
<li class="chapter" data-level="3.1.2" data-path="ch-03.html"><a href="ch-03.html#learning-objectives-1"><i class="fa fa-check"></i><b>3.1.2</b> Learning objectives</a></li>
<li class="chapter" data-level="3.1.3" data-path="ch-03.html"><a href="ch-03.html#key-points-from-the-lecture-2"><i class="fa fa-check"></i><b>3.1.3</b> Key points from the lecture</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="ch-03.html"><a href="ch-03.html#tutorial-2"><i class="fa fa-check"></i><b>3.2</b> Tutorial</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="ch-03.html"><a href="ch-03.html#overview-1"><i class="fa fa-check"></i><b>3.2.1</b> Overview</a></li>
<li class="chapter" data-level="3.2.2" data-path="ch-03.html"><a href="ch-03.html#modis-remote-download"><i class="fa fa-check"></i><b>3.2.2</b> MODIS remote download</a></li>
<li class="chapter" data-level="3.2.3" data-path="ch-03.html"><a href="ch-03.html#points-on-the-globe"><i class="fa fa-check"></i><b>3.2.3</b> Points on the globe</a></li>
<li class="chapter" data-level="3.2.4" data-path="ch-03.html"><a href="ch-03.html#shapefiles"><i class="fa fa-check"></i><b>3.2.4</b> Shapefiles</a></li>
<li class="chapter" data-level="3.2.5" data-path="ch-03.html"><a href="ch-03.html#rasters"><i class="fa fa-check"></i><b>3.2.5</b> Rasters</a></li>
<li class="chapter" data-level="3.2.6" data-path="ch-03.html"><a href="ch-03.html#key-points-from-the-tutorial-2"><i class="fa fa-check"></i><b>3.2.6</b> Key points from the tutorial</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="ch-03.html"><a href="ch-03.html#exercise-2"><i class="fa fa-check"></i><b>3.3</b> Exercise</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="ch-04.html"><a href="ch-04.html"><i class="fa fa-check"></i><b>4</b> Data Scraping</a>
<ul>
<li class="chapter" data-level="4.1" data-path="ch-04.html"><a href="ch-04.html#introduction-3"><i class="fa fa-check"></i><b>4.1</b> Introduction</a>
<ul>
<li class="chapter" data-level="4.1.1" data-path="ch-04.html"><a href="ch-04.html#key-points-from-the-lecture-3"><i class="fa fa-check"></i><b>4.1.1</b> Key points from the lecture</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="ch-04.html"><a href="ch-04.html#tutorial-3"><i class="fa fa-check"></i><b>4.2</b> Tutorial</a>
<ul>
<li class="chapter" data-level="4.2.1" data-path="ch-04.html"><a href="ch-04.html#r-packages-and-functions"><i class="fa fa-check"></i><b>4.2.1</b> R-Packages and Functions</a></li>
<li class="chapter" data-level="4.2.2" data-path="ch-04.html"><a href="ch-04.html#the-fishbase-website"><i class="fa fa-check"></i><b>4.2.2</b> The FishBase website</a></li>
<li class="chapter" data-level="4.2.3" data-path="ch-04.html"><a href="ch-04.html#accessing-fishbase"><i class="fa fa-check"></i><b>4.2.3</b> Accessing FishBase</a></li>
<li class="chapter" data-level="4.2.4" data-path="ch-04.html"><a href="ch-04.html#scraping-numbers"><i class="fa fa-check"></i><b>4.2.4</b> Scraping Numbers</a></li>
<li class="chapter" data-level="4.2.5" data-path="ch-04.html"><a href="ch-04.html#scraping-text-snippetrs"><i class="fa fa-check"></i><b>4.2.5</b> Scraping Text Snippetrs</a></li>
<li class="chapter" data-level="4.2.6" data-path="ch-04.html"><a href="ch-04.html#scraping-tables"><i class="fa fa-check"></i><b>4.2.6</b> Scraping Tables</a></li>
<li class="chapter" data-level="4.2.7" data-path="ch-04.html"><a href="ch-04.html#the-fishbase-package"><i class="fa fa-check"></i><b>4.2.7</b> The Fishbase Package</a></li>
<li class="chapter" data-level="4.2.8" data-path="ch-04.html"><a href="ch-04.html#summary"><i class="fa fa-check"></i><b>4.2.8</b> Summary</a></li>
<li class="chapter" data-level="4.2.9" data-path="ch-04.html"><a href="ch-04.html#case-study"><i class="fa fa-check"></i><b>4.2.9</b> Case Study</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="ch-04.html"><a href="ch-04.html#exercise-3"><i class="fa fa-check"></i><b>4.3</b> Exercise</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="ch-05.html"><a href="ch-05.html"><i class="fa fa-check"></i><b>5</b> Catch-up</a>
<ul>
<li class="chapter" data-level="5.1" data-path="ch-05.html"><a href="ch-05.html#loops-in-r"><i class="fa fa-check"></i><b>5.1</b> Loops in R</a>
<ul>
<li class="chapter" data-level="5.1.1" data-path="ch-05.html"><a href="ch-05.html#some-simple-examples"><i class="fa fa-check"></i><b>5.1.1</b> Some simple examples</a></li>
<li class="chapter" data-level="5.1.2" data-path="ch-05.html"><a href="ch-05.html#nested-loops"><i class="fa fa-check"></i><b>5.1.2</b> Nested loops</a></li>
<li class="chapter" data-level="5.1.3" data-path="ch-05.html"><a href="ch-05.html#exercise-4"><i class="fa fa-check"></i><b>5.1.3</b> Exercise</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="ch-05.html"><a href="ch-05.html#functional-programming-using-purr"><i class="fa fa-check"></i><b>5.2</b> Functional programming using purr</a>
<ul>
<li class="chapter" data-level="5.2.1" data-path="ch-05.html"><a href="ch-05.html#shortcuts-in-a-purrr-function"><i class="fa fa-check"></i><b>5.2.1</b> Shortcuts in a <code>purrr</code> function</a></li>
<li class="chapter" data-level="5.2.2" data-path="ch-05.html"><a href="ch-05.html#workflow-nested-data-map-and-mutate"><i class="fa fa-check"></i><b>5.2.2</b> Workflow: nested data, map and mutate</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="ch-05.html"><a href="ch-05.html#string-manipulations"><i class="fa fa-check"></i><b>5.3</b> String Manipulations</a>
<ul>
<li class="chapter" data-level="5.3.1" data-path="ch-05.html"><a href="ch-05.html#introduction-to-strings"><i class="fa fa-check"></i><b>5.3.1</b> Introduction to strings</a></li>
<li class="chapter" data-level="5.3.2" data-path="ch-05.html"><a href="ch-05.html#matching-and-extracting-patterns"><i class="fa fa-check"></i><b>5.3.2</b> Matching and extracting patterns</a></li>
<li class="chapter" data-level="5.3.3" data-path="ch-05.html"><a href="ch-05.html#advanced-example"><i class="fa fa-check"></i><b>5.3.3</b> Advanced example</a></li>
</ul></li>
<li class="chapter" data-level="5.4" data-path="ch-05.html"><a href="ch-05.html#web-scraping-in-a-nut-shell"><i class="fa fa-check"></i><b>5.4</b> Web-scraping in a nut-shell</a></li>
<li class="chapter" data-level="5.5" data-path="ch-05.html"><a href="ch-05.html#tidyverses-filter-and-select"><i class="fa fa-check"></i><b>5.5</b> Tidyverse’s filter and select</a>
<ul>
<li class="chapter" data-level="5.5.1" data-path="ch-05.html"><a href="ch-05.html#introduction-4"><i class="fa fa-check"></i><b>5.5.1</b> Introduction</a></li>
<li class="chapter" data-level="5.5.2" data-path="ch-05.html"><a href="ch-05.html#select"><i class="fa fa-check"></i><b>5.5.2</b> Select()</a></li>
<li class="chapter" data-level="5.5.3" data-path="ch-05.html"><a href="ch-05.html#filter"><i class="fa fa-check"></i><b>5.5.3</b> Filter()</a></li>
<li class="chapter" data-level="5.5.4" data-path="ch-05.html"><a href="ch-05.html#exercises"><i class="fa fa-check"></i><b>5.5.4</b> Exercises</a></li>
<li class="chapter" data-level="5.5.5" data-path="ch-05.html"><a href="ch-05.html#solutions"><i class="fa fa-check"></i><b>5.5.5</b> Solutions</a></li>
</ul></li>
<li class="chapter" data-level="5.6" data-path="ch-05.html"><a href="ch-05.html#preparing-data-for-ggplot"><i class="fa fa-check"></i><b>5.6</b> Preparing data for ggplot()</a></li>
<li class="chapter" data-level="5.7" data-path="ch-05.html"><a href="ch-05.html#base-r-functions"><i class="fa fa-check"></i><b>5.7</b> Base R functions</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="ch-06.html"><a href="ch-06.html"><i class="fa fa-check"></i><b>6</b> Supervised Machine Learning I</a>
<ul>
<li class="chapter" data-level="6.1" data-path="ch-06.html"><a href="ch-06.html#introduction-5"><i class="fa fa-check"></i><b>6.1</b> Introduction</a>
<ul>
<li class="chapter" data-level="6.1.1" data-path="ch-06.html"><a href="ch-06.html#learning-objectives-2"><i class="fa fa-check"></i><b>6.1.1</b> Learning objectives</a></li>
<li class="chapter" data-level="6.1.2" data-path="ch-06.html"><a href="ch-06.html#important-points-from-the-lecture"><i class="fa fa-check"></i><b>6.1.2</b> Important points from the lecture</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="ch-06.html"><a href="ch-06.html#tutorial-4"><i class="fa fa-check"></i><b>6.2</b> Tutorial</a>
<ul>
<li class="chapter" data-level="6.2.1" data-path="ch-06.html"><a href="ch-06.html#overfitting"><i class="fa fa-check"></i><b>6.2.1</b> Overfitting</a></li>
<li class="chapter" data-level="6.2.2" data-path="ch-06.html"><a href="ch-06.html#motivation"><i class="fa fa-check"></i><b>6.2.2</b> Modelling challenge</a></li>
<li class="chapter" data-level="6.2.3" data-path="ch-06.html"><a href="ch-06.html#a-selection-of-model-types"><i class="fa fa-check"></i><b>6.2.3</b> A selection of model types</a></li>
<li class="chapter" data-level="6.2.4" data-path="ch-06.html"><a href="ch-06.html#data-splitting"><i class="fa fa-check"></i><b>6.2.4</b> Data splitting</a></li>
<li class="chapter" data-level="6.2.5" data-path="ch-06.html"><a href="ch-06.html#preprocessing"><i class="fa fa-check"></i><b>6.2.5</b> Pre-processing</a></li>
<li class="chapter" data-level="6.2.6" data-path="ch-06.html"><a href="ch-06.html#model-formulation"><i class="fa fa-check"></i><b>6.2.6</b> Model formulation</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="ch-06.html"><a href="ch-06.html#exercise-5"><i class="fa fa-check"></i><b>6.3</b> Exercise</a>
<ul>
<li class="chapter" data-level="6.3.1" data-path="ch-06.html"><a href="ch-06.html#reading-and-cleaning"><i class="fa fa-check"></i><b>6.3.1</b> Reading and cleaning</a></li>
<li class="chapter" data-level="6.3.2" data-path="ch-06.html"><a href="ch-06.html#data-splitting-1"><i class="fa fa-check"></i><b>6.3.2</b> Data splitting</a></li>
<li class="chapter" data-level="6.3.3" data-path="ch-06.html"><a href="ch-06.html#linear-model"><i class="fa fa-check"></i><b>6.3.3</b> Linear model</a></li>
<li class="chapter" data-level="6.3.4" data-path="ch-06.html"><a href="ch-06.html#pre-processing"><i class="fa fa-check"></i><b>6.3.4</b> Pre-processing</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7" data-path="ch-07.html"><a href="ch-07.html"><i class="fa fa-check"></i><b>7</b> Supervised Machine Learning II</a>
<ul>
<li class="chapter" data-level="7.1" data-path="ch-07.html"><a href="ch-07.html#introduction-6"><i class="fa fa-check"></i><b>7.1</b> Introduction</a>
<ul>
<li class="chapter" data-level="7.1.1" data-path="ch-07.html"><a href="ch-07.html#learning-objectives-3"><i class="fa fa-check"></i><b>7.1.1</b> Learning objectives</a></li>
<li class="chapter" data-level="7.1.2" data-path="ch-07.html"><a href="ch-07.html#key-points-from-the-lecture-4"><i class="fa fa-check"></i><b>7.1.2</b> Key points from the lecture</a></li>
</ul></li>
<li class="chapter" data-level="7.2" data-path="ch-07.html"><a href="ch-07.html#tutorial-5"><i class="fa fa-check"></i><b>7.2</b> Tutorial</a>
<ul>
<li class="chapter" data-level="7.2.1" data-path="ch-07.html"><a href="ch-07.html#model-formulation-using-train"><i class="fa fa-check"></i><b>7.2.1</b> Model formulation using <code>train()</code></a></li>
<li class="chapter" data-level="7.2.2" data-path="ch-07.html"><a href="ch-07.html#model-training"><i class="fa fa-check"></i><b>7.2.2</b> Model training</a></li>
<li class="chapter" data-level="7.2.3" data-path="ch-07.html"><a href="ch-07.html#model-evaluation"><i class="fa fa-check"></i><b>7.2.3</b> Model evaluation</a></li>
<li class="chapter" data-level="7.2.4" data-path="ch-07.html"><a href="ch-07.html#bonus-model-interpretation"><i class="fa fa-check"></i><b>7.2.4</b> Bonus: Model interpretation</a></li>
</ul></li>
<li class="chapter" data-level="7.3" data-path="ch-07.html"><a href="ch-07.html#exercise-6"><i class="fa fa-check"></i><b>7.3</b> Exercise</a>
<ul>
<li class="chapter" data-level="7.3.1" data-path="ch-07.html"><a href="ch-07.html#setup"><i class="fa fa-check"></i><b>7.3.1</b> Setup</a></li>
<li class="chapter" data-level="7.3.2" data-path="ch-07.html"><a href="ch-07.html#linear-model-1"><i class="fa fa-check"></i><b>7.3.2</b> Linear Model</a></li>
</ul></li>
<li class="chapter" data-level="7.4" data-path="ch-07.html"><a href="ch-07.html#knn"><i class="fa fa-check"></i><b>7.4</b> KNN</a>
<ul>
<li class="chapter" data-level="7.4.1" data-path="ch-07.html"><a href="ch-07.html#check-data"><i class="fa fa-check"></i><b>7.4.1</b> Check data</a></li>
<li class="chapter" data-level="7.4.2" data-path="ch-07.html"><a href="ch-07.html#training-1"><i class="fa fa-check"></i><b>7.4.2</b> Training</a></li>
<li class="chapter" data-level="7.4.3" data-path="ch-07.html"><a href="ch-07.html#prediction-1"><i class="fa fa-check"></i><b>7.4.3</b> Prediction</a></li>
<li class="chapter" data-level="7.4.4" data-path="ch-07.html"><a href="ch-07.html#sample-hyperparameters"><i class="fa fa-check"></i><b>7.4.4</b> Sample hyperparameters</a></li>
</ul></li>
<li class="chapter" data-level="7.5" data-path="ch-07.html"><a href="ch-07.html#random-forest-1"><i class="fa fa-check"></i><b>7.5</b> Random forest</a>
<ul>
<li class="chapter" data-level="7.5.1" data-path="ch-07.html"><a href="ch-07.html#training-2"><i class="fa fa-check"></i><b>7.5.1</b> Training</a></li>
<li class="chapter" data-level="7.5.2" data-path="ch-07.html"><a href="ch-07.html#prediction-2"><i class="fa fa-check"></i><b>7.5.2</b> Prediction</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="8" data-path="ch-08.html"><a href="ch-08.html"><i class="fa fa-check"></i><b>8</b> Application 1: Variable selection</a>
<ul>
<li class="chapter" data-level="8.1" data-path="ch-08.html"><a href="ch-08.html#introduction-7"><i class="fa fa-check"></i><b>8.1</b> Introduction</a></li>
<li class="chapter" data-level="8.2" data-path="ch-08.html"><a href="ch-08.html#application"><i class="fa fa-check"></i><b>8.2</b> Application</a>
<ul>
<li class="chapter" data-level="8.2.1" data-path="ch-08.html"><a href="ch-08.html#warm-up-1-nested-for-loop"><i class="fa fa-check"></i><b>8.2.1</b> Warm-up 1: Nested for-loop</a></li>
<li class="chapter" data-level="8.2.2" data-path="ch-08.html"><a href="ch-08.html#warm-up-2-find-the-best-single-predictor"><i class="fa fa-check"></i><b>8.2.2</b> Warm-up 2: Find the best single predictor</a></li>
<li class="chapter" data-level="8.2.3" data-path="ch-08.html"><a href="ch-08.html#full-stepwise-regression"><i class="fa fa-check"></i><b>8.2.3</b> Full stepwise regression</a></li>
<li class="chapter" data-level="8.2.4" data-path="ch-08.html"><a href="ch-08.html#bonus-stepwise-regression-out-of-the-box"><i class="fa fa-check"></i><b>8.2.4</b> Bonus: Stepwise regression out-of-the-box</a></li>
<li class="chapter" data-level="8.2.5" data-path="ch-08.html"><a href="ch-08.html#bonus-best-subset-selection---not-included-in-application-for-students-too-long"><i class="fa fa-check"></i><b>8.2.5</b> Bonus: Best Subset Selection - Not included in application for students (too long…)</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="9" data-path="ch-09.html"><a href="ch-09.html"><i class="fa fa-check"></i><b>9</b> Supervised Neural Networks I</a>
<ul>
<li class="chapter" data-level="9.1" data-path="ch-09.html"><a href="ch-09.html#introduction-8"><i class="fa fa-check"></i><b>9.1</b> Introduction</a>
<ul>
<li class="chapter" data-level="9.1.1" data-path="ch-09.html"><a href="ch-09.html#learning-objectives-4"><i class="fa fa-check"></i><b>9.1.1</b> Learning objectives</a></li>
<li class="chapter" data-level="9.1.2" data-path="ch-09.html"><a href="ch-09.html#important-points-from-the-lecture-1"><i class="fa fa-check"></i><b>9.1.2</b> Important points from the lecture</a></li>
</ul></li>
<li class="chapter" data-level="9.2" data-path="ch-09.html"><a href="ch-09.html#tutorial-6"><i class="fa fa-check"></i><b>9.2</b> Tutorial</a>
<ul>
<li class="chapter" data-level="9.2.1" data-path="ch-09.html"><a href="ch-09.html#set-up"><i class="fa fa-check"></i><b>9.2.1</b> Set-up</a></li>
<li class="chapter" data-level="9.2.2" data-path="ch-09.html"><a href="ch-09.html#keras-for-linear-models"><i class="fa fa-check"></i><b>9.2.2</b> Keras for linear models</a></li>
<li class="chapter" data-level="9.2.3" data-path="ch-09.html"><a href="ch-09.html#tuning-learning-rate"><i class="fa fa-check"></i><b>9.2.3</b> Tuning learning rate</a></li>
<li class="chapter" data-level="9.2.4" data-path="ch-09.html"><a href="ch-09.html#logistic-regression"><i class="fa fa-check"></i><b>9.2.4</b> Logistic Regression</a></li>
</ul></li>
<li class="chapter" data-level="9.3" data-path="ch-09.html"><a href="ch-09.html#exercise-7"><i class="fa fa-check"></i><b>9.3</b> Exercise</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="ch-10.html"><a href="ch-10.html"><i class="fa fa-check"></i><b>10</b> Supervised Neural Networks II</a>
<ul>
<li class="chapter" data-level="10.1" data-path="ch-10.html"><a href="ch-10.html#introduction-9"><i class="fa fa-check"></i><b>10.1</b> Introduction</a>
<ul>
<li class="chapter" data-level="10.1.1" data-path="ch-10.html"><a href="ch-10.html#learning-objectives-5"><i class="fa fa-check"></i><b>10.1.1</b> Learning objectives</a></li>
<li class="chapter" data-level="10.1.2" data-path="ch-10.html"><a href="ch-10.html#important-points-from-the-lecture-2"><i class="fa fa-check"></i><b>10.1.2</b> Important points from the lecture</a></li>
</ul></li>
<li class="chapter" data-level="10.2" data-path="ch-10.html"><a href="ch-10.html#tutorial-7"><i class="fa fa-check"></i><b>10.2</b> Tutorial</a>
<ul>
<li class="chapter" data-level="10.2.1" data-path="ch-10.html"><a href="ch-10.html#import-libraries-1"><i class="fa fa-check"></i><b>10.2.1</b> Import libraries</a></li>
<li class="chapter" data-level="10.2.2" data-path="ch-10.html"><a href="ch-10.html#construct-a-toy-dataset"><i class="fa fa-check"></i><b>10.2.2</b> Construct a toy dataset</a></li>
<li class="chapter" data-level="10.2.3" data-path="ch-10.html"><a href="ch-10.html#build-and-train-nn"><i class="fa fa-check"></i><b>10.2.3</b> Build and train NN</a></li>
<li class="chapter" data-level="10.2.4" data-path="ch-10.html"><a href="ch-10.html#model-performance"><i class="fa fa-check"></i><b>10.2.4</b> Model performance</a></li>
<li class="chapter" data-level="10.2.5" data-path="ch-10.html"><a href="ch-10.html#influence-of-nn-architecture"><i class="fa fa-check"></i><b>10.2.5</b> Influence of NN architecture</a></li>
</ul></li>
<li class="chapter" data-level="10.3" data-path="ch-10.html"><a href="ch-10.html#exercise-8"><i class="fa fa-check"></i><b>10.3</b> Exercise</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="ch-11.html"><a href="ch-11.html"><i class="fa fa-check"></i><b>11</b> Application 2: Neural Networks and Hyperparameter Tuning</a>
<ul>
<li class="chapter" data-level="11.1" data-path="ch-11.html"><a href="ch-11.html#introduction-10"><i class="fa fa-check"></i><b>11.1</b> Introduction</a>
<ul>
<li class="chapter" data-level="11.1.1" data-path="ch-11.html"><a href="ch-11.html#learning-goals"><i class="fa fa-check"></i><b>11.1.1</b> Learning Goals</a></li>
<li class="chapter" data-level="11.1.2" data-path="ch-11.html"><a href="ch-11.html#key-points-from-previous-lectures"><i class="fa fa-check"></i><b>11.1.2</b> Key Points from Previous Lectures</a></li>
</ul></li>
<li class="chapter" data-level="11.2" data-path="ch-11.html"><a href="ch-11.html#application-1"><i class="fa fa-check"></i><b>11.2</b> Application</a>
<ul>
<li class="chapter" data-level="11.2.1" data-path="ch-11.html"><a href="ch-11.html#problem-statement"><i class="fa fa-check"></i><b>11.2.1</b> Problem Statement</a></li>
<li class="chapter" data-level="11.2.2" data-path="ch-11.html"><a href="ch-11.html#data-preparation"><i class="fa fa-check"></i><b>11.2.2</b> Data preparation</a></li>
<li class="chapter" data-level="11.2.3" data-path="ch-11.html"><a href="ch-11.html#center-and-scale"><i class="fa fa-check"></i><b>11.2.3</b> Center and scale</a></li>
<li class="chapter" data-level="11.2.4" data-path="ch-11.html"><a href="ch-11.html#building-a-simple-model-with-keras-subtask-1"><i class="fa fa-check"></i><b>11.2.4</b> Building a simple model with keras ( SubTask 1)</a></li>
<li class="chapter" data-level="11.2.5" data-path="ch-11.html"><a href="ch-11.html#cross-validation"><i class="fa fa-check"></i><b>11.2.5</b> Cross validation</a></li>
<li class="chapter" data-level="11.2.6" data-path="ch-11.html"><a href="ch-11.html#parameter-tuning"><i class="fa fa-check"></i><b>11.2.6</b> Parameter Tuning</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="12" data-path="ch-12.html"><a href="ch-12.html"><i class="fa fa-check"></i><b>12</b> Supervised Deep Learning I</a>
<ul>
<li class="chapter" data-level="12.1" data-path="ch-12.html"><a href="ch-12.html#introduction-11"><i class="fa fa-check"></i><b>12.1</b> Introduction</a>
<ul>
<li class="chapter" data-level="12.1.1" data-path="ch-12.html"><a href="ch-12.html#learning-objectives-6"><i class="fa fa-check"></i><b>12.1.1</b> Learning objectives</a></li>
</ul></li>
<li class="chapter" data-level="12.2" data-path="ch-12.html"><a href="ch-12.html#tutorial-8"><i class="fa fa-check"></i><b>12.2</b> Tutorial</a>
<ul>
<li class="chapter" data-level="12.2.1" data-path="ch-12.html"><a href="ch-12.html#building-blocks-of-cnns"><i class="fa fa-check"></i><b>12.2.1</b> Building Blocks of CNNs</a></li>
<li class="chapter" data-level="12.2.2" data-path="ch-12.html"><a href="ch-12.html#build-the-model"><i class="fa fa-check"></i><b>12.2.2</b> Build the model</a></li>
<li class="chapter" data-level="12.2.3" data-path="ch-12.html"><a href="ch-12.html#compile-and-train-the-model"><i class="fa fa-check"></i><b>12.2.3</b> Compile and train the model</a></li>
<li class="chapter" data-level="12.2.4" data-path="ch-12.html"><a href="ch-12.html#reduce-overfitting"><i class="fa fa-check"></i><b>12.2.4</b> Reduce Overfitting</a></li>
<li class="chapter" data-level="12.2.5" data-path="ch-12.html"><a href="ch-12.html#visualizing-a-cnn"><i class="fa fa-check"></i><b>12.2.5</b> Visualizing a CNN</a></li>
</ul></li>
<li class="chapter" data-level="12.3" data-path="ch-12.html"><a href="ch-12.html#exercise-9"><i class="fa fa-check"></i><b>12.3</b> Exercise</a>
<ul>
<li class="chapter" data-level="12.3.1" data-path="ch-12.html"><a href="ch-12.html#import-libraries-and-data"><i class="fa fa-check"></i><b>12.3.1</b> Import libraries and data</a></li>
<li class="chapter" data-level="12.3.2" data-path="ch-12.html"><a href="ch-12.html#tasks"><i class="fa fa-check"></i><b>12.3.2</b> Tasks</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="13" data-path="ch-13.html"><a href="ch-13.html"><i class="fa fa-check"></i><b>13</b> Supervised Deep Learning II - <em>A Scenario of Environmental Systems</em></a>
<ul>
<li class="chapter" data-level="13.1" data-path="ch-13.html"><a href="ch-13.html#introduction-12"><i class="fa fa-check"></i><b>13.1</b> Introduction</a>
<ul>
<li class="chapter" data-level="13.1.1" data-path="ch-13.html"><a href="ch-13.html#learning-objectives-7"><i class="fa fa-check"></i><b>13.1.1</b> Learning objectives</a></li>
<li class="chapter" data-level="13.1.2" data-path="ch-13.html"><a href="ch-13.html#content-operations"><i class="fa fa-check"></i><b>13.1.2</b> Content &amp; Operations</a></li>
</ul></li>
<li class="chapter" data-level="13.2" data-path="ch-13.html"><a href="ch-13.html#tutorial-9"><i class="fa fa-check"></i><b>13.2</b> Tutorial</a>
<ul>
<li class="chapter" data-level="13.2.1" data-path="ch-13.html"><a href="ch-13.html#description-of-the-modelling-task"><i class="fa fa-check"></i><b>13.2.1</b> Description of the modelling task</a></li>
<li class="chapter" data-level="13.2.2" data-path="ch-13.html"><a href="ch-13.html#goal-of-the-tutorial"><i class="fa fa-check"></i><b>13.2.2</b> Goal of the tutorial</a></li>
<li class="chapter" data-level="13.2.3" data-path="ch-13.html"><a href="ch-13.html#dataset"><i class="fa fa-check"></i><b>13.2.3</b> Dataset</a></li>
<li class="chapter" data-level="13.2.4" data-path="ch-13.html"><a href="ch-13.html#lets-dive-into-the-code"><i class="fa fa-check"></i><b>13.2.4</b> Let’s dive into the code</a></li>
<li class="chapter" data-level="13.2.5" data-path="ch-13.html"><a href="ch-13.html#read-in-the-data"><i class="fa fa-check"></i><b>13.2.5</b> Read in the Data</a></li>
<li class="chapter" data-level="13.2.6" data-path="ch-13.html"><a href="ch-13.html#naive-models-old-world-linear-models"><i class="fa fa-check"></i><b>13.2.6</b> Naive models (Old World): Linear Models</a></li>
<li class="chapter" data-level="13.2.7" data-path="ch-13.html"><a href="ch-13.html#neural-networks-new-world"><i class="fa fa-check"></i><b>13.2.7</b> Neural Networks (New World)</a></li>
<li class="chapter" data-level="13.2.8" data-path="ch-13.html"><a href="ch-13.html#convolutional-neural-network"><i class="fa fa-check"></i><b>13.2.8</b> Convolutional Neural Network</a></li>
</ul></li>
<li class="chapter" data-level="13.3" data-path="ch-13.html"><a href="ch-13.html#exercise-10"><i class="fa fa-check"></i><b>13.3</b> Exercise</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Environmental Systems Data Science</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="ch-03" class="section level1" number="3">
<h1><span class="header-section-number">Chapter 3</span> Data variety</h1>
<div id="introduction-2" class="section level2" number="3.1">
<h2><span class="header-section-number">3.1</span> Introduction</h2>
<div id="overview" class="section level3" number="3.1.1">
<h3><span class="header-section-number">3.1.1</span> Overview</h3>
<p>In this chapter, we will look at data variety in environmental sciences. We will start with the data from one eddy covariance measurement site in Switzerland encountered in Chapter 1, and complement it with remote sensing data. Specifically, we will download remote sensing data that measures vegetation greenness data, quantified by the normalised difference vegetation index, NDVI. We are interested in remote sensing data, because we expect ecosystem photosynthesis (gross primary production), measured at the eddy covariance tower, to covary with NDVI. Such covariation can provide powerful information for modelling. For example, we can train a machine learning model with the observed covariation between measured GPP and NDVI at eddy covariance sites and use that model to predict GPP from data obtained in space (NDVI is available for the whole globe, while GPP can only be measured locally.) You will be doing this modelling in exercise 13. Here, we will focus on working with the spatial aspects of the data (since remote sensing data is inherently spatial) and introduce the tool set to work with geo-spatial data.</p>
<p>To get familiar with spatial data types, we will use a variety of data from freely accessible sites. We can obtain abiotic and biotic conditions at the tower locations. We will be spatially plotting the eddy towers you have already encountered in the first two chapters and extracting values for these locations from other data. By doing this, we can show that the climate at these sites spans a gradient temperature and landcover.</p>
</div>
<div id="learning-objectives-1" class="section level3" number="3.1.2">
<h3><span class="header-section-number">3.1.2</span> Learning objectives</h3>
<p>After this learning unit, you will be able to …</p>
<ul>
<li>Explain the possible sources of data in environmental sciences.</li>
<li>Understand the range of operations applied to data from basic to complex.</li>
<li>Read various types of data in R and apply basic operations.</li>
<li>Understand the structure of spatial data, including rasters and shapefiles.</li>
<li>Apply a range of operations to prepare data for analyses.</li>
</ul>
</div>
<div id="key-points-from-the-lecture-2" class="section level3" number="3.1.3">
<h3><span class="header-section-number">3.1.3</span> Key points from the lecture</h3>
<p>Data operations range in complexity, here they are listed from simplest to extremely complex:</p>
<ul>
<li>Statistical operations</li>
<li>Similarity metrics</li>
<li>Ordinations</li>
<li>Clustering</li>
<li>Classifications</li>
<li>Regressions</li>
<li>Neural network deep learning</li>
</ul>
<p>Examples of methods for the computing differences between observations associated with a set of features:</p>
<ul>
<li><em>Euclidean distance</em> is used for the simple quantification of variation.</li>
<li><em>PCA</em> is a valuable tool to explore variation and reduce dimension.</li>
<li><em>Hamming distance</em> helps measure the difference between strings.</li>
<li><em>Jaccard index</em> describes the similarity between two or more binary data sets.</li>
</ul>
<p>Machine learning is loosely defined as any learning done by a computer. It can be divided into two main categories…</p>
<ul>
<li><em>Unsupervised learning</em>: without explanatory data, which uses clustering to obtain a categorical output</li>
<li><em>Supervised learning</em>: with explanatory data, which uses either classification also resulting in a categorical output, or regression when a numerical output is required</li>
</ul>
<p>Data errors are divided into errors of accuracy and precision. If data is inaccurate, it strays from the true value. If data is imprecise, individual data points are variable under the same conditions. Systematic errors and inaccurate data is much harder to correct.</p>
<p>Errors can arise throughout the data science workflow.</p>
<ul>
<li><em>Inherent error</em> refers to the error present in the source documents and data.</li>
<li><em>Operational error</em> is created after data collection.</li>
</ul>
<p>Data can be cleaned from errors by looking for:</p>
<ul>
<li><em>Non-uniform data</em> where the data is not uniformly or normally distributed.</li>
<li><em>Missing data</em> where there is no value for the observed variable, often denoted as <em>NA</em>.</li>
<li><em>Duplicated data</em> where a dataset contains multiple records of identical data.</li>
<li><em>Outliers</em> which are data points that are significantly different to other data points or lie abnormally far from most other data points.</li>
<li><em>Measurement errors</em> known as the discrepancy between the measured value and its true value.</li>
</ul>
<p>Quantifying uncertainty is extremely important, as undetectable errors will persist even after data cleaning. Examples of uncertainty quantification metrics include:</p>
<ul>
<li><em>Confidence interval (CI)</em> is a range of values that the chosen parameter of the data variable will fall within with a certain probability or degree of certainty.</li>
<li><em>Prediction interval</em> is the estimated interval within which observations will occur based on the previously observed data and with a certain degree of confidence.</li>
</ul>
<p>Error propagation is used for datasets containing different uncertainties to determine the overall uncertainty. For example, if the variables in the dataset come from measurements, these values will have a level of uncertainty due to limitations in the measuring process, such as the precision of the instrument. This uncertainty or errors will add up across the data set and analysis due to the variables being combined within a function. Often this error or uncertainty is expressed in terms of the standard deviation <em>σ</em>.</p>
</div>
</div>
<div id="tutorial-2" class="section level2" number="3.2">
<h2><span class="header-section-number">3.2</span> Tutorial</h2>
<div id="overview-1" class="section level3" number="3.2.1">
<h3><span class="header-section-number">3.2.1</span> Overview</h3>
<p>In this practical, we will be downloading and getting to know spatial data. There are three types of spatial data:</p>
<ul>
<li><em>points</em>: Spatial points are data points consist of x and y coordinates representing a specific geographic location.</li>
<li><em>shapefiles</em>: Shapefiles are a format for storing geospatial data in the form of points, lines or polygons. They contain geographic locations and attribute information on the features stored within them.</li>
<li><em>rasters</em>: Rasters are gridded data stored in pixels or cells. Each grid cell represents a section of the geographic area the raster covers and contains a value of the variable of interest.</li>
</ul>
<p>This practical will start with a little introduction on downloading remote sensing data for our tower sites and seeing how this information can be used for analyses. Then we will get into the nitty-gritty aspects of the aforementioned spatial data types.</p>
</div>
<div id="modis-remote-download" class="section level3" number="3.2.2">
<h3><span class="header-section-number">3.2.2</span> MODIS remote download</h3>
<p>We will be starting off this tutorial with an example on using remote sensing data. We will focus on a fluxnet site already presented in the first practical: CH-Lae. The Lägern site is located on a mountain in the Swiss Plateau NW of Zürich and is surrounded by managed mixed deciduous mountain forests. The forest is highly diverse and dominated by beech. In the following figures, you can get an impression of the tower and its surroundings.</p>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:unnamed-chunk-111"></span>
<img src="figures/site1.jpg" alt="Images of Fluxnet sites and measurement station at the Lägern site." width="32%" height="49%" /><img src="figures/site2.jpg" alt="Images of Fluxnet sites and measurement station at the Lägern site." width="32%" height="49%" /><img src="figures/site3.jpg" alt="Images of Fluxnet sites and measurement station at the Lägern site." width="32%" height="49%" />
<p class="caption">
Figure 3.1: Images of Fluxnet sites and measurement station at the Lägern site.
</p>
</div>
<p>As always, we start by loading <code>tidyverse</code>and our fluxnet site data.</p>
<div class="sourceCode" id="cb163"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb163-1"><a href="ch-03.html#cb163-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb163-2"><a href="ch-03.html#cb163-2" aria-hidden="true" tabindex="-1"></a>df_sites <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">&quot;./data/fluxnet_site_info_reduced.csv&quot;</span>)</span></code></pre></div>
<p>Since we will only be working with the Lägern site for this section, we can extract its latitude and longitude for further use.</p>
<div class="sourceCode" id="cb164"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb164-1"><a href="ch-03.html#cb164-1" aria-hidden="true" tabindex="-1"></a>lon_lae <span class="ot">&lt;-</span> df_sites <span class="sc">%&gt;%</span> </span>
<span id="cb164-2"><a href="ch-03.html#cb164-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(site <span class="sc">==</span> <span class="st">&quot;CH-Lae&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb164-3"><a href="ch-03.html#cb164-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(lon)</span>
<span id="cb164-4"><a href="ch-03.html#cb164-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb164-5"><a href="ch-03.html#cb164-5" aria-hidden="true" tabindex="-1"></a>lat_lae <span class="ot">&lt;-</span> df_sites <span class="sc">%&gt;%</span> </span>
<span id="cb164-6"><a href="ch-03.html#cb164-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(site <span class="sc">==</span> <span class="st">&quot;CH-Lae&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb164-7"><a href="ch-03.html#cb164-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(lat)</span></code></pre></div>
<p>In this first analysis, we want to complement temporal data measured by the Fluxnet tower with remote sensing data. <em>Remote sensing</em> is the detection or monitoring of physical characteristics of the Earth’s surface by measuring reflected and emitted radiation at a distance. Data is collected in the form of images by special cameras typically from aircrafts or satellites. With this method, a large amount of global data at large spatial scales gets easily accessible and therefore represents a useful method for the monitoring of ecosystems. However, this remotely acquired data requires validation from ground measurements, which can be done for example using the eddy towers from the previous practicals.</p>
<p>One of these satellite remote sensing instruments is MODIS (Moderate Resolution Imaging Spectroradiometer). Terra MODIS and Aqua MODIS are viewing the entire Earth’s surface every 1 to 2 days, acquiring data in 36 spectral bands, or groups of wavelengths.</p>
<p>We have access to tools that make it more straightforward to download remote sensing data from satellites. It provides Atmosphere, Ocean, Cryosphere and Land data series. The <code>MODISTools</code> package in R provides a programmatic interface to the <a href="https://modis.gsfc.nasa.gov/">MODIS Land Products Subsets web services</a> allows for easy downloads of “MODIS” time series (of single pixels or small regions of interest) directly to your R workspace or your computer.</p>
<ul>
<li>Using the <code>mt_...()</code> functions of the MODISTools, we can check which products are available in MODIS, how the product we are searching for is called, and what temporal and spatial resolutions are available.</li>
<li><code>t_products()</code> lists all available products from MODIS with their temporal and spatial resolution. Products are parent categories of variables measured by the satellites, such as vegetation indices.</li>
<li><code>mt_bands()</code> requires the entry of a product chosen from “products” and list the available data variables that are represented by the different actually measured wavelengths.</li>
<li>Finally, <code>mt_dates()</code> lists all dates of which data from the chosen product and band are available.</li>
</ul>
<p>We will make use of this by loading NDVI data around our towers directly from MODIS.</p>
<div class="sourceCode" id="cb165"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb165-1"><a href="ch-03.html#cb165-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(MODISTools)</span>
<span id="cb165-2"><a href="ch-03.html#cb165-2" aria-hidden="true" tabindex="-1"></a>products <span class="ot">&lt;-</span> <span class="fu">mt_products</span>() <span class="sc">%&gt;%</span> <span class="fu">as_tibble</span>()</span>
<span id="cb165-3"><a href="ch-03.html#cb165-3" aria-hidden="true" tabindex="-1"></a>bands <span class="ot">&lt;-</span> <span class="fu">mt_bands</span>(<span class="at">product =</span> <span class="st">&quot;MOD13Q1&quot;</span>) <span class="sc">%&gt;%</span> <span class="fu">as_tibble</span>()</span>
<span id="cb165-4"><a href="ch-03.html#cb165-4" aria-hidden="true" tabindex="-1"></a>dates <span class="ot">&lt;-</span> <span class="fu">mt_dates</span>(<span class="at">product =</span> <span class="st">&quot;MOD13Q1&quot;</span>, <span class="at">lat =</span> lat_lae, <span class="at">lon =</span> lon_lae) <span class="sc">%&gt;%</span> <span class="fu">as_tibble</span>()</span></code></pre></div>
<p>Next, we will get the NDVI data for 6 years for a square of 2km x 2km around the tower site. We can use the function <code>mt_subset()</code> for this. The parameters of this function download a subset of data within the chosen product (here ‘MOD13Q1’). We specify the location as latitude and longitude, and the band we chose, which is at 250m spatial resolution and 16-day temporal resolution. The time period can be chosen as a subset of “dates” and must be provided in the form of start and end date. We are looking at the beginning of 2009 to the end of 2014. <code>km_lr</code> and <code>km_ab</code> define the kilometers to the left and right of the location and kilometers above and below, respectively. Since these values are being rounded to the nearest integer, we choose this minimum of 1, corresponding to 2 km^2. Sitename is used in writing data to file, internal gives the command whether the data should be returned as an internal structure. The progress setting defines whether the download progress should be shown or not.</p>
<div class="sourceCode" id="cb166"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb166-1"><a href="ch-03.html#cb166-1" aria-hidden="true" tabindex="-1"></a>df_ndvi <span class="ot">&lt;-</span> <span class="fu">mt_subset</span>(<span class="at">product =</span> <span class="st">&quot;MOD13Q1&quot;</span>,            <span class="co"># the chosen product</span></span>
<span id="cb166-2"><a href="ch-03.html#cb166-2" aria-hidden="true" tabindex="-1"></a>                  <span class="at">lat =</span> lat_lae,                     <span class="co"># desired lat/lon</span></span>
<span id="cb166-3"><a href="ch-03.html#cb166-3" aria-hidden="true" tabindex="-1"></a>                  <span class="at">lon =</span> lon_lae,</span>
<span id="cb166-4"><a href="ch-03.html#cb166-4" aria-hidden="true" tabindex="-1"></a>                  <span class="at">band =</span> <span class="st">&quot;250m_16_days_NDVI&quot;</span>,        <span class="co"># chosen band defining spatial and temporal scale</span></span>
<span id="cb166-5"><a href="ch-03.html#cb166-5" aria-hidden="true" tabindex="-1"></a>                  <span class="at">start =</span> <span class="st">&quot;2009-01-01&quot;</span>,              <span class="co"># start date: 1st Jan 2009</span></span>
<span id="cb166-6"><a href="ch-03.html#cb166-6" aria-hidden="true" tabindex="-1"></a>                  <span class="at">end =</span> <span class="st">&quot;2014-12-19&quot;</span>,                <span class="co"># end date: 19th Dec 2014</span></span>
<span id="cb166-7"><a href="ch-03.html#cb166-7" aria-hidden="true" tabindex="-1"></a>                  <span class="at">km_lr =</span> <span class="dv">1</span>,                         <span class="co"># kilometers left &amp; right of the chosen location (lat/lon above)</span></span>
<span id="cb166-8"><a href="ch-03.html#cb166-8" aria-hidden="true" tabindex="-1"></a>                  <span class="at">km_ab =</span> <span class="dv">1</span>,                         <span class="co"># kilometers above and below the location</span></span>
<span id="cb166-9"><a href="ch-03.html#cb166-9" aria-hidden="true" tabindex="-1"></a>                  <span class="at">site_name =</span> <span class="st">&quot;CH-Lae&quot;</span>,              <span class="co"># the site name we want to give the data</span></span>
<span id="cb166-10"><a href="ch-03.html#cb166-10" aria-hidden="true" tabindex="-1"></a>                  <span class="at">internal =</span> <span class="cn">TRUE</span>,</span>
<span id="cb166-11"><a href="ch-03.html#cb166-11" aria-hidden="true" tabindex="-1"></a>                  <span class="at">progress =</span> <span class="cn">FALSE</span></span>
<span id="cb166-12"><a href="ch-03.html#cb166-12" aria-hidden="true" tabindex="-1"></a>                  ) <span class="sc">%&gt;%</span> </span>
<span id="cb166-13"><a href="ch-03.html#cb166-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>()</span></code></pre></div>
<div class="sourceCode" id="cb167"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb167-1"><a href="ch-03.html#cb167-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(df_ndvi) <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="dv">2</span><span class="sc">:</span><span class="dv">7</span>) <span class="co"># Only displaying 6 of 21 features</span></span></code></pre></div>
<pre><code>## # A tibble: 6 × 6
##   yllcorner  cellsize      nrows ncols band              units                
##   &lt;chr&gt;      &lt;chr&gt;         &lt;int&gt; &lt;int&gt; &lt;chr&gt;             &lt;chr&gt;                
## 1 5278290.12 231.656358264     9     9 250m_16_days_NDVI NDVI ratio - No units
## 2 5278290.12 231.656358264     9     9 250m_16_days_NDVI NDVI ratio - No units
## 3 5278290.12 231.656358264     9     9 250m_16_days_NDVI NDVI ratio - No units
## 4 5278290.12 231.656358264     9     9 250m_16_days_NDVI NDVI ratio - No units
## 5 5278290.12 231.656358264     9     9 250m_16_days_NDVI NDVI ratio - No units
## 6 5278290.12 231.656358264     9     9 250m_16_days_NDVI NDVI ratio - No units</code></pre>
<p>This data frame appears complicated, but we can transform the data into a useful spatial format. For that it needs to be converted to a raster. This is a key spatial data type and will be described in more detail in the section Raster below.
The <code>MODISTools</code> packages provides a handy function, called <code>mt_to_raster()</code>, for converting such data frames produced by <code>mt_subset()</code> into a raster.</p>
<p>By plotting the data we can verify that we loaded a square of NDVI data around our tower for every 16-day time step.
We plot four images in the winter season.</p>
<div class="sourceCode" id="cb169"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb169-1"><a href="ch-03.html#cb169-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(raster_ndvi[[<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>]], <span class="at">zlim=</span><span class="fu">c</span>(<span class="sc">-</span><span class="fl">0.1</span>, <span class="fl">0.95</span>))</span></code></pre></div>
<p><img src="esds_book_files/figure-html/unnamed-chunk-119-1.png" width="50%" style="display: block; margin: auto;" /></p>
<p>We can derive a variety of statisctics and for instance calculate the minimum and maximum of these rasters.</p>
<div class="sourceCode" id="cb170"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb170-1"><a href="ch-03.html#cb170-1" aria-hidden="true" tabindex="-1"></a>min_winter <span class="ot">&lt;-</span> <span class="fu">min</span>(<span class="fu">minValue</span>(raster_ndvi[[<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>]]))</span>
<span id="cb170-2"><a href="ch-03.html#cb170-2" aria-hidden="true" tabindex="-1"></a>max_winter <span class="ot">&lt;-</span> <span class="fu">max</span>(<span class="fu">maxValue</span>(raster_ndvi[[<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>]]))</span>
<span id="cb170-3"><a href="ch-03.html#cb170-3" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot; Minimum Winter: &quot;</span>, min_winter, <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>,</span>
<span id="cb170-4"><a href="ch-03.html#cb170-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;Maximum Winter: &quot;</span>, max_winter)</span></code></pre></div>
<pre><code>##  Minimum Winter:  -0.06791774 
##  Maximum Winter:  0.6837171</code></pre>
<p>The same can be done for the summer season.</p>
<div class="sourceCode" id="cb172"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb172-1"><a href="ch-03.html#cb172-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(raster_ndvi[[<span class="dv">13</span><span class="sc">:</span><span class="dv">16</span>]], <span class="at">zlim=</span><span class="fu">c</span>(<span class="sc">-</span><span class="fl">0.1</span>, <span class="fl">0.95</span>))</span></code></pre></div>
<p><img src="esds_book_files/figure-html/unnamed-chunk-121-1.png" width="50%" style="display: block; margin: auto;" /></p>
<p>We again compute minimum and maximum.</p>
<div class="sourceCode" id="cb173"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb173-1"><a href="ch-03.html#cb173-1" aria-hidden="true" tabindex="-1"></a>min_summer <span class="ot">&lt;-</span> <span class="fu">min</span>(<span class="fu">minValue</span>(raster_ndvi[[<span class="dv">13</span><span class="sc">:</span><span class="dv">16</span>]]))</span>
<span id="cb173-2"><a href="ch-03.html#cb173-2" aria-hidden="true" tabindex="-1"></a>max_summer <span class="ot">&lt;-</span> <span class="fu">max</span>(<span class="fu">maxValue</span>(raster_ndvi[[<span class="dv">13</span><span class="sc">:</span><span class="dv">16</span>]]))</span>
<span id="cb173-3"><a href="ch-03.html#cb173-3" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot; Minimum Summer: &quot;</span>, min_summer, <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>,</span>
<span id="cb173-4"><a href="ch-03.html#cb173-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;Maximum Summer: &quot;</span>, max_summer)</span></code></pre></div>
<pre><code>##  Minimum Summer:  0.569611 
##  Maximum Summer:  0.9034679</code></pre>
<p>From the two plots, we can clearly distinguish summer and winter time steps due to the differences in NDVI. Summer NDVI is higher since our tower site is located in the Northern hemisphere where leaves get lost during winter for many vegetation types. The range in winter is also larger which might be due to conifers that do not lose their leaves during this season.</p>
<p>We are also interested in the mean across all (spatial) pixels for each date. For this we can collapse the pixel dimension into a single mean value for each date. This is done using <code>group_by()</code> in combination with <code>summarise()</code>, which were explained in Chapter <a href="ch-02.html#ch-02">2</a>.</p>
<div class="sourceCode" id="cb175"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb175-1"><a href="ch-03.html#cb175-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lubridate) <span class="co"># lubridate is loaded to work with dates</span></span>
<span id="cb175-2"><a href="ch-03.html#cb175-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-3"><a href="ch-03.html#cb175-3" aria-hidden="true" tabindex="-1"></a><span class="do">## first determine the scaling factor that is to be applied to the NDVI values. This has practical reasons: reduces disk space</span></span>
<span id="cb175-4"><a href="ch-03.html#cb175-4" aria-hidden="true" tabindex="-1"></a>scale_factor <span class="ot">&lt;-</span> bands <span class="sc">%&gt;%</span> </span>
<span id="cb175-5"><a href="ch-03.html#cb175-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(band <span class="sc">==</span> <span class="st">&quot;250m_16_days_NDVI&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb175-6"><a href="ch-03.html#cb175-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(scale_factor) <span class="sc">%&gt;%</span> </span>
<span id="cb175-7"><a href="ch-03.html#cb175-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.numeric</span>()</span>
<span id="cb175-8"><a href="ch-03.html#cb175-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb175-9"><a href="ch-03.html#cb175-9" aria-hidden="true" tabindex="-1"></a>df_ndvi_spatialmean <span class="ot">&lt;-</span> df_ndvi <span class="sc">%&gt;%</span> </span>
<span id="cb175-10"><a href="ch-03.html#cb175-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">calendar_date =</span> <span class="fu">ymd</span>(calendar_date)) <span class="sc">%&gt;%</span>  <span class="co"># make the dates into comprehensible values not X.yyyy.mm.dd</span></span>
<span id="cb175-11"><a href="ch-03.html#cb175-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(calendar_date) <span class="sc">%&gt;%</span>                     <span class="co"># group the data by day </span></span>
<span id="cb175-12"><a href="ch-03.html#cb175-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">mean =</span> <span class="fu">mean</span>(value), <span class="at">min =</span> <span class="fu">min</span>(value), <span class="at">max =</span> <span class="fu">max</span>(value)) <span class="sc">%&gt;%</span>   <span class="co"># calculate mean, min and max across pixels</span></span>
<span id="cb175-13"><a href="ch-03.html#cb175-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">mean =</span> mean <span class="sc">*</span> scale_factor, <span class="at">min =</span> min <span class="sc">*</span> scale_factor, <span class="at">max =</span> max <span class="sc">*</span> scale_factor)  <span class="co"># apply scale_factor (see )</span></span></code></pre></div>
<p>We can now plot our NDVI time series across our years (2009 to 2014) using the mean NDVI values from the rasters calculated.</p>
<div class="sourceCode" id="cb176"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb176-1"><a href="ch-03.html#cb176-1" aria-hidden="true" tabindex="-1"></a>df_ndvi_spatialmean <span class="sc">%&gt;%</span> </span>
<span id="cb176-2"><a href="ch-03.html#cb176-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> calendar_date)) <span class="sc">+</span></span>
<span id="cb176-3"><a href="ch-03.html#cb176-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> min, <span class="at">ymax =</span> max), <span class="at">fill =</span> <span class="st">&quot;grey70&quot;</span>) <span class="sc">+</span></span>
<span id="cb176-4"><a href="ch-03.html#cb176-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> mean))</span></code></pre></div>
<p><img src="esds_book_files/figure-html/unnamed-chunk-124-1.png" width="50%" style="display: block; margin: auto;" /></p>
<p>After having aggregated the data to the mean NDVI across all 81 pixels for each date, we have reduced the dimensions of the data frame to one unique dimension. It now has a structure that can easily be combined with the time series data from the eddy covariance tower (each site is a point in space).</p>
<div class="sourceCode" id="cb177"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb177-1"><a href="ch-03.html#cb177-1" aria-hidden="true" tabindex="-1"></a><span class="co"># this can now be combined to the data frame with flux data that also has dates along rows</span></span>
<span id="cb177-2"><a href="ch-03.html#cb177-2" aria-hidden="true" tabindex="-1"></a>ddf_ch_lae <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">&quot;./data/ddf_ch_lae.csv&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb178"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb178-1"><a href="ch-03.html#cb178-1" aria-hidden="true" tabindex="-1"></a><span class="co"># now we can combine the two data frames along dates. </span></span>
<span id="cb178-2"><a href="ch-03.html#cb178-2" aria-hidden="true" tabindex="-1"></a>ddf_ch_lae_ndvi <span class="ot">&lt;-</span> ddf_ch_lae <span class="sc">%&gt;%</span></span>
<span id="cb178-3"><a href="ch-03.html#cb178-3" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">rename</span>(<span class="at">date =</span> TIMESTAMP) <span class="sc">%&gt;%</span> </span>
<span id="cb178-4"><a href="ch-03.html#cb178-4" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">year =</span> <span class="fu">year</span>(date)) <span class="sc">%&gt;%</span> </span>
<span id="cb178-5"><a href="ch-03.html#cb178-5" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(year <span class="sc">%in%</span> <span class="dv">2009</span><span class="sc">:</span><span class="dv">2014</span>) <span class="sc">%&gt;%</span>  <span class="co"># NDVI data was downloaded only for these years</span></span>
<span id="cb178-6"><a href="ch-03.html#cb178-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(df_ndvi_spatialmean <span class="sc">%&gt;%</span> <span class="fu">rename</span>(<span class="at">date =</span> calendar_date), <span class="at">by =</span> <span class="st">&quot;date&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb178-7"><a href="ch-03.html#cb178-7" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>year)</span></code></pre></div>
<p>NDVI data is provided every 16 days, but the eddy towers provide continuous measurements. In order to predict values at other time steps, we can fit a cubic smoothing spline to our daily values using <code>smooth.spline()</code>. In a nutshell, this is a way to fit a curve between two data points using cubic functions.</p>
<p>Cubic smoothing splines embody a curve fitting technique that blends the ideas of cubic splines and curvature minimization to create an effective data modeling tool for noisy data. Traditional interpolating cubic splines represent the tabulated data as a piece-wise continuous curve which passes through each value in the data table. The curve spanning each data interval is represented by a cubic polynomial, with the requirement that the endpoints of adjacent cubic polynomials match in location and in their first and second derivatives. For more, have a look at this <a href="https://towardsdatascience.com/numerical-interpolation-natural-cubic-spline-52c1157b98ac">blogpost</a>.</p>
<div class="sourceCode" id="cb179"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb179-1"><a href="ch-03.html#cb179-1" aria-hidden="true" tabindex="-1"></a>ddf_ch_lae_ndvi <span class="ot">&lt;-</span> ddf_ch_lae_ndvi <span class="sc">%&gt;%</span> </span>
<span id="cb179-2"><a href="ch-03.html#cb179-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">date_dec =</span> <span class="fu">decimal_date</span>(date))     <span class="co"># adds a column with the date converted into a decimal of its year</span></span>
<span id="cb179-3"><a href="ch-03.html#cb179-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb179-4"><a href="ch-03.html#cb179-4" aria-hidden="true" tabindex="-1"></a>df_nona <span class="ot">&lt;-</span> ddf_ch_lae_ndvi <span class="sc">%&gt;%</span> </span>
<span id="cb179-5"><a href="ch-03.html#cb179-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">drop_na</span>()                                 <span class="co"># removes any rows containing NAs</span></span>
<span id="cb179-6"><a href="ch-03.html#cb179-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb179-7"><a href="ch-03.html#cb179-7" aria-hidden="true" tabindex="-1"></a>out_spline <span class="ot">&lt;-</span> <span class="fu">smooth.spline</span>(df_nona<span class="sc">$</span>date_dec, df_nona<span class="sc">$</span>mean, <span class="at">spar=</span><span class="fl">0.1</span> )   <span class="co"># fits a cubic smoothing spline to df</span></span>
<span id="cb179-8"><a href="ch-03.html#cb179-8" aria-hidden="true" tabindex="-1"></a>vals_spline <span class="ot">&lt;-</span> <span class="fu">predict</span>(out_spline, ddf_ch_lae_ndvi<span class="sc">$</span>date_dec )<span class="sc">$</span>y          <span class="co"># applies the cubic smoothing spline to our data</span></span>
<span id="cb179-9"><a href="ch-03.html#cb179-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb179-10"><a href="ch-03.html#cb179-10" aria-hidden="true" tabindex="-1"></a>ddf_ch_lae_ndvi <span class="ot">&lt;-</span> ddf_ch_lae_ndvi <span class="sc">%&gt;%</span> </span>
<span id="cb179-11"><a href="ch-03.html#cb179-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">ndvi_splined =</span> vals_spline)        <span class="co"># adds the spline values for our data to ddf_ch_lae_ndvi</span></span></code></pre></div>
<p>Now, we can plot this relationship.</p>
<div class="sourceCode" id="cb180"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb180-1"><a href="ch-03.html#cb180-1" aria-hidden="true" tabindex="-1"></a>ddf_ch_lae_ndvi <span class="sc">%&gt;%</span> </span>
<span id="cb180-2"><a href="ch-03.html#cb180-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb180-3"><a href="ch-03.html#cb180-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> date, <span class="at">y =</span> mean)) <span class="sc">+</span></span>
<span id="cb180-4"><a href="ch-03.html#cb180-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> date, <span class="at">y =</span> ndvi_splined), <span class="at">color =</span> <span class="st">&quot;red&quot;</span>)</span></code></pre></div>
<p><img src="esds_book_files/figure-html/unnamed-chunk-128-1.png" width="50%" style="display: block; margin: auto;" />
Note how the red line is smoothed and closely follows the black data points.</p>
<p>To see how well this data correlates with measurements from the fluxnet tower, we look at the relationship of GPP (gross primary productivity) vs. NDVI (Normalized Difference Vegetation Index) * PPFD (photosynthetic photon flux density).</p>
<div class="sourceCode" id="cb181"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb181-1"><a href="ch-03.html#cb181-1" aria-hidden="true" tabindex="-1"></a>ddf_ch_lae_ndvi <span class="ot">&lt;-</span> ddf_ch_lae_ndvi <span class="sc">%&gt;%</span> </span>
<span id="cb181-2"><a href="ch-03.html#cb181-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">ppfd_abs =</span> ndvi_splined <span class="sc">*</span> PPFD_IN)</span></code></pre></div>
<p>In order to investigate whether NDVI is associated with GPP and PPFD, we can fit a linear model.</p>
<div class="sourceCode" id="cb182"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb182-1"><a href="ch-03.html#cb182-1" aria-hidden="true" tabindex="-1"></a>linmod1 <span class="ot">&lt;-</span> <span class="fu">lm</span>(GPP_NT_VUT_REF <span class="sc">~</span> PPFD_IN, <span class="at">data =</span> ddf_ch_lae_ndvi)</span>
<span id="cb182-2"><a href="ch-03.html#cb182-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(linmod1)</span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = GPP_NT_VUT_REF ~ PPFD_IN, data = ddf_ch_lae_ndvi)
## 
## Residuals:
##      Min       1Q   Median       3Q      Max 
## -10.3749  -2.0413  -0.0137   1.9913  14.8576 
## 
## Coefficients:
##              Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept) 0.9348433  0.1097112   8.521   &lt;2e-16 ***
## PPFD_IN     0.0148270  0.0003038  48.797   &lt;2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 3.06 on 2173 degrees of freedom
##   (16 observations deleted due to missingness)
## Multiple R-squared:  0.5229, Adjusted R-squared:  0.5226 
## F-statistic:  2381 on 1 and 2173 DF,  p-value: &lt; 2.2e-16</code></pre>
<p>The summary contains the following information:</p>
<ul>
<li>Call: this is the formula R uses to fit the data.</li>
<li>Residuals: residuals are essentially the difference between the actual observed response values and the response values that the model predicts.</li>
<li>Coefficients: the coefficients are the two unknown constants that represent the intercept and slope terms in the linear model. Besides the estimates of the two unknown constants (-5.078 and 15.412), the standard error of the estimates and measures of statistical significance (t value and Pr(&gt;|t|)) are given. The coefficient standard error measures the average amount that the coefficient estimates vary from the actual average value of our response variable. The coefficient t-value is a measure of how many standard deviations our coefficient estimate is away from zero. The larger the absolute value of t, the smaller gets the probability of observing any value larger than |t| by chance, which is expressed by Pr(&gt;|t|). The signif. codes or p-values (stars behind the coefficients) are associated to each estimate and categorize the probabilities Pr(&gt;|t|) by significance thresholds.</li>
<li>Residual standard error: the Residual Standard Error is the average amount that the response will deviate from the true regression line. It is a measure of the quality of a linear regression fit.</li>
<li>Multiple R-squared : the R^2 quantifies what proportion of the variance found in the response variable can be explained by the predictor variable. It is a measure of how well the model is fitting the actual data.</li>
<li>F-statistic: F-statistic is a good indicator of whether there is a relationship between our predictor and the response variables. The further the F-statistics from 1 the better it is. However it depends on the number of data points and the number of predictors how much larger the F-statistics has to be in order to ascertain a relationship between the predictor and the response variables.</li>
</ul>
<div class="sourceCode" id="cb184"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb184-1"><a href="ch-03.html#cb184-1" aria-hidden="true" tabindex="-1"></a>linmod2 <span class="ot">&lt;-</span> <span class="fu">lm</span>(GPP_NT_VUT_REF <span class="sc">~</span> ppfd_abs, <span class="at">data =</span> ddf_ch_lae_ndvi)</span>
<span id="cb184-2"><a href="ch-03.html#cb184-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(linmod2)</span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = GPP_NT_VUT_REF ~ ppfd_abs, data = ddf_ch_lae_ndvi)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -8.9202 -1.8307 -0.0829  1.7236 14.4273 
## 
## Coefficients:
##              Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept) 1.3395678  0.0903180   14.83   &lt;2e-16 ***
## ppfd_abs    0.0180868  0.0003148   57.45   &lt;2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 2.792 on 2173 degrees of freedom
##   (16 observations deleted due to missingness)
## Multiple R-squared:  0.603,  Adjusted R-squared:  0.6028 
## F-statistic:  3301 on 1 and 2173 DF,  p-value: &lt; 2.2e-16</code></pre>
<p>R2 increased from 0.5229 to 0.603 when including considering NDVI * PPFD, instead of just PPFD. Hence, it also matters whether leaves are actually out and green for modelling the relationship between GPP and PPFD. NDVI * PPFD approximates the amount of <em>absorbed</em> incoming light, not just the incoming light, and is therefore a physiologically more relevant quantity.</p>
</div>
<div id="points-on-the-globe" class="section level3" number="3.2.3">
<h3><span class="header-section-number">3.2.3</span> Points on the globe</h3>
<p>Documenting the geographic coordinates of data allows us to assign a precise location to that data observation, which can be important for further analysis when, for example, comparing location. Coordinates come with a latitude (defining the position N or S of the equator) and longitude (defining the position E or W of the meridian). With the coordinates, we can plot data points, remembering that the latitude is equivalent to the y-axis and longitude to the x-axis.</p>
<p>In this section, we look at the position of the Fluxnet sites. The Fluxnet network measures land-atmosphere exchanges of greenhouse gases and energy for sites across the globe using the eddy covariance technique. High-frequency measurements of vertical wind velocity and a scalar mixing ratio (CO2, H2O, temperature, etc.) provides estimates of the net exchange of the scalar. Eddy covariance is currently the standard method to measure fluxes of trace gases between ecosystems and the atmosphere (sources:
<a href="https://fluxnet.org/about/">Fluxnet</a>, Nature Article by <span class="citation">Pastorello et al. (<a href="#ref-Pastorello2020" role="doc-biblioref">2020</a>)</span> on <a href="https://www.nature.com/articles/s41597-020-0534-3.pdf">Fluxnet Dataset</a>.</p>
<p>At the beginning of this tutorial we loaded the dataset containing information on sites in Europe. We treat site locations as a geographical position. So we will extract the name, longitude and latitude of our sites.</p>
<div class="sourceCode" id="cb186"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb186-1"><a href="ch-03.html#cb186-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(df_sites)</span></code></pre></div>
<pre><code>## # A tibble: 6 × 3
##   site     lon   lat
##   &lt;chr&gt;  &lt;dbl&gt; &lt;dbl&gt;
## 1 BE-Bra  4.52  51.3
## 2 BE-Lon  4.75  50.6
## 3 BE-Vie  6.00  50.3
## 4 CH-Cha  8.41  47.2
## 5 CH-Fru  8.54  47.1
## 6 CH-Lae  8.36  47.5</code></pre>
<p>Our dataset <em>‘df_sites’</em> contains two sites in Greenland and Siberia. We’ll focus on a smaller spatial domain, restricted to “mainland” Europe. Therefore, we exclude sites RU-Cok and DK-ZaH. We will also remove DE-Obe since this was removed in previous chapters.</p>
<div class="sourceCode" id="cb188"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb188-1"><a href="ch-03.html#cb188-1" aria-hidden="true" tabindex="-1"></a>df_sites <span class="ot">&lt;-</span> df_sites <span class="sc">%&gt;%</span> </span>
<span id="cb188-2"><a href="ch-03.html#cb188-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span>(site <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;RU-Cok&quot;</span>, <span class="st">&quot;DK-ZaH&quot;</span>, <span class="st">&quot;DE-Obe&quot;</span>)))</span></code></pre></div>
<p>Now we can plot our data points without any further adjustments.</p>
<div class="sourceCode" id="cb189"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb189-1"><a href="ch-03.html#cb189-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb189-2"><a href="ch-03.html#cb189-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> df_sites, <span class="fu">aes</span>(<span class="at">x =</span> lon, <span class="at">y =</span> lat), <span class="at">color =</span> <span class="st">&quot;red&quot;</span>) <span class="sc">+</span></span>
<span id="cb189-3"><a href="ch-03.html#cb189-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Selected FLUXNET sites&quot;</span>, <span class="at">x =</span> <span class="st">&quot;Longitude&quot;</span>, <span class="at">y =</span> <span class="st">&quot;Latitude&quot;</span>)<span class="sc">+</span></span>
<span id="cb189-4"><a href="ch-03.html#cb189-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span></code></pre></div>
<p><img src="esds_book_files/figure-html/unnamed-chunk-134-1.png" width="50%" style="display: block; margin: auto;" /></p>
<p>We can make an educated guess where the points are but this plot does not tell us much by itself without a map as a reference.</p>
<p>To visualize the location of our points we plot them on a map. We use the packages <strong>sf</strong> <span class="citation">(<a href="#ref-R-sf" role="doc-biblioref">Pebesma 2018</a>)</span> and <strong>SpData</strong> <span class="citation">(<a href="#ref-R-SpData" role="doc-biblioref"><strong>R-SpData?</strong></a>)</span> to get the world map and crop it to Europe.</p>
<div class="sourceCode" id="cb190"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb190-1"><a href="ch-03.html#cb190-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sf)</span>
<span id="cb190-2"><a href="ch-03.html#cb190-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(spData)</span>
<span id="cb190-3"><a href="ch-03.html#cb190-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb190-4"><a href="ch-03.html#cb190-4" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb190-5"><a href="ch-03.html#cb190-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> world) <span class="sc">+</span></span>
<span id="cb190-6"><a href="ch-03.html#cb190-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> df_sites, <span class="fu">aes</span>(<span class="at">x =</span> lon, <span class="at">y =</span> lat), <span class="at">color =</span> <span class="st">&quot;red&quot;</span>) <span class="sc">+</span></span>
<span id="cb190-7"><a href="ch-03.html#cb190-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Longitude&quot;</span>, <span class="at">y =</span> <span class="st">&quot;Latitude&quot;</span>) <span class="sc">+</span></span>
<span id="cb190-8"><a href="ch-03.html#cb190-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_sf</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">30</span>,<span class="dv">40</span>), <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">35</span>,<span class="dv">80</span>), <span class="at">expand =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb190-9"><a href="ch-03.html#cb190-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span></code></pre></div>
<p><img src="esds_book_files/figure-html/unnamed-chunk-135-1.png" width="50%" style="display: block; margin: auto;" /></p>
<p>We can carry on using the data points as they are (for plotting or analysis) but for more detailed spatial analysis we will transform them into a <em>SpatialPoints</em> format.</p>
<p><em>SpatialPoints</em> consist of a matrix with <em>n</em> rows and 2 columns, one for each coordinate (latitude &amp; longitude). <em>n</em> is the number of points in the data. These points also have a so-called <em>‘projection string’</em> or <em>‘crs’</em> indicating the coordinate reference system in which coordinates of points are expressed.
There are different ways (formulas) to project the earth (an ellipsoid) onto a 2-dimensional map. We can only perform calculations, if the same method (projection, coordinate reference system (crs)) is used. Having points in different coordinate reference systems can cause data to look skewed. It is essential to know which coordinate reference system your data is in. The most commonly used one is <strong>WGS84 (EPSG: 4326)</strong>. There are some useful resources to convert help you find the correct <a href="https://spatialreference.org/ref/epsg/4326/">spatial reference</a>.</p>
<p>To transform points into <em>SpatialPoints</em>, we use the function <code>SpatialPoints</code> in the R package <strong>sp</strong> <span class="citation">(<a href="#ref-Bivand2013" role="doc-biblioref">R. S. Bivand, Pebesma, and Gómez-Rubio 2013</a>; <a href="#ref-Pebesma2005" role="doc-biblioref">Pebesma and Bivand 2005</a>)</span>.</p>
<div class="sourceCode" id="cb191"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb191-1"><a href="ch-03.html#cb191-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sp)</span>
<span id="cb191-2"><a href="ch-03.html#cb191-2" aria-hidden="true" tabindex="-1"></a>sp_sites <span class="ot">&lt;-</span> <span class="fu">SpatialPoints</span>(dplyr<span class="sc">::</span><span class="fu">select</span>(df_sites, <span class="sc">-</span>site)) <span class="co"># remove character column</span></span></code></pre></div>
<p>Below you can see how the R-base call <code>plot()</code>, plots the <em>SpatialPoints</em> directly.</p>
<div class="sourceCode" id="cb192"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb192-1"><a href="ch-03.html#cb192-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(sp_sites, <span class="at">col =</span> <span class="st">&quot;red&quot;</span>, <span class="at">pch =</span> <span class="dv">16</span>)</span></code></pre></div>
<p><img src="esds_book_files/figure-html/unnamed-chunk-137-1.png" width="50%" style="display: block; margin: auto;" /></p>
<p>If, however, we want to make the point’s locations visually meaningful, we have to provide a map to plot as a background. To load a raster file in R, we will use the package <strong>rgdal</strong> <span class="citation">(<a href="#ref-R-rgdal" role="doc-biblioref">R. Bivand, Keitt, and Rowlingson 2021</a>)</span>. The shapefile of Europe we will load, will also be used in the next section called Shapefiles.</p>
<div class="sourceCode" id="cb193"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb193-1"><a href="ch-03.html#cb193-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rgdal)</span>
<span id="cb193-2"><a href="ch-03.html#cb193-2" aria-hidden="true" tabindex="-1"></a>europe_shape <span class="ot">&lt;-</span> <span class="fu">readOGR</span>(<span class="at">dsn=</span><span class="st">&quot;./data/shapefiles&quot;</span>, <span class="at">layer=</span><span class="st">&quot;europe_map&quot;</span>) <span class="co"># imports the shapefile of the European map</span></span></code></pre></div>
<pre><code>## OGR data source with driver: ESRI Shapefile 
## Source: &quot;/Users/pascalschneider/Polybox/Shared/Data Science Lecture Planning - shared folder/4 Datasets/shapefiles&quot;, layer: &quot;europe_map&quot;
## with 53 features
## It has 94 fields</code></pre>
<div class="sourceCode" id="cb195"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb195-1"><a href="ch-03.html#cb195-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(europe_shape, <span class="at">col=</span><span class="st">&quot;grey&quot;</span>)                                       <span class="co"># plots the European map as the background</span></span>
<span id="cb195-2"><a href="ch-03.html#cb195-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(sp_sites, <span class="at">col =</span> <span class="st">&quot;red&quot;</span>, <span class="at">add =</span> <span class="cn">TRUE</span>, <span class="at">pch =</span> <span class="dv">16</span>)                    <span class="co"># plots the points (here tower locations) on to the map</span></span></code></pre></div>
<p><img src="esds_book_files/figure-html/unnamed-chunk-138-1.png" width="50%" style="display: block; margin: auto;" />
Now, we can see the tower locations as red circles plotted on a grey European map with country boarders, which puts the data points in a meaningful and comprehendable visual context.</p>
</div>
<div id="shapefiles" class="section level3" number="3.2.4">
<h3><span class="header-section-number">3.2.4</span> Shapefiles</h3>
<p>Above we looked at points on the globe and transformed our data to <em>SpatialPoints</em>. This was already the first example of what forms a shapefile can come in. Shapefiles store geographic information, including location and any additional information, in shape objects. Shape objects in R are defined by <em>SpatialPoints</em>, <em>SpatialLines</em>, and <em>SpatialPolygons</em> classes of the <strong>sp</strong> package . The corresponding <em>SpatialPointsDataFrame</em>, <em>SpatialLinesDataFrame</em>, and <em>SpatialPolygonsDataFrame</em> classes allow storing shape objects together with a data frame. The number of rows in the data frame corresponds to the number of points (number of rows in coordinate matrix), lines (size of the list of Lines), or polygons (size of the list of Polygons). This allows us to associate a vector of variables (a row of the data frame) to each shape object.
In the next step, we load a shapefile containing the countries of the world provided by <a href="www.naturalearthdata.com">Natural Earth</a>, as a reference with which we can contextualize our spatial data. Since we only are looking at towers in Europe, we have cropped the raster to Europe for you.</p>
<div class="sourceCode" id="cb196"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb196-1"><a href="ch-03.html#cb196-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rgdal)</span>
<span id="cb196-2"><a href="ch-03.html#cb196-2" aria-hidden="true" tabindex="-1"></a>europe_shape <span class="ot">&lt;-</span> <span class="fu">readOGR</span>(<span class="at">dsn=</span><span class="st">&quot;./data/shapefiles&quot;</span>, <span class="at">layer=</span><span class="st">&quot;europe_map&quot;</span>)</span></code></pre></div>
<pre><code>## OGR data source with driver: ESRI Shapefile 
## Source: &quot;/Users/pascalschneider/Polybox/Shared/Data Science Lecture Planning - shared folder/4 Datasets/shapefiles&quot;, layer: &quot;europe_map&quot;
## with 53 features
## It has 94 fields</code></pre>
<p>We can look at what class <em>europe_shape</em> is:</p>
<div class="sourceCode" id="cb198"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb198-1"><a href="ch-03.html#cb198-1" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(europe_shape)</span></code></pre></div>
<pre><code>## [1] &quot;SpatialPolygonsDataFrame&quot;
## attr(,&quot;package&quot;)
## [1] &quot;sp&quot;</code></pre>
<p>Above we mentioned that <em>SpatialPolygonsDataFrame</em> contains both a list of <em>SpatialPolygons</em> and a with information on each polygon. Here is how we can access the information in the . We will start by displaying the header of some of the 94 features for now.</p>
<div class="sourceCode" id="cb200"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb200-1"><a href="ch-03.html#cb200-1" aria-hidden="true" tabindex="-1"></a>europe_shape<span class="sc">@</span>data <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="fu">c</span>(NAME, SOVEREIGNT, SUBREGION, POP_EST))<span class="sc">%&gt;%</span> <span class="fu">head</span>()</span></code></pre></div>
<pre><code>##             NAME     SOVEREIGNT       SUBREGION  POP_EST
## 0        Vatican        Vatican Southern Europe     1000
## 1         Jersey United Kingdom Northern Europe    98840
## 2       Guernsey United Kingdom Northern Europe    66502
## 3    Isle of Man United Kingdom Northern Europe    88815
## 4 United Kingdom United Kingdom Northern Europe 64769452
## 5        Ukraine        Ukraine  Eastern Europe 44033874</code></pre>
<p>Now, we want to plot our towers on this map of Europe. First, we need to extract the projection from <em>europe_shape</em> using <code>proj4string()</code> and add it to our <em>SpatialPoints</em>. Thereby ensuring they are in the same reference system to plot them together.</p>
<div class="sourceCode" id="cb202"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb202-1"><a href="ch-03.html#cb202-1" aria-hidden="true" tabindex="-1"></a>geo.proj <span class="ot">&lt;-</span> sp<span class="sc">::</span><span class="fu">proj4string</span>(europe_shape)</span>
<span id="cb202-2"><a href="ch-03.html#cb202-2" aria-hidden="true" tabindex="-1"></a>pts <span class="ot">&lt;-</span> sp<span class="sc">::</span><span class="fu">SpatialPoints</span>(sp_sites, <span class="at">proj4string =</span> sp<span class="sc">::</span><span class="fu">CRS</span>(geo.proj))</span></code></pre></div>
<p>By using the <em>SpatialPoints</em>, now in the correct coordinate reference system, and the data from <em>europe_shape</em>, we can bind them to our tower sites in the data frame <em>df_sites</em>. The function <code>over</code>from the package <code>sp</code>, retrieves the indexes or attributes from the specified spatial object (<em>europe shape</em>) at the spatial locations of a specified object (<em>pts</em>).</p>
<div class="sourceCode" id="cb203"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb203-1"><a href="ch-03.html#cb203-1" aria-hidden="true" tabindex="-1"></a>df_sites_country_info <span class="ot">&lt;-</span> sp<span class="sc">::</span><span class="fu">over</span>(pts, europe_shape) <span class="sc">%&gt;%</span>  <span class="co"># retrieves info from &#39;europe_shape&#39; at the &#39;pts&#39; locations</span></span>
<span id="cb203-2"><a href="ch-03.html#cb203-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span>                                       <span class="co"># makes a tibble</span></span>
<span id="cb203-3"><a href="ch-03.html#cb203-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">bind_cols</span>(df_sites, .)                                <span class="co"># bind the information gathered to the df_sites</span></span>
<span id="cb203-4"><a href="ch-03.html#cb203-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb203-5"><a href="ch-03.html#cb203-5" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(df_sites_country_info) <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>)</span></code></pre></div>
<pre><code>## # A tibble: 6 × 6
##   site     lon   lat featurecla      scalerank LABELRANK
##   &lt;chr&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;               &lt;int&gt;     &lt;int&gt;
## 1 BE-Bra  4.52  51.3 Admin-0 country         1         2
## 2 BE-Lon  4.75  50.6 Admin-0 country         1         2
## 3 BE-Vie  6.00  50.3 Admin-0 country         1         2
## 4 CH-Cha  8.41  47.2 Admin-0 country         1         4
## 5 CH-Fru  8.54  47.1 Admin-0 country         1         4
## 6 CH-Lae  8.36  47.5 Admin-0 country         1         4</code></pre>
<p>In the header above, is the new data frame <em>df_sites_country_info</em> consisting of three columns (‘site’, ‘lat’, ‘lon’) from <em>df_sites</em> and then 91 columns containing information from <em>europe_shape</em> at the spatial locations of <em>pts</em> (the tower sites).</p>
<p>For the next part, we will be using a European map with country boarders. For this, we will make an object called <em>shp_df</em> using the column <em>SOVEREIGNT</em>, which we saw when looking at <code>europe_shape@data</code>. The package <strong>broom</strong> <span class="citation">(<a href="#ref-R-broom" role="doc-biblioref">Robinson, Hayes, and Couch 2021</a>)</span> converts objects from R into ‘tidy tibbles’, this will allow us to preserves only the data needed for further analysis and plotting.</p>
<div class="sourceCode" id="cb205"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb205-1"><a href="ch-03.html#cb205-1" aria-hidden="true" tabindex="-1"></a>shp_df <span class="ot">&lt;-</span> broom<span class="sc">::</span><span class="fu">tidy</span>(europe_shape, <span class="at">region =</span> <span class="st">&quot;SOVEREIGNT&quot;</span>) <span class="co"># transforms the information in &#39;SOVREIGNT&#39; into a tidy df</span></span>
<span id="cb205-2"><a href="ch-03.html#cb205-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb205-3"><a href="ch-03.html#cb205-3" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(shp_df)</span></code></pre></div>
<pre><code>## # A tibble: 6 × 7
##    long   lat order hole  piece group     id     
##   &lt;dbl&gt; &lt;dbl&gt; &lt;int&gt; &lt;lgl&gt; &lt;fct&gt; &lt;fct&gt;     &lt;chr&gt;  
## 1  19.3  41.9     1 FALSE 1     Albania.1 Albania
## 2  19.3  41.9     2 FALSE 1     Albania.1 Albania
## 3  19.4  42.0     3 FALSE 1     Albania.1 Albania
## 4  19.4  42.0     4 FALSE 1     Albania.1 Albania
## 5  19.4  42.1     5 FALSE 1     Albania.1 Albania
## 6  19.3  42.1     6 FALSE 1     Albania.1 Albania</code></pre>
<p>The data frame above is the tidied version of the information in the <em>SOVEREIGNT</em> column of <em>europe_shape</em>. It contains the coordinates, country (sovereignty) and order of each of the polygons from the <em>SpatialPolygonsDataFrame</em>. Plotting the information in this data frame looks as follows:</p>
<div class="sourceCode" id="cb207"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb207-1"><a href="ch-03.html#cb207-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span> </span>
<span id="cb207-2"><a href="ch-03.html#cb207-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_polygon</span>(<span class="at">data =</span> shp_df, <span class="fu">aes</span>(<span class="at">x =</span> long, <span class="at">y =</span> lat, <span class="at">group =</span> group, <span class="at">fill =</span> id), <span class="at">colour =</span> <span class="st">&quot;black&quot;</span>) <span class="sc">+</span></span>
<span id="cb207-3"><a href="ch-03.html#cb207-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb207-4"><a href="ch-03.html#cb207-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span>)</span></code></pre></div>
<p><img src="esds_book_files/figure-html/unnamed-chunk-145-1.png" width="50%" style="display: block; margin: auto;" />
As we saw in the earlier plot of the tower locations only some countries in Europe contain towers. Therefore, we want to crop our map to only include those countries.</p>
<p>We first create a vector which is lists the country each towers is located in. We obtain this vector from the data frame <em>df_site_country_info</em>. Then, we filter out only those countries with a tower in them. We can plot the countries and tower locations as a result.</p>
<div class="sourceCode" id="cb208"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb208-1"><a href="ch-03.html#cb208-1" aria-hidden="true" tabindex="-1"></a><span class="co"># character vector of the country each tower is located in from column &#39;SOVREIGNT&#39;</span></span>
<span id="cb208-2"><a href="ch-03.html#cb208-2" aria-hidden="true" tabindex="-1"></a>countries_with_site <span class="ot">&lt;-</span> df_sites_country_info <span class="sc">%&gt;%</span> <span class="fu">pull</span>(SOVEREIGNT) <span class="sc">%&gt;%</span> <span class="fu">as.character</span>()   </span>
<span id="cb208-3"><a href="ch-03.html#cb208-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb208-4"><a href="ch-03.html#cb208-4" aria-hidden="true" tabindex="-1"></a><span class="co"># resulting character vector (without NAs)</span></span>
<span id="cb208-5"><a href="ch-03.html#cb208-5" aria-hidden="true" tabindex="-1"></a>countries_with_site <span class="sc">%&gt;%</span> <span class="fu">na.omit</span>()</span></code></pre></div>
<pre><code>##  [1] &quot;Belgium&quot;     &quot;Belgium&quot;     &quot;Belgium&quot;     &quot;Switzerland&quot; &quot;Switzerland&quot;
##  [6] &quot;Switzerland&quot; &quot;Switzerland&quot; &quot;Switzerland&quot; &quot;Switzerland&quot; &quot;Germany&quot;    
## [11] &quot;Germany&quot;     &quot;Germany&quot;     &quot;Germany&quot;     &quot;Denmark&quot;     &quot;Finland&quot;    
## [16] &quot;Finland&quot;     &quot;France&quot;      &quot;France&quot;      &quot;France&quot;      &quot;France&quot;     
## [21] &quot;Italy&quot;       &quot;Italy&quot;       &quot;Italy&quot;       &quot;Italy&quot;       &quot;Italy&quot;      
## [26] &quot;Italy&quot;       &quot;Italy&quot;       &quot;Italy&quot;       &quot;Italy&quot;       &quot;Netherlands&quot;
## [31] &quot;Czechia&quot;    
## attr(,&quot;na.action&quot;)
## [1] 32
## attr(,&quot;class&quot;)
## [1] &quot;omit&quot;</code></pre>
<div class="sourceCode" id="cb210"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb210-1"><a href="ch-03.html#cb210-1" aria-hidden="true" tabindex="-1"></a><span class="co"># country with towers filtered</span></span>
<span id="cb210-2"><a href="ch-03.html#cb210-2" aria-hidden="true" tabindex="-1"></a>shp_df_sub <span class="ot">&lt;-</span> shp_df <span class="sc">%&gt;%</span> </span>
<span id="cb210-3"><a href="ch-03.html#cb210-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(id <span class="sc">%in%</span> countries_with_site)</span>
<span id="cb210-4"><a href="ch-03.html#cb210-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb210-5"><a href="ch-03.html#cb210-5" aria-hidden="true" tabindex="-1"></a><span class="co"># plot result</span></span>
<span id="cb210-6"><a href="ch-03.html#cb210-6" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span> </span>
<span id="cb210-7"><a href="ch-03.html#cb210-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_polygon</span>(<span class="at">data =</span> shp_df_sub, <span class="fu">aes</span>(<span class="at">x =</span> long, <span class="at">y =</span> lat, <span class="at">group =</span> group, <span class="at">fill =</span> id), <span class="at">colour =</span> <span class="st">&quot;black&quot;</span>) <span class="sc">+</span></span>
<span id="cb210-8"><a href="ch-03.html#cb210-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> df_sites, <span class="fu">aes</span>(<span class="at">x =</span> lon, <span class="at">y =</span> lat)) <span class="sc">+</span></span>
<span id="cb210-9"><a href="ch-03.html#cb210-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span></code></pre></div>
<p><img src="esds_book_files/figure-html/unnamed-chunk-146-1.png" width="50%" style="display: block; margin: auto;" /></p>
<p><strong>Checkpoint</strong></p>
<p>You just learnt how to plot <em>europe_shape</em> coloured by country (“SOVREIGNT”), now plot it coloured by region in Europe.
Start by finding the column that gives you this information in <code>europe_shape@data</code>.</p>
<p><strong>Solution</strong></p>
<div class="sourceCode" id="cb211"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb211-1"><a href="ch-03.html#cb211-1" aria-hidden="true" tabindex="-1"></a><span class="co"># take a look at the first 6 column names</span></span>
<span id="cb211-2"><a href="ch-03.html#cb211-2" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(europe_shape<span class="sc">@</span>data)[<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>]</span></code></pre></div>
<pre><code>##  [1] &quot;featurecla&quot; &quot;scalerank&quot;  &quot;LABELRANK&quot;  &quot;SOVEREIGNT&quot; &quot;SOV_A3&quot;    
##  [6] &quot;ADM0_DIF&quot;   &quot;LEVEL&quot;      &quot;TYPE&quot;       &quot;ADMIN&quot;      &quot;ADM0_A3&quot;</code></pre>
<div class="sourceCode" id="cb213"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb213-1"><a href="ch-03.html#cb213-1" aria-hidden="true" tabindex="-1"></a><span class="co"># make a df of the data needed from europe_shape</span></span>
<span id="cb213-2"><a href="ch-03.html#cb213-2" aria-hidden="true" tabindex="-1"></a>shp_df_region <span class="ot">&lt;-</span> broom<span class="sc">::</span><span class="fu">tidy</span>(europe_shape, <span class="at">region =</span> <span class="st">&quot;SUBREGION&quot;</span>)</span>
<span id="cb213-3"><a href="ch-03.html#cb213-3" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(shp_df_region)</span></code></pre></div>
<pre><code>## # A tibble: 6 × 7
##    long   lat order hole  piece group            id            
##   &lt;dbl&gt; &lt;dbl&gt; &lt;int&gt; &lt;lgl&gt; &lt;fct&gt; &lt;fct&gt;            &lt;chr&gt;         
## 1  28    42.0     1 FALSE 1     Eastern Europe.1 Eastern Europe
## 2  27.9  42.0     2 FALSE 1     Eastern Europe.1 Eastern Europe
## 3  27.8  42.0     3 FALSE 1     Eastern Europe.1 Eastern Europe
## 4  27.8  42.0     4 FALSE 1     Eastern Europe.1 Eastern Europe
## 5  27.7  42.0     5 FALSE 1     Eastern Europe.1 Eastern Europe
## 6  27.7  42.0     6 FALSE 1     Eastern Europe.1 Eastern Europe</code></pre>
<div class="sourceCode" id="cb215"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb215-1"><a href="ch-03.html#cb215-1" aria-hidden="true" tabindex="-1"></a><span class="co"># plot europe coloured by region</span></span>
<span id="cb215-2"><a href="ch-03.html#cb215-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span> </span>
<span id="cb215-3"><a href="ch-03.html#cb215-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_polygon</span>(<span class="at">data =</span> shp_df_region, <span class="fu">aes</span>(<span class="at">x =</span> long, <span class="at">y =</span> lat, <span class="at">group =</span> group, <span class="at">fill =</span> id), <span class="at">colour =</span> <span class="st">&quot;black&quot;</span>) <span class="sc">+</span></span>
<span id="cb215-4"><a href="ch-03.html#cb215-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> df_sites, <span class="fu">aes</span>(<span class="at">x =</span> lon, <span class="at">y =</span> lat)) <span class="sc">+</span></span>
<span id="cb215-5"><a href="ch-03.html#cb215-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span></code></pre></div>
<p><img src="esds_book_files/figure-html/unnamed-chunk-147-1.png" width="50%" style="display: block; margin: auto;" />
We now have a map showing the tower’s locations as black circles within the different regions in Europe.</p>
</div>
<div id="rasters" class="section level3" number="3.2.5">
<h3><span class="header-section-number">3.2.5</span> Rasters</h3>
<p>In this section we will learn how to use rasters. A raster is a matrix or grid of cells each of which contains information in the form of a value.</p>
<p>A raster object consists primarily of:</p>
<ul>
<li>A grid of cells;<br />
</li>
<li>A coordinate reference system (CRS) for the grid and its cells so that we know the location to which the grid refers;</li>
<li>A variable of interest for which each cell in the grid has a value, and;</li>
<li>Other information relating to the CRS, projection, resolution, etc.</li>
</ul>
<p>We will load and check some rasters and get familiar with functions to analyse them.</p>
<p>Since our goal ultimate goal is to predict productivity, we will consider different factors that might explain productivity, for example, landcover and temperature.
To start off we’ll look at some landcover data. With this data, we can investigate the surroundings of the Fluxnet towers. This data gives us the different classes of physical coverage of the Earth’s surface, such as forests, grasslands, croplands, lakes, etc. Landcover types affect fluxes measured by the tower through the vegetation that characterizes them, or by influencing the radiation budget through albedo, or water availability. Although we have some information from the overview file of the towers, we can still check whether we can confirm this information. We will load landcover data from GlobCover provided by the <a href="http://due.esrin.esa.int/page_globcover.php">European space agency (ESA)</a>. This project provides landcover maps observations of surface reflectance from the 300m MERIS sensor on board the ENVISAT satellite mission as their input.</p>
<div class="sourceCode" id="cb216"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb216-1"><a href="ch-03.html#cb216-1" aria-hidden="true" tabindex="-1"></a><span class="co"># library(raster) -&gt; we have already done this but remember you need this to load rasters!</span></span>
<span id="cb216-2"><a href="ch-03.html#cb216-2" aria-hidden="true" tabindex="-1"></a>raster_landcover <span class="ot">&lt;-</span> <span class="fu">raster</span>(<span class="st">&quot;./data/Globcover_EU.tif&quot;</span>)</span></code></pre></div>
<p>This landcover data consists of different categories, these GlobCover categories are based on the Land Cover Classification System (LCCS) which was
developed by the Food and Agricultural Organization of the United Nations (FAO) to provide a consistent framework for the classification of mapping land cover. They include various types of forest, shrub- and grasslands, cropland and artificial surfaces.</p>
<p>Before we look at the data, we first reduce the spatial extent that the raster covers. We crop it to a rectangle around the site location of CH-Lae (+/- 2 degrees in longitudinal direction, +/- 1 degree in latitudinal direction).</p>
<div class="sourceCode" id="cb217"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb217-1"><a href="ch-03.html#cb217-1" aria-hidden="true" tabindex="-1"></a>bounding_box <span class="ot">&lt;-</span> <span class="fu">extent</span>(lon_lae<span class="dv">-2</span>, lon_lae<span class="sc">+</span><span class="dv">2</span>, lat_lae<span class="dv">-1</span>, lat_lae<span class="sc">+</span><span class="dv">1</span>)</span>
<span id="cb217-2"><a href="ch-03.html#cb217-2" aria-hidden="true" tabindex="-1"></a>raster_landcover_crop <span class="ot">&lt;-</span> <span class="fu">crop</span>(raster_landcover, bounding_box)</span></code></pre></div>
<p>We can plot our raster as the region around our tower. To indicate the position of our tower, we add a red dot.</p>
<div class="sourceCode" id="cb218"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb218-1"><a href="ch-03.html#cb218-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(raster_landcover_crop, <span class="at">legend=</span><span class="cn">FALSE</span>, <span class="at">xlab=</span><span class="st">&quot;longitude&quot;</span>, <span class="at">ylab=</span><span class="st">&quot;latitude&quot;</span>)</span>
<span id="cb218-2"><a href="ch-03.html#cb218-2" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(lon_lae, lat_lae, <span class="at">pch =</span> <span class="dv">16</span>, <span class="at">col =</span> <span class="st">&quot;red&quot;</span>)</span></code></pre></div>
<p>If we want to conduct analysis using two different rasters, we have to make sure they have the same resolution and are aligned on the same grid. We can read a second raster and compare the grids. We load spatio-temporal temperature rasters available from <a href="https://chelsa-climate.org">CHELSA</a> to complement our flux tower measurements for further analysis.
The temperature raster data from CHELSA provides free high-resolution climate data (temperature and precipitation) for the past and the future. The past data we use here are downscaled model output temperature and precipitation estimates of the ERA-Interim climatic reanalysis (forecast models and data assimilation systems reanalysing archived observations). While the temperature algorithm is based on statistical downscaling of atmospheric temperatures, the precipitation algorithm incorporates orographic predictors including wind fields, valley exposition, and boundary layer height, with subsequent bias correction. The data we use consists of a monthly temperature and precipitation time series over the area of Europe from 2006 to 2012 in January. To compare this new raster with the previous one we need to crop it to the same region as the tower. Cropping rasters can be done using the R package <strong>raster</strong> <span class="citation">(<a href="#ref-R-raster" role="doc-biblioref">Hijmans 2021</a>)</span>.</p>
<div class="sourceCode" id="cb219"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb219-1"><a href="ch-03.html#cb219-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(raster)</span>
<span id="cb219-2"><a href="ch-03.html#cb219-2" aria-hidden="true" tabindex="-1"></a>raster_chelsa <span class="ot">&lt;-</span> <span class="fu">raster</span>(<span class="st">&quot;./data/Chelsa_t_mean_2006-2012.tif&quot;</span>)</span>
<span id="cb219-3"><a href="ch-03.html#cb219-3" aria-hidden="true" tabindex="-1"></a>raster_chelsa_crop <span class="ot">&lt;-</span> <span class="fu">crop</span>(raster_chelsa, bounding_box)</span></code></pre></div>
<p>We now plot our raster.</p>
<div class="sourceCode" id="cb220"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb220-1"><a href="ch-03.html#cb220-1" aria-hidden="true" tabindex="-1"></a>pal <span class="ot">&lt;-</span> <span class="fu">colorRampPalette</span>(<span class="fu">c</span>(<span class="st">&quot;purple&quot;</span>,<span class="st">&quot;blue&quot;</span>,<span class="st">&quot;cyan&quot;</span>,<span class="st">&quot;green&quot;</span>,<span class="st">&quot;yellow&quot;</span>,<span class="st">&quot;red&quot;</span>))</span>
<span id="cb220-2"><a href="ch-03.html#cb220-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(raster_chelsa_crop, <span class="at">col =</span> <span class="fu">pal</span>(<span class="dv">20</span>), <span class="at">xlab=</span><span class="st">&quot;longitude&quot;</span>, <span class="at">ylab=</span><span class="st">&quot;latitude&quot;</span>)</span>
<span id="cb220-3"><a href="ch-03.html#cb220-3" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(lon_lae, lat_lae, <span class="at">pch =</span> <span class="dv">16</span>, <span class="at">col =</span> <span class="st">&quot;red&quot;</span>)</span></code></pre></div>
<p><img src="esds_book_files/figure-html/unnamed-chunk-152-1.png" width="50%" style="display: block; margin: auto;" /></p>
<p>We see that the temperature units are not in a format that is straightforward to read. To change the unit from Kelvin x10 to degree Celsius, we have to divide the data by 10 and subtract 273.15.</p>
<div class="sourceCode" id="cb221"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb221-1"><a href="ch-03.html#cb221-1" aria-hidden="true" tabindex="-1"></a>raster_chelsa_crop <span class="ot">&lt;-</span> raster_chelsa_crop<span class="sc">/</span><span class="dv">10</span><span class="fl">-273.15</span></span></code></pre></div>
<p>We plot our raster again, with this temperature transformation.</p>
<div class="sourceCode" id="cb222"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb222-1"><a href="ch-03.html#cb222-1" aria-hidden="true" tabindex="-1"></a>pal <span class="ot">&lt;-</span> <span class="fu">colorRampPalette</span>(<span class="fu">c</span>(<span class="st">&quot;purple&quot;</span>,<span class="st">&quot;blue&quot;</span>,<span class="st">&quot;cyan&quot;</span>,<span class="st">&quot;green&quot;</span>,<span class="st">&quot;yellow&quot;</span>,<span class="st">&quot;red&quot;</span>))</span>
<span id="cb222-2"><a href="ch-03.html#cb222-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(raster_chelsa_crop, <span class="at">col =</span> <span class="fu">pal</span>(<span class="dv">20</span>), <span class="at">xlab=</span><span class="st">&quot;longitude&quot;</span>, <span class="at">ylab=</span><span class="st">&quot;latitude&quot;</span>)</span>
<span id="cb222-3"><a href="ch-03.html#cb222-3" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(lon_lae, lat_lae, <span class="at">pch =</span> <span class="dv">16</span>, <span class="at">col =</span> <span class="st">&quot;red&quot;</span>)</span></code></pre></div>
<p><img src="esds_book_files/figure-html/unnamed-chunk-154-1.png" width="50%" style="display: block; margin: auto;" /></p>
<p>We have seen some of the basic functions in the package <strong>raster</strong>. Now we will load one more package to work with raster files. We use the package <strong>rasterVis</strong> <span class="citation">(<a href="#ref-R-rasterVis" role="doc-biblioref">Perpiñán and Hijmans 2021</a>)</span>. This package contains methods for enhanced visualization and interaction with raster data. It implements visualization methods for quantitative data and categorical data, both for univariate and multivariate rasters. It also provides methods to display spatiotemporal rasters, and vector fields. To enhance the visualisation of our raster data, we will use the colour palettes from the package <strong>RColorBrewer</strong> <span class="citation">(<a href="#ref-R-RColorBrewer" role="doc-biblioref">Neuwirth 2014</a>)</span></p>
<div class="sourceCode" id="cb223"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb223-1"><a href="ch-03.html#cb223-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rasterVis)</span>
<span id="cb223-2"><a href="ch-03.html#cb223-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(RColorBrewer)</span>
<span id="cb223-3"><a href="ch-03.html#cb223-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb223-4"><a href="ch-03.html#cb223-4" aria-hidden="true" tabindex="-1"></a>mapTheme <span class="ot">&lt;-</span> <span class="fu">rasterTheme</span>(<span class="at">region =</span> <span class="fu">rev</span>(<span class="fu">brewer.pal</span>(<span class="dv">8</span>,<span class="st">&quot;RdYlBu&quot;</span>)))</span>
<span id="cb223-5"><a href="ch-03.html#cb223-5" aria-hidden="true" tabindex="-1"></a>plt <span class="ot">&lt;-</span> <span class="fu">levelplot</span>(raster_chelsa_crop, <span class="at">margin=</span><span class="cn">FALSE</span>, <span class="at">par.settings =</span> mapTheme)</span>
<span id="cb223-6"><a href="ch-03.html#cb223-6" aria-hidden="true" tabindex="-1"></a>plt</span></code></pre></div>
<p><img src="esds_book_files/figure-html/unnamed-chunk-155-1.png" width="50%" style="display: block; margin: auto;" /></p>
<p><strong>Checkpoint</strong></p>
<p>Create your own small raster with 100 grid cells. Give it values, a projection (e.g. ‘+proj=utm +zone=48 +datum=WGS84’) and plot it.</p>
<p>If you chose the example projection provided, add <em>europe_shape</em> to your plot.</p>
<p><strong>Solution</strong></p>
<div class="sourceCode" id="cb224"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb224-1"><a href="ch-03.html#cb224-1" aria-hidden="true" tabindex="-1"></a><span class="co"># create a raster</span></span>
<span id="cb224-2"><a href="ch-03.html#cb224-2" aria-hidden="true" tabindex="-1"></a><span class="co"># short compact version</span></span>
<span id="cb224-3"><a href="ch-03.html#cb224-3" aria-hidden="true" tabindex="-1"></a>myraster <span class="ot">&lt;-</span> <span class="fu">raster</span>(<span class="at">ncol=</span><span class="dv">10</span>, <span class="at">nrow=</span><span class="dv">10</span>)</span>
<span id="cb224-4"><a href="ch-03.html#cb224-4" aria-hidden="true" tabindex="-1"></a><span class="co"># OR </span></span>
<span id="cb224-5"><a href="ch-03.html#cb224-5" aria-hidden="true" tabindex="-1"></a><span class="co"># longer version</span></span>
<span id="cb224-6"><a href="ch-03.html#cb224-6" aria-hidden="true" tabindex="-1"></a>myraster <span class="ot">&lt;-</span> <span class="fu">raster</span>()</span>
<span id="cb224-7"><a href="ch-03.html#cb224-7" aria-hidden="true" tabindex="-1"></a><span class="fu">ncol</span>(myraster) <span class="ot">&lt;-</span> <span class="dv">10</span></span>
<span id="cb224-8"><a href="ch-03.html#cb224-8" aria-hidden="true" tabindex="-1"></a><span class="fu">nrow</span>(myraster) <span class="ot">&lt;-</span> <span class="dv">10</span></span>
<span id="cb224-9"><a href="ch-03.html#cb224-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-10"><a href="ch-03.html#cb224-10" aria-hidden="true" tabindex="-1"></a><span class="co"># add values to the raster, this can be done in many ways here are two examples:</span></span>
<span id="cb224-11"><a href="ch-03.html#cb224-11" aria-hidden="true" tabindex="-1"></a><span class="fu">values</span>(myraster) <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">ncell</span>(myraster)</span>
<span id="cb224-12"><a href="ch-03.html#cb224-12" aria-hidden="true" tabindex="-1"></a><span class="co"># OR </span></span>
<span id="cb224-13"><a href="ch-03.html#cb224-13" aria-hidden="true" tabindex="-1"></a><span class="fu">values</span>(myraster) <span class="ot">&lt;-</span> <span class="fu">runif</span>(<span class="fu">ncell</span>(myraster))</span>
<span id="cb224-14"><a href="ch-03.html#cb224-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-15"><a href="ch-03.html#cb224-15" aria-hidden="true" tabindex="-1"></a><span class="co"># add a projection</span></span>
<span id="cb224-16"><a href="ch-03.html#cb224-16" aria-hidden="true" tabindex="-1"></a><span class="fu">projection</span>(myraster) <span class="ot">&lt;-</span> <span class="st">&quot;+proj=utm +zone=48 +datum=WGS84&quot;</span></span>
<span id="cb224-17"><a href="ch-03.html#cb224-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-18"><a href="ch-03.html#cb224-18" aria-hidden="true" tabindex="-1"></a><span class="co"># plot it</span></span>
<span id="cb224-19"><a href="ch-03.html#cb224-19" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(myraster)</span>
<span id="cb224-20"><a href="ch-03.html#cb224-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Since the raster has a projection we can visualise Europe on this new raster.</span></span>
<span id="cb224-21"><a href="ch-03.html#cb224-21" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(europe_shape, <span class="at">add=</span><span class="cn">TRUE</span>)</span></code></pre></div>
<p><img src="esds_book_files/figure-html/unnamed-chunk-156-1.png" width="50%" style="display: block; margin: auto;" /></p>
<div id="aggregating-1" class="section level4" number="3.2.5.1">
<h4><span class="header-section-number">3.2.5.1</span> Aggregating</h4>
<p>A <strong>raster grid</strong> is uniquely defined by an <em>origin</em>, a point that one of the intersections of grid lines, and its resolution, the magnitude of each cell-side. In the R package <code>raster</code>, the origin is defined as the point closest to (0,0) that is still an intersection of grid lines. The functions <code>origin()</code> and <code>res()</code> from the R package <code>raster</code> return the origin and resolution of a raster object. As an example, we will see what the resolution and origin of the rasters we loaded before are.</p>
<div class="sourceCode" id="cb225"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb225-1"><a href="ch-03.html#cb225-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot; Resolution Raster Landover: &quot;</span>, <span class="fu">res</span>(raster_landcover), <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>,</span>
<span id="cb225-2"><a href="ch-03.html#cb225-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;Resolution Raster Chelsa: &quot;</span>, <span class="fu">res</span>(raster_chelsa))</span></code></pre></div>
<pre><code>##  Resolution Raster Landover:  0.002777778 0.002777778 
##  Resolution Raster Chelsa:  0.008333333 0.008333333</code></pre>
<div class="sourceCode" id="cb227"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb227-1"><a href="ch-03.html#cb227-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot; Origin Raster Landover: &quot;</span>, <span class="fu">origin</span>(raster_landcover), <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>,</span>
<span id="cb227-2"><a href="ch-03.html#cb227-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;Origin Raster Chelsa: &quot;</span>, <span class="fu">origin</span>(raster_chelsa))</span></code></pre></div>
<pre><code>##  Origin Raster Landover:  0.001388889 -0.001388889 
##  Origin Raster Chelsa:  -0.000139609 -0.000139249</code></pre>
<p>Landcover has a much higher resolution. We can re-grid the Landcover raster to match the grid of the Chelsa raster. Aggregating means resampling an input raster to a coarser resolution based on a specified aggregation strategy. We now determine the aggregation factor by dividing the resolution of the landcover raster by that of the Chelsa raster. We do it both for the longitude and latitude to make sure they match.</p>
<div class="sourceCode" id="cb229"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb229-1"><a href="ch-03.html#cb229-1" aria-hidden="true" tabindex="-1"></a>res_landcover <span class="ot">&lt;-</span> <span class="fu">res</span>(raster_landcover)</span>
<span id="cb229-2"><a href="ch-03.html#cb229-2" aria-hidden="true" tabindex="-1"></a>res_chelsa <span class="ot">&lt;-</span> <span class="fu">res</span>(raster_chelsa)</span>
<span id="cb229-3"><a href="ch-03.html#cb229-3" aria-hidden="true" tabindex="-1"></a>factor_agg_lon <span class="ot">&lt;-</span> res_chelsa[<span class="dv">1</span>] <span class="sc">/</span> res_landcover[<span class="dv">1</span>]</span>
<span id="cb229-4"><a href="ch-03.html#cb229-4" aria-hidden="true" tabindex="-1"></a>factor_agg_lat <span class="ot">&lt;-</span> res_chelsa[<span class="dv">2</span>] <span class="sc">/</span> res_landcover[<span class="dv">2</span>]</span>
<span id="cb229-5"><a href="ch-03.html#cb229-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb229-6"><a href="ch-03.html#cb229-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb229-7"><a href="ch-03.html#cb229-7" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot; Longitudinal Aggregation Factor: &quot;</span>, factor_agg_lon, <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>,</span>
<span id="cb229-8"><a href="ch-03.html#cb229-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;Latitudinal Aggregation Factor: &quot;</span>, factor_agg_lon)</span></code></pre></div>
<pre><code>##  Longitudinal Aggregation Factor:  3 
##  Latitudinal Aggregation Factor:  3</code></pre>
<p>We observed that the landcover raster has a higher resolution than the temperature raster, we have deduced it is 3 times higher. So we need to transform the landcover raster to make sure it has the same grid (same <em>origin</em> and <em>resolution</em>) as the temperature raster. This will allow us to combine them in a potential analysis. We achieve this using <code>aggregate()</code> from the R package <code>raster</code> to obtain a sum of edges raster at 1000m x 1000m resolution.</p>
<p>The aggregate function takes three main arguments.
* <strong><em>x</em></strong> : the raster object to aggregate,
* <strong><em>fact</em></strong> : aggregation factor, i.e. the number of current cells that will make up the side of one of the new cells, and,
* <strong><em>fun</em></strong> : the function to apply to summarize the raster values of the fact^2 (in this case 3ˆ2=9) cells.</p>
<p>We aggregate the landcover raster at 1km using the aggregation factor calculated above.</p>
<div class="sourceCode" id="cb231"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb231-1"><a href="ch-03.html#cb231-1" aria-hidden="true" tabindex="-1"></a>raster_landcover_crop_agg <span class="ot">&lt;-</span> <span class="fu">aggregate</span>(raster_landcover_crop, <span class="at">fact =</span> factor_agg_lon, <span class="at">fun =</span> modal)</span></code></pre></div>
<p>We check the resolutions and origin of the two rasters and plot our the new landcover one.</p>
<div class="sourceCode" id="cb232"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb232-1"><a href="ch-03.html#cb232-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot; Resolution Landcover: &quot;</span>, <span class="fu">res</span>(raster_landcover_crop_agg), <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>,</span>
<span id="cb232-2"><a href="ch-03.html#cb232-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;Resolution Chelsa:    &quot;</span>, <span class="fu">res</span>(raster_chelsa), <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>,</span>
<span id="cb232-3"><a href="ch-03.html#cb232-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;Origin Landcover:    &quot;</span>, <span class="fu">origin</span>(raster_landcover_crop_agg), <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>,</span>
<span id="cb232-4"><a href="ch-03.html#cb232-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;Origin Chelsa:       &quot;</span>, <span class="fu">origin</span>(raster_chelsa), <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span></code></pre></div>
<pre><code>##  Resolution Landcover:  0.008333333 0.008333333 
##  Resolution Chelsa:     0.008333333 0.008333333 
##  Origin Landcover:     -0.001388889 -0.004166667 
##  Origin Chelsa:        -0.000139609 -0.000139249</code></pre>
<div class="sourceCode" id="cb234"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb234-1"><a href="ch-03.html#cb234-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(raster_landcover_crop_agg, <span class="at">legend=</span><span class="cn">FALSE</span>, <span class="at">xlab=</span><span class="st">&quot;longitude&quot;</span>, <span class="at">ylab=</span><span class="st">&quot;latitude&quot;</span>)</span></code></pre></div>
<p><img src="esds_book_files/figure-html/unnamed-chunk-161-1.png" width="50%" style="display: block; margin: auto;" /></p>
<p>We can see that the resolutions are now the same but the origin still differs. To get matching origins we must do another step: align the rasters.</p>
</div>
<div id="aligning" class="section level4" number="3.2.5.2">
<h4><span class="header-section-number">3.2.5.2</span> Aligning</h4>
<p>Aligning rasters is done using the function <code>resample()</code>. There are two main resampling methods: <em>Nearest Neighbour</em> or <em>Bilinear Interpolation</em>, which method is used depends upon the input data and its use after the operation is performed.</p>
<p><strong><em>Nearest Neighbour</em></strong> is best used for categorical data like land-use classification or slope classification. The values that go into the grid stay exactly the same, a 2 comes out as a 2, and 99 comes out as 99. The value of the output cell is determined by the nearest cell center on the input grid. Nearest Neighbor can be used on continuous data but the results can be blocky.</p>
<p><strong><em>Bilinear Interpolation</em></strong> uses a weighted average of the four nearest cell centers. The closer an input cell center is to the output cell center, the higher the influence of its value is on the output cell value. This means that the output value could be different than the nearest input, but is always within the same range of values as the input. Since the values can change, Bilinear is not recommended for categorical data. Instead, it should be used for continuous data like elevation and raw slope values.</p>
<div class="sourceCode" id="cb235"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb235-1"><a href="ch-03.html#cb235-1" aria-hidden="true" tabindex="-1"></a>raster_landcover_crop_resampl <span class="ot">&lt;-</span> <span class="fu">resample</span>(raster_landcover_crop, raster_chelsa_crop, <span class="at">method=</span><span class="st">&quot;ngb&quot;</span>)</span>
<span id="cb235-2"><a href="ch-03.html#cb235-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(raster_landcover_crop_resampl, <span class="at">legend=</span><span class="cn">FALSE</span>, <span class="at">xlab=</span><span class="st">&quot;longitude&quot;</span>, <span class="at">ylab=</span><span class="st">&quot;latitude&quot;</span>)</span></code></pre></div>
<p><a href="./figures/04_output-crop.png"></a></p>
<p>Now, we can check whether the two rasters are aligned.</p>
<div class="sourceCode" id="cb236"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb236-1"><a href="ch-03.html#cb236-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot; Resolution Landcover: &quot;</span>, <span class="fu">res</span>(raster_landcover_crop_resampl), <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>,</span>
<span id="cb236-2"><a href="ch-03.html#cb236-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;Resolution Chelsa:    &quot;</span>, <span class="fu">res</span>(raster_chelsa), <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>,</span>
<span id="cb236-3"><a href="ch-03.html#cb236-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;Origin Landcover:   &quot;</span>, <span class="fu">origin</span>(raster_landcover_crop_resampl), <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>,</span>
<span id="cb236-4"><a href="ch-03.html#cb236-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;Origin Chelsa:      &quot;</span>, <span class="fu">origin</span>(raster_chelsa), <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span></code></pre></div>
<pre><code>##  Resolution Landcover:  0.008333333 0.008333333 
##  Resolution Chelsa:     0.008333333 0.008333333 
##  Origin Landcover:    -0.000139609 -0.000139249 
##  Origin Chelsa:       -0.000139609 -0.000139249</code></pre>
<p>As we can see in the output of the code above, both the resolution and origin are identical. This means our rasters are now aligned. Remember, the <em>resolution</em> is the size of the cells or pixels in a raster and the <em>origin</em> is the coordinates of the point point closest to <em>(0,0)</em> that you could get if you moved towards <em>that point</em>(0,0) in steps of the x and y resolution of the rasters being analysed.</p>
</div>
<div id="point-extraction" class="section level4" number="3.2.5.3">
<h4><span class="header-section-number">3.2.5.3</span> Point extraction</h4>
<p>In this section, we will extract data from our rasters or spatial data. We will be extracting the values for the locations of our towers. The function to extract values is aptly named <code>extract()</code>. First, we specify the raster from which the values should be extracted and then the exact sites at which the values should be extracted. Here, we combine all this into a .</p>
<div class="sourceCode" id="cb238"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb238-1"><a href="ch-03.html#cb238-1" aria-hidden="true" tabindex="-1"></a>df_sites_temp <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">&quot;./data/fluxnet_site_info_reduced.csv&quot;</span>)</span>
<span id="cb238-2"><a href="ch-03.html#cb238-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb238-3"><a href="ch-03.html#cb238-3" aria-hidden="true" tabindex="-1"></a>df_sites_temp <span class="ot">&lt;-</span> <span class="fu">extract</span>(raster_chelsa, sp_sites, <span class="at">sp =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb238-4"><a href="ch-03.html#cb238-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb238-5"><a href="ch-03.html#cb238-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">right_join</span>(df_sites_temp, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&quot;lon&quot;</span>, <span class="st">&quot;lat&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb238-6"><a href="ch-03.html#cb238-6" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">rename</span>(<span class="at">temp_chelsa =</span> Chelsa_t_mean_2006<span class="fl">.2012</span>)</span></code></pre></div>
<p>In the lectures, we have seen that we must always be aware of modelled data and be aware of its limitations. Therefore, we do not just want to use CHELSA temperature data. It is important to consider different models and compare them. Hence, we will look at another climate model: <a href="https://worldclim.org/">WorldClim</a>. The WorldClim data website is a database containing global weather and climate data at a high spatial resolution. The data can be downloaded for historic (“near current”) and future climate and weather conditions. We will be using the historical monthly weather data. Due to the size of the rasters downloaded from WorldClim, we have done this already and made a raster of the mean annual temperature for the years 2006 to 2012. Through this we lose some details and information but for our analysis it suffices.</p>
<p>Next, we load and plot the provided rasters showing the mean annual temperatures for the WorldClim data for the years 2006-2012. WorldClim is a set of global climate layers (gridded climate data) with a spatial resolution between 1-340 km^2.
We want to extract values from WorldClim at the same tower sites, as we have used previously, and add them to the <em>df_sites</em> data frame.</p>
<p>This will give us a tidy with the site, latitude and longitude, temperatures for Chelsa and WorldClim at each tower location.</p>
<div class="sourceCode" id="cb239"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb239-1"><a href="ch-03.html#cb239-1" aria-hidden="true" tabindex="-1"></a>raster_worldclim <span class="ot">&lt;-</span> <span class="fu">raster</span>(<span class="st">&quot;./data/WC_mean_t_2006-2012.tif&quot;</span>)</span>
<span id="cb239-2"><a href="ch-03.html#cb239-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb239-3"><a href="ch-03.html#cb239-3" aria-hidden="true" tabindex="-1"></a>df_sites_temp <span class="ot">&lt;-</span> <span class="fu">extract</span>(raster_worldclim, sp_sites, <span class="at">sp =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb239-4"><a href="ch-03.html#cb239-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb239-5"><a href="ch-03.html#cb239-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">right_join</span>(df_sites_temp, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&quot;lon&quot;</span>, <span class="st">&quot;lat&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb239-6"><a href="ch-03.html#cb239-6" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">rename</span>(<span class="at">temp_wc =</span> WC_mean_t_2006<span class="fl">.2012</span>)</span>
<span id="cb239-7"><a href="ch-03.html#cb239-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb239-8"><a href="ch-03.html#cb239-8" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(df_sites_temp)</span></code></pre></div>
<pre><code>## # A tibble: 6 × 5
##   temp_wc   lon   lat temp_chelsa site  
##     &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;       &lt;dbl&gt; &lt;chr&gt; 
## 1  -0.633  4.52  51.3        2750 BE-Bra
## 2  -1.45   4.75  50.6        2741 BE-Lon
## 3  -3.75   6.00  50.3        2716 BE-Vie
## 4  -4.76   8.41  47.2        2730 CH-Cha
## 5  -4.97   8.54  47.1        2699 CH-Fru
## 6  -5.38   8.36  47.5        2710 CH-Lae</code></pre>
<p>We obtain the monthly mean temperature of January 2006 from FLUXNET data.</p>
<div class="sourceCode" id="cb241"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb241-1"><a href="ch-03.html#cb241-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lubridate)</span>
<span id="cb241-2"><a href="ch-03.html#cb241-2" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="st">&quot;./data/ddf_allsites_nested_joined.RData&quot;</span>)</span>
<span id="cb241-3"><a href="ch-03.html#cb241-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb241-4"><a href="ch-03.html#cb241-4" aria-hidden="true" tabindex="-1"></a>df_sites_temp <span class="ot">&lt;-</span> ddf_allsites_nested_joined <span class="sc">%&gt;%</span> </span>
<span id="cb241-5"><a href="ch-03.html#cb241-5" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="at">site =</span> siteid, data) <span class="sc">%&gt;%</span> </span>
<span id="cb241-6"><a href="ch-03.html#cb241-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest</span>(data) <span class="sc">%&gt;%</span> </span>
<span id="cb241-7"><a href="ch-03.html#cb241-7" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(site, TIMESTAMP, TA_F) <span class="sc">%&gt;%</span> </span>
<span id="cb241-8"><a href="ch-03.html#cb241-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">month =</span> <span class="fu">month</span>(TIMESTAMP), <span class="at">year =</span> <span class="fu">year</span>(TIMESTAMP)) <span class="sc">%&gt;%</span> </span>
<span id="cb241-9"><a href="ch-03.html#cb241-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(month <span class="sc">==</span> <span class="dv">1</span>, year <span class="sc">==</span> <span class="dv">2006</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb241-10"><a href="ch-03.html#cb241-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(site) <span class="sc">%&gt;%</span> </span>
<span id="cb241-11"><a href="ch-03.html#cb241-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">temp_fluxnet =</span> <span class="fu">mean</span>(TA_F)) <span class="sc">%&gt;%</span> </span>
<span id="cb241-12"><a href="ch-03.html#cb241-12" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb241-13"><a href="ch-03.html#cb241-13" aria-hidden="true" tabindex="-1"></a>  <span class="co"># add temp data extracted from spatial files (chelsa and worldclim)</span></span>
<span id="cb241-14"><a href="ch-03.html#cb241-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(df_sites_temp, dplyr<span class="sc">::</span><span class="fu">select</span>(site, temp_wc, temp_chelsa),</span>
<span id="cb241-15"><a href="ch-03.html#cb241-15" aria-hidden="true" tabindex="-1"></a>            <span class="at">by =</span> <span class="st">&quot;site&quot;</span>)</span></code></pre></div>
<p>We compare the climate models by showing the correlations with the tower’s data. The dotted line shows what the linear model would look like if the values of our model and the tower data overlapped. The red line shows the actual linear model of the relationship between the climate model and the tower data. The closer the red line to the dotted line the better the model is at predicting the temperatures measured by the towers.</p>
<div class="sourceCode" id="cb242"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb242-1"><a href="ch-03.html#cb242-1" aria-hidden="true" tabindex="-1"></a>df_sites_temp<span class="sc">$</span>temp_chelsa <span class="ot">&lt;-</span> df_sites_temp<span class="sc">$</span>temp_chelsa<span class="sc">/</span><span class="dv">10</span> <span class="sc">-</span><span class="fl">273.15</span></span>
<span id="cb242-2"><a href="ch-03.html#cb242-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb242-3"><a href="ch-03.html#cb242-3" aria-hidden="true" tabindex="-1"></a><span class="co"># we remove the sites we removed before</span></span>
<span id="cb242-4"><a href="ch-03.html#cb242-4" aria-hidden="true" tabindex="-1"></a>df_sites_temp <span class="ot">&lt;-</span> df_sites_temp <span class="sc">%&gt;%</span> </span>
<span id="cb242-5"><a href="ch-03.html#cb242-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span>(site <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;RU-Cok&quot;</span>, <span class="st">&quot;DK-ZaH&quot;</span>)))</span>
<span id="cb242-6"><a href="ch-03.html#cb242-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb242-7"><a href="ch-03.html#cb242-7" aria-hidden="true" tabindex="-1"></a>df_sites_temp <span class="sc">%&gt;%</span> </span>
<span id="cb242-8"><a href="ch-03.html#cb242-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> temp_fluxnet, <span class="at">y =</span> temp_chelsa), <span class="at">xlim=</span><span class="fu">c</span>(<span class="sc">-</span><span class="dv">10</span>,<span class="dv">5</span>)) <span class="sc">+</span></span>
<span id="cb242-9"><a href="ch-03.html#cb242-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb242-10"><a href="ch-03.html#cb242-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">intercept=</span><span class="dv">0</span>, <span class="at">slope=</span><span class="dv">1</span>, <span class="at">linetype=</span><span class="st">&quot;dotted&quot;</span>) <span class="sc">+</span></span>
<span id="cb242-11"><a href="ch-03.html#cb242-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method=</span><span class="st">&#39;lm&#39;</span>, <span class="at">color=</span><span class="st">&quot;red&quot;</span>, <span class="at">size=</span><span class="fl">0.5</span>, <span class="at">se=</span><span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb242-12"><a href="ch-03.html#cb242-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>()</span></code></pre></div>
<p><img src="esds_book_files/figure-html/unnamed-chunk-168-1.png" width="50%" style="display: block; margin: auto;" /></p>
<p>We compute the mean squared error (MSE). The MSE calculates the average of the squares of errors of all the data points from a fitted line or model. Put simply this is the difference between the data points (the actual data) and the estimated points given by the line or model. The values are squared to get positive values even if the difference is negative. Smaller values reflect less variation of the data. In a model you want to minimise the MSE, as this reflects that the model’s predicted or estimated points are closer to your actual data. The R package <strong>Metrics</strong> <span class="citation">(<a href="#ref-R-Metrics" role="doc-biblioref">Hamner and Frasco 2018</a>)</span>, has a function <code>mse()</code> to calculate the mean squared error.</p>
<div class="sourceCode" id="cb243"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb243-1"><a href="ch-03.html#cb243-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(Metrics)</span>
<span id="cb243-2"><a href="ch-03.html#cb243-2" aria-hidden="true" tabindex="-1"></a><span class="fu">mse</span>(df_sites_temp<span class="sc">$</span>temp_fluxnet, df_sites_temp<span class="sc">$</span>temp_chelsa)</span></code></pre></div>
<pre><code>## [1] 2.314917</code></pre>
<div class="sourceCode" id="cb245"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb245-1"><a href="ch-03.html#cb245-1" aria-hidden="true" tabindex="-1"></a>df_sites_temp <span class="sc">%&gt;%</span> </span>
<span id="cb245-2"><a href="ch-03.html#cb245-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> temp_fluxnet, <span class="at">y =</span> temp_wc), <span class="at">xlim=</span><span class="fu">c</span>(<span class="sc">-</span><span class="dv">10</span>,<span class="dv">5</span>)) <span class="sc">+</span></span>
<span id="cb245-3"><a href="ch-03.html#cb245-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb245-4"><a href="ch-03.html#cb245-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">intercept=</span><span class="dv">0</span>, <span class="at">slope=</span><span class="dv">1</span>, <span class="at">linetype=</span><span class="st">&quot;dotted&quot;</span>) <span class="sc">+</span></span>
<span id="cb245-5"><a href="ch-03.html#cb245-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method=</span><span class="st">&#39;lm&#39;</span>, <span class="at">color=</span><span class="st">&quot;red&quot;</span>, <span class="at">size=</span><span class="fl">0.5</span>, <span class="at">se=</span><span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb245-6"><a href="ch-03.html#cb245-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>()</span></code></pre></div>
<p><img src="esds_book_files/figure-html/unnamed-chunk-170-1.png" width="50%" style="display: block; margin: auto;" /></p>
<p>We compute the mean squared error.</p>
<div class="sourceCode" id="cb246"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb246-1"><a href="ch-03.html#cb246-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mse</span>(df_sites_temp<span class="sc">$</span>temp_fluxnet, df_sites_temp<span class="sc">$</span>temp_wc)</span></code></pre></div>
<pre><code>## [1] 10.43716</code></pre>
<p>We see that CHELSA correlates better, since the mean squared error is smaller, with the temperature values at the towers. We also see that WorldClim compared to CHELSA tends to predict colder temperatures.
It is important to remember that CHELSA and WorldClim are both ‘modelled data’ and as such come with errors and uncertainties. When using environmental layers for analyses, the data source should be well researched and possible uncertainty or errors carefully considered to understand the weaknesses and limitations of the data.
Th main differences between CHELSA and WorldClim are down to the input data of their models. As mentioned earlier CHELSA predicts its variable on down-scaled ERA-Interim data (global atmospheric reanalysis) and implements bias correction analyses.
WorldClim’s predicted variables are based on point data from weather station, which is then interpolated based on elevation, longitude and latitude. Due to the dependence on data from weather stations, the accuracy of WorldClim is more dependent on station density. For a more detailed comparison of the two climate data and why such models must be used with care, refer to the <span class="citation">Bobrowski, Weidinger, and Schickhoff (<a href="#ref-atmos12050543" role="doc-biblioref">2021</a>)</span> paper <a href="https://www.mdpi.com/2073-4433/12/5/543">here</a>.</p>
<p><strong>Checkpoint</strong></p>
<p>Above, we compared the CHELSA temperatures with the tower temperatures. Now we want to visually see which of the two data had the higher mean for each tower location.
To achieve this, attempt to plot the map of Europe and add the tower locations as points. Then colour the points so that for a higher CHESLA mean they are one colour and a higher tower temperature another.</p>
<p><strong>Solution</strong></p>
<div class="sourceCode" id="cb248"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb248-1"><a href="ch-03.html#cb248-1" aria-hidden="true" tabindex="-1"></a><span class="co"># There are more way to do this but we used the function ifelse(). </span></span>
<span id="cb248-2"><a href="ch-03.html#cb248-2" aria-hidden="true" tabindex="-1"></a><span class="co"># It takes 3 components: a condition, what to do if the condition applies and what to do if it doesn&#39;t apply.</span></span>
<span id="cb248-3"><a href="ch-03.html#cb248-3" aria-hidden="true" tabindex="-1"></a><span class="co"># So here if CHELSA temperatures are higher we want the point to be purple otherwise orange:</span></span>
<span id="cb248-4"><a href="ch-03.html#cb248-4" aria-hidden="true" tabindex="-1"></a>cols_chelsa_flux <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(df_sites_temp<span class="sc">$</span>temp_chelsa <span class="sc">&gt;</span> df_sites_temp<span class="sc">$</span>temp_fluxnet,<span class="st">&quot;purple&quot;</span>,<span class="st">&quot;orange&quot;</span>)</span>
<span id="cb248-5"><a href="ch-03.html#cb248-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb248-6"><a href="ch-03.html#cb248-6" aria-hidden="true" tabindex="-1"></a><span class="co"># We could also do different shapes if we wanted...</span></span>
<span id="cb248-7"><a href="ch-03.html#cb248-7" aria-hidden="true" tabindex="-1"></a>pch_chelsa_flux <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(df_sites_temp<span class="sc">$</span>temp_chelsa <span class="sc">&gt;</span> df_sites_temp<span class="sc">$</span>temp_fluxnet, <span class="dv">19</span> ,<span class="dv">17</span>)</span>
<span id="cb248-8"><a href="ch-03.html#cb248-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb248-9"><a href="ch-03.html#cb248-9" aria-hidden="true" tabindex="-1"></a><span class="do">## Plot the result using base R:</span></span>
<span id="cb248-10"><a href="ch-03.html#cb248-10" aria-hidden="true" tabindex="-1"></a><span class="co"># plot(europe_shape)</span></span>
<span id="cb248-11"><a href="ch-03.html#cb248-11" aria-hidden="true" tabindex="-1"></a><span class="co"># points(df_sites_temp$lon,df_sites_temp$lat, pch=pch_diff, col = col_checkpoint)</span></span>
<span id="cb248-12"><a href="ch-03.html#cb248-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb248-13"><a href="ch-03.html#cb248-13" aria-hidden="true" tabindex="-1"></a><span class="do">## Plot the result using ggplot:</span></span>
<span id="cb248-14"><a href="ch-03.html#cb248-14" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb248-15"><a href="ch-03.html#cb248-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_polygon</span>(<span class="at">data =</span> europe_shape, <span class="fu">aes</span>(<span class="at">x =</span> long, <span class="at">y =</span> lat, <span class="at">group =</span> group), <span class="at">fill=</span><span class="cn">NA</span>, <span class="at">colour =</span> <span class="st">&quot;black&quot;</span>) <span class="sc">+</span></span>
<span id="cb248-16"><a href="ch-03.html#cb248-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> df_sites_temp, <span class="fu">aes</span>(<span class="at">x =</span> lon, <span class="at">y =</span> lat), <span class="at">color =</span> cols_chelsa_flux, <span class="at">shape =</span> pch_chelsa_flux, <span class="at">size=</span><span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb248-17"><a href="ch-03.html#cb248-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Longitude&quot;</span>, <span class="at">y =</span> <span class="st">&quot;Latitude&quot;</span>) <span class="sc">+</span></span>
<span id="cb248-18"><a href="ch-03.html#cb248-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>()<span class="sc">+</span> </span>
<span id="cb248-19"><a href="ch-03.html#cb248-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_quickmap</span>()</span></code></pre></div>
<p><img src="esds_book_files/figure-html/unnamed-chunk-172-1.png" width="50%" style="display: block; margin: auto;" />
From the resulting map of Europe, we can deduce that for any points (here representing the towers) that are purple (circles) the mean temperature of CHELSA is higher than the measured temperature. Any orange points (triangles) the towers measured a higher temperature than CHELSA predicted. There seem to be more purple circles suggests CHELSA predicts higher temperatures than are measured by the fluxnet towers.</p>
</div>
<div id="correlations-with-gpp" class="section level4" number="3.2.5.4">
<h4><span class="header-section-number">3.2.5.4</span> Correlations with GPP</h4>
<p>We already had a look at GPP in Chapter <a href="ch-02.html#ch-02">2</a>. In this section we want to correlate CHELSA temperature and landcover with GPP.</p>
<p>In models we often take multiple variables and correlate them to another variable (here GPP). By seeing if they correlate well we can see if any of the variables make good so-called <em>predictors</em>. Below we will explore how well landcover and temperature correlate with GPP.</p>
<p>We start off by extracting the mean GPP at the tower sites. To do this we group our data by the <em>siteid</em> (or tower) and the year. This way we can get the GPP across a year and then an average across all years for each site. We will also consider the median to see if this changes the correlation.</p>
<p>To compare GPP and landcover, we will use both the landcover from the raster used above and the landcover given in the fluxnet data for each tower site. There is a column in the the fluxnet data set called <code>umd_land_cover</code>, which refers to the University of Maryland landcover classification scheme.</p>
<div class="sourceCode" id="cb249"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb249-1"><a href="ch-03.html#cb249-1" aria-hidden="true" tabindex="-1"></a>GPP_ann <span class="ot">&lt;-</span> ddf_allsites_nested_joined <span class="sc">%&gt;%</span> </span>
<span id="cb249-2"><a href="ch-03.html#cb249-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest</span>(data) <span class="sc">%&gt;%</span> </span>
<span id="cb249-3"><a href="ch-03.html#cb249-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">year =</span> <span class="fu">year</span>(TIMESTAMP)) <span class="sc">%&gt;%</span> </span>
<span id="cb249-4"><a href="ch-03.html#cb249-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(siteid, year) <span class="sc">%&gt;%</span> </span>
<span id="cb249-5"><a href="ch-03.html#cb249-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">gpp_ann =</span> <span class="fu">sum</span>(GPP_NT_VUT_REF)) <span class="sc">%&gt;%</span> </span>
<span id="cb249-6"><a href="ch-03.html#cb249-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb249-7"><a href="ch-03.html#cb249-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(siteid) <span class="sc">%&gt;%</span> </span>
<span id="cb249-8"><a href="ch-03.html#cb249-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">gpp_meanann =</span> <span class="fu">mean</span>(gpp_ann),  <span class="at">gpp_medianann =</span> <span class="fu">median</span>(gpp_ann)) <span class="sc">%&gt;%</span> </span>
<span id="cb249-9"><a href="ch-03.html#cb249-9" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(siteid, gpp_meanann, gpp_medianann)</span>
<span id="cb249-10"><a href="ch-03.html#cb249-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb249-11"><a href="ch-03.html#cb249-11" aria-hidden="true" tabindex="-1"></a>GPP_ann <span class="ot">&lt;-</span> <span class="fu">cbind</span>(GPP_ann, <span class="st">&#39;umd_land_cover&#39;</span> <span class="ot">=</span> ddf_allsites_nested_joined<span class="sc">$</span>umd_land_cover)</span>
<span id="cb249-12"><a href="ch-03.html#cb249-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb249-13"><a href="ch-03.html#cb249-13" aria-hidden="true" tabindex="-1"></a><span class="co"># for the correlations we remove the sites we don&#39;t have in the other datasets</span></span>
<span id="cb249-14"><a href="ch-03.html#cb249-14" aria-hidden="true" tabindex="-1"></a>GPP_ann <span class="ot">&lt;-</span> GPP_ann <span class="sc">%&gt;%</span></span>
<span id="cb249-15"><a href="ch-03.html#cb249-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span>siteid <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;DE-Obe&quot;</span>,<span class="st">&quot;DK-ZaH&quot;</span>, <span class="st">&quot;RU-Cok&quot;</span>))</span></code></pre></div>
<p>We then extract landcover data from the GlobCover raster at the tower sites.</p>
<div class="sourceCode" id="cb250"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb250-1"><a href="ch-03.html#cb250-1" aria-hidden="true" tabindex="-1"></a>df_sites_landcover <span class="ot">&lt;-</span> <span class="fu">extract</span>(raster_landcover, sp_sites, <span class="at">sp =</span> <span class="cn">TRUE</span>)</span>
<span id="cb250-2"><a href="ch-03.html#cb250-2" aria-hidden="true" tabindex="-1"></a>df_sites_landcover <span class="ot">&lt;-</span> <span class="fu">as.tibble</span>(df_sites_landcover)</span></code></pre></div>
<p>To make the correlations, we create a data frame with all the extracted temperature, landcover and GPP data from the tower sites.</p>
<div class="sourceCode" id="cb251"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb251-1"><a href="ch-03.html#cb251-1" aria-hidden="true" tabindex="-1"></a>landcover <span class="ot">&lt;-</span> df_sites_landcover<span class="sc">$</span>Globcover_EU</span>
<span id="cb251-2"><a href="ch-03.html#cb251-2" aria-hidden="true" tabindex="-1"></a>chelsa <span class="ot">&lt;-</span> df_sites_temp<span class="sc">$</span>temp_chelsa</span>
<span id="cb251-3"><a href="ch-03.html#cb251-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb251-4"><a href="ch-03.html#cb251-4" aria-hidden="true" tabindex="-1"></a>df_corr_ann <span class="ot">&lt;-</span> <span class="fu">cbind</span>(landcover, chelsa, GPP_ann)</span>
<span id="cb251-5"><a href="ch-03.html#cb251-5" aria-hidden="true" tabindex="-1"></a>df_corr_ann <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(df_corr_ann)</span>
<span id="cb251-6"><a href="ch-03.html#cb251-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb251-7"><a href="ch-03.html#cb251-7" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(df_corr_ann)</span></code></pre></div>
<pre><code>##   landcover chelsa siteid gpp_meanann gpp_medianann umd_land_cover
## 1        50   1.85 BE-Bra          NA            NA  Mixed Forests
## 2        20   0.95 BE-Lon    1348.667      1538.198      Croplands
## 3        90  -1.55 BE-Vie    1792.497      1757.801  Mixed Forests
## 4       120  -0.15 CH-Cha    2478.429      2635.465     Grasslands
## 5       140  -6.95 CH-Dav    1166.543      1176.724     Grasslands
## 6        50  -3.25 CH-Fru    2106.319      2015.295  Mixed Forests</code></pre>
<p>We will start by correlating the CHELSA temperatures with GPP. We do this by building a simple linear model using the function <code>lm()</code>. We do this for both the mean and the median.</p>
<div class="sourceCode" id="cb253"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb253-1"><a href="ch-03.html#cb253-1" aria-hidden="true" tabindex="-1"></a><span class="co"># linear model of temperature and mean annual GPP:</span></span>
<span id="cb253-2"><a href="ch-03.html#cb253-2" aria-hidden="true" tabindex="-1"></a>reg_mean_1 <span class="ot">&lt;-</span> <span class="fu">lm</span>(gpp_meanann<span class="sc">~</span>chelsa, <span class="at">data =</span> df_corr_ann) </span>
<span id="cb253-3"><a href="ch-03.html#cb253-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(reg_mean_1)</span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = gpp_meanann ~ chelsa, data = df_corr_ann)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -854.69 -279.10   29.79  260.51  843.33 
## 
## Coefficients:
##             Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)  1637.47      77.85   21.03   &lt;2e-16 ***
## chelsa         15.81      15.50    1.02    0.317    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 407.4 on 26 degrees of freedom
##   (4 observations deleted due to missingness)
## Multiple R-squared:  0.0385, Adjusted R-squared:  0.001519 
## F-statistic: 1.041 on 1 and 26 DF,  p-value: 0.317</code></pre>
<div class="sourceCode" id="cb255"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb255-1"><a href="ch-03.html#cb255-1" aria-hidden="true" tabindex="-1"></a><span class="co"># linear model of temperature and meadian annual GPP:</span></span>
<span id="cb255-2"><a href="ch-03.html#cb255-2" aria-hidden="true" tabindex="-1"></a>reg_median_1 <span class="ot">&lt;-</span> <span class="fu">lm</span>(gpp_medianann<span class="sc">~</span>chelsa, <span class="at">data =</span> df_corr_ann) </span>
<span id="cb255-3"><a href="ch-03.html#cb255-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(reg_median_1)</span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = gpp_medianann ~ chelsa, data = df_corr_ann)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -835.60 -283.48   36.19  233.05 1008.69 
## 
## Coefficients:
##             Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)  1629.43      78.63   20.72   &lt;2e-16 ***
## chelsa         17.68      15.65    1.13    0.269    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 411.5 on 26 degrees of freedom
##   (4 observations deleted due to missingness)
## Multiple R-squared:  0.04679,    Adjusted R-squared:  0.01013 
## F-statistic: 1.276 on 1 and 26 DF,  p-value: 0.2689</code></pre>
<p>To visualise the correlation we plot our temperature data with the two linear models.</p>
<div class="sourceCode" id="cb257"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb257-1"><a href="ch-03.html#cb257-1" aria-hidden="true" tabindex="-1"></a>p_mean <span class="ot">&lt;-</span> df_corr_ann <span class="sc">%&gt;%</span> </span>
<span id="cb257-2"><a href="ch-03.html#cb257-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> chelsa, <span class="at">y =</span> gpp_meanann)) <span class="sc">+</span></span>
<span id="cb257-3"><a href="ch-03.html#cb257-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb257-4"><a href="ch-03.html#cb257-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method=</span><span class="st">&#39;lm&#39;</span>, <span class="at">color=</span><span class="st">&quot;red&quot;</span>, <span class="at">size=</span><span class="fl">0.5</span>, <span class="at">se=</span><span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb257-5"><a href="ch-03.html#cb257-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&quot;Chelsa temperature&quot;</span>) <span class="sc">+</span></span>
<span id="cb257-6"><a href="ch-03.html#cb257-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;GPP mean [µmolCO2 m-2 s-1]&quot;</span>) <span class="sc">+</span></span>
<span id="cb257-7"><a href="ch-03.html#cb257-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>()</span>
<span id="cb257-8"><a href="ch-03.html#cb257-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb257-9"><a href="ch-03.html#cb257-9" aria-hidden="true" tabindex="-1"></a>p_mean</span></code></pre></div>
<p><img src="esds_book_files/figure-html/unnamed-chunk-177-1.png" width="50%" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb258"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb258-1"><a href="ch-03.html#cb258-1" aria-hidden="true" tabindex="-1"></a>p_median <span class="ot">&lt;-</span> df_corr_ann <span class="sc">%&gt;%</span> </span>
<span id="cb258-2"><a href="ch-03.html#cb258-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> chelsa, <span class="at">y =</span> gpp_medianann)) <span class="sc">+</span></span>
<span id="cb258-3"><a href="ch-03.html#cb258-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb258-4"><a href="ch-03.html#cb258-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method=</span><span class="st">&#39;lm&#39;</span>, <span class="at">color=</span><span class="st">&quot;blue&quot;</span>, <span class="at">size=</span><span class="fl">0.5</span>, <span class="at">se=</span><span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb258-5"><a href="ch-03.html#cb258-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&quot;Chelsa temperature&quot;</span>) <span class="sc">+</span></span>
<span id="cb258-6"><a href="ch-03.html#cb258-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;GPP median [µmolCO2 m-2 s-1]&quot;</span>) <span class="sc">+</span></span>
<span id="cb258-7"><a href="ch-03.html#cb258-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>()</span>
<span id="cb258-8"><a href="ch-03.html#cb258-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb258-9"><a href="ch-03.html#cb258-9" aria-hidden="true" tabindex="-1"></a>p_median</span></code></pre></div>
<p><img src="esds_book_files/figure-html/unnamed-chunk-177-2.png" width="50%" style="display: block; margin: auto;" />
We can see a slight positive correlation between the mean and median annual GPP and the CHELSA temperatures. To see if this varies across the whole year, we will also investigate the correlation between mean seasonal GPP and CHELSA temperatures. The same steps apply as for considering mean annual GPP, except that the data is grouped into seasons according to the equinoxes.</p>
<div class="sourceCode" id="cb259"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb259-1"><a href="ch-03.html#cb259-1" aria-hidden="true" tabindex="-1"></a>WS <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(<span class="st">&quot;2012-12-21&quot;</span>, <span class="at">format =</span> <span class="st">&quot;%Y-%m-%d&quot;</span>) <span class="co"># Winter Solstice</span></span>
<span id="cb259-2"><a href="ch-03.html#cb259-2" aria-hidden="true" tabindex="-1"></a>SE <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(<span class="st">&quot;2012-3-21&quot;</span>, <span class="at">format =</span> <span class="st">&quot;%Y-%m-%d&quot;</span>) <span class="co"># Spring Equinox</span></span>
<span id="cb259-3"><a href="ch-03.html#cb259-3" aria-hidden="true" tabindex="-1"></a>SS <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(<span class="st">&quot;2012-6-20&quot;</span>, <span class="at">format =</span> <span class="st">&quot;%Y-%m-%d&quot;</span>) <span class="co"># Summer Solstice</span></span>
<span id="cb259-4"><a href="ch-03.html#cb259-4" aria-hidden="true" tabindex="-1"></a>AE <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(<span class="st">&quot;2012-9-23&quot;</span>, <span class="at">format =</span> <span class="st">&quot;%Y-%m-%d&quot;</span>) <span class="co"># Autumn Equinox</span></span>
<span id="cb259-5"><a href="ch-03.html#cb259-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb259-6"><a href="ch-03.html#cb259-6" aria-hidden="true" tabindex="-1"></a>GPP_seasonal <span class="ot">&lt;-</span> ddf_allsites_nested_joined <span class="sc">%&gt;%</span></span>
<span id="cb259-7"><a href="ch-03.html#cb259-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest</span>(data) <span class="sc">%&gt;%</span></span>
<span id="cb259-8"><a href="ch-03.html#cb259-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">site =</span> siteid) <span class="sc">%&gt;%</span></span>
<span id="cb259-9"><a href="ch-03.html#cb259-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(site) <span class="sc">%&gt;%</span></span>
<span id="cb259-10"><a href="ch-03.html#cb259-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">season =</span> <span class="fu">case_when</span>(TIMESTAMP <span class="sc">&gt;=</span> WS <span class="sc">|</span> TIMESTAMP <span class="sc">&lt;</span> SE <span class="sc">~</span> <span class="st">&quot;Winter&quot;</span>,</span>
<span id="cb259-11"><a href="ch-03.html#cb259-11" aria-hidden="true" tabindex="-1"></a>                            TIMESTAMP <span class="sc">&gt;=</span> SE <span class="sc">&amp;</span> TIMESTAMP <span class="sc">&lt;</span> SS <span class="sc">~</span> <span class="st">&quot;Spring&quot;</span>,</span>
<span id="cb259-12"><a href="ch-03.html#cb259-12" aria-hidden="true" tabindex="-1"></a>                            TIMESTAMP <span class="sc">&gt;=</span> SS <span class="sc">&amp;</span> TIMESTAMP <span class="sc">&lt;</span> AE <span class="sc">~</span> <span class="st">&quot;Summer&quot;</span>, </span>
<span id="cb259-13"><a href="ch-03.html#cb259-13" aria-hidden="true" tabindex="-1"></a>                            TIMESTAMP <span class="sc">&gt;=</span> AE <span class="sc">&amp;</span> TIMESTAMP <span class="sc">&lt;</span> WS <span class="sc">~</span> <span class="st">&quot;Autumn&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb259-14"><a href="ch-03.html#cb259-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(site, season) <span class="sc">%&gt;%</span></span>
<span id="cb259-15"><a href="ch-03.html#cb259-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">gpp_season =</span> <span class="fu">mean</span>(GPP_NT_VUT_REF)) <span class="sc">%&gt;%</span></span>
<span id="cb259-16"><a href="ch-03.html#cb259-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb259-17"><a href="ch-03.html#cb259-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb259-18"><a href="ch-03.html#cb259-18" aria-hidden="true" tabindex="-1"></a><span class="co"># we remove the towers we don&#39;t have in the other datasets for the correlations</span></span>
<span id="cb259-19"><a href="ch-03.html#cb259-19" aria-hidden="true" tabindex="-1"></a>GPP_seasonal <span class="ot">&lt;-</span>  GPP_seasonal <span class="sc">%&gt;%</span></span>
<span id="cb259-20"><a href="ch-03.html#cb259-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span>site <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;DE-Obe&quot;</span>,<span class="st">&quot;DK-ZaH&quot;</span>, <span class="st">&quot;RU-Cok&quot;</span>))</span>
<span id="cb259-21"><a href="ch-03.html#cb259-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb259-22"><a href="ch-03.html#cb259-22" aria-hidden="true" tabindex="-1"></a><span class="co"># here we aren&#39;t looking t landcover so we only add the CHELSA temperatures to the correlations data frame.</span></span>
<span id="cb259-23"><a href="ch-03.html#cb259-23" aria-hidden="true" tabindex="-1"></a>chelsa_season <span class="ot">&lt;-</span> df_sites_temp[,<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">6</span>)]</span>
<span id="cb259-24"><a href="ch-03.html#cb259-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb259-25"><a href="ch-03.html#cb259-25" aria-hidden="true" tabindex="-1"></a>df_corr_season <span class="ot">&lt;-</span> <span class="fu">merge</span>(GPP_seasonal, chelsa_season, <span class="at">by =</span> <span class="st">&quot;site&quot;</span>)</span>
<span id="cb259-26"><a href="ch-03.html#cb259-26" aria-hidden="true" tabindex="-1"></a>df_corr_season <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(df_corr_season)</span>
<span id="cb259-27"><a href="ch-03.html#cb259-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb259-28"><a href="ch-03.html#cb259-28" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(df_corr_season)</span></code></pre></div>
<pre><code>##     site season gpp_season temp_chelsa
## 1 BE-Bra Autumn  2.4531735        1.85
## 2 BE-Bra Spring  6.6628702        1.85
## 3 BE-Bra Summer  9.6589652        1.85
## 4 BE-Bra Winter         NA        1.85
## 5 BE-Lon Autumn  1.3152037        0.95
## 6 BE-Lon Spring  0.9780171        0.95</code></pre>
<p>Once, the data frame for the seasonal correlations is ready, we order the plots by season and plot the results.</p>
<div class="sourceCode" id="cb261"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb261-1"><a href="ch-03.html#cb261-1" aria-hidden="true" tabindex="-1"></a><span class="co"># re-order by season as they should appear in plots</span></span>
<span id="cb261-2"><a href="ch-03.html#cb261-2" aria-hidden="true" tabindex="-1"></a>order_by_season <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Spring&quot;</span>, <span class="st">&quot;Summer&quot;</span>,<span class="st">&quot;Autumn&quot;</span>, <span class="st">&quot;Winter&quot;</span>)</span>
<span id="cb261-3"><a href="ch-03.html#cb261-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb261-4"><a href="ch-03.html#cb261-4" aria-hidden="true" tabindex="-1"></a>df_corr_season <span class="ot">&lt;-</span> <span class="fu">arrange</span>(<span class="fu">transform</span>(df_corr_season, <span class="at">season=</span><span class="fu">factor</span>(season, <span class="at">levels=</span>order_by_season)), season)</span>
<span id="cb261-5"><a href="ch-03.html#cb261-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb261-6"><a href="ch-03.html#cb261-6" aria-hidden="true" tabindex="-1"></a>p_mean_season <span class="ot">&lt;-</span> df_corr_season <span class="sc">%&gt;%</span> </span>
<span id="cb261-7"><a href="ch-03.html#cb261-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> temp_chelsa, <span class="at">y =</span> gpp_season)) <span class="sc">+</span></span>
<span id="cb261-8"><a href="ch-03.html#cb261-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb261-9"><a href="ch-03.html#cb261-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method=</span><span class="st">&#39;lm&#39;</span>, <span class="at">color=</span><span class="st">&quot;red&quot;</span>, <span class="at">size=</span><span class="fl">0.5</span>, <span class="at">se=</span><span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb261-10"><a href="ch-03.html#cb261-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&quot;Chelsa temperature&quot;</span>) <span class="sc">+</span></span>
<span id="cb261-11"><a href="ch-03.html#cb261-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;GPP mean [µmolCO2 m-2 s-1]&quot;</span>) <span class="sc">+</span></span>
<span id="cb261-12"><a href="ch-03.html#cb261-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="fu">vars</span>(season)) <span class="sc">+</span></span>
<span id="cb261-13"><a href="ch-03.html#cb261-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>()</span>
<span id="cb261-14"><a href="ch-03.html#cb261-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb261-15"><a href="ch-03.html#cb261-15" aria-hidden="true" tabindex="-1"></a>p_mean_season</span></code></pre></div>
<p><img src="esds_book_files/figure-html/unnamed-chunk-179-1.png" width="50%" style="display: block; margin: auto;" />
From the graph above we can see that the correlation between GPP and temperature differs among the seasons. Summer temperatures show a negative correlation with GPP. Spring, Autumn and Winter temperatures, on the other hand, are slighlty positively correlated with GPP. Spring and Summer seem to have more variability in GPP at different temperatures.</p>
<p>Back to landcover and GPP. The landcover column from the GlobCover raster contains numbers, even though it is actually categorical data. Each number represents a specific landcover type, so we can add a column with the corresponding the landcover category name.</p>
<div class="sourceCode" id="cb262"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb262-1"><a href="ch-03.html#cb262-1" aria-hidden="true" tabindex="-1"></a>df_corr_ann <span class="ot">&lt;-</span> df_corr_ann <span class="sc">%&gt;%</span></span>
<span id="cb262-2"><a href="ch-03.html#cb262-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">landcover_cat =</span> <span class="fu">case_when</span>(landcover <span class="sc">==</span> <span class="dv">14</span> <span class="sc">~</span> <span class="st">&quot;cropland&quot;</span>,</span>
<span id="cb262-3"><a href="ch-03.html#cb262-3" aria-hidden="true" tabindex="-1"></a>        landcover <span class="sc">==</span> <span class="dv">20</span> <span class="sc">~</span> <span class="st">&quot;mosaic cropland&quot;</span>,</span>
<span id="cb262-4"><a href="ch-03.html#cb262-4" aria-hidden="true" tabindex="-1"></a>        landcover <span class="sc">==</span> <span class="dv">50</span> <span class="sc">~</span> <span class="st">&quot;deciduous forest&quot;</span>,</span>
<span id="cb262-5"><a href="ch-03.html#cb262-5" aria-hidden="true" tabindex="-1"></a>        landcover <span class="sc">==</span> <span class="dv">70</span> <span class="sc">~</span> <span class="st">&quot;evergreen forest&quot;</span>,</span>
<span id="cb262-6"><a href="ch-03.html#cb262-6" aria-hidden="true" tabindex="-1"></a>        landcover <span class="sc">==</span> <span class="dv">90</span> <span class="sc">~</span> <span class="st">&quot;needleleaved forest&quot;</span>,</span>
<span id="cb262-7"><a href="ch-03.html#cb262-7" aria-hidden="true" tabindex="-1"></a>        landcover <span class="sc">==</span> <span class="dv">110</span> <span class="sc">~</span> <span class="st">&quot;mosaic forest&quot;</span>,</span>
<span id="cb262-8"><a href="ch-03.html#cb262-8" aria-hidden="true" tabindex="-1"></a>        landcover <span class="sc">==</span> <span class="dv">120</span> <span class="sc">~</span> <span class="st">&quot;mosaic forest/shrub/grass&quot;</span>,</span>
<span id="cb262-9"><a href="ch-03.html#cb262-9" aria-hidden="true" tabindex="-1"></a>        landcover <span class="sc">==</span> <span class="dv">130</span> <span class="sc">~</span> <span class="st">&quot;mosaic shrubland&quot;</span>,</span>
<span id="cb262-10"><a href="ch-03.html#cb262-10" aria-hidden="true" tabindex="-1"></a>        landcover <span class="sc">==</span> <span class="dv">140</span> <span class="sc">~</span> <span class="st">&quot;mosaic grassland&quot;</span>,</span>
<span id="cb262-11"><a href="ch-03.html#cb262-11" aria-hidden="true" tabindex="-1"></a>        landcover <span class="sc">==</span> <span class="dv">150</span> <span class="sc">~</span> <span class="st">&quot;sparse vegetation&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb262-12"><a href="ch-03.html#cb262-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">droplevels</span>()</span></code></pre></div>
<p>Again, we can plot it to visualise the correlation. However, since landcover is categorical data we will make a boxplot instead.
A boxplot is a figure that gives a graphical representation of the variability or spread of the data, by providing information beyond the central tendency of the data. A boxplot will show the <em>median</em> (the mid-pont of the data or 50th percentile, shown as a bold line in the middle of the box), the <em>interquartile range</em> (the <em>box</em> shows the range of the data with the edges being the 25th percentile and 75th percentile limits), whiskers (the lines coming out of the box) and any outliers as points beyond the whiskers.</p>
<p>We make a boxplot for mean GPP and the GlobCover landcover raster, as well as mean GPP and the provided fluxnet tower site landcover for comparison.</p>
<div class="sourceCode" id="cb263"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb263-1"><a href="ch-03.html#cb263-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> df_corr_ann, <span class="fu">aes</span>(<span class="at">x =</span> landcover_cat, <span class="at">y =</span> gpp_meanann, <span class="at">group =</span> <span class="fu">as.factor</span>(landcover_cat)))<span class="sc">+</span> </span>
<span id="cb263-2"><a href="ch-03.html#cb263-2" aria-hidden="true" tabindex="-1"></a>        <span class="fu">geom_boxplot</span>() <span class="sc">+</span> </span>
<span id="cb263-3"><a href="ch-03.html#cb263-3" aria-hidden="true" tabindex="-1"></a>        <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Landcover Category (raster)&quot;</span>, <span class="at">y =</span> <span class="st">&quot;GPP mean [µmolCO2 m-2 s-1]&quot;</span>) <span class="sc">+</span></span>
<span id="cb263-4"><a href="ch-03.html#cb263-4" aria-hidden="true" tabindex="-1"></a>        <span class="fu">theme_classic</span>() <span class="sc">+</span></span>
<span id="cb263-5"><a href="ch-03.html#cb263-5" aria-hidden="true" tabindex="-1"></a>        <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">90</span>, <span class="at">size =</span> <span class="dv">10</span>))</span></code></pre></div>
<p><img src="esds_book_files/figure-html/unnamed-chunk-181-1.png" width="50%" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb264"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb264-1"><a href="ch-03.html#cb264-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> df_corr_ann, <span class="fu">aes</span>(<span class="at">x =</span> umd_land_cover, <span class="at">y =</span> gpp_meanann, <span class="at">group =</span> <span class="fu">as.factor</span>(umd_land_cover)))<span class="sc">+</span> </span>
<span id="cb264-2"><a href="ch-03.html#cb264-2" aria-hidden="true" tabindex="-1"></a>        <span class="fu">geom_boxplot</span>() <span class="sc">+</span> </span>
<span id="cb264-3"><a href="ch-03.html#cb264-3" aria-hidden="true" tabindex="-1"></a>        <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Landcover Category (tower - umd)&quot;</span>, <span class="at">y =</span> <span class="st">&quot;GPP mean [µmolCO2 m-2 s-1]&quot;</span>) <span class="sc">+</span></span>
<span id="cb264-4"><a href="ch-03.html#cb264-4" aria-hidden="true" tabindex="-1"></a>        <span class="fu">theme_classic</span>() <span class="sc">+</span></span>
<span id="cb264-5"><a href="ch-03.html#cb264-5" aria-hidden="true" tabindex="-1"></a>        <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">90</span>, <span class="at">size =</span> <span class="dv">10</span>))</span></code></pre></div>
<p><img src="esds_book_files/figure-html/unnamed-chunk-181-2.png" width="50%" style="display: block; margin: auto;" /></p>
<p>We don’t see a particularly strong correlation with the two plotted landcover categories, as the mean GPP varies depeding on the landcover type. Thus we need to consider other predictors and more complex models to find better predictors of GPP.</p>
</div>
</div>
<div id="key-points-from-the-tutorial-2" class="section level3" number="3.2.6">
<h3><span class="header-section-number">3.2.6</span> Key points from the tutorial</h3>
<p><strong>Integrating remote sensing data</strong>: We extracted NDVI in the area around our eddy flux towers from the MODISTools package and converted it into a raster format.</p>
<ul>
<li>Then collapse NDVI measured within an area around the eddy flux towers to calculate the mean across years.</li>
<li>Merge this temporal data with our eddy flux data.</li>
<li>Apply a linear regression to test whether the addition of NDVI data to our model of GPP and PPFD_IN improves its accuracy.</li>
</ul>
<p><strong>Points</strong>: The eddy flux tower sites were plotted as points on a map of Europe.</p>
<ul>
<li>Extract coordinates of the tower sites from the metadata.</li>
<li>Transform the points into SpatialPoints with the sp package and plot them on a map of Europe.</li>
</ul>
<p><strong>Shapefiles</strong>: We added country and border information to our tower site plots.</p>
<ul>
<li>Extract the information about the spatial polygons in the europe_shape shapefile and apply one coordinate reference system.</li>
<li>Add the SpatialPoints matrix and shapefile data europe_shape to the tower site data frame.</li>
<li>Filter out the countries with towers and visualize only the countries containing a tower.</li>
</ul>
<p><strong>Rasters</strong>: We investigated whether the variables landcover and temperature can explain GPP.</p>
<ul>
<li>Load landcover data from Globcover temperature data from CHELSA in the form of rasters and plot them around our tower sites with the raster and rasterVis packages.</li>
<li>Apply the same resolution (aggregate) and origin (align) to the climate and landcover rasters.</li>
<li>Compare modelled climate data from CHELSA and WorldClim to our fluxnet data by extracting the temperatures at the tower sites and calculating the MSE (mean square error).</li>
<li>Finally, landcover and CHELSA modelled temperatures are plugged into a linear regression to see if they are significantly correlated with GPP.</li>
</ul>
</div>
</div>
<div id="exercise-2" class="section level2" number="3.3">
<h2><span class="header-section-number">3.3</span> Exercise</h2>
<p><strong>Part 1: Plotting Elevation differences</strong></p>
<p>In this first part of the exercise, we consider elevation data from the ETOPO dataset. ETOPO is a 1 arc-minute global relief model of the Earth’s surface that integrates land topography and ocean bathymetry. Since it is modelled date there is a certain level of uncertainty associated with it. In this exercise, you will look at the differences between the elevations from the tower data, which is directly measured at the site, and the values you will extract from this modelled ETOPO data.</p>
<p><em>Note:</em> think about which packages you need to load to complete each of the tasks.</p>
<ol style="list-style-type: lower-alpha">
<li><p>Load the <em>‘dataset_ex3.csv’</em> file containing the elevations of the towers.</p></li>
<li><p>Load both the <em>‘ETOPO.tif’</em> raster and the <em>‘europe_shape’</em> shapefile. Plot the shape of Europe over the raster.
(Since we used the shapefile in the tutorial too, it isn’t located in the same folder as the data for this exercise. You’ll have to use the correct pathway to load it, if you are unsure about how to find this use the ‘Files’ tab on the right can help you figure it out.)</p></li>
<li><p>Extract the elevations from the raster at the tower sites.</p></li>
<li><p>Calculate the difference between the elevations of the towers and the one extracted from the ETOPO.</p></li>
<li><p>Plot the difference in elevation calculated for each site on a map of Europe.
<em>Hint:</em> there are several ways to do this, one could be to using ifelse().</p></li>
</ol>
<p><strong>Part 2: Temperature and Elevation Correlations</strong></p>
<p>Since we know temperature and altitude (or elevation) are correlated due to a decrease in air pressure at higher altitudes, we want to see this correlation in our data. Therefore, in this second part, we want to find out which of the elevations we gathered in the first part (ETOPO and tower elevations) correlates better with the temperatures measured at the towers. Since the temperatures and elevations for the tower were measured in the same place, we would expect those to be more correlated than the modelled ETOPO elevations and the tower temperatures.</p>
<ol style="list-style-type: lower-alpha">
<li><p>Correlate the ETOPO elevations at the towers sites with the temperatures measured at the towers.</p></li>
<li><p>Correlate the elevations measured at the tower sites with the temperatures measured at the towers.</p></li>
<li><p>What is the mean squared errors of the two models above. Which of the two correlates better?</p></li>
<li><p>The <em>‘lapse rate’</em> is known as the rate of decrease of an atmospheric variable, in our case temperature, with increased elevation (also altitude). This <em>lapse</em> (gradual fall) in temperature with increasing altitude at a given time and place, is the slope of your models above. Find and compare the <em>lapse rate</em> of the two models. <em>Hint:</em> if you are stuck take a closer look at your model with summary().</p></li>
</ol>
<p>Now, that you’ve made it to the end of the exercise, remember to ‘knit’ this document so you can upload the html to moodle.</p>

</div>
</div>
<h3>References</h3>
<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-Bivand2013" class="csl-entry">
Bivand, Roger S., Edzer Pebesma, and Virgilio Gómez-Rubio. 2013. <em><span class="nocase">Applied Spatial Data Analysis with R: Second Edition</span></em>. <a href="https://doi.org/10.1007/978-1-4614-7618-4">https://doi.org/10.1007/978-1-4614-7618-4</a>.
</div>
<div id="ref-R-rgdal" class="csl-entry">
Bivand, Roger, Tim Keitt, and Barry Rowlingson. 2021. <em>Rgdal: Bindings for the ’Geospatial’ Data Abstraction Library</em>. <a href="https://CRAN.R-project.org/package=rgdal">https://CRAN.R-project.org/package=rgdal</a>.
</div>
<div id="ref-atmos12050543" class="csl-entry">
Bobrowski, Maria, Johannes Weidinger, and Udo Schickhoff. 2021. <span>“Is New Always Better? Frontiers in Global Climate Datasets for Modeling Treeline Species in the Himalayas.”</span> <em>Atmosphere</em> 12 (5). <a href="https://doi.org/10.3390/atmos12050543">https://doi.org/10.3390/atmos12050543</a>.
</div>
<div id="ref-R-Metrics" class="csl-entry">
Hamner, Ben, and Michael Frasco. 2018. <em>Metrics: Evaluation Metrics for Machine Learning</em>. <a href="https://CRAN.R-project.org/package=Metrics">https://CRAN.R-project.org/package=Metrics</a>.
</div>
<div id="ref-R-raster" class="csl-entry">
Hijmans, Robert J. 2021. <em>Raster: Geographic Data Analysis and Modeling</em>. <a href="https://CRAN.R-project.org/package=raster">https://CRAN.R-project.org/package=raster</a>.
</div>
<div id="ref-R-RColorBrewer" class="csl-entry">
Neuwirth, Erich. 2014. <em>RColorBrewer: ColorBrewer Palettes</em>. <a href="https://CRAN.R-project.org/package=RColorBrewer">https://CRAN.R-project.org/package=RColorBrewer</a>.
</div>
<div id="ref-Pastorello2020" class="csl-entry">
Pastorello, Gilberto, Carlo Trotta, Eleonora Canfora, Housen Chu, Danielle Christianson, You Wei Cheah, Cristina Poindexter, et al. 2020. <span>“<span class="nocase">The FLUXNET2015 dataset and the ONEFlux processing pipeline for eddy covariance data</span>.”</span> <em>Scientific Data</em> 7 (1): 225. <a href="https://doi.org/10.1038/s41597-020-0534-3">https://doi.org/10.1038/s41597-020-0534-3</a>.
</div>
<div id="ref-R-sf" class="csl-entry">
Pebesma, Edzer. 2018. <span>“<span class="nocase">Simple Features for R: Standardized Support for Spatial Vector Data</span>.”</span> <em><span>The R Journal</span></em> 10 (1): 439–46. <a href="https://doi.org/10.32614/RJ-2018-009">https://doi.org/10.32614/RJ-2018-009</a>.
</div>
<div id="ref-Pebesma2005" class="csl-entry">
Pebesma, Edzer, and Roger S Bivand. 2005. <span>“<span class="nocase">S Classes and Methods for Spatial Data : the sp Package</span>.”</span> <em>Economic Geography</em> 50 (1): 1–21. <a href="http://citeseerx.ist.psu.edu/viewdoc/download?doi=10.1.1.160.9361&amp;rep=rep1&amp;type=pdf">http://citeseerx.ist.psu.edu/viewdoc/download?doi=10.1.1.160.9361&amp;rep=rep1&amp;type=pdf</a>.
</div>
<div id="ref-R-rasterVis" class="csl-entry">
Perpiñán, Oscar, and Robert Hijmans. 2021. <em><span class="nocase">rasterVis</span></em>. <a href="https://oscarperpinan.github.io/rastervis/">https://oscarperpinan.github.io/rastervis/</a>.
</div>
<div id="ref-R-broom" class="csl-entry">
Robinson, David, Alex Hayes, and Simon Couch. 2021. <em>Broom: Convert Statistical Objects into Tidy Tibbles</em>. <a href="https://CRAN.R-project.org/package=broom">https://CRAN.R-project.org/package=broom</a>.
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="ch-02.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="ch-04.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
