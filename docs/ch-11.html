<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 11 Application 2: Neural Networks and Hyperparameter Tuning | Environmental Systems Data Science</title>
  <meta name="description" content="Tutorial and exercises for Environmental System Data Science, ETH Zürich." />
  <meta name="generator" content="bookdown 0.24 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 11 Application 2: Neural Networks and Hyperparameter Tuning | Environmental Systems Data Science" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="Tutorial and exercises for Environmental System Data Science, ETH Zürich." />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 11 Application 2: Neural Networks and Hyperparameter Tuning | Environmental Systems Data Science" />
  
  <meta name="twitter:description" content="Tutorial and exercises for Environmental System Data Science, ETH Zürich." />
  

<meta name="author" content="Loïc Pellissier, Joshua Payne, Benjamin Stocker" />


<meta name="date" content="2021-12-30" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="ch-10.html"/>
<link rel="next" href="ch-12.html"/>
<script src="libs/header-attrs-2.11/header-attrs.js"></script>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.0.1/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0.1/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Prerequisites</a>
<ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#course-description"><i class="fa fa-check"></i>Course Description</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#course-objectives"><i class="fa fa-check"></i>Course Objectives</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#content"><i class="fa fa-check"></i>Content</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#useful-prerequisites"><i class="fa fa-check"></i>Useful Prerequisites</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="ch-01.html"><a href="ch-01.html"><i class="fa fa-check"></i><b>1</b> Primers</a>
<ul>
<li class="chapter" data-level="1.1" data-path="ch-01.html"><a href="ch-01.html#introduction"><i class="fa fa-check"></i><b>1.1</b> Introduction</a>
<ul>
<li class="chapter" data-level="1.1.1" data-path="ch-01.html"><a href="ch-01.html#key-points-from-the-lecture"><i class="fa fa-check"></i><b>1.1.1</b> Key Points from the lecture</a></li>
</ul></li>
<li class="chapter" data-level="1.2" data-path="ch-01.html"><a href="ch-01.html#tutorial"><i class="fa fa-check"></i><b>1.2</b> Tutorial</a>
<ul>
<li class="chapter" data-level="1.2.1" data-path="ch-01.html"><a href="ch-01.html#working-with-rstudio-on-renku"><i class="fa fa-check"></i><b>1.2.1</b> Working with RStudio on Renku</a></li>
<li class="chapter" data-level="1.2.2" data-path="ch-01.html"><a href="ch-01.html#git"><i class="fa fa-check"></i><b>1.2.2</b> Git</a></li>
<li class="chapter" data-level="1.2.3" data-path="ch-01.html"><a href="ch-01.html#libraries"><i class="fa fa-check"></i><b>1.2.3</b> Libraries</a></li>
<li class="chapter" data-level="1.2.4" data-path="ch-01.html"><a href="ch-01.html#r-scripts"><i class="fa fa-check"></i><b>1.2.4</b> R scripts</a></li>
<li class="chapter" data-level="1.2.5" data-path="ch-01.html"><a href="ch-01.html#rmarkdown"><i class="fa fa-check"></i><b>1.2.5</b> RMarkdown</a></li>
<li class="chapter" data-level="1.2.6" data-path="ch-01.html"><a href="ch-01.html#functions"><i class="fa fa-check"></i><b>1.2.6</b> Functions</a></li>
<li class="chapter" data-level="1.2.7" data-path="ch-01.html"><a href="ch-01.html#tidy-data"><i class="fa fa-check"></i><b>1.2.7</b> Tidy data</a></li>
<li class="chapter" data-level="1.2.8" data-path="ch-01.html"><a href="ch-01.html#r-projects"><i class="fa fa-check"></i><b>1.2.8</b> R projects</a></li>
<li class="chapter" data-level="1.2.9" data-path="ch-01.html"><a href="ch-01.html#working-with-data-frames"><i class="fa fa-check"></i><b>1.2.9</b> Working with data frames</a></li>
<li class="chapter" data-level="1.2.10" data-path="ch-01.html"><a href="ch-01.html#r-objects"><i class="fa fa-check"></i><b>1.2.10</b> R objects</a></li>
<li class="chapter" data-level="1.2.11" data-path="ch-01.html"><a href="ch-01.html#data-visualisation"><i class="fa fa-check"></i><b>1.2.11</b> Data visualisation</a></li>
<li class="chapter" data-level="1.2.12" data-path="ch-01.html"><a href="ch-01.html#conditionals"><i class="fa fa-check"></i><b>1.2.12</b> Conditionals</a></li>
<li class="chapter" data-level="1.2.13" data-path="ch-01.html"><a href="ch-01.html#loops"><i class="fa fa-check"></i><b>1.2.13</b> Loops</a></li>
<li class="chapter" data-level="1.2.14" data-path="ch-01.html"><a href="ch-01.html#where-to-find-help"><i class="fa fa-check"></i><b>1.2.14</b> Where to find help</a></li>
<li class="chapter" data-level="1.2.15" data-path="ch-01.html"><a href="ch-01.html#key-points-from-the-tutorial"><i class="fa fa-check"></i><b>1.2.15</b> Key points from the tutorial</a></li>
<li class="chapter" data-level="1.2.16" data-path="ch-01.html"><a href="ch-01.html#further-reading"><i class="fa fa-check"></i><b>1.2.16</b> Further reading</a></li>
</ul></li>
<li class="chapter" data-level="1.3" data-path="ch-01.html"><a href="ch-01.html#exercise"><i class="fa fa-check"></i><b>1.3</b> Exercise</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="ch-02.html"><a href="ch-02.html"><i class="fa fa-check"></i><b>2</b> Data wrangling</a>
<ul>
<li class="chapter" data-level="2.1" data-path="ch-02.html"><a href="ch-02.html#introduction-1"><i class="fa fa-check"></i><b>2.1</b> Introduction</a>
<ul>
<li class="chapter" data-level="2.1.1" data-path="ch-02.html"><a href="ch-02.html#learning-objectives"><i class="fa fa-check"></i><b>2.1.1</b> Learning objectives</a></li>
<li class="chapter" data-level="2.1.2" data-path="ch-02.html"><a href="ch-02.html#key-points-from-the-lecture-1"><i class="fa fa-check"></i><b>2.1.2</b> Key points from the lecture</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="ch-02.html"><a href="ch-02.html#tutorial-1"><i class="fa fa-check"></i><b>2.2</b> Tutorial</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="ch-02.html"><a href="ch-02.html#libraries-1"><i class="fa fa-check"></i><b>2.2.1</b> Libraries</a></li>
<li class="chapter" data-level="2.2.2" data-path="ch-02.html"><a href="ch-02.html#variables-in-a-data-frame"><i class="fa fa-check"></i><b>2.2.2</b> Variables in a data frame</a></li>
<li class="chapter" data-level="2.2.3" data-path="ch-02.html"><a href="ch-02.html#time-objects"><i class="fa fa-check"></i><b>2.2.3</b> Time objects</a></li>
<li class="chapter" data-level="2.2.4" data-path="ch-02.html"><a href="ch-02.html#variable-re--definition"><i class="fa fa-check"></i><b>2.2.4</b> Variable (re-) definition</a></li>
<li class="chapter" data-level="2.2.5" data-path="ch-02.html"><a href="ch-02.html#selecting-cleaning-and-gap-filling"><i class="fa fa-check"></i><b>2.2.5</b> Selecting, cleaning and gap-filling</a></li>
<li class="chapter" data-level="2.2.6" data-path="ch-02.html"><a href="ch-02.html#functions-1"><i class="fa fa-check"></i><b>2.2.6</b> Functions</a></li>
<li class="chapter" data-level="2.2.7" data-path="ch-02.html"><a href="ch-02.html#data-overview"><i class="fa fa-check"></i><b>2.2.7</b> Data overview</a></li>
<li class="chapter" data-level="2.2.8" data-path="ch-02.html"><a href="ch-02.html#data-visualisation-i"><i class="fa fa-check"></i><b>2.2.8</b> Data visualisation I</a></li>
<li class="chapter" data-level="2.2.9" data-path="ch-02.html"><a href="ch-02.html#aggregating"><i class="fa fa-check"></i><b>2.2.9</b> Aggregating</a></li>
<li class="chapter" data-level="2.2.10" data-path="ch-02.html"><a href="ch-02.html#data-visualisation-ii"><i class="fa fa-check"></i><b>2.2.10</b> Data visualisation II</a></li>
<li class="chapter" data-level="2.2.11" data-path="ch-02.html"><a href="ch-02.html#functional-programming-i"><i class="fa fa-check"></i><b>2.2.11</b> Functional programming I</a></li>
<li class="chapter" data-level="2.2.12" data-path="ch-02.html"><a href="ch-02.html#strings"><i class="fa fa-check"></i><b>2.2.12</b> Strings</a></li>
<li class="chapter" data-level="2.2.13" data-path="ch-02.html"><a href="ch-02.html#combining-relational-data"><i class="fa fa-check"></i><b>2.2.13</b> Combining relational data</a></li>
<li class="chapter" data-level="2.2.14" data-path="ch-02.html"><a href="ch-02.html#key-points-from-the-tutorial-1"><i class="fa fa-check"></i><b>2.2.14</b> Key points from the tutorial</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="ch-02.html"><a href="ch-02.html#exercise-1"><i class="fa fa-check"></i><b>2.3</b> Exercise</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="ch-03.html"><a href="ch-03.html"><i class="fa fa-check"></i><b>3</b> Data variety</a>
<ul>
<li class="chapter" data-level="3.1" data-path="ch-03.html"><a href="ch-03.html#introduction-2"><i class="fa fa-check"></i><b>3.1</b> Introduction</a>
<ul>
<li class="chapter" data-level="3.1.1" data-path="ch-03.html"><a href="ch-03.html#overview"><i class="fa fa-check"></i><b>3.1.1</b> Overview</a></li>
<li class="chapter" data-level="3.1.2" data-path="ch-03.html"><a href="ch-03.html#learning-objectives-1"><i class="fa fa-check"></i><b>3.1.2</b> Learning objectives</a></li>
<li class="chapter" data-level="3.1.3" data-path="ch-03.html"><a href="ch-03.html#key-points-from-the-lecture-2"><i class="fa fa-check"></i><b>3.1.3</b> Key points from the lecture</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="ch-03.html"><a href="ch-03.html#tutorial-2"><i class="fa fa-check"></i><b>3.2</b> Tutorial</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="ch-03.html"><a href="ch-03.html#overview-1"><i class="fa fa-check"></i><b>3.2.1</b> Overview</a></li>
<li class="chapter" data-level="3.2.2" data-path="ch-03.html"><a href="ch-03.html#modis-remote-download"><i class="fa fa-check"></i><b>3.2.2</b> MODIS remote download</a></li>
<li class="chapter" data-level="3.2.3" data-path="ch-03.html"><a href="ch-03.html#points-on-the-globe"><i class="fa fa-check"></i><b>3.2.3</b> Points on the globe</a></li>
<li class="chapter" data-level="3.2.4" data-path="ch-03.html"><a href="ch-03.html#shapefiles"><i class="fa fa-check"></i><b>3.2.4</b> Shapefiles</a></li>
<li class="chapter" data-level="3.2.5" data-path="ch-03.html"><a href="ch-03.html#rasters"><i class="fa fa-check"></i><b>3.2.5</b> Rasters</a></li>
<li class="chapter" data-level="3.2.6" data-path="ch-03.html"><a href="ch-03.html#key-points-from-the-tutorial-2"><i class="fa fa-check"></i><b>3.2.6</b> Key points from the tutorial</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="ch-03.html"><a href="ch-03.html#exercise-2"><i class="fa fa-check"></i><b>3.3</b> Exercise</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="ch-04.html"><a href="ch-04.html"><i class="fa fa-check"></i><b>4</b> Data Scraping</a>
<ul>
<li class="chapter" data-level="4.1" data-path="ch-04.html"><a href="ch-04.html#introduction-3"><i class="fa fa-check"></i><b>4.1</b> Introduction</a>
<ul>
<li class="chapter" data-level="4.1.1" data-path="ch-04.html"><a href="ch-04.html#key-points-from-the-lecture-3"><i class="fa fa-check"></i><b>4.1.1</b> Key points from the lecture</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="ch-04.html"><a href="ch-04.html#tutorial-3"><i class="fa fa-check"></i><b>4.2</b> Tutorial</a>
<ul>
<li class="chapter" data-level="4.2.1" data-path="ch-04.html"><a href="ch-04.html#r-packages-and-functions"><i class="fa fa-check"></i><b>4.2.1</b> R-Packages and Functions</a></li>
<li class="chapter" data-level="4.2.2" data-path="ch-04.html"><a href="ch-04.html#the-fishbase-website"><i class="fa fa-check"></i><b>4.2.2</b> The FishBase website</a></li>
<li class="chapter" data-level="4.2.3" data-path="ch-04.html"><a href="ch-04.html#accessing-fishbase"><i class="fa fa-check"></i><b>4.2.3</b> Accessing FishBase</a></li>
<li class="chapter" data-level="4.2.4" data-path="ch-04.html"><a href="ch-04.html#scraping-numbers"><i class="fa fa-check"></i><b>4.2.4</b> Scraping Numbers</a></li>
<li class="chapter" data-level="4.2.5" data-path="ch-04.html"><a href="ch-04.html#scraping-text-snippetrs"><i class="fa fa-check"></i><b>4.2.5</b> Scraping Text Snippetrs</a></li>
<li class="chapter" data-level="4.2.6" data-path="ch-04.html"><a href="ch-04.html#scraping-tables"><i class="fa fa-check"></i><b>4.2.6</b> Scraping Tables</a></li>
<li class="chapter" data-level="4.2.7" data-path="ch-04.html"><a href="ch-04.html#the-fishbase-package"><i class="fa fa-check"></i><b>4.2.7</b> The Fishbase Package</a></li>
<li class="chapter" data-level="4.2.8" data-path="ch-04.html"><a href="ch-04.html#summary"><i class="fa fa-check"></i><b>4.2.8</b> Summary</a></li>
<li class="chapter" data-level="4.2.9" data-path="ch-04.html"><a href="ch-04.html#case-study"><i class="fa fa-check"></i><b>4.2.9</b> Case Study</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="ch-04.html"><a href="ch-04.html#exercise-3"><i class="fa fa-check"></i><b>4.3</b> Exercise</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="ch-05.html"><a href="ch-05.html"><i class="fa fa-check"></i><b>5</b> Catch-up</a>
<ul>
<li class="chapter" data-level="5.1" data-path="ch-05.html"><a href="ch-05.html#loops-in-r"><i class="fa fa-check"></i><b>5.1</b> Loops in R</a>
<ul>
<li class="chapter" data-level="5.1.1" data-path="ch-05.html"><a href="ch-05.html#some-simple-examples"><i class="fa fa-check"></i><b>5.1.1</b> Some simple examples</a></li>
<li class="chapter" data-level="5.1.2" data-path="ch-05.html"><a href="ch-05.html#nested-loops"><i class="fa fa-check"></i><b>5.1.2</b> Nested loops</a></li>
<li class="chapter" data-level="5.1.3" data-path="ch-05.html"><a href="ch-05.html#exercise-4"><i class="fa fa-check"></i><b>5.1.3</b> Exercise</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="ch-05.html"><a href="ch-05.html#functional-programming-using-purr"><i class="fa fa-check"></i><b>5.2</b> Functional programming using purr</a>
<ul>
<li class="chapter" data-level="5.2.1" data-path="ch-05.html"><a href="ch-05.html#shortcuts-in-a-purrr-function"><i class="fa fa-check"></i><b>5.2.1</b> Shortcuts in a <code>purrr</code> function</a></li>
<li class="chapter" data-level="5.2.2" data-path="ch-05.html"><a href="ch-05.html#workflow-nested-data-map-and-mutate"><i class="fa fa-check"></i><b>5.2.2</b> Workflow: nested data, map and mutate</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="ch-05.html"><a href="ch-05.html#string-manipulations"><i class="fa fa-check"></i><b>5.3</b> String Manipulations</a>
<ul>
<li class="chapter" data-level="5.3.1" data-path="ch-05.html"><a href="ch-05.html#introduction-to-strings"><i class="fa fa-check"></i><b>5.3.1</b> Introduction to strings</a></li>
<li class="chapter" data-level="5.3.2" data-path="ch-05.html"><a href="ch-05.html#matching-and-extracting-patterns"><i class="fa fa-check"></i><b>5.3.2</b> Matching and extracting patterns</a></li>
<li class="chapter" data-level="5.3.3" data-path="ch-05.html"><a href="ch-05.html#advanced-example"><i class="fa fa-check"></i><b>5.3.3</b> Advanced example</a></li>
</ul></li>
<li class="chapter" data-level="5.4" data-path="ch-05.html"><a href="ch-05.html#web-scraping-in-a-nut-shell"><i class="fa fa-check"></i><b>5.4</b> Web-scraping in a nut-shell</a></li>
<li class="chapter" data-level="5.5" data-path="ch-05.html"><a href="ch-05.html#tidyverses-filter-and-select"><i class="fa fa-check"></i><b>5.5</b> Tidyverse’s filter and select</a>
<ul>
<li class="chapter" data-level="5.5.1" data-path="ch-05.html"><a href="ch-05.html#introduction-4"><i class="fa fa-check"></i><b>5.5.1</b> Introduction</a></li>
<li class="chapter" data-level="5.5.2" data-path="ch-05.html"><a href="ch-05.html#select"><i class="fa fa-check"></i><b>5.5.2</b> Select()</a></li>
<li class="chapter" data-level="5.5.3" data-path="ch-05.html"><a href="ch-05.html#filter"><i class="fa fa-check"></i><b>5.5.3</b> Filter()</a></li>
<li class="chapter" data-level="5.5.4" data-path="ch-05.html"><a href="ch-05.html#exercises"><i class="fa fa-check"></i><b>5.5.4</b> Exercises</a></li>
<li class="chapter" data-level="5.5.5" data-path="ch-05.html"><a href="ch-05.html#solutions"><i class="fa fa-check"></i><b>5.5.5</b> Solutions</a></li>
</ul></li>
<li class="chapter" data-level="5.6" data-path="ch-05.html"><a href="ch-05.html#preparing-data-for-ggplot"><i class="fa fa-check"></i><b>5.6</b> Preparing data for ggplot()</a></li>
<li class="chapter" data-level="5.7" data-path="ch-05.html"><a href="ch-05.html#base-r-functions"><i class="fa fa-check"></i><b>5.7</b> Base R functions</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="ch-06.html"><a href="ch-06.html"><i class="fa fa-check"></i><b>6</b> Supervised Machine Learning I</a>
<ul>
<li class="chapter" data-level="6.1" data-path="ch-06.html"><a href="ch-06.html#introduction-5"><i class="fa fa-check"></i><b>6.1</b> Introduction</a>
<ul>
<li class="chapter" data-level="6.1.1" data-path="ch-06.html"><a href="ch-06.html#learning-objectives-2"><i class="fa fa-check"></i><b>6.1.1</b> Learning objectives</a></li>
<li class="chapter" data-level="6.1.2" data-path="ch-06.html"><a href="ch-06.html#important-points-from-the-lecture"><i class="fa fa-check"></i><b>6.1.2</b> Important points from the lecture</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="ch-06.html"><a href="ch-06.html#tutorial-4"><i class="fa fa-check"></i><b>6.2</b> Tutorial</a>
<ul>
<li class="chapter" data-level="6.2.1" data-path="ch-06.html"><a href="ch-06.html#overfitting"><i class="fa fa-check"></i><b>6.2.1</b> Overfitting</a></li>
<li class="chapter" data-level="6.2.2" data-path="ch-06.html"><a href="ch-06.html#motivation"><i class="fa fa-check"></i><b>6.2.2</b> Modelling challenge</a></li>
<li class="chapter" data-level="6.2.3" data-path="ch-06.html"><a href="ch-06.html#a-selection-of-model-types"><i class="fa fa-check"></i><b>6.2.3</b> A selection of model types</a></li>
<li class="chapter" data-level="6.2.4" data-path="ch-06.html"><a href="ch-06.html#data-splitting"><i class="fa fa-check"></i><b>6.2.4</b> Data splitting</a></li>
<li class="chapter" data-level="6.2.5" data-path="ch-06.html"><a href="ch-06.html#preprocessing"><i class="fa fa-check"></i><b>6.2.5</b> Pre-processing</a></li>
<li class="chapter" data-level="6.2.6" data-path="ch-06.html"><a href="ch-06.html#model-formulation"><i class="fa fa-check"></i><b>6.2.6</b> Model formulation</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="ch-06.html"><a href="ch-06.html#exercise-5"><i class="fa fa-check"></i><b>6.3</b> Exercise</a>
<ul>
<li class="chapter" data-level="6.3.1" data-path="ch-06.html"><a href="ch-06.html#reading-and-cleaning"><i class="fa fa-check"></i><b>6.3.1</b> Reading and cleaning</a></li>
<li class="chapter" data-level="6.3.2" data-path="ch-06.html"><a href="ch-06.html#data-splitting-1"><i class="fa fa-check"></i><b>6.3.2</b> Data splitting</a></li>
<li class="chapter" data-level="6.3.3" data-path="ch-06.html"><a href="ch-06.html#linear-model"><i class="fa fa-check"></i><b>6.3.3</b> Linear model</a></li>
<li class="chapter" data-level="6.3.4" data-path="ch-06.html"><a href="ch-06.html#pre-processing"><i class="fa fa-check"></i><b>6.3.4</b> Pre-processing</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7" data-path="ch-07.html"><a href="ch-07.html"><i class="fa fa-check"></i><b>7</b> Supervised Machine Learning II</a>
<ul>
<li class="chapter" data-level="7.1" data-path="ch-07.html"><a href="ch-07.html#introduction-6"><i class="fa fa-check"></i><b>7.1</b> Introduction</a>
<ul>
<li class="chapter" data-level="7.1.1" data-path="ch-07.html"><a href="ch-07.html#learning-objectives-3"><i class="fa fa-check"></i><b>7.1.1</b> Learning objectives</a></li>
<li class="chapter" data-level="7.1.2" data-path="ch-07.html"><a href="ch-07.html#key-points-from-the-lecture-4"><i class="fa fa-check"></i><b>7.1.2</b> Key points from the lecture</a></li>
</ul></li>
<li class="chapter" data-level="7.2" data-path="ch-07.html"><a href="ch-07.html#tutorial-5"><i class="fa fa-check"></i><b>7.2</b> Tutorial</a>
<ul>
<li class="chapter" data-level="7.2.1" data-path="ch-07.html"><a href="ch-07.html#model-formulation-using-train"><i class="fa fa-check"></i><b>7.2.1</b> Model formulation using <code>train()</code></a></li>
<li class="chapter" data-level="7.2.2" data-path="ch-07.html"><a href="ch-07.html#model-training"><i class="fa fa-check"></i><b>7.2.2</b> Model training</a></li>
<li class="chapter" data-level="7.2.3" data-path="ch-07.html"><a href="ch-07.html#model-evaluation"><i class="fa fa-check"></i><b>7.2.3</b> Model evaluation</a></li>
<li class="chapter" data-level="7.2.4" data-path="ch-07.html"><a href="ch-07.html#bonus-model-interpretation"><i class="fa fa-check"></i><b>7.2.4</b> Bonus: Model interpretation</a></li>
</ul></li>
<li class="chapter" data-level="7.3" data-path="ch-07.html"><a href="ch-07.html#exercise-6"><i class="fa fa-check"></i><b>7.3</b> Exercise</a>
<ul>
<li class="chapter" data-level="7.3.1" data-path="ch-07.html"><a href="ch-07.html#setup"><i class="fa fa-check"></i><b>7.3.1</b> Setup</a></li>
<li class="chapter" data-level="7.3.2" data-path="ch-07.html"><a href="ch-07.html#linear-model-1"><i class="fa fa-check"></i><b>7.3.2</b> Linear Model</a></li>
</ul></li>
<li class="chapter" data-level="7.4" data-path="ch-07.html"><a href="ch-07.html#knn"><i class="fa fa-check"></i><b>7.4</b> KNN</a>
<ul>
<li class="chapter" data-level="7.4.1" data-path="ch-07.html"><a href="ch-07.html#check-data"><i class="fa fa-check"></i><b>7.4.1</b> Check data</a></li>
<li class="chapter" data-level="7.4.2" data-path="ch-07.html"><a href="ch-07.html#training-1"><i class="fa fa-check"></i><b>7.4.2</b> Training</a></li>
<li class="chapter" data-level="7.4.3" data-path="ch-07.html"><a href="ch-07.html#prediction-1"><i class="fa fa-check"></i><b>7.4.3</b> Prediction</a></li>
<li class="chapter" data-level="7.4.4" data-path="ch-07.html"><a href="ch-07.html#sample-hyperparameters"><i class="fa fa-check"></i><b>7.4.4</b> Sample hyperparameters</a></li>
</ul></li>
<li class="chapter" data-level="7.5" data-path="ch-07.html"><a href="ch-07.html#random-forest-1"><i class="fa fa-check"></i><b>7.5</b> Random forest</a>
<ul>
<li class="chapter" data-level="7.5.1" data-path="ch-07.html"><a href="ch-07.html#training-2"><i class="fa fa-check"></i><b>7.5.1</b> Training</a></li>
<li class="chapter" data-level="7.5.2" data-path="ch-07.html"><a href="ch-07.html#prediction-2"><i class="fa fa-check"></i><b>7.5.2</b> Prediction</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="8" data-path="ch-08.html"><a href="ch-08.html"><i class="fa fa-check"></i><b>8</b> Application 1: Variable selection</a>
<ul>
<li class="chapter" data-level="8.1" data-path="ch-08.html"><a href="ch-08.html#introduction-7"><i class="fa fa-check"></i><b>8.1</b> Introduction</a></li>
<li class="chapter" data-level="8.2" data-path="ch-08.html"><a href="ch-08.html#application"><i class="fa fa-check"></i><b>8.2</b> Application</a>
<ul>
<li class="chapter" data-level="8.2.1" data-path="ch-08.html"><a href="ch-08.html#warm-up-1-nested-for-loop"><i class="fa fa-check"></i><b>8.2.1</b> Warm-up 1: Nested for-loop</a></li>
<li class="chapter" data-level="8.2.2" data-path="ch-08.html"><a href="ch-08.html#warm-up-2-find-the-best-single-predictor"><i class="fa fa-check"></i><b>8.2.2</b> Warm-up 2: Find the best single predictor</a></li>
<li class="chapter" data-level="8.2.3" data-path="ch-08.html"><a href="ch-08.html#full-stepwise-regression"><i class="fa fa-check"></i><b>8.2.3</b> Full stepwise regression</a></li>
<li class="chapter" data-level="8.2.4" data-path="ch-08.html"><a href="ch-08.html#bonus-stepwise-regression-out-of-the-box"><i class="fa fa-check"></i><b>8.2.4</b> Bonus: Stepwise regression out-of-the-box</a></li>
<li class="chapter" data-level="8.2.5" data-path="ch-08.html"><a href="ch-08.html#bonus-best-subset-selection---not-included-in-application-for-students-too-long"><i class="fa fa-check"></i><b>8.2.5</b> Bonus: Best Subset Selection - Not included in application for students (too long…)</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="9" data-path="ch-09.html"><a href="ch-09.html"><i class="fa fa-check"></i><b>9</b> Supervised Neural Networks I</a>
<ul>
<li class="chapter" data-level="9.1" data-path="ch-09.html"><a href="ch-09.html#introduction-8"><i class="fa fa-check"></i><b>9.1</b> Introduction</a>
<ul>
<li class="chapter" data-level="9.1.1" data-path="ch-09.html"><a href="ch-09.html#learning-objectives-4"><i class="fa fa-check"></i><b>9.1.1</b> Learning objectives</a></li>
<li class="chapter" data-level="9.1.2" data-path="ch-09.html"><a href="ch-09.html#important-points-from-the-lecture-1"><i class="fa fa-check"></i><b>9.1.2</b> Important points from the lecture</a></li>
</ul></li>
<li class="chapter" data-level="9.2" data-path="ch-09.html"><a href="ch-09.html#tutorial-6"><i class="fa fa-check"></i><b>9.2</b> Tutorial</a>
<ul>
<li class="chapter" data-level="9.2.1" data-path="ch-09.html"><a href="ch-09.html#set-up"><i class="fa fa-check"></i><b>9.2.1</b> Set-up</a></li>
<li class="chapter" data-level="9.2.2" data-path="ch-09.html"><a href="ch-09.html#keras-for-linear-models"><i class="fa fa-check"></i><b>9.2.2</b> Keras for linear models</a></li>
<li class="chapter" data-level="9.2.3" data-path="ch-09.html"><a href="ch-09.html#tuning-learning-rate"><i class="fa fa-check"></i><b>9.2.3</b> Tuning learning rate</a></li>
<li class="chapter" data-level="9.2.4" data-path="ch-09.html"><a href="ch-09.html#logistic-regression"><i class="fa fa-check"></i><b>9.2.4</b> Logistic Regression</a></li>
</ul></li>
<li class="chapter" data-level="9.3" data-path="ch-09.html"><a href="ch-09.html#exercise-7"><i class="fa fa-check"></i><b>9.3</b> Exercise</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="ch-10.html"><a href="ch-10.html"><i class="fa fa-check"></i><b>10</b> Supervised Neural Networks II</a>
<ul>
<li class="chapter" data-level="10.1" data-path="ch-10.html"><a href="ch-10.html#introduction-9"><i class="fa fa-check"></i><b>10.1</b> Introduction</a>
<ul>
<li class="chapter" data-level="10.1.1" data-path="ch-10.html"><a href="ch-10.html#learning-objectives-5"><i class="fa fa-check"></i><b>10.1.1</b> Learning objectives</a></li>
<li class="chapter" data-level="10.1.2" data-path="ch-10.html"><a href="ch-10.html#important-points-from-the-lecture-2"><i class="fa fa-check"></i><b>10.1.2</b> Important points from the lecture</a></li>
</ul></li>
<li class="chapter" data-level="10.2" data-path="ch-10.html"><a href="ch-10.html#tutorial-7"><i class="fa fa-check"></i><b>10.2</b> Tutorial</a>
<ul>
<li class="chapter" data-level="10.2.1" data-path="ch-10.html"><a href="ch-10.html#import-libraries-1"><i class="fa fa-check"></i><b>10.2.1</b> Import libraries</a></li>
<li class="chapter" data-level="10.2.2" data-path="ch-10.html"><a href="ch-10.html#construct-a-toy-dataset"><i class="fa fa-check"></i><b>10.2.2</b> Construct a toy dataset</a></li>
<li class="chapter" data-level="10.2.3" data-path="ch-10.html"><a href="ch-10.html#build-and-train-nn"><i class="fa fa-check"></i><b>10.2.3</b> Build and train NN</a></li>
<li class="chapter" data-level="10.2.4" data-path="ch-10.html"><a href="ch-10.html#model-performance"><i class="fa fa-check"></i><b>10.2.4</b> Model performance</a></li>
<li class="chapter" data-level="10.2.5" data-path="ch-10.html"><a href="ch-10.html#influence-of-nn-architecture"><i class="fa fa-check"></i><b>10.2.5</b> Influence of NN architecture</a></li>
</ul></li>
<li class="chapter" data-level="10.3" data-path="ch-10.html"><a href="ch-10.html#exercise-8"><i class="fa fa-check"></i><b>10.3</b> Exercise</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="ch-11.html"><a href="ch-11.html"><i class="fa fa-check"></i><b>11</b> Application 2: Neural Networks and Hyperparameter Tuning</a>
<ul>
<li class="chapter" data-level="11.1" data-path="ch-11.html"><a href="ch-11.html#introduction-10"><i class="fa fa-check"></i><b>11.1</b> Introduction</a>
<ul>
<li class="chapter" data-level="11.1.1" data-path="ch-11.html"><a href="ch-11.html#learning-goals"><i class="fa fa-check"></i><b>11.1.1</b> Learning Goals</a></li>
<li class="chapter" data-level="11.1.2" data-path="ch-11.html"><a href="ch-11.html#key-points-from-previous-lectures"><i class="fa fa-check"></i><b>11.1.2</b> Key Points from Previous Lectures</a></li>
</ul></li>
<li class="chapter" data-level="11.2" data-path="ch-11.html"><a href="ch-11.html#application-1"><i class="fa fa-check"></i><b>11.2</b> Application</a>
<ul>
<li class="chapter" data-level="11.2.1" data-path="ch-11.html"><a href="ch-11.html#problem-statement"><i class="fa fa-check"></i><b>11.2.1</b> Problem Statement</a></li>
<li class="chapter" data-level="11.2.2" data-path="ch-11.html"><a href="ch-11.html#data-preparation"><i class="fa fa-check"></i><b>11.2.2</b> Data preparation</a></li>
<li class="chapter" data-level="11.2.3" data-path="ch-11.html"><a href="ch-11.html#center-and-scale"><i class="fa fa-check"></i><b>11.2.3</b> Center and scale</a></li>
<li class="chapter" data-level="11.2.4" data-path="ch-11.html"><a href="ch-11.html#building-a-simple-model-with-keras-subtask-1"><i class="fa fa-check"></i><b>11.2.4</b> Building a simple model with keras ( SubTask 1)</a></li>
<li class="chapter" data-level="11.2.5" data-path="ch-11.html"><a href="ch-11.html#cross-validation"><i class="fa fa-check"></i><b>11.2.5</b> Cross validation</a></li>
<li class="chapter" data-level="11.2.6" data-path="ch-11.html"><a href="ch-11.html#parameter-tuning"><i class="fa fa-check"></i><b>11.2.6</b> Parameter Tuning</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="12" data-path="ch-12.html"><a href="ch-12.html"><i class="fa fa-check"></i><b>12</b> Supervised Deep Learning I</a>
<ul>
<li class="chapter" data-level="12.1" data-path="ch-12.html"><a href="ch-12.html#introduction-11"><i class="fa fa-check"></i><b>12.1</b> Introduction</a>
<ul>
<li class="chapter" data-level="12.1.1" data-path="ch-12.html"><a href="ch-12.html#learning-objectives-6"><i class="fa fa-check"></i><b>12.1.1</b> Learning objectives</a></li>
</ul></li>
<li class="chapter" data-level="12.2" data-path="ch-12.html"><a href="ch-12.html#tutorial-8"><i class="fa fa-check"></i><b>12.2</b> Tutorial</a>
<ul>
<li class="chapter" data-level="12.2.1" data-path="ch-12.html"><a href="ch-12.html#building-blocks-of-cnns"><i class="fa fa-check"></i><b>12.2.1</b> Building Blocks of CNNs</a></li>
<li class="chapter" data-level="12.2.2" data-path="ch-12.html"><a href="ch-12.html#build-the-model"><i class="fa fa-check"></i><b>12.2.2</b> Build the model</a></li>
<li class="chapter" data-level="12.2.3" data-path="ch-12.html"><a href="ch-12.html#compile-and-train-the-model"><i class="fa fa-check"></i><b>12.2.3</b> Compile and train the model</a></li>
<li class="chapter" data-level="12.2.4" data-path="ch-12.html"><a href="ch-12.html#reduce-overfitting"><i class="fa fa-check"></i><b>12.2.4</b> Reduce Overfitting</a></li>
<li class="chapter" data-level="12.2.5" data-path="ch-12.html"><a href="ch-12.html#visualizing-a-cnn"><i class="fa fa-check"></i><b>12.2.5</b> Visualizing a CNN</a></li>
</ul></li>
<li class="chapter" data-level="12.3" data-path="ch-12.html"><a href="ch-12.html#exercise-9"><i class="fa fa-check"></i><b>12.3</b> Exercise</a>
<ul>
<li class="chapter" data-level="12.3.1" data-path="ch-12.html"><a href="ch-12.html#import-libraries-and-data"><i class="fa fa-check"></i><b>12.3.1</b> Import libraries and data</a></li>
<li class="chapter" data-level="12.3.2" data-path="ch-12.html"><a href="ch-12.html#tasks"><i class="fa fa-check"></i><b>12.3.2</b> Tasks</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="13" data-path="ch-13.html"><a href="ch-13.html"><i class="fa fa-check"></i><b>13</b> Supervised Deep Learning II - <em>A Scenario of Environmental Systems</em></a>
<ul>
<li class="chapter" data-level="13.1" data-path="ch-13.html"><a href="ch-13.html#introduction-12"><i class="fa fa-check"></i><b>13.1</b> Introduction</a>
<ul>
<li class="chapter" data-level="13.1.1" data-path="ch-13.html"><a href="ch-13.html#learning-objectives-7"><i class="fa fa-check"></i><b>13.1.1</b> Learning objectives</a></li>
<li class="chapter" data-level="13.1.2" data-path="ch-13.html"><a href="ch-13.html#content-operations"><i class="fa fa-check"></i><b>13.1.2</b> Content &amp; Operations</a></li>
</ul></li>
<li class="chapter" data-level="13.2" data-path="ch-13.html"><a href="ch-13.html#tutorial-9"><i class="fa fa-check"></i><b>13.2</b> Tutorial</a>
<ul>
<li class="chapter" data-level="13.2.1" data-path="ch-13.html"><a href="ch-13.html#description-of-the-modelling-task"><i class="fa fa-check"></i><b>13.2.1</b> Description of the modelling task</a></li>
<li class="chapter" data-level="13.2.2" data-path="ch-13.html"><a href="ch-13.html#goal-of-the-tutorial"><i class="fa fa-check"></i><b>13.2.2</b> Goal of the tutorial</a></li>
<li class="chapter" data-level="13.2.3" data-path="ch-13.html"><a href="ch-13.html#dataset"><i class="fa fa-check"></i><b>13.2.3</b> Dataset</a></li>
<li class="chapter" data-level="13.2.4" data-path="ch-13.html"><a href="ch-13.html#lets-dive-into-the-code"><i class="fa fa-check"></i><b>13.2.4</b> Let’s dive into the code</a></li>
<li class="chapter" data-level="13.2.5" data-path="ch-13.html"><a href="ch-13.html#read-in-the-data"><i class="fa fa-check"></i><b>13.2.5</b> Read in the Data</a></li>
<li class="chapter" data-level="13.2.6" data-path="ch-13.html"><a href="ch-13.html#naive-models-old-world-linear-models"><i class="fa fa-check"></i><b>13.2.6</b> Naive models (Old World): Linear Models</a></li>
<li class="chapter" data-level="13.2.7" data-path="ch-13.html"><a href="ch-13.html#neural-networks-new-world"><i class="fa fa-check"></i><b>13.2.7</b> Neural Networks (New World)</a></li>
<li class="chapter" data-level="13.2.8" data-path="ch-13.html"><a href="ch-13.html#convolutional-neural-network"><i class="fa fa-check"></i><b>13.2.8</b> Convolutional Neural Network</a></li>
</ul></li>
<li class="chapter" data-level="13.3" data-path="ch-13.html"><a href="ch-13.html#exercise-10"><i class="fa fa-check"></i><b>13.3</b> Exercise</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Environmental Systems Data Science</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="ch-11" class="section level1" number="11">
<h1><span class="header-section-number">Chapter 11</span> Application 2: Neural Networks and Hyperparameter Tuning</h1>
<p>The goal of this application is to put the concepts that we have learnt over all these weeks into practice. The task at hand is to predict the productivity of vegetation (<code>GPP_NT_VUT_REF</code>), using an artificial neural network. For this task we will be using the <code>FLX_CH-Lae_FLUXNET2015_FULLSET_HH_2004-2014_1-3_CLEAN</code> data, that we obtained after the data wrangling tutorial</p>
<div id="introduction-10" class="section level2" number="11.1">
<h2><span class="header-section-number">11.1</span> Introduction</h2>
<div id="learning-goals" class="section level3" number="11.1.1">
<h3><span class="header-section-number">11.1.1</span> Learning Goals</h3>
<p>After this exercise session you shall be able to</p>
<ul>
<li>Create training and testing splits (80/20)</li>
<li>Center and scale your data features (pre-processing)</li>
<li>Use KFold cross-validation for hyper-parameter tuning</li>
<li>Build and train a simple, 1 hidden layer NN for regression tasks</li>
<li>Optimise the number of hidden layer units.</li>
<li>Evaluate feature importance and its effects on the model performance (maybe as bonus?) Definitely a bonus</li>
</ul>
</div>
<div id="key-points-from-previous-lectures" class="section level3" number="11.1.2">
<h3><span class="header-section-number">11.1.2</span> Key Points from Previous Lectures</h3>
<ul>
<li><p>It is always worthwhile to perform an initial exploratory analysis of your data, e.g. to identify outliers, missing values, etc.</p></li>
<li><p>To train a statistical model using machine learning, we split our data into training and testing sets. Sometimes we also include a validation set.</p></li>
<li><p>Testing data is set aside at the initial split and not “touched” during model training. It is key to test a model’s predictive power or whether it is overfitted.</p></li>
<li><p>Validation data is used for determining the loss during model training. The reason for distinguishing between testing and validation data is to assure we’re not misleading model training by some peculiarities of the validation data and we get an assessment of generalisability based on data that was not seen during model training.</p></li>
<li><p>Loss is a measure of how well our trained model predicts training labels. Loss is high when predictions are poor. Loss is low when predictions are good.</p></li>
<li><p>Model training minimises the loss. In other words, it optimises (maximises) the agreement between predicted and observed values.</p></li>
<li><p>There are several ways to measure loss. RMSE (Root Mean Squared Error) is one such measure. It is used in regression problems.<br />
</p></li>
<li><p>Gradient descent is a method that searches for model parameters that minimize loss.</p></li>
<li><p>Machine learning algorithms have hyperparameters. These are parameters that are set by the user rather than learned during training. An example is the learning rate in gradient descent. In the case of Artificial Neural Networks, this can be the number of nodes per hidden layer, or the number of hidden layers.</p></li>
<li><p>To tune a model, you can set hyperparameters that determine model structure or calibrate the coefficients.</p></li>
<li><p>Generalisability refers to the model’s performance on data not seen during the training - the testing data.</p></li>
<li><p>To avoid overfitting, model generalisability is desired already during model training. One method to do this is cross validation.</p></li>
<li><p>Data leakage is when data from the testing dataset creeps into the training data. To avoid this the testing set must be left completely untouched!</p></li>
</ul>
</div>
</div>
<div id="application-1" class="section level2" number="11.2">
<h2><span class="header-section-number">11.2</span> Application</h2>
<div id="problem-statement" class="section level3" number="11.2.1">
<h3><span class="header-section-number">11.2.1</span> Problem Statement</h3>
<p>For this exercise we can use the reduced and cleaned dataset with half-hourly data from Chapter <a href="ch-02.html#ch-02">2</a>. The task is to predict the <em>productivity of vegetation (GPP)</em>, using all the other features as predictor variables.</p>
<p><strong>GPP_NT_VUT_REF</strong> from the dataset is the target variable and rest of the columns can be used as the input predictor variables. For the sake of limiting the task complexity, we assume the data to be IID generated, and treat each row in the dataset as an independent observation.</p>
<ul>
<li>Use these inputs to create a neural network with just one hidden layer.</li>
<li>Use cross validation to optimise hyper-parameters such as number of hidden nodes, choice of activation function etc.</li>
<li>Use mean squared error (MSE) loss as a metric for monitoring the performance, plot the MSE loss as a function of the number of epochs.</li>
<li>Plot the MSE loss as a function of the hyperparameters used.</li>
<li><em>The list of tasks mentioned here are not exhaustive, you’ll be guided through the application and asked questions along the way!</em></li>
</ul>
</div>
<div id="data-preparation" class="section level3" number="11.2.2">
<h3><span class="header-section-number">11.2.2</span> Data preparation</h3>
<div class="sourceCode" id="cb845"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb845-1"><a href="ch-11.html#cb845-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Loading the required libraries </span></span>
<span id="cb845-2"><a href="ch-11.html#cb845-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(keras)</span>
<span id="cb845-3"><a href="ch-11.html#cb845-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(reticulate)</span>
<span id="cb845-4"><a href="ch-11.html#cb845-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(caret)</span>
<span id="cb845-5"><a href="ch-11.html#cb845-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb845-6"><a href="ch-11.html#cb845-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(recipes)</span>
<span id="cb845-7"><a href="ch-11.html#cb845-7" aria-hidden="true" tabindex="-1"></a><span class="co"># use_condaenv()</span></span></code></pre></div>
<div class="sourceCode" id="cb846"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb846-1"><a href="ch-11.html#cb846-1" aria-hidden="true" tabindex="-1"></a><span class="do">### Read in the .csv file as a dataframe </span></span>
<span id="cb846-2"><a href="ch-11.html#cb846-2" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">&quot;./data/FLX_CH-Lae_FLUXNET2015_FULLSET_HH_2004-2014_1-3_CLEAN.csv&quot;</span>)</span>
<span id="cb846-3"><a href="ch-11.html#cb846-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb846-4"><a href="ch-11.html#cb846-4" aria-hidden="true" tabindex="-1"></a><span class="do">### Things to check when preprocessing </span></span>
<span id="cb846-5"><a href="ch-11.html#cb846-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Look at the structure and shape of the data (print it out using str())</span></span>
<span id="cb846-6"><a href="ch-11.html#cb846-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert time-stamp columns using as.POSIXct() to convert them from a character to date-time object </span></span>
<span id="cb846-7"><a href="ch-11.html#cb846-7" aria-hidden="true" tabindex="-1"></a><span class="co"># As we treat the observations as IID, we don&#39;t really need the time-stamp values as a feature variable, but we still retain them as they will be used for some time series plots later. </span></span>
<span id="cb846-8"><a href="ch-11.html#cb846-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb846-9"><a href="ch-11.html#cb846-9" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(df)</span></code></pre></div>
<pre><code>## [1] 192864     20</code></pre>
<div class="sourceCode" id="cb848"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb848-1"><a href="ch-11.html#cb848-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(df)</span></code></pre></div>
<pre><code>## &#39;data.frame&#39;:    192864 obs. of  20 variables:
##  $ TIMESTAMP_START: chr  &quot;2004-01-01T00:00:00Z&quot; &quot;2004-01-01T00:30:00Z&quot; &quot;2004-01-01T01:00:00Z&quot; &quot;2004-01-01T01:30:00Z&quot; ...
##  $ TIMESTAMP_END  : chr  &quot;2004-01-01T00:30:00Z&quot; &quot;2004-01-01T01:00:00Z&quot; &quot;2004-01-01T01:30:00Z&quot; &quot;2004-01-01T02:00:00Z&quot; ...
##  $ TA_F           : num  -2.22 -2.25 -2.28 -2.5 -2.72 ...
##  $ SW_IN_F        : num  0 0 0 0 0 0 0 0 0 0 ...
##  $ LW_IN_F        : num  304 304 281 281 281 ...
##  $ VPD_F          : num  0.562 0.56 0.558 0.565 0.571 0.577 0.584 0.59 0.596 0.606 ...
##  $ PA_F           : num  93.3 93.3 93.3 93.3 93.3 ...
##  $ P_F            : num  0.014 0.014 0 0 0 0 0 0 0 0 ...
##  $ WS_F           : num  2.2 2.13 2.06 1.96 1.85 ...
##  $ CO2_F_MDS      : num  NA NA NA NA NA NA NA NA NA NA ...
##  $ PPFD_IN        : num  NA NA NA NA NA NA NA NA NA NA ...
##  $ GPP_NT_VUT_REF : num  NA NA NA NA NA NA NA NA NA NA ...
##  $ SWC_F_MDS_1    : num  NA NA NA NA NA NA NA NA NA NA ...
##  $ SWC_F_MDS_2    : num  NA NA NA NA NA NA NA NA NA NA ...
##  $ SWC_F_MDS_3    : num  NA NA NA NA NA NA NA NA NA NA ...
##  $ WS             : num  NA NA NA NA NA NA NA NA NA NA ...
##  $ WD             : num  NA NA NA NA NA NA NA NA NA NA ...
##  $ RH             : num  NA NA NA NA NA NA NA NA NA NA ...
##  $ NIGHT          : int  1 1 1 1 1 1 1 1 1 1 ...
##  $ NEE_VUT_REF_QC : int  3 3 3 3 3 3 3 3 3 3 ...</code></pre>
<div class="sourceCode" id="cb850"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb850-1"><a href="ch-11.html#cb850-1" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>TIMESTAMP_START <span class="ot">&lt;-</span> <span class="fu">as.POSIXct</span>(df<span class="sc">$</span>TIMESTAMP_START, <span class="at">format =</span> <span class="st">&quot;%Y-%m-%dT%TZ&quot;</span>)</span>
<span id="cb850-2"><a href="ch-11.html#cb850-2" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>TIMESTAMP_END <span class="ot">&lt;-</span> <span class="fu">as.POSIXct</span>(df<span class="sc">$</span>TIMESTAMP_END, <span class="at">format =</span> <span class="st">&quot;%Y-%m-%dT%TZ&quot;</span>)</span>
<span id="cb850-3"><a href="ch-11.html#cb850-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb850-4"><a href="ch-11.html#cb850-4" aria-hidden="true" tabindex="-1"></a><span class="do">### Check the structure of your data again (print it out using str())</span></span>
<span id="cb850-5"><a href="ch-11.html#cb850-5" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(df)</span></code></pre></div>
<pre><code>## &#39;data.frame&#39;:    192864 obs. of  20 variables:
##  $ TIMESTAMP_START: POSIXct, format: &quot;2004-01-01 00:00:00&quot; &quot;2004-01-01 00:30:00&quot; ...
##  $ TIMESTAMP_END  : POSIXct, format: &quot;2004-01-01 00:30:00&quot; &quot;2004-01-01 01:00:00&quot; ...
##  $ TA_F           : num  -2.22 -2.25 -2.28 -2.5 -2.72 ...
##  $ SW_IN_F        : num  0 0 0 0 0 0 0 0 0 0 ...
##  $ LW_IN_F        : num  304 304 281 281 281 ...
##  $ VPD_F          : num  0.562 0.56 0.558 0.565 0.571 0.577 0.584 0.59 0.596 0.606 ...
##  $ PA_F           : num  93.3 93.3 93.3 93.3 93.3 ...
##  $ P_F            : num  0.014 0.014 0 0 0 0 0 0 0 0 ...
##  $ WS_F           : num  2.2 2.13 2.06 1.96 1.85 ...
##  $ CO2_F_MDS      : num  NA NA NA NA NA NA NA NA NA NA ...
##  $ PPFD_IN        : num  NA NA NA NA NA NA NA NA NA NA ...
##  $ GPP_NT_VUT_REF : num  NA NA NA NA NA NA NA NA NA NA ...
##  $ SWC_F_MDS_1    : num  NA NA NA NA NA NA NA NA NA NA ...
##  $ SWC_F_MDS_2    : num  NA NA NA NA NA NA NA NA NA NA ...
##  $ SWC_F_MDS_3    : num  NA NA NA NA NA NA NA NA NA NA ...
##  $ WS             : num  NA NA NA NA NA NA NA NA NA NA ...
##  $ WD             : num  NA NA NA NA NA NA NA NA NA NA ...
##  $ RH             : num  NA NA NA NA NA NA NA NA NA NA ...
##  $ NIGHT          : int  1 1 1 1 1 1 1 1 1 1 ...
##  $ NEE_VUT_REF_QC : int  3 3 3 3 3 3 3 3 3 3 ...</code></pre>
<p>Recall the tutorial on <em>data wrangling</em>. We already performed some data-preprocessing there. We had replaced the missing value flag -9999 by NAs for the target variable <strong>GPP_NT_VUT_REF</strong>.
We had used the categorical variable <strong>NEE_VUT_REF_QC</strong>, representing the quality control, to further edit some of the values of the target variable <strong>GPP_NT_VUT_REF</strong>. For all those rows where <span class="math inline">\(NEE\_VUT\_REF\_QC \in \{3,4\}\)</span>, i.e. poor quality of measurements, we have already replaced the target variable <strong>GPP_NT_VUT_REF</strong> with NAs.</p>
<p>Thus we remove all the rows where the target variable is NA. As the target GPP_NT_VUT_REF is missing, we cannot learn or test against this data, so we remove all the rows where the target variable is missing. After we do this, the information that we previously encoded in NEE_VUT_REF_QC has already been used to filter out the rows with poor quality control measures. The variable NEE_VUT_REF_QC does not carry any additional information that would be helpful in predicting the target variable. Consequently, we can discard this variable. Note that NEE_VUT_REF_QC was a categorical feature in our dataset, and by discarding it we got lucky. Neural networks in keras require input data in the form of matrices, and if we had any other categorical variables present in our data, we would have to encode these e.g. One-Hot Encoding vectors. But indeed we have one remaining: NIGHT (Check unique(df$NIGHT)). In order to avoid further complications we remove Night from our dataset as well.</p>
<div class="sourceCode" id="cb852"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb852-1"><a href="ch-11.html#cb852-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Drop rows with NAs for GPP_NT_VUT_REF, and discard the columns NEE_VUT_REF_QC and NIGHT</span></span>
<span id="cb852-2"><a href="ch-11.html#cb852-2" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span> </span>
<span id="cb852-3"><a href="ch-11.html#cb852-3" aria-hidden="true" tabindex="-1"></a>            <span class="fu">drop_na</span>(<span class="fu">any_of</span>(<span class="st">&quot;GPP_NT_VUT_REF&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb852-4"><a href="ch-11.html#cb852-4" aria-hidden="true" tabindex="-1"></a>            <span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(<span class="st">&quot;NEE_VUT_REF_QC&quot;</span>,<span class="st">&quot;NIGHT&quot;</span>))</span>
<span id="cb852-5"><a href="ch-11.html#cb852-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb852-6"><a href="ch-11.html#cb852-6" aria-hidden="true" tabindex="-1"></a><span class="do">## Print the dimensionality of the data frame now to check how many rows have been deleted, and the num of columns remaining </span></span>
<span id="cb852-7"><a href="ch-11.html#cb852-7" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(df)</span></code></pre></div>
<pre><code>## [1] 176132     18</code></pre>
<div class="sourceCode" id="cb854"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb854-1"><a href="ch-11.html#cb854-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Print the summary() of your dataframe for some more information about your variables  </span></span>
<span id="cb854-2"><a href="ch-11.html#cb854-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(df)</span></code></pre></div>
<pre><code>##  TIMESTAMP_START               TIMESTAMP_END                      TA_F        
##  Min.   :2004-03-31 11:00:00   Min.   :2004-03-31 11:30:00   Min.   :-17.200  
##  1st Qu.:2007-02-04 11:52:30   1st Qu.:2007-02-04 12:22:30   1st Qu.:  1.520  
##  Median :2009-10-01 17:15:00   Median :2009-10-01 17:45:00   Median :  8.010  
##  Mean   :2009-09-26 02:34:05   Mean   :2009-09-26 03:04:06   Mean   :  7.808  
##  3rd Qu.:2012-05-19 19:37:30   3rd Qu.:2012-05-19 20:07:30   3rd Qu.: 13.850  
##  Max.   :2014-12-31 23:30:00   Max.   :2015-01-01 00:00:00   Max.   : 31.820  
##  NA&#39;s   :20                    NA&#39;s   :20                                     
##     SW_IN_F            LW_IN_F          VPD_F             PA_F      
##  Min.   :   0.000   Min.   :135.4   Min.   : 0.000   Min.   :89.57  
##  1st Qu.:   0.000   1st Qu.:275.4   1st Qu.: 0.203   1st Qu.:92.86  
##  Median :   2.139   Median :310.5   Median : 1.737   Median :93.34  
##  Mean   : 138.904   Mean   :304.2   Mean   : 3.313   Mean   :93.26  
##  3rd Qu.: 182.627   3rd Qu.:337.2   3rd Qu.: 4.877   3rd Qu.:93.75  
##  Max.   :1074.410   Max.   :423.9   Max.   :34.391   Max.   :95.32  
##                                                                     
##       P_F              WS_F          CO2_F_MDS        PPFD_IN        
##  Min.   :0.0000   Min.   : 0.004   Min.   :210.8   Min.   :   3.399  
##  1st Qu.:0.0000   1st Qu.: 1.180   1st Qu.:370.7   1st Qu.:   4.114  
##  Median :0.0000   Median : 2.065   Median :386.5   Median :   6.831  
##  Mean   :0.0656   Mean   : 2.499   Mean   :395.9   Mean   : 281.226  
##  3rd Qu.:0.0590   3rd Qu.: 3.366   3rd Qu.:401.6   3rd Qu.: 341.000  
##  Max.   :3.5510   Max.   :13.249   Max.   :999.4   Max.   :2170.000  
##                                                    NA&#39;s   :5172      
##  GPP_NT_VUT_REF      SWC_F_MDS_1     SWC_F_MDS_2      SWC_F_MDS_3   
##  Min.   :-35.4686   Min.   : 7.70   Min.   : 6.532   Min.   : 7.32  
##  1st Qu.: -0.3901   1st Qu.:18.46   1st Qu.:17.340   1st Qu.:18.61  
##  Median :  1.6599   Median :21.17   Median :22.050   Median :21.55  
##  Mean   :  4.8678   Mean   :21.47   Mean   :21.213   Mean   :21.24  
##  3rd Qu.:  7.7467   3rd Qu.:25.03   3rd Qu.:24.690   3rd Qu.:24.01  
##  Max.   : 61.1749   Max.   :32.74   Max.   :32.086   Max.   :31.79  
##                     NA&#39;s   :15112   NA&#39;s   :8344     NA&#39;s   :8344   
##        WS               WD                RH        
##  Min.   : 0.004   Min.   :  0.062   Min.   : 17.09  
##  1st Qu.: 1.174   1st Qu.:101.198   1st Qu.: 65.74  
##  Median : 2.065   Median :227.899   Median : 81.80  
##  Mean   : 2.502   Mean   :188.123   Mean   : 78.89  
##  3rd Qu.: 3.377   3rd Qu.:259.823   3rd Qu.: 97.10  
##  Max.   :13.249   Max.   :359.987   Max.   :100.00  
##  NA&#39;s   :4039     NA&#39;s   :3442      NA&#39;s   :6017</code></pre>
<p>We see that there are still a few variables with NAs. Let’s see how many NAs each column has and what would be the number of rows in the resulting dataframe if we drop all rows with NAs</p>
<div class="sourceCode" id="cb856"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb856-1"><a href="ch-11.html#cb856-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Compute how many rows have NA values for each column, and report the result for each column, print the result </span></span>
<span id="cb856-2"><a href="ch-11.html#cb856-2" aria-hidden="true" tabindex="-1"></a><span class="co"># e.g. </span></span>
<span id="cb856-3"><a href="ch-11.html#cb856-3" aria-hidden="true" tabindex="-1"></a><span class="co"># TIMESTAMP_START                 0</span></span>
<span id="cb856-4"><a href="ch-11.html#cb856-4" aria-hidden="true" tabindex="-1"></a><span class="co"># TIMESTAMP_START0TIMESTAMP_END   0</span></span>
<span id="cb856-5"><a href="ch-11.html#cb856-5" aria-hidden="true" tabindex="-1"></a><span class="co"># TA_F                            abc</span></span>
<span id="cb856-6"><a href="ch-11.html#cb856-6" aria-hidden="true" tabindex="-1"></a><span class="co"># .</span></span>
<span id="cb856-7"><a href="ch-11.html#cb856-7" aria-hidden="true" tabindex="-1"></a><span class="co"># . </span></span>
<span id="cb856-8"><a href="ch-11.html#cb856-8" aria-hidden="true" tabindex="-1"></a><span class="co"># . </span></span>
<span id="cb856-9"><a href="ch-11.html#cb856-9" aria-hidden="true" tabindex="-1"></a><span class="co"># RH                           xyz</span></span>
<span id="cb856-10"><a href="ch-11.html#cb856-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb856-11"><a href="ch-11.html#cb856-11" aria-hidden="true" tabindex="-1"></a><span class="fu">colSums</span>(<span class="fu">is.na</span>(df))</span></code></pre></div>
<pre><code>## TIMESTAMP_START   TIMESTAMP_END            TA_F         SW_IN_F         LW_IN_F 
##              20              20               0               0               0 
##           VPD_F            PA_F             P_F            WS_F       CO2_F_MDS 
##               0               0               0               0               0 
##         PPFD_IN  GPP_NT_VUT_REF     SWC_F_MDS_1     SWC_F_MDS_2     SWC_F_MDS_3 
##            5172               0           15112            8344            8344 
##              WS              WD              RH 
##            4039            3442            6017</code></pre>
<div class="sourceCode" id="cb858"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb858-1"><a href="ch-11.html#cb858-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Compute the rows we will be left with, if we drop all rows where even 1 column contains NA, print the result</span></span>
<span id="cb858-2"><a href="ch-11.html#cb858-2" aria-hidden="true" tabindex="-1"></a><span class="fu">nrow</span>(df <span class="sc">%&gt;%</span> <span class="fu">drop_na</span>())</span></code></pre></div>
<pre><code>## [1] 155451</code></pre>
<p>The number of rows with NAs are not that large compared to the current size of the dataset. So we can afford to discard these rows without reducing the size of our dataset by much, and we still have enough data to carry out analysis.</p>
<p><em>Sidenote:</em> It can happen in some cases that by doing so we lose a majority of our dataset, because each row has at least 1 column with NA. If the number of rows reduced significantly by this operation, we would use some data imputation technique to fill-in these NA values. But also note that by doing so, we are introducing some bias to our model, by the data imputation technique we choose.</p>
<div class="sourceCode" id="cb860"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb860-1"><a href="ch-11.html#cb860-1" aria-hidden="true" tabindex="-1"></a><span class="do">## drop all the rows with NAs</span></span>
<span id="cb860-2"><a href="ch-11.html#cb860-2" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span>  df <span class="sc">%&gt;%</span> <span class="fu">drop_na</span>()</span>
<span id="cb860-3"><a href="ch-11.html#cb860-3" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(df)</span></code></pre></div>
<pre><code>## &#39;data.frame&#39;:    155451 obs. of  18 variables:
##  $ TIMESTAMP_START: POSIXct, format: &quot;2004-09-20 10:30:00&quot; &quot;2004-09-20 11:00:00&quot; ...
##  $ TIMESTAMP_END  : POSIXct, format: &quot;2004-09-20 11:00:00&quot; &quot;2004-09-20 11:30:00&quot; ...
##  $ TA_F           : num  13.3 13.4 13.8 14.5 14 ...
##  $ SW_IN_F        : num  561 462 536 672 390 ...
##  $ LW_IN_F        : num  346 346 346 346 346 ...
##  $ VPD_F          : num  2.87 3.35 3.71 4.58 4.25 ...
##  $ PA_F           : num  93.6 93.6 93.6 93.6 93.6 ...
##  $ P_F            : num  0.019 0.019 0.019 0.019 0.019 0 0 0 0 0 ...
##  $ WS_F           : num  2.29 2.86 2.42 2.91 2.87 ...
##  $ CO2_F_MDS      : num  356 355 354 353 352 ...
##  $ PPFD_IN        : num  1078 889 1030 1292 750 ...
##  $ GPP_NT_VUT_REF : num  21.1 19.4 22.4 30.9 16.9 ...
##  $ SWC_F_MDS_1    : num  16.4 16.4 16.4 16.4 16.4 ...
##  $ SWC_F_MDS_2    : num  14.4 14.4 14.4 14.4 14.4 ...
##  $ SWC_F_MDS_3    : num  16.7 16.7 16.7 16.7 16.7 ...
##  $ WS             : num  2.29 2.86 2.42 2.91 2.87 ...
##  $ WD             : num  244 252 248 249 256 ...
##  $ RH             : num  81.2 78.2 76.5 72.2 73.4 ...</code></pre>
<div class="sourceCode" id="cb862"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb862-1"><a href="ch-11.html#cb862-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Here we create a few variables to reference different columns that might make preprocessing a little easier for us</span></span>
<span id="cb862-2"><a href="ch-11.html#cb862-2" aria-hidden="true" tabindex="-1"></a><span class="do">## Feel free to use or not use them in the subsequent steps; If you wish not to use them, just put a &quot;#&quot; before the lines below </span></span>
<span id="cb862-3"><a href="ch-11.html#cb862-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb862-4"><a href="ch-11.html#cb862-4" aria-hidden="true" tabindex="-1"></a>time_cols <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;TIMESTAMP_START&quot;</span>,<span class="st">&quot;TIMESTAMP_END&quot;</span>)</span>
<span id="cb862-5"><a href="ch-11.html#cb862-5" aria-hidden="true" tabindex="-1"></a>target_variable <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;GPP_NT_VUT_REF&quot;</span>)</span>
<span id="cb862-6"><a href="ch-11.html#cb862-6" aria-hidden="true" tabindex="-1"></a>column_names <span class="ot">&lt;-</span> <span class="fu">colnames</span>(df)</span>
<span id="cb862-7"><a href="ch-11.html#cb862-7" aria-hidden="true" tabindex="-1"></a>predictors <span class="ot">&lt;-</span> column_names[<span class="sc">!</span>column_names <span class="sc">%in%</span> <span class="fu">c</span>(target_variable, time_cols)] <span class="do">## time stamp columns and the target variables are not used as predictors</span></span></code></pre></div>
<p>Next, we create indices to split the entire dataset into train and test (80/20) split.</p>
<p>The 80% of our data will be used to train the models and the rest 20% will be our held-out test set to evaluate the performance of the model.</p>
<div class="sourceCode" id="cb863"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb863-1"><a href="ch-11.html#cb863-1" aria-hidden="true" tabindex="-1"></a><span class="do">## set seed for reproducibility </span></span>
<span id="cb863-2"><a href="ch-11.html#cb863-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">2021</span>)</span>
<span id="cb863-3"><a href="ch-11.html#cb863-3" aria-hidden="true" tabindex="-1"></a><span class="do">## First shuffle the dataset (Hint: sample() )</span></span>
<span id="cb863-4"><a href="ch-11.html#cb863-4" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> df[<span class="fu">sample</span>(<span class="fu">nrow</span>(df)),]</span>
<span id="cb863-5"><a href="ch-11.html#cb863-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb863-6"><a href="ch-11.html#cb863-6" aria-hidden="true" tabindex="-1"></a><span class="do">## get indices for train_data into train and test splits (Hint: sample() )</span></span>
<span id="cb863-7"><a href="ch-11.html#cb863-7" aria-hidden="true" tabindex="-1"></a>ind <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="dv">2</span>, <span class="fu">nrow</span>(df), <span class="at">replace=</span><span class="cn">TRUE</span>, <span class="at">prob =</span> <span class="fu">c</span>(<span class="fl">0.8</span>,<span class="fl">0.2</span>))</span>
<span id="cb863-8"><a href="ch-11.html#cb863-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb863-9"><a href="ch-11.html#cb863-9" aria-hidden="true" tabindex="-1"></a><span class="do">## Use the  indicies to get test and train splits</span></span>
<span id="cb863-10"><a href="ch-11.html#cb863-10" aria-hidden="true" tabindex="-1"></a>train_split <span class="ot">&lt;-</span> df[ind <span class="sc">==</span> <span class="dv">1</span>, ] <span class="do">## include all columns </span></span>
<span id="cb863-11"><a href="ch-11.html#cb863-11" aria-hidden="true" tabindex="-1"></a>test_split <span class="ot">&lt;-</span> df[ind <span class="sc">==</span> <span class="dv">2</span>, ]  <span class="do">## include all columns </span></span></code></pre></div>
<p>Next we separate the target variable from the predictors.</p>
<div class="sourceCode" id="cb864"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb864-1"><a href="ch-11.html#cb864-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Save time stamps for the test and train splits, as a separate data frame for time-series plots </span></span>
<span id="cb864-2"><a href="ch-11.html#cb864-2" aria-hidden="true" tabindex="-1"></a>train_data_time <span class="ot">&lt;-</span> train_split<span class="sc">$</span>TIMESTAMP_START</span>
<span id="cb864-3"><a href="ch-11.html#cb864-3" aria-hidden="true" tabindex="-1"></a>test_data_time <span class="ot">&lt;-</span> test_split<span class="sc">$</span>TIMESTAMP_START</span>
<span id="cb864-4"><a href="ch-11.html#cb864-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb864-5"><a href="ch-11.html#cb864-5" aria-hidden="true" tabindex="-1"></a><span class="do">## Separate the splits to get train_data, train_target, test_data and test_target. After this you should have 4 corresponding dataframes. Also drop the time stamp columns from the train data and test data as we treat the observations as IID. ( we have stored them separately for plots )</span></span>
<span id="cb864-6"><a href="ch-11.html#cb864-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb864-7"><a href="ch-11.html#cb864-7" aria-hidden="true" tabindex="-1"></a>train_target <span class="ot">&lt;-</span>  train_split <span class="sc">%&gt;%</span> <span class="fu">select</span>(target_variable)</span>
<span id="cb864-8"><a href="ch-11.html#cb864-8" aria-hidden="true" tabindex="-1"></a>test_target <span class="ot">&lt;-</span> test_split <span class="sc">%&gt;%</span> <span class="fu">select</span>(target_variable)</span>
<span id="cb864-9"><a href="ch-11.html#cb864-9" aria-hidden="true" tabindex="-1"></a>train_data <span class="ot">&lt;-</span> train_split <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">-</span><span class="fu">one_of</span>(<span class="fu">c</span>(target_variable, time_cols)))</span>
<span id="cb864-10"><a href="ch-11.html#cb864-10" aria-hidden="true" tabindex="-1"></a>test_data <span class="ot">&lt;-</span> test_split <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">-</span><span class="fu">one_of</span>(<span class="fu">c</span>(target_variable, time_cols)))</span>
<span id="cb864-11"><a href="ch-11.html#cb864-11" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(test_data)</span></code></pre></div>
<pre><code>##          TA_F SW_IN_F LW_IN_F VPD_F   PA_F   P_F  WS_F CO2_F_MDS PPFD_IN
## 94853   4.473 116.437 263.402 2.854 92.573 0.000 4.911   391.322 230.800
## 119494  6.142 132.001 341.487 0.123 94.599 0.201 1.483   489.318 279.600
## 91493  13.550 446.310 340.507 6.240 93.764 0.026 0.625   372.174 938.000
## 65225   9.200   0.000 346.635 3.556 93.191 0.000 6.901   371.297   4.106
## 119406 14.450 320.703 297.376 5.043 93.937 0.000 0.365   393.235 706.000
## 41390  12.480   0.000 276.947 6.894 93.491 0.000 0.859   358.149   4.262
##        SWC_F_MDS_1 SWC_F_MDS_2 SWC_F_MDS_3    WS      WD    RH
## 94853       27.760      24.550      24.140 4.911 225.587 66.06
## 119494      28.861      28.542      28.722 1.483 105.247 98.70
## 91493       27.620      24.990      26.960 0.625 222.012 59.82
## 65225       15.780      17.330      16.660 6.901 252.697 69.45
## 119406      27.528      26.817      27.282 0.365 198.350 69.37
## 41390       18.420      20.860      21.390 0.859 137.811 52.39</code></pre>
</div>
<div id="center-and-scale" class="section level3" number="11.2.3">
<h3><span class="header-section-number">11.2.3</span> Center and scale</h3>
<p>Take care to extract the centering and scaling parameters from the training set and use them to center and scale your test data.</p>
<p>If you use the entire data set to get the centering and scaling parameters, we actually use information from the test-data, which is something we don’t have access to in real life. Thus doing so results in <em>information leak</em> from the test data, and we may get results more optimistic than our model’s true predictions. Follow the steps below to carry out centering and scaling in a proper way:</p>
<ul>
<li>Extract normalisation parameters from <em>train</em> data for numeric predictors</li>
<li>Normalize train data using these parameters</li>
<li>Normalize test data using the parameters extracted from <em>train</em> data</li>
<li>Generally we only normalize the numeric variables and not the factors</li>
</ul>
<div class="sourceCode" id="cb866"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb866-1"><a href="ch-11.html#cb866-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Make use of recipe() or any other function you wish, to scale and center each of the columns</span></span>
<span id="cb866-2"><a href="ch-11.html#cb866-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb866-3"><a href="ch-11.html#cb866-3" aria-hidden="true" tabindex="-1"></a>train_data_stat <span class="ot">&lt;-</span> <span class="fu">preProcess</span>(train_data, <span class="at">method =</span> <span class="fu">c</span>(<span class="st">&quot;center&quot;</span>,<span class="st">&quot;scale&quot;</span>))    <span class="co"># get the statistics (mean, variance, etc) of numeric cols</span></span>
<span id="cb866-4"><a href="ch-11.html#cb866-4" aria-hidden="true" tabindex="-1"></a>train_data[, predictors] <span class="ot">&lt;-</span> <span class="fu">predict</span>(train_data_stat, train_data)  <span class="co"># transform the train data to center and scale it</span></span>
<span id="cb866-5"><a href="ch-11.html#cb866-5" aria-hidden="true" tabindex="-1"></a>test_data[, predictors] <span class="ot">&lt;-</span> <span class="fu">predict</span>(train_data_stat, test_data)    <span class="co"># transform the test data to center and scale it</span></span>
<span id="cb866-6"><a href="ch-11.html#cb866-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb866-7"><a href="ch-11.html#cb866-7" aria-hidden="true" tabindex="-1"></a><span class="co"># OR </span></span>
<span id="cb866-8"><a href="ch-11.html#cb866-8" aria-hidden="true" tabindex="-1"></a><span class="co"># scale_and_center&lt;- recipe(train_data) %&gt;%</span></span>
<span id="cb866-9"><a href="ch-11.html#cb866-9" aria-hidden="true" tabindex="-1"></a><span class="co">#                             step_center(all_numeric()) %&gt;%</span></span>
<span id="cb866-10"><a href="ch-11.html#cb866-10" aria-hidden="true" tabindex="-1"></a><span class="co">#                             step_scale(all_numeric())</span></span>
<span id="cb866-11"><a href="ch-11.html#cb866-11" aria-hidden="true" tabindex="-1"></a><span class="co"># prep_recipe &lt;- prep(scale_and_center, training = train_data)</span></span>
<span id="cb866-12"><a href="ch-11.html#cb866-12" aria-hidden="true" tabindex="-1"></a><span class="co"># train_data &lt;- bake(prep_recipe, new_data = train_data)</span></span>
<span id="cb866-13"><a href="ch-11.html#cb866-13" aria-hidden="true" tabindex="-1"></a><span class="co"># test_data &lt;- bake(prep_recipe, new_data = test_data)</span></span>
<span id="cb866-14"><a href="ch-11.html#cb866-14" aria-hidden="true" tabindex="-1"></a><span class="do">## Display the summary of train data and test data</span></span>
<span id="cb866-15"><a href="ch-11.html#cb866-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb866-16"><a href="ch-11.html#cb866-16" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(train_data)</span></code></pre></div>
<pre><code>##       TA_F             SW_IN_F           LW_IN_F            VPD_F        
##  Min.   :-3.07087   Min.   :-0.5797   Min.   :-3.5688   Min.   :-0.7826  
##  1st Qu.:-0.78187   1st Qu.:-0.5797   1st Qu.:-0.6240   1st Qu.:-0.7360  
##  Median : 0.00522   Median :-0.5706   Median : 0.1365   Median :-0.3832  
##  Mean   : 0.00000   Mean   : 0.0000   Mean   : 0.0000   Mean   : 0.0000  
##  3rd Qu.: 0.75652   3rd Qu.: 0.1359   3rd Qu.: 0.7074   3rd Qu.: 0.3563  
##  Max.   : 2.91712   Max.   : 4.1269   Max.   : 2.5027   Max.   : 7.6424  
##       PA_F              P_F               WS_F           CO2_F_MDS       
##  Min.   :-4.9809   Min.   :-0.4291   Min.   :-1.3776   Min.   :-3.29786  
##  1st Qu.:-0.5438   1st Qu.:-0.4291   1st Qu.:-0.7414   1st Qu.:-0.46095  
##  Median : 0.1137   Median :-0.4291   Median :-0.2446   Median :-0.17433  
##  Mean   : 0.0000   Mean   : 0.0000   Mean   : 0.0000   Mean   : 0.00000  
##  3rd Qu.: 0.6697   3rd Qu.:-0.0453   3rd Qu.: 0.4881   3rd Qu.: 0.09763  
##  Max.   : 2.7963   Max.   :22.6680   Max.   : 5.9249   Max.   :10.73269  
##     PPFD_IN         SWC_F_MDS_1        SWC_F_MDS_2       SWC_F_MDS_3      
##  Min.   :-0.5767   Min.   :-3.06114   Min.   :-2.7664   Min.   :-2.85365  
##  1st Qu.:-0.5752   1st Qu.:-0.66958   1st Qu.:-0.9207   1st Qu.:-0.73046  
##  Median :-0.5700   Median :-0.06612   Median : 0.1963   Median : 0.09601  
##  Mean   : 0.0000   Mean   : 0.00000   Mean   : 0.0000   Mean   : 0.00000  
##  3rd Qu.: 0.1117   3rd Qu.: 0.78896   3rd Qu.: 0.8196   3rd Qu.: 0.77429  
##  Max.   : 3.9776   Max.   : 2.51471   Max.   : 2.5913   Max.   : 3.02886  
##        WS                WD                RH         
##  Min.   :-1.3776   Min.   :-2.2447   Min.   :-3.3769  
##  1st Qu.:-0.7414   1st Qu.:-1.0371   1st Qu.:-0.7124  
##  Median :-0.2446   Median : 0.4799   Median : 0.1570  
##  Mean   : 0.0000   Mean   : 0.0000   Mean   : 0.0000  
##  3rd Qu.: 0.4881   3rd Qu.: 0.8422   3rd Qu.: 0.9816  
##  Max.   : 5.9249   Max.   : 2.0263   Max.   : 1.1509</code></pre>
<div class="sourceCode" id="cb868"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb868-1"><a href="ch-11.html#cb868-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(test_data)</span></code></pre></div>
<pre><code>##       TA_F               SW_IN_F             LW_IN_F        
##  Min.   :-3.0758483   Min.   :-0.579662   Min.   :-3.51786  
##  1st Qu.:-0.7919767   1st Qu.:-0.579662   1st Qu.:-0.64789  
##  Median :-0.0009991   Median :-0.570660   Median : 0.11998  
##  Mean   :-0.0034195   Mean   : 0.009953   Mean   :-0.01008  
##  3rd Qu.: 0.7527867   3rd Qu.: 0.155803   3rd Qu.: 0.70732  
##  Max.   : 2.8885133   Max.   : 4.014066   Max.   : 2.47299  
##      VPD_F                PA_F               P_F                WS_F         
##  Min.   :-0.782558   Min.   :-4.55211   Min.   :-0.42906   Min.   :-1.37378  
##  1st Qu.:-0.734788   1st Qu.:-0.52891   1st Qu.:-0.42906   1st Qu.:-0.74359  
##  Median :-0.383248   Median : 0.12314   Median :-0.42906   Median :-0.25731  
##  Mean   : 0.001133   Mean   : 0.01085   Mean   :-0.01593   Mean   :-0.01063  
##  3rd Qu.: 0.357802   3rd Qu.: 0.67373   3rd Qu.:-0.07132   3rd Qu.: 0.47322  
##  Max.   : 7.332737   Max.   : 2.78408   Max.   :22.66796   Max.   : 5.47831  
##    CO2_F_MDS           PPFD_IN           SWC_F_MDS_1         SWC_F_MDS_2       
##  Min.   :-3.11425   Min.   :-0.576680   Min.   :-3.050001   Min.   :-2.775959  
##  1st Qu.:-0.46494   1st Qu.:-0.575222   1st Qu.:-0.667353   1st Qu.:-0.942087  
##  Median :-0.17863   Median :-0.570717   Median :-0.075031   Median : 0.192294  
##  Mean   :-0.01124   Mean   : 0.008878   Mean   :-0.005281   Mean   :-0.009313  
##  3rd Qu.: 0.09051   3rd Qu.: 0.133568   3rd Qu.: 0.777824   3rd Qu.: 0.806045  
##  Max.   :10.27260   Max.   : 3.824155   Max.   : 2.481306   Max.   : 2.529647  
##   SWC_F_MDS_3              WS                 WD                  RH           
##  Min.   :-2.850802   Min.   :-1.37378   Min.   :-2.242558   Min.   :-3.357215  
##  1st Qu.:-0.721914   1st Qu.:-0.74359   1st Qu.:-1.042955   1st Qu.:-0.710242  
##  Median : 0.090312   Median :-0.25731   Median : 0.466688   Median : 0.151513  
##  Mean   :-0.002816   Mean   :-0.01063   Mean   :-0.005619   Mean   :-0.000871  
##  3rd Qu.: 0.754343   3rd Qu.: 0.47322   3rd Qu.: 0.842417   3rd Qu.: 0.970671  
##  Max.   : 2.845898   Max.   : 5.47831   Max.   : 2.022990   Max.   : 1.150886</code></pre>
<div class="sourceCode" id="cb870"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb870-1"><a href="ch-11.html#cb870-1" aria-hidden="true" tabindex="-1"></a>train_data_stat <span class="ot">&lt;-</span> <span class="fu">preProcess</span>(train_data, <span class="at">method =</span> <span class="fu">c</span>(<span class="st">&quot;center&quot;</span>, <span class="st">&quot;scale&quot;</span>))</span>
<span id="cb870-2"><a href="ch-11.html#cb870-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb870-3"><a href="ch-11.html#cb870-3" aria-hidden="true" tabindex="-1"></a><span class="co">#initialize of same dimension</span></span>
<span id="cb870-4"><a href="ch-11.html#cb870-4" aria-hidden="true" tabindex="-1"></a>train_data_cs <span class="ot">&lt;-</span> train_data</span>
<span id="cb870-5"><a href="ch-11.html#cb870-5" aria-hidden="true" tabindex="-1"></a>test_data_cs <span class="ot">&lt;-</span> test_data</span>
<span id="cb870-6"><a href="ch-11.html#cb870-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb870-7"><a href="ch-11.html#cb870-7" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">ncol</span>(train_data)){</span>
<span id="cb870-8"><a href="ch-11.html#cb870-8" aria-hidden="true" tabindex="-1"></a>  <span class="co">#center and scale training data set</span></span>
<span id="cb870-9"><a href="ch-11.html#cb870-9" aria-hidden="true" tabindex="-1"></a>  train_data_cs[,i] <span class="ot">&lt;-</span> (train_data[,i] <span class="sc">-</span> train_data_stat<span class="sc">$</span>mean[i])<span class="sc">/</span>train_data_stat<span class="sc">$</span>std[i]</span>
<span id="cb870-10"><a href="ch-11.html#cb870-10" aria-hidden="true" tabindex="-1"></a>  <span class="co">#center and scale testing data set</span></span>
<span id="cb870-11"><a href="ch-11.html#cb870-11" aria-hidden="true" tabindex="-1"></a>  test_data_cs[,i] <span class="ot">&lt;-</span> (test_data[,i] <span class="sc">-</span> train_data_stat<span class="sc">$</span>mean[i])<span class="sc">/</span>train_data_stat<span class="sc">$</span>std[i]</span>
<span id="cb870-12"><a href="ch-11.html#cb870-12" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb870-13"><a href="ch-11.html#cb870-13" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(train_data_cs)</span></code></pre></div>
<pre><code>##       TA_F             SW_IN_F           LW_IN_F            VPD_F        
##  Min.   :-3.07087   Min.   :-0.5797   Min.   :-3.5688   Min.   :-0.7826  
##  1st Qu.:-0.78187   1st Qu.:-0.5797   1st Qu.:-0.6240   1st Qu.:-0.7360  
##  Median : 0.00522   Median :-0.5706   Median : 0.1365   Median :-0.3832  
##  Mean   : 0.00000   Mean   : 0.0000   Mean   : 0.0000   Mean   : 0.0000  
##  3rd Qu.: 0.75652   3rd Qu.: 0.1359   3rd Qu.: 0.7074   3rd Qu.: 0.3563  
##  Max.   : 2.91712   Max.   : 4.1269   Max.   : 2.5027   Max.   : 7.6424  
##       PA_F              P_F               WS_F           CO2_F_MDS       
##  Min.   :-4.9809   Min.   :-0.4291   Min.   :-1.3776   Min.   :-3.29786  
##  1st Qu.:-0.5438   1st Qu.:-0.4291   1st Qu.:-0.7414   1st Qu.:-0.46095  
##  Median : 0.1137   Median :-0.4291   Median :-0.2446   Median :-0.17433  
##  Mean   : 0.0000   Mean   : 0.0000   Mean   : 0.0000   Mean   : 0.00000  
##  3rd Qu.: 0.6697   3rd Qu.:-0.0453   3rd Qu.: 0.4881   3rd Qu.: 0.09763  
##  Max.   : 2.7963   Max.   :22.6680   Max.   : 5.9249   Max.   :10.73269  
##     PPFD_IN         SWC_F_MDS_1        SWC_F_MDS_2       SWC_F_MDS_3      
##  Min.   :-0.5767   Min.   :-3.06114   Min.   :-2.7664   Min.   :-2.85365  
##  1st Qu.:-0.5752   1st Qu.:-0.66958   1st Qu.:-0.9207   1st Qu.:-0.73046  
##  Median :-0.5700   Median :-0.06612   Median : 0.1963   Median : 0.09601  
##  Mean   : 0.0000   Mean   : 0.00000   Mean   : 0.0000   Mean   : 0.00000  
##  3rd Qu.: 0.1117   3rd Qu.: 0.78896   3rd Qu.: 0.8196   3rd Qu.: 0.77429  
##  Max.   : 3.9776   Max.   : 2.51471   Max.   : 2.5913   Max.   : 3.02886  
##        WS                WD                RH         
##  Min.   :-1.3776   Min.   :-2.2447   Min.   :-3.3769  
##  1st Qu.:-0.7414   1st Qu.:-1.0371   1st Qu.:-0.7124  
##  Median :-0.2446   Median : 0.4799   Median : 0.1570  
##  Mean   : 0.0000   Mean   : 0.0000   Mean   : 0.0000  
##  3rd Qu.: 0.4881   3rd Qu.: 0.8422   3rd Qu.: 0.9816  
##  Max.   : 5.9249   Max.   : 2.0263   Max.   : 1.1509</code></pre>
<div class="sourceCode" id="cb872"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb872-1"><a href="ch-11.html#cb872-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(test_data_cs)</span></code></pre></div>
<pre><code>##       TA_F               SW_IN_F             LW_IN_F        
##  Min.   :-3.0758483   Min.   :-0.579662   Min.   :-3.51786  
##  1st Qu.:-0.7919767   1st Qu.:-0.579662   1st Qu.:-0.64789  
##  Median :-0.0009991   Median :-0.570660   Median : 0.11998  
##  Mean   :-0.0034195   Mean   : 0.009953   Mean   :-0.01008  
##  3rd Qu.: 0.7527867   3rd Qu.: 0.155803   3rd Qu.: 0.70732  
##  Max.   : 2.8885133   Max.   : 4.014066   Max.   : 2.47299  
##      VPD_F                PA_F               P_F                WS_F         
##  Min.   :-0.782558   Min.   :-4.55211   Min.   :-0.42906   Min.   :-1.37378  
##  1st Qu.:-0.734788   1st Qu.:-0.52891   1st Qu.:-0.42906   1st Qu.:-0.74359  
##  Median :-0.383248   Median : 0.12314   Median :-0.42906   Median :-0.25731  
##  Mean   : 0.001133   Mean   : 0.01085   Mean   :-0.01593   Mean   :-0.01063  
##  3rd Qu.: 0.357802   3rd Qu.: 0.67373   3rd Qu.:-0.07132   3rd Qu.: 0.47322  
##  Max.   : 7.332737   Max.   : 2.78408   Max.   :22.66796   Max.   : 5.47831  
##    CO2_F_MDS           PPFD_IN           SWC_F_MDS_1         SWC_F_MDS_2       
##  Min.   :-3.11425   Min.   :-0.576680   Min.   :-3.050001   Min.   :-2.775959  
##  1st Qu.:-0.46494   1st Qu.:-0.575222   1st Qu.:-0.667353   1st Qu.:-0.942087  
##  Median :-0.17863   Median :-0.570717   Median :-0.075031   Median : 0.192294  
##  Mean   :-0.01124   Mean   : 0.008878   Mean   :-0.005281   Mean   :-0.009313  
##  3rd Qu.: 0.09051   3rd Qu.: 0.133568   3rd Qu.: 0.777824   3rd Qu.: 0.806045  
##  Max.   :10.27260   Max.   : 3.824155   Max.   : 2.481306   Max.   : 2.529647  
##   SWC_F_MDS_3              WS                 WD                  RH           
##  Min.   :-2.850802   Min.   :-1.37378   Min.   :-2.242558   Min.   :-3.357215  
##  1st Qu.:-0.721914   1st Qu.:-0.74359   1st Qu.:-1.042955   1st Qu.:-0.710242  
##  Median : 0.090312   Median :-0.25731   Median : 0.466688   Median : 0.151513  
##  Mean   :-0.002816   Mean   :-0.01063   Mean   :-0.005619   Mean   :-0.000871  
##  3rd Qu.: 0.754343   3rd Qu.: 0.47322   3rd Qu.: 0.842417   3rd Qu.: 0.970671  
##  Max.   : 2.845898   Max.   : 5.47831   Max.   : 2.022990   Max.   : 1.150886</code></pre>
<p>Are all of the columns in the training set are centered perfectly with a mean = 0.0000? Yes!
Are all of the columns in the testing set are centered perfectly with a mean = 0.0000? No!</p>
<p>Explanation: This is because the mean of the training set is used to center it, thus that is centered perfectly. Using the statistics of the train data, we centered the test data, thus we can see the data is not exactly centered, but it is normalized enough to bring all features to 1 scale and to not affect the predictions at test time.</p>
</div>
<div id="building-a-simple-model-with-keras-subtask-1" class="section level3" number="11.2.4">
<h3><span class="header-section-number">11.2.4</span> Building a simple model with keras ( SubTask 1)</h3>
<p>To train keras models, the input data needs to be as a R matrix or arrays. Since all our features are numeric, we can safely convert the train and test datasets to matrices.</p>
<div class="sourceCode" id="cb874"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb874-1"><a href="ch-11.html#cb874-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Convert the &quot;train_data&quot;, &quot;train_targets&quot;, &quot;test_data&quot; and &quot;test_targets&quot;, to matrix using as.matrix()  </span></span>
<span id="cb874-2"><a href="ch-11.html#cb874-2" aria-hidden="true" tabindex="-1"></a>train_data <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(train_data)</span>
<span id="cb874-3"><a href="ch-11.html#cb874-3" aria-hidden="true" tabindex="-1"></a>train_target <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(train_target)</span>
<span id="cb874-4"><a href="ch-11.html#cb874-4" aria-hidden="true" tabindex="-1"></a>test_data <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(test_data)</span>
<span id="cb874-5"><a href="ch-11.html#cb874-5" aria-hidden="true" tabindex="-1"></a>test_target <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(test_target)</span></code></pre></div>
<p>Now we can build a sequential model with keras. Define a model with 1 hidden layer with 20 units, and 1 output unit, for the target variable. Remember to specify a non-linear activation such as Sigmoid or ReLU for the hidden layer, and a linear activation function for the output unit (as it is a regression task). If we don’t specify a non-linear activation we will just be training a linear mapping!
When compiling the model take care to use appropriate optimiser, loss and evaluation metric. Use mean squared error as the loss, and mean absolute error as the evaluation metric</p>
<p><em>Side Note</em>: Since our model is not very deep in this application (only 1 hidden layer), we can use any of the non-linear activations (tanh, sigmoid, or ReLu), but in practice when we train deep neural networks (with a large number of hidden layers) we prefer to use ReLU as the activation function, as it does not suffer from the problem of Vanishing or Exploding gradients (which happens if we use sigmoid or tanh). In a nutshell : In a network of n hidden layers, n derivatives will be multiplied together. If the derivatives are large then the gradient will increase exponentially as we propagate down the model until they eventually explode, and this is what we call the problem of exploding gradient. Alternatively, if the derivatives are small then the gradient will decrease exponentially as we propagate through the model until it eventually vanishes, and this is the vanishing gradient problem. [Source for the interested] (<a href="https://towardsdatascience.com/the-vanishing-exploding-gradient-problem-in-deep-neural-networks-191358470c11" class="uri">https://towardsdatascience.com/the-vanishing-exploding-gradient-problem-in-deep-neural-networks-191358470c11</a>).</p>
<div class="sourceCode" id="cb875"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb875-1"><a href="ch-11.html#cb875-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Define and compile the model </span></span>
<span id="cb875-2"><a href="ch-11.html#cb875-2" aria-hidden="true" tabindex="-1"></a>model <span class="ot">&lt;-</span> <span class="fu">keras_model_sequential</span>()</span>
<span id="cb875-3"><a href="ch-11.html#cb875-3" aria-hidden="true" tabindex="-1"></a>model <span class="sc">%&gt;%</span> </span>
<span id="cb875-4"><a href="ch-11.html#cb875-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">layer_dense</span>(<span class="at">units =</span> <span class="dv">20</span>, <span class="at">activation =</span> <span class="st">&#39;relu&#39;</span>, <span class="at">input_shape =</span> <span class="fu">ncol</span>(train_data)) <span class="sc">%&gt;%</span></span>
<span id="cb875-5"><a href="ch-11.html#cb875-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">layer_dense</span>(<span class="at">units =</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb875-6"><a href="ch-11.html#cb875-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">compile</span>( <span class="at">optimizer =</span> <span class="fu">optimizer_adam</span>(<span class="at">lr=</span><span class="fl">0.001</span>),</span>
<span id="cb875-7"><a href="ch-11.html#cb875-7" aria-hidden="true" tabindex="-1"></a>           <span class="at">loss =</span> <span class="st">&#39;mse&#39;</span>,</span>
<span id="cb875-8"><a href="ch-11.html#cb875-8" aria-hidden="true" tabindex="-1"></a>           <span class="at">metrics =</span> <span class="fu">list</span>(<span class="st">&#39;mean_absolute_error&#39;</span>))</span>
<span id="cb875-9"><a href="ch-11.html#cb875-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb875-10"><a href="ch-11.html#cb875-10" aria-hidden="true" tabindex="-1"></a><span class="do">## Print the summary of the model using summary()</span></span>
<span id="cb875-11"><a href="ch-11.html#cb875-11" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model)</span></code></pre></div>
<div class="sourceCode" id="cb876"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb876-1"><a href="ch-11.html#cb876-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Model: &quot;sequential&quot;</span></span>
<span id="cb876-2"><a href="ch-11.html#cb876-2" aria-hidden="true" tabindex="-1"></a><span class="do">## ________________________________________________________________________________</span></span>
<span id="cb876-3"><a href="ch-11.html#cb876-3" aria-hidden="true" tabindex="-1"></a><span class="do">## Layer (type)                        Output Shape                    Param #     </span></span>
<span id="cb876-4"><a href="ch-11.html#cb876-4" aria-hidden="true" tabindex="-1"></a><span class="do">## ================================================================================</span></span>
<span id="cb876-5"><a href="ch-11.html#cb876-5" aria-hidden="true" tabindex="-1"></a><span class="do">## dense (Dense)                       (None, 20)                      320         </span></span>
<span id="cb876-6"><a href="ch-11.html#cb876-6" aria-hidden="true" tabindex="-1"></a><span class="do">## ________________________________________________________________________________</span></span>
<span id="cb876-7"><a href="ch-11.html#cb876-7" aria-hidden="true" tabindex="-1"></a><span class="do">## dense_1 (Dense)                     (None, 1)                       21          </span></span>
<span id="cb876-8"><a href="ch-11.html#cb876-8" aria-hidden="true" tabindex="-1"></a><span class="do">## ================================================================================</span></span>
<span id="cb876-9"><a href="ch-11.html#cb876-9" aria-hidden="true" tabindex="-1"></a><span class="do">## Total params: 341</span></span>
<span id="cb876-10"><a href="ch-11.html#cb876-10" aria-hidden="true" tabindex="-1"></a><span class="do">## Trainable params: 341</span></span>
<span id="cb876-11"><a href="ch-11.html#cb876-11" aria-hidden="true" tabindex="-1"></a><span class="do">## Non-trainable params: 0</span></span>
<span id="cb876-12"><a href="ch-11.html#cb876-12" aria-hidden="true" tabindex="-1"></a><span class="do">## ________________________________________________________________________________</span></span></code></pre></div>
<p>How many training parameters are needed? Can you account for the total number of parameters at each layer?
The network needs 341 parameters. These are split as Layer 1: 320 parameters – (20x15) weight and (20x1) bias matrix, and Layer 2: 21 parameters – (20x1) weight matrix and (1x1) bias unit.</p>
<div class="sourceCode" id="cb877"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb877-1"><a href="ch-11.html#cb877-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Fit the model and store the training history. Use a reasonable batch_size, epochs, and validation_split</span></span>
<span id="cb877-2"><a href="ch-11.html#cb877-2" aria-hidden="true" tabindex="-1"></a><span class="do">## The validation split here is a portion of the training data that is kept apart to evaluate the loss and evaluation metric at the end of each epoch. The model will set apart this fraction of the training data, will not train on it, and will evaluate the loss and any model metrics on this data at the end of each epoch. The validation data is selected from the last samples in the x and y data provided, before shuffling. This is useful for stopping training after a certain number of epochs if we see the validation error increasing with training. We can also program the model to do so, this is called Early Stopping. </span></span>
<span id="cb877-3"><a href="ch-11.html#cb877-3" aria-hidden="true" tabindex="-1"></a><span class="do">## This can be done by using a training callback for early stopping: callback_early_stopping()</span></span>
<span id="cb877-4"><a href="ch-11.html#cb877-4" aria-hidden="true" tabindex="-1"></a><span class="do">## More info on training callbacks: https://keras.rstudio.com/articles/training_callbacks.html</span></span>
<span id="cb877-5"><a href="ch-11.html#cb877-5" aria-hidden="true" tabindex="-1"></a><span class="do">## More info on the fit function https://keras.rstudio.com/reference/fit.html</span></span>
<span id="cb877-6"><a href="ch-11.html#cb877-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb877-7"><a href="ch-11.html#cb877-7" aria-hidden="true" tabindex="-1"></a><span class="do">## You can choose the number of epochs to train, manually by monitoring the validation loss while training and selecting the number of epochs where the validation loss starts to increase. Alternatively you can use early stopping to pause the model training at an optimal point for you. Choose whatever me(thod you feel is best! </span></span>
<span id="cb877-8"><a href="ch-11.html#cb877-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb877-9"><a href="ch-11.html#cb877-9" aria-hidden="true" tabindex="-1"></a>history <span class="ot">&lt;-</span> <span class="fu">fit</span>(</span>
<span id="cb877-10"><a href="ch-11.html#cb877-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">object           =</span> model, </span>
<span id="cb877-11"><a href="ch-11.html#cb877-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">x                =</span> train_data, </span>
<span id="cb877-12"><a href="ch-11.html#cb877-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">y                =</span> train_target,</span>
<span id="cb877-13"><a href="ch-11.html#cb877-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">batch_size       =</span> <span class="dv">128</span>, </span>
<span id="cb877-14"><a href="ch-11.html#cb877-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">validation_split =</span> <span class="fl">0.15</span>, </span>
<span id="cb877-15"><a href="ch-11.html#cb877-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">epochs =</span> <span class="dv">50</span>,</span>
<span id="cb877-16"><a href="ch-11.html#cb877-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">shuffle =</span> <span class="cn">TRUE</span>, </span>
<span id="cb877-17"><a href="ch-11.html#cb877-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">callbacks =</span> <span class="fu">list</span>(<span class="fu">callback_early_stopping</span>( <span class="at">monitor =</span> <span class="st">&quot;val_loss&quot;</span>,  <span class="at">patience =</span> <span class="dv">0</span>))</span>
<span id="cb877-18"><a href="ch-11.html#cb877-18" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb877-19"><a href="ch-11.html#cb877-19" aria-hidden="true" tabindex="-1"></a><span class="do">##  Patience : number of epochs with no improvement after which training will be stopped.</span></span></code></pre></div>
<p>Now that the model training is complete we can look at the history, plot the training history, and look at our trained weights. Pay attention to the trained weight matrices and try to recognise the transformation weights and the bias units.</p>
<div class="sourceCode" id="cb878"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb878-1"><a href="ch-11.html#cb878-1" aria-hidden="true" tabindex="-1"></a><span class="co"># print(history)</span></span>
<span id="cb878-2"><a href="ch-11.html#cb878-2" aria-hidden="true" tabindex="-1"></a><span class="co"># plot history </span></span>
<span id="cb878-3"><a href="ch-11.html#cb878-3" aria-hidden="true" tabindex="-1"></a><span class="co"># plot(history, metrics = c(&quot;loss&quot;), smooth = getOption(&quot;keras.plot.history.smooth&quot;, TRUE))</span></span>
<span id="cb878-4"><a href="ch-11.html#cb878-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb878-5"><a href="ch-11.html#cb878-5" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(history)</span>
<span id="cb878-6"><a href="ch-11.html#cb878-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb878-7"><a href="ch-11.html#cb878-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Get weights of model</span></span>
<span id="cb878-8"><a href="ch-11.html#cb878-8" aria-hidden="true" tabindex="-1"></a><span class="fu">get_weights</span>(model)</span></code></pre></div>
<p><img src="figures/11_output-history.png" /></p>
<div class="sourceCode" id="cb879"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb879-1"><a href="ch-11.html#cb879-1" aria-hidden="true" tabindex="-1"></a><span class="do">## [[1]]</span></span>
<span id="cb879-2"><a href="ch-11.html#cb879-2" aria-hidden="true" tabindex="-1"></a><span class="do">##               [,1]        [,2]        [,3]        [,4]       [,5]       [,6]</span></span>
<span id="cb879-3"><a href="ch-11.html#cb879-3" aria-hidden="true" tabindex="-1"></a><span class="do">##  [1,]  2.869463682  2.19894099 -2.60152483  0.51017755  8.1782951 -0.1264951</span></span>
<span id="cb879-4"><a href="ch-11.html#cb879-4" aria-hidden="true" tabindex="-1"></a><span class="do">##  [2,] -0.257749677 -6.38722610 -0.26673290  0.12389217  1.9635506  5.5812244</span></span>
<span id="cb879-5"><a href="ch-11.html#cb879-5" aria-hidden="true" tabindex="-1"></a><span class="do">##  [3,] -0.810692906 -0.22325119  3.41061616  1.36443913  1.3101629  9.2959471</span></span>
<span id="cb879-6"><a href="ch-11.html#cb879-6" aria-hidden="true" tabindex="-1"></a><span class="do">##  [4,] -3.332208872 -3.74554729  0.69165123 -2.23075891  1.1527030 -7.5465598</span></span>
<span id="cb879-7"><a href="ch-11.html#cb879-7" aria-hidden="true" tabindex="-1"></a><span class="do">##  [5,]  0.009921599 -0.57942855  0.06560050  0.35118413  1.8717020  0.5662153</span></span>
<span id="cb879-8"><a href="ch-11.html#cb879-8" aria-hidden="true" tabindex="-1"></a><span class="do">##  [6,] -0.639508903 -0.51970196 -7.03948593 -0.35604978 -1.0026512  0.5032421</span></span>
<span id="cb879-9"><a href="ch-11.html#cb879-9" aria-hidden="true" tabindex="-1"></a><span class="do">##  [7,]  0.117622830  0.18488406 -0.07820407 -0.74191588  0.4872454  1.5795393</span></span>
<span id="cb879-10"><a href="ch-11.html#cb879-10" aria-hidden="true" tabindex="-1"></a><span class="do">##  [8,] -1.078623652  0.32196170 -0.07609604 -0.92650974 -2.3898470  1.1969419</span></span>
<span id="cb879-11"><a href="ch-11.html#cb879-11" aria-hidden="true" tabindex="-1"></a><span class="do">##  [9,] -0.291276693 -7.54775238 -0.15960379 -0.36234933  2.0654554 -0.3033638</span></span>
<span id="cb879-12"><a href="ch-11.html#cb879-12" aria-hidden="true" tabindex="-1"></a><span class="do">## [10,] -0.354794204  0.27889904 -1.32088995 -0.26132381  6.1111360 -0.0110246</span></span>
<span id="cb879-13"><a href="ch-11.html#cb879-13" aria-hidden="true" tabindex="-1"></a><span class="do">## [11,] -0.075735129 -0.51960874 -1.08324683  1.22804534 -9.2768269 -0.3711588</span></span>
<span id="cb879-14"><a href="ch-11.html#cb879-14" aria-hidden="true" tabindex="-1"></a><span class="do">## [12,]  0.058648713  0.01862233  1.23881853  0.08873922  0.6291698 -0.2280734</span></span>
<span id="cb879-15"><a href="ch-11.html#cb879-15" aria-hidden="true" tabindex="-1"></a><span class="do">## [13,] -0.219447121  0.06975523 -0.28102785  0.84798932  0.1717782  5.7479606</span></span>
<span id="cb879-16"><a href="ch-11.html#cb879-16" aria-hidden="true" tabindex="-1"></a><span class="do">## [14,] -0.777138412 -2.31531525  7.50002480 -2.60044813  7.6696396 -6.5305896</span></span>
<span id="cb879-17"><a href="ch-11.html#cb879-17" aria-hidden="true" tabindex="-1"></a><span class="do">## [15,] -1.614494205 -0.05201649 -0.51413023 -0.94068855 -2.0706074 -3.8512673</span></span>
<span id="cb879-18"><a href="ch-11.html#cb879-18" aria-hidden="true" tabindex="-1"></a><span class="do">##              [,7]         [,8]         [,9]       [,10]       [,11]</span></span>
<span id="cb879-19"><a href="ch-11.html#cb879-19" aria-hidden="true" tabindex="-1"></a><span class="do">##  [1,]  0.04682195 -0.052829422  1.172855377  6.30979824  0.52859932</span></span>
<span id="cb879-20"><a href="ch-11.html#cb879-20" aria-hidden="true" tabindex="-1"></a><span class="do">##  [2,] -0.22194999 -0.243081853 -2.264952421  3.04037237 -0.95039535</span></span>
<span id="cb879-21"><a href="ch-11.html#cb879-21" aria-hidden="true" tabindex="-1"></a><span class="do">##  [3,]  0.14613368  0.332655936  0.491766244  4.90739346 -0.50222224</span></span>
<span id="cb879-22"><a href="ch-11.html#cb879-22" aria-hidden="true" tabindex="-1"></a><span class="do">##  [4,]  0.05983398 -0.335039854 -2.523161650 -4.82348061 -0.73482287</span></span>
<span id="cb879-23"><a href="ch-11.html#cb879-23" aria-hidden="true" tabindex="-1"></a><span class="do">##  [5,]  0.20005836 -0.089846745  0.515249848 -0.01903337  0.29309896</span></span>
<span id="cb879-24"><a href="ch-11.html#cb879-24" aria-hidden="true" tabindex="-1"></a><span class="do">##  [6,] -0.76276135 -0.172726154  0.191874042  1.01086140 -0.50880861</span></span>
<span id="cb879-25"><a href="ch-11.html#cb879-25" aria-hidden="true" tabindex="-1"></a><span class="do">##  [7,] -0.27699345  0.031146886 -0.068503618 -1.35167754 -0.09551523</span></span>
<span id="cb879-26"><a href="ch-11.html#cb879-26" aria-hidden="true" tabindex="-1"></a><span class="do">##  [8,] -0.19921121 -0.050250128 -1.608266592 -1.96596658 -0.53051108</span></span>
<span id="cb879-27"><a href="ch-11.html#cb879-27" aria-hidden="true" tabindex="-1"></a><span class="do">##  [9,] -0.29272005 -0.153516173 -1.579962850  1.97364700 -1.06721187</span></span>
<span id="cb879-28"><a href="ch-11.html#cb879-28" aria-hidden="true" tabindex="-1"></a><span class="do">## [10,] -0.35709265 -0.048273247  0.995545089 -1.33178234  0.56702429</span></span>
<span id="cb879-29"><a href="ch-11.html#cb879-29" aria-hidden="true" tabindex="-1"></a><span class="do">## [11,] -0.38769460  0.195704937  1.311706424  1.23969197  0.12406404</span></span>
<span id="cb879-30"><a href="ch-11.html#cb879-30" aria-hidden="true" tabindex="-1"></a><span class="do">## [12,]  0.48858991 -0.010217057  0.085440978 -0.37758657  0.27877322</span></span>
<span id="cb879-31"><a href="ch-11.html#cb879-31" aria-hidden="true" tabindex="-1"></a><span class="do">## [13,] -0.09290090  0.005608748  0.484116018 -1.63200808  0.39846551</span></span>
<span id="cb879-32"><a href="ch-11.html#cb879-32" aria-hidden="true" tabindex="-1"></a><span class="do">## [14,]  0.25080982 -0.011659722 -1.215049624 -1.07155561 -0.32186502</span></span>
<span id="cb879-33"><a href="ch-11.html#cb879-33" aria-hidden="true" tabindex="-1"></a><span class="do">## [15,] -0.06362370  0.235450491  0.007811341 -8.73015308 -0.52522039</span></span>
<span id="cb879-34"><a href="ch-11.html#cb879-34" aria-hidden="true" tabindex="-1"></a><span class="do">##              [,12]        [,13]      [,14]       [,15]        [,16]       [,17]</span></span>
<span id="cb879-35"><a href="ch-11.html#cb879-35" aria-hidden="true" tabindex="-1"></a><span class="do">##  [1,] -0.711098015 -0.155946359 -5.3655915   7.3770199  0.293657303 -0.19214493</span></span>
<span id="cb879-36"><a href="ch-11.html#cb879-36" aria-hidden="true" tabindex="-1"></a><span class="do">##  [2,] -0.365851760  0.089299537  1.3707904  -5.9960160 -0.127565414 -0.53482211</span></span>
<span id="cb879-37"><a href="ch-11.html#cb879-37" aria-hidden="true" tabindex="-1"></a><span class="do">##  [3,]  0.055914585 -0.007191619 -2.1241577   4.7871284 -0.239663601 -0.07870594</span></span>
<span id="cb879-38"><a href="ch-11.html#cb879-38" aria-hidden="true" tabindex="-1"></a><span class="do">##  [4,] -0.827158570  0.168920189 -4.2775497  -7.5697961  0.079768963 -0.42832005</span></span>
<span id="cb879-39"><a href="ch-11.html#cb879-39" aria-hidden="true" tabindex="-1"></a><span class="do">##  [5,] -0.786235392 -0.258505225 -0.2865027  -0.2799671 -0.104162373 -0.08785495</span></span>
<span id="cb879-40"><a href="ch-11.html#cb879-40" aria-hidden="true" tabindex="-1"></a><span class="do">##  [6,] -0.007873034 -0.371807247 -4.7030549   0.5258003 -0.060212884 -0.01263460</span></span>
<span id="cb879-41"><a href="ch-11.html#cb879-41" aria-hidden="true" tabindex="-1"></a><span class="do">##  [7,]  0.003547309 -0.341258347  5.6166472  -1.9062901 -0.028141027  0.04434934</span></span>
<span id="cb879-42"><a href="ch-11.html#cb879-42" aria-hidden="true" tabindex="-1"></a><span class="do">##  [8,] -0.368607908 -0.188798785 -2.9444225  -1.5065690  0.002863772 -0.20875025</span></span>
<span id="cb879-43"><a href="ch-11.html#cb879-43" aria-hidden="true" tabindex="-1"></a><span class="do">##  [9,] -0.495464146  0.092135318  2.9440861  -4.1805649 -0.266763061 -0.20316155</span></span>
<span id="cb879-44"><a href="ch-11.html#cb879-44" aria-hidden="true" tabindex="-1"></a><span class="do">## [10,] -0.042366728 -0.102412179  0.4786149  -0.9693843  0.136674106 -0.17017232</span></span>
<span id="cb879-45"><a href="ch-11.html#cb879-45" aria-hidden="true" tabindex="-1"></a><span class="do">## [11,] -0.495398074 -0.109507836  1.6707268   1.7287951 -0.145421311  0.10051851</span></span>
<span id="cb879-46"><a href="ch-11.html#cb879-46" aria-hidden="true" tabindex="-1"></a><span class="do">## [12,] -0.254084796  0.439668804  2.7467921  -1.3010908  0.075597413  0.29256424</span></span>
<span id="cb879-47"><a href="ch-11.html#cb879-47" aria-hidden="true" tabindex="-1"></a><span class="do">## [13,] -0.634631693  0.172714919  1.5466242  -1.5283233  0.020010771 -0.13009861</span></span>
<span id="cb879-48"><a href="ch-11.html#cb879-48" aria-hidden="true" tabindex="-1"></a><span class="do">## [14,]  0.059612643  0.105869599 -6.3877649  -1.9179984 -0.045273066 -0.40067214</span></span>
<span id="cb879-49"><a href="ch-11.html#cb879-49" aria-hidden="true" tabindex="-1"></a><span class="do">## [15,]  0.231342480 -0.376736462 -1.6059383 -10.0494280 -0.094165772  0.14342698</span></span>
<span id="cb879-50"><a href="ch-11.html#cb879-50" aria-hidden="true" tabindex="-1"></a><span class="do">##             [,18]       [,19]      [,20]</span></span>
<span id="cb879-51"><a href="ch-11.html#cb879-51" aria-hidden="true" tabindex="-1"></a><span class="do">##  [1,]   5.5032167 -0.46716672 -0.6539110</span></span>
<span id="cb879-52"><a href="ch-11.html#cb879-52" aria-hidden="true" tabindex="-1"></a><span class="do">##  [2,]   1.9781926 -0.42978939  0.3046646</span></span>
<span id="cb879-53"><a href="ch-11.html#cb879-53" aria-hidden="true" tabindex="-1"></a><span class="do">##  [3,]   0.1271483  0.47976965 -0.2256196</span></span>
<span id="cb879-54"><a href="ch-11.html#cb879-54" aria-hidden="true" tabindex="-1"></a><span class="do">##  [4,] -12.0853949 -0.80036938  0.4287973</span></span>
<span id="cb879-55"><a href="ch-11.html#cb879-55" aria-hidden="true" tabindex="-1"></a><span class="do">##  [5,]   0.9761505 -0.22349076  0.2876348</span></span>
<span id="cb879-56"><a href="ch-11.html#cb879-56" aria-hidden="true" tabindex="-1"></a><span class="do">##  [6,]  -2.0184972 -0.84300071 -0.2434829</span></span>
<span id="cb879-57"><a href="ch-11.html#cb879-57" aria-hidden="true" tabindex="-1"></a><span class="do">##  [7,]  -2.3686037  0.22000718 -0.4334196</span></span>
<span id="cb879-58"><a href="ch-11.html#cb879-58" aria-hidden="true" tabindex="-1"></a><span class="do">##  [8,]  -6.2144308 -0.28150293 -0.5173919</span></span>
<span id="cb879-59"><a href="ch-11.html#cb879-59" aria-hidden="true" tabindex="-1"></a><span class="do">##  [9,]   0.8613948 -0.59269583  0.3008582</span></span>
<span id="cb879-60"><a href="ch-11.html#cb879-60" aria-hidden="true" tabindex="-1"></a><span class="do">## [10,]   0.1340202  0.15566082  0.1325917</span></span>
<span id="cb879-61"><a href="ch-11.html#cb879-61" aria-hidden="true" tabindex="-1"></a><span class="do">## [11,]   0.9494711 -0.08530131  0.1096366</span></span>
<span id="cb879-62"><a href="ch-11.html#cb879-62" aria-hidden="true" tabindex="-1"></a><span class="do">## [12,]   0.4856019  0.75556695  0.5051430</span></span>
<span id="cb879-63"><a href="ch-11.html#cb879-63" aria-hidden="true" tabindex="-1"></a><span class="do">## [13,]  -1.7481350 -0.40033895  0.7129067</span></span>
<span id="cb879-64"><a href="ch-11.html#cb879-64" aria-hidden="true" tabindex="-1"></a><span class="do">## [14,]  -5.9514213 -0.21660900  0.1049089</span></span>
<span id="cb879-65"><a href="ch-11.html#cb879-65" aria-hidden="true" tabindex="-1"></a><span class="do">## [15,]  -2.7778580  0.19276462 -0.3107617</span></span>
<span id="cb879-66"><a href="ch-11.html#cb879-66" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb879-67"><a href="ch-11.html#cb879-67" aria-hidden="true" tabindex="-1"></a><span class="do">## [[2]]</span></span>
<span id="cb879-68"><a href="ch-11.html#cb879-68" aria-hidden="true" tabindex="-1"></a><span class="do">##  [1]  -9.184246   1.047771 -20.209112  -8.611093 -19.685486 -16.133827</span></span>
<span id="cb879-69"><a href="ch-11.html#cb879-69" aria-hidden="true" tabindex="-1"></a><span class="do">##  [7]  -2.834236  -1.757904 -15.453846  -6.230545  -7.671953  -6.257191</span></span>
<span id="cb879-70"><a href="ch-11.html#cb879-70" aria-hidden="true" tabindex="-1"></a><span class="do">## [13]  -2.829708 -21.390947 -14.927919  -1.536069  -2.516061 -11.184190</span></span>
<span id="cb879-71"><a href="ch-11.html#cb879-71" aria-hidden="true" tabindex="-1"></a><span class="do">## [19]  -5.883048  -4.925455</span></span>
<span id="cb879-72"><a href="ch-11.html#cb879-72" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb879-73"><a href="ch-11.html#cb879-73" aria-hidden="true" tabindex="-1"></a><span class="do">## [[3]]</span></span>
<span id="cb879-74"><a href="ch-11.html#cb879-74" aria-hidden="true" tabindex="-1"></a><span class="do">##              [,1]</span></span>
<span id="cb879-75"><a href="ch-11.html#cb879-75" aria-hidden="true" tabindex="-1"></a><span class="do">##  [1,]  0.47884747</span></span>
<span id="cb879-76"><a href="ch-11.html#cb879-76" aria-hidden="true" tabindex="-1"></a><span class="do">##  [2,] -0.44409966</span></span>
<span id="cb879-77"><a href="ch-11.html#cb879-77" aria-hidden="true" tabindex="-1"></a><span class="do">##  [3,]  0.72907656</span></span>
<span id="cb879-78"><a href="ch-11.html#cb879-78" aria-hidden="true" tabindex="-1"></a><span class="do">##  [4,]  0.12370997</span></span>
<span id="cb879-79"><a href="ch-11.html#cb879-79" aria-hidden="true" tabindex="-1"></a><span class="do">##  [5,] -0.52531523</span></span>
<span id="cb879-80"><a href="ch-11.html#cb879-80" aria-hidden="true" tabindex="-1"></a><span class="do">##  [6,]  0.34080574</span></span>
<span id="cb879-81"><a href="ch-11.html#cb879-81" aria-hidden="true" tabindex="-1"></a><span class="do">##  [7,]  0.41197014</span></span>
<span id="cb879-82"><a href="ch-11.html#cb879-82" aria-hidden="true" tabindex="-1"></a><span class="do">##  [8,] -0.07848634</span></span>
<span id="cb879-83"><a href="ch-11.html#cb879-83" aria-hidden="true" tabindex="-1"></a><span class="do">##  [9,] -2.98452473</span></span>
<span id="cb879-84"><a href="ch-11.html#cb879-84" aria-hidden="true" tabindex="-1"></a><span class="do">## [10,]  0.82209224</span></span>
<span id="cb879-85"><a href="ch-11.html#cb879-85" aria-hidden="true" tabindex="-1"></a><span class="do">## [11,] -0.90803719</span></span>
<span id="cb879-86"><a href="ch-11.html#cb879-86" aria-hidden="true" tabindex="-1"></a><span class="do">## [12,] -0.10138759</span></span>
<span id="cb879-87"><a href="ch-11.html#cb879-87" aria-hidden="true" tabindex="-1"></a><span class="do">## [13,] -0.12153122</span></span>
<span id="cb879-88"><a href="ch-11.html#cb879-88" aria-hidden="true" tabindex="-1"></a><span class="do">## [14,] -0.31301230</span></span>
<span id="cb879-89"><a href="ch-11.html#cb879-89" aria-hidden="true" tabindex="-1"></a><span class="do">## [15,] -0.70200449</span></span>
<span id="cb879-90"><a href="ch-11.html#cb879-90" aria-hidden="true" tabindex="-1"></a><span class="do">## [16,]  0.04088609</span></span>
<span id="cb879-91"><a href="ch-11.html#cb879-91" aria-hidden="true" tabindex="-1"></a><span class="do">## [17,]  0.11272940</span></span>
<span id="cb879-92"><a href="ch-11.html#cb879-92" aria-hidden="true" tabindex="-1"></a><span class="do">## [18,]  0.19971827</span></span>
<span id="cb879-93"><a href="ch-11.html#cb879-93" aria-hidden="true" tabindex="-1"></a><span class="do">## [19,]  0.26930034</span></span>
<span id="cb879-94"><a href="ch-11.html#cb879-94" aria-hidden="true" tabindex="-1"></a><span class="do">## [20,] -0.10159779</span></span>
<span id="cb879-95"><a href="ch-11.html#cb879-95" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb879-96"><a href="ch-11.html#cb879-96" aria-hidden="true" tabindex="-1"></a><span class="do">## [[4]]</span></span>
<span id="cb879-97"><a href="ch-11.html#cb879-97" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 4.201512</span></span></code></pre></div>
<p>Now we can evaluate our model predictions on the held-out testing set.</p>
<div class="sourceCode" id="cb880"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb880-1"><a href="ch-11.html#cb880-1" aria-hidden="true" tabindex="-1"></a><span class="do">## make predictions and evaluate using test set </span></span>
<span id="cb880-2"><a href="ch-11.html#cb880-2" aria-hidden="true" tabindex="-1"></a>test_data_predictions <span class="ot">&lt;-</span> <span class="fu">predict</span>(model, test_data)</span>
<span id="cb880-3"><a href="ch-11.html#cb880-3" aria-hidden="true" tabindex="-1"></a>eval_result <span class="ot">&lt;-</span> model <span class="sc">%&gt;%</span> <span class="fu">evaluate</span>(test_data, test_target)</span>
<span id="cb880-4"><a href="ch-11.html#cb880-4" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(eval_result)</span></code></pre></div>
<div class="sourceCode" id="cb881"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb881-1"><a href="ch-11.html#cb881-1" aria-hidden="true" tabindex="-1"></a><span class="do">## $loss</span></span>
<span id="cb881-2"><a href="ch-11.html#cb881-2" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 26.00271</span></span>
<span id="cb881-3"><a href="ch-11.html#cb881-3" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb881-4"><a href="ch-11.html#cb881-4" aria-hidden="true" tabindex="-1"></a><span class="do">## $mean_absolute_error</span></span>
<span id="cb881-5"><a href="ch-11.html#cb881-5" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 3.288165</span></span></code></pre></div>
<p><img src="figures/11_output-test.png" /></p>
<p>Next we can plot the model predictions with along with the ground truth for the test and training dataset. Check if the model predictions actually follow the trend in the data.</p>
<div class="sourceCode" id="cb882"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb882-1"><a href="ch-11.html#cb882-1" aria-hidden="true" tabindex="-1"></a><span class="do">## plot the test data observations along with the test data predictions. Use color red for predictions, and blue for the observed data.</span></span>
<span id="cb882-2"><a href="ch-11.html#cb882-2" aria-hidden="true" tabindex="-1"></a>plt_1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>() <span class="sc">+</span> <span class="fu">geom_line</span>(<span class="at">data =</span> test_split, <span class="fu">aes</span>(<span class="at">x =</span> test_data_time, <span class="at">y =</span> test_data_predictions), <span class="at">col =</span> <span class="fu">alpha</span>(<span class="st">&quot;red&quot;</span>, <span class="fl">0.5</span>)) <span class="sc">+</span> <span class="fu">geom_line</span>(<span class="at">data =</span> test_split, <span class="fu">aes</span>(<span class="at">x =</span> test_data_time, <span class="at">y =</span> test_target),<span class="at">col=</span><span class="fu">alpha</span>(<span class="st">&quot;blue&quot;</span>,<span class="fl">0.3</span>))<span class="sc">+</span></span>
<span id="cb882-3"><a href="ch-11.html#cb882-3" aria-hidden="true" tabindex="-1"></a><span class="fu">xlab</span>(<span class="st">&quot;Time of observation&quot;</span>)<span class="sc">+</span></span>
<span id="cb882-4"><a href="ch-11.html#cb882-4" aria-hidden="true" tabindex="-1"></a><span class="fu">ylab</span>(<span class="st">&quot;Prediction and observation&quot;</span>)<span class="sc">+</span></span>
<span id="cb882-5"><a href="ch-11.html#cb882-5" aria-hidden="true" tabindex="-1"></a><span class="fu">labs</span>(<span class="at">title=</span><span class="st">&quot;Test data&quot;</span>)</span>
<span id="cb882-6"><a href="ch-11.html#cb882-6" aria-hidden="true" tabindex="-1"></a>plt_1</span>
<span id="cb882-7"><a href="ch-11.html#cb882-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb882-8"><a href="ch-11.html#cb882-8" aria-hidden="true" tabindex="-1"></a><span class="do">## plot the train data observations along with the train data predictions. Use color red for predictions, and blue for the observed data.</span></span>
<span id="cb882-9"><a href="ch-11.html#cb882-9" aria-hidden="true" tabindex="-1"></a>train_data_predictions <span class="ot">&lt;-</span> <span class="fu">predict</span>(model, train_data)</span>
<span id="cb882-10"><a href="ch-11.html#cb882-10" aria-hidden="true" tabindex="-1"></a>plt_2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>() <span class="sc">+</span> <span class="fu">geom_line</span>(<span class="at">data =</span> train_split, <span class="fu">aes</span>(<span class="at">x =</span> train_data_time, <span class="at">y =</span> train_data_predictions), <span class="at">col =</span> <span class="fu">alpha</span>(<span class="st">&quot;red&quot;</span>, <span class="fl">0.5</span>)) <span class="sc">+</span> <span class="fu">geom_line</span>(<span class="at">data =</span> train_split, <span class="fu">aes</span>(<span class="at">x =</span> train_data_time, <span class="at">y =</span> train_target),<span class="at">col=</span><span class="fu">alpha</span>(<span class="st">&quot;blue&quot;</span>,<span class="fl">0.15</span>))<span class="sc">+</span></span>
<span id="cb882-11"><a href="ch-11.html#cb882-11" aria-hidden="true" tabindex="-1"></a><span class="fu">xlab</span>(<span class="st">&quot;Time of observation&quot;</span>)<span class="sc">+</span></span>
<span id="cb882-12"><a href="ch-11.html#cb882-12" aria-hidden="true" tabindex="-1"></a><span class="fu">ylab</span>(<span class="st">&quot;Prediction and observation&quot;</span>)<span class="sc">+</span></span>
<span id="cb882-13"><a href="ch-11.html#cb882-13" aria-hidden="true" tabindex="-1"></a><span class="fu">labs</span>(<span class="at">title=</span><span class="st">&quot;Train data&quot;</span>)</span>
<span id="cb882-14"><a href="ch-11.html#cb882-14" aria-hidden="true" tabindex="-1"></a>plt_2</span>
<span id="cb882-15"><a href="ch-11.html#cb882-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb882-16"><a href="ch-11.html#cb882-16" aria-hidden="true" tabindex="-1"></a><span class="do">## Hint: For both the plots above, edit the alpha value such that the test data observations and the test data predictions both can be seen even with overlap </span></span></code></pre></div>
<p>Nice! From our domain knowledge we know that the target varible GPP_NT_VUT_REF cannot be negative, but our dataset contains some negative observations because of noisy measurements. From the plot we see that the model learns the trends in the data, without learning the noise.</p>
<p>Finally let’s make a plot of our predictions v/s observed data. In an ideal world this should be a straight line y=x, giving us a Pearson’s correlation coefficient of 1, but because of the noise in data we can expect some deviations from the ideal result.</p>
<div class="sourceCode" id="cb883"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb883-1"><a href="ch-11.html#cb883-1" aria-hidden="true" tabindex="-1"></a><span class="do">## plot test set predictions v/s test set observations (from the test dataset)</span></span>
<span id="cb883-2"><a href="ch-11.html#cb883-2" aria-hidden="true" tabindex="-1"></a>plt3 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(test_split, <span class="fu">aes</span>(<span class="at">x =</span> test_target, <span class="at">y=</span>test_data_predictions)) <span class="sc">+</span> <span class="fu">geom_point</span>() </span>
<span id="cb883-3"><a href="ch-11.html#cb883-3" aria-hidden="true" tabindex="-1"></a>plt3</span></code></pre></div>
<p><img src="figures/11_output-scatter.png" /></p>
<p>What is the Pearson’s correlation coefficient obtained for this?</p>
<div class="sourceCode" id="cb884"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb884-1"><a href="ch-11.html#cb884-1" aria-hidden="true" tabindex="-1"></a><span class="do">## compute the correlation coefficient</span></span>
<span id="cb884-2"><a href="ch-11.html#cb884-2" aria-hidden="true" tabindex="-1"></a>r2 <span class="ot">&lt;-</span> <span class="cf">function</span> (p, q) {<span class="fu">cor</span>(p, q)<span class="sc">^</span><span class="dv">2</span>}</span>
<span id="cb884-3"><a href="ch-11.html#cb884-3" aria-hidden="true" tabindex="-1"></a><span class="fu">r2</span>(test_target, test_data_predictions)</span></code></pre></div>
<div class="sourceCode" id="cb885"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb885-1"><a href="ch-11.html#cb885-1" aria-hidden="true" tabindex="-1"></a><span class="do">##                     [,1]</span></span>
<span id="cb885-2"><a href="ch-11.html#cb885-2" aria-hidden="true" tabindex="-1"></a><span class="do">## GPP_NT_VUT_REF 0.6658682</span></span></code></pre></div>
<p>Having done this we have an idea of how well our model generalises against unseen data. But, to optimise the hyperparameters of the network we should not use the performance on the test set to select these hyperparameters. If we tune our model hyperparameters using results from the test set, then the performance of our best model on the test set underestimates the true risk of our model. In the following steps we do the same things as we have discusses until now, but with 5-fold cross validation. We will do cross validation “by-hand”, as we try to avoid using caret here, and doing so by hand gives us a more fine grain control.</p>
<p>Let’s put the model creating and training in a function which takes the different hyper-parameters as inputs. This will make it easier to build a model from inside a cross validation loop.</p>
<p>Write a function, that does all the above steps, and returns a trained model. This will come in handy when we perform cross-validation.
Use mean squared error as your loss and evaluation metric. Don’t forget to use <em>early stopping</em> (callback_early_stopping()).</p>
<div class="sourceCode" id="cb886"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb886-1"><a href="ch-11.html#cb886-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Function name: build_model()  </span></span>
<span id="cb886-2"><a href="ch-11.html#cb886-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Inputs: Training data, Training target, number of hidden units, activation type, number of epochs, batch size and validation size  </span></span>
<span id="cb886-3"><a href="ch-11.html#cb886-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Output: List of 2 objects --&gt; trained model, and the training history </span></span>
<span id="cb886-4"><a href="ch-11.html#cb886-4" aria-hidden="true" tabindex="-1"></a><span class="do">## We also return the training history in case we want to make plots of the training process for each of the folds  </span></span>
<span id="cb886-5"><a href="ch-11.html#cb886-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb886-6"><a href="ch-11.html#cb886-6" aria-hidden="true" tabindex="-1"></a>build_model <span class="ot">&lt;-</span> <span class="cf">function</span>(X_train, y_train,</span>
<span id="cb886-7"><a href="ch-11.html#cb886-7" aria-hidden="true" tabindex="-1"></a>                        num_units, </span>
<span id="cb886-8"><a href="ch-11.html#cb886-8" aria-hidden="true" tabindex="-1"></a>                        activation_type,</span>
<span id="cb886-9"><a href="ch-11.html#cb886-9" aria-hidden="true" tabindex="-1"></a>                        num_epochs,</span>
<span id="cb886-10"><a href="ch-11.html#cb886-10" aria-hidden="true" tabindex="-1"></a>                        batch_size,</span>
<span id="cb886-11"><a href="ch-11.html#cb886-11" aria-hidden="true" tabindex="-1"></a>                        val_size){</span>
<span id="cb886-12"><a href="ch-11.html#cb886-12" aria-hidden="true" tabindex="-1"></a>  model <span class="ot">&lt;-</span> <span class="fu">keras_model_sequential</span>()</span>
<span id="cb886-13"><a href="ch-11.html#cb886-13" aria-hidden="true" tabindex="-1"></a>  model <span class="sc">%&gt;%</span> </span>
<span id="cb886-14"><a href="ch-11.html#cb886-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">layer_dense</span>(<span class="at">units =</span> num_units, <span class="at">activation =</span> activation_type, <span class="at">input_shape =</span> <span class="fu">ncol</span>(X_train)) <span class="sc">%&gt;%</span></span>
<span id="cb886-15"><a href="ch-11.html#cb886-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">layer_dense</span>(<span class="at">units =</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb886-16"><a href="ch-11.html#cb886-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">compile</span>( <span class="at">optimizer =</span> <span class="fu">optimizer_adam</span>(<span class="at">lr=</span><span class="fl">0.001</span>),</span>
<span id="cb886-17"><a href="ch-11.html#cb886-17" aria-hidden="true" tabindex="-1"></a>             <span class="at">loss =</span> <span class="st">&#39;mean_squared_error&#39;</span>, </span>
<span id="cb886-18"><a href="ch-11.html#cb886-18" aria-hidden="true" tabindex="-1"></a>             <span class="at">metrics =</span> <span class="st">&#39;mean_squared_error&#39;</span>)</span>
<span id="cb886-19"><a href="ch-11.html#cb886-19" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb886-20"><a href="ch-11.html#cb886-20" aria-hidden="true" tabindex="-1"></a>  history <span class="ot">&lt;-</span> <span class="fu">fit</span>(</span>
<span id="cb886-21"><a href="ch-11.html#cb886-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">object           =</span> model, </span>
<span id="cb886-22"><a href="ch-11.html#cb886-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">x                =</span> X_train, </span>
<span id="cb886-23"><a href="ch-11.html#cb886-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">y                =</span> y_train,</span>
<span id="cb886-24"><a href="ch-11.html#cb886-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">batch_size       =</span> batch_size, </span>
<span id="cb886-25"><a href="ch-11.html#cb886-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">epochs           =</span> num_epochs,</span>
<span id="cb886-26"><a href="ch-11.html#cb886-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">validation_split =</span> val_size,</span>
<span id="cb886-27"><a href="ch-11.html#cb886-27" aria-hidden="true" tabindex="-1"></a>    <span class="at">shuffle =</span> <span class="cn">TRUE</span>, </span>
<span id="cb886-28"><a href="ch-11.html#cb886-28" aria-hidden="true" tabindex="-1"></a>    <span class="at">callbacks =</span> <span class="fu">list</span>(<span class="fu">callback_early_stopping</span>( <span class="at">monitor =</span> <span class="st">&quot;val_loss&quot;</span>,  <span class="at">patience =</span> <span class="dv">0</span>))</span>
<span id="cb886-29"><a href="ch-11.html#cb886-29" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb886-30"><a href="ch-11.html#cb886-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb886-31"><a href="ch-11.html#cb886-31" aria-hidden="true" tabindex="-1"></a>  trained_model <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="st">&quot;model&quot;</span> <span class="ot">=</span> model, <span class="st">&quot;history&quot;</span> <span class="ot">=</span> history)</span>
<span id="cb886-32"><a href="ch-11.html#cb886-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(trained_model)</span>
<span id="cb886-33"><a href="ch-11.html#cb886-33" aria-hidden="true" tabindex="-1"></a>}  </span></code></pre></div>
</div>
<div id="cross-validation" class="section level3" number="11.2.5">
<h3><span class="header-section-number">11.2.5</span> Cross validation</h3>
<p>In this section you will perform 5-Fold CV, “by - hand”</p>
<div class="sourceCode" id="cb887"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb887-1"><a href="ch-11.html#cb887-1" aria-hidden="true" tabindex="-1"></a><span class="co"># We prepare our cross validation splits. First we randomly shuffle the initial train set. </span></span>
<span id="cb887-2"><a href="ch-11.html#cb887-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Note: Use the data that we obtained from the train split, from before we centered and scaled the data. </span></span>
<span id="cb887-3"><a href="ch-11.html#cb887-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Using the already centered and scaled data, will introduce information leak into out cross-validation folds </span></span>
<span id="cb887-4"><a href="ch-11.html#cb887-4" aria-hidden="true" tabindex="-1"></a>cv_data <span class="ot">&lt;-</span> train_split </span>
<span id="cb887-5"><a href="ch-11.html#cb887-5" aria-hidden="true" tabindex="-1"></a>cv_data <span class="ot">&lt;-</span> cv_data[<span class="fu">sample</span>(<span class="fu">nrow</span>(cv_data)),]</span>
<span id="cb887-6"><a href="ch-11.html#cb887-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb887-7"><a href="ch-11.html#cb887-7" aria-hidden="true" tabindex="-1"></a><span class="co">#Create 5 equally size folds</span></span>
<span id="cb887-8"><a href="ch-11.html#cb887-8" aria-hidden="true" tabindex="-1"></a><span class="do">## hint: folds &lt;- cut(seq(1,nrow(cv_data)),breaks=5,labels=FALSE)</span></span>
<span id="cb887-9"><a href="ch-11.html#cb887-9" aria-hidden="true" tabindex="-1"></a>folds <span class="ot">&lt;-</span> <span class="fu">cut</span>(<span class="fu">seq</span>(<span class="dv">1</span>,<span class="fu">nrow</span>(cv_data)),<span class="at">breaks=</span><span class="dv">5</span>,<span class="at">labels=</span><span class="cn">FALSE</span>)</span>
<span id="cb887-10"><a href="ch-11.html#cb887-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb887-11"><a href="ch-11.html#cb887-11" aria-hidden="true" tabindex="-1"></a><span class="do">## create a list, to store the results across different folds</span></span>
<span id="cb887-12"><a href="ch-11.html#cb887-12" aria-hidden="true" tabindex="-1"></a>history_list <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb887-13"><a href="ch-11.html#cb887-13" aria-hidden="true" tabindex="-1"></a>cv_performance_list <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb887-14"><a href="ch-11.html#cb887-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb887-15"><a href="ch-11.html#cb887-15" aria-hidden="true" tabindex="-1"></a><span class="co">#Perform 5 fold cross validation</span></span>
<span id="cb887-16"><a href="ch-11.html#cb887-16" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>){</span>
<span id="cb887-17"><a href="ch-11.html#cb887-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="fu">sprintf</span>(<span class="st">&quot;CV Fold --&gt; %i/5</span><span class="sc">\n</span><span class="st">&quot;</span>, i))</span>
<span id="cb887-18"><a href="ch-11.html#cb887-18" aria-hidden="true" tabindex="-1"></a>  <span class="co">#Segment the data by fold </span></span>
<span id="cb887-19"><a href="ch-11.html#cb887-19" aria-hidden="true" tabindex="-1"></a>  <span class="do">## hint : indices &lt;- which(folds==i,arr.ind=TRUE)</span></span>
<span id="cb887-20"><a href="ch-11.html#cb887-20" aria-hidden="true" tabindex="-1"></a>  indices <span class="ot">&lt;-</span> <span class="fu">which</span>(folds<span class="sc">==</span>i,<span class="at">arr.ind=</span><span class="cn">TRUE</span>)</span>
<span id="cb887-21"><a href="ch-11.html#cb887-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb887-22"><a href="ch-11.html#cb887-22" aria-hidden="true" tabindex="-1"></a>  <span class="do">## indices is a vector with TRUE for the rows where the folds == i; and FALSE for the rest of the row</span></span>
<span id="cb887-23"><a href="ch-11.html#cb887-23" aria-hidden="true" tabindex="-1"></a>  <span class="do">## indices which are TRUE for a particular loop form the cross-validation test set for that loop  </span></span>
<span id="cb887-24"><a href="ch-11.html#cb887-24" aria-hidden="true" tabindex="-1"></a>  <span class="do">## Segment data as cv_test_data and cv_train data using the indices. </span></span>
<span id="cb887-25"><a href="ch-11.html#cb887-25" aria-hidden="true" tabindex="-1"></a>  <span class="do">## Now we just repeat the steps we did previously</span></span>
<span id="cb887-26"><a href="ch-11.html#cb887-26" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb887-27"><a href="ch-11.html#cb887-27" aria-hidden="true" tabindex="-1"></a>  <span class="do">## Seperate out the cv_test_data, cv_test_targets, cv_train_data, cv_train_targets. We won&#39;t be making any time series plots when cross-validating, so we can drop the timestamp columns</span></span>
<span id="cb887-28"><a href="ch-11.html#cb887-28" aria-hidden="true" tabindex="-1"></a>  cv_test_data <span class="ot">&lt;-</span> cv_data[indices, ]</span>
<span id="cb887-29"><a href="ch-11.html#cb887-29" aria-hidden="true" tabindex="-1"></a>  cv_test_target <span class="ot">&lt;-</span> cv_test_data <span class="sc">%&gt;%</span> <span class="fu">select</span>(target_variable)</span>
<span id="cb887-30"><a href="ch-11.html#cb887-30" aria-hidden="true" tabindex="-1"></a>  cv_test_data <span class="ot">&lt;-</span> cv_test_data <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">-</span><span class="fu">one_of</span>(<span class="fu">c</span>(target_variable, time_cols)))</span>
<span id="cb887-31"><a href="ch-11.html#cb887-31" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb887-32"><a href="ch-11.html#cb887-32" aria-hidden="true" tabindex="-1"></a>  cv_train_data <span class="ot">&lt;-</span> cv_data[<span class="sc">-</span>indices, ]</span>
<span id="cb887-33"><a href="ch-11.html#cb887-33" aria-hidden="true" tabindex="-1"></a>  cv_train_target <span class="ot">&lt;-</span> cv_train_data <span class="sc">%&gt;%</span> <span class="fu">select</span>(target_variable)</span>
<span id="cb887-34"><a href="ch-11.html#cb887-34" aria-hidden="true" tabindex="-1"></a>  cv_train_data <span class="ot">&lt;-</span> cv_train_data <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">-</span><span class="fu">one_of</span>(<span class="fu">c</span>(target_variable, time_cols)))</span>
<span id="cb887-35"><a href="ch-11.html#cb887-35" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb887-36"><a href="ch-11.html#cb887-36" aria-hidden="true" tabindex="-1"></a>  <span class="co"># scale and center using cv_train_data </span></span>
<span id="cb887-37"><a href="ch-11.html#cb887-37" aria-hidden="true" tabindex="-1"></a>  <span class="co"># get the statistics (mean, variance, etc) of numeric cols </span></span>
<span id="cb887-38"><a href="ch-11.html#cb887-38" aria-hidden="true" tabindex="-1"></a>  cv_train_data_stat <span class="ot">&lt;-</span> <span class="fu">preProcess</span>(cv_train_data, <span class="at">method =</span> <span class="fu">c</span>(<span class="st">&quot;center&quot;</span>,<span class="st">&quot;scale&quot;</span>))  </span>
<span id="cb887-39"><a href="ch-11.html#cb887-39" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb887-40"><a href="ch-11.html#cb887-40" aria-hidden="true" tabindex="-1"></a>  <span class="co"># transform the cv_train_data and cv_test_data to center and scale it </span></span>
<span id="cb887-41"><a href="ch-11.html#cb887-41" aria-hidden="true" tabindex="-1"></a>  cv_train_data[, predictors] <span class="ot">&lt;-</span> <span class="fu">predict</span>(cv_train_data_stat, cv_train_data)  </span>
<span id="cb887-42"><a href="ch-11.html#cb887-42" aria-hidden="true" tabindex="-1"></a>  cv_test_data[, predictors] <span class="ot">&lt;-</span> <span class="fu">predict</span>(cv_train_data_stat, cv_test_data)</span>
<span id="cb887-43"><a href="ch-11.html#cb887-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb887-44"><a href="ch-11.html#cb887-44" aria-hidden="true" tabindex="-1"></a>  <span class="co"># OR</span></span>
<span id="cb887-45"><a href="ch-11.html#cb887-45" aria-hidden="true" tabindex="-1"></a>  <span class="co"># scale_and_center&lt;- recipe(cv_train_data) %&gt;%</span></span>
<span id="cb887-46"><a href="ch-11.html#cb887-46" aria-hidden="true" tabindex="-1"></a>  <span class="co">#                             step_center(all_numeric()) %&gt;%</span></span>
<span id="cb887-47"><a href="ch-11.html#cb887-47" aria-hidden="true" tabindex="-1"></a>  <span class="co">#                             step_scale(all_numeric())</span></span>
<span id="cb887-48"><a href="ch-11.html#cb887-48" aria-hidden="true" tabindex="-1"></a>  <span class="co"># prep_recipe &lt;- prep(scale_and_center, training = cv_train_data)</span></span>
<span id="cb887-49"><a href="ch-11.html#cb887-49" aria-hidden="true" tabindex="-1"></a>  <span class="co"># cv_train_data &lt;- bake(prep_recipe, new_data = cv_train_data)</span></span>
<span id="cb887-50"><a href="ch-11.html#cb887-50" aria-hidden="true" tabindex="-1"></a>  <span class="co"># cv_test_data &lt;- bake(prep_recipe, new_data = cv_test_data)</span></span>
<span id="cb887-51"><a href="ch-11.html#cb887-51" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb887-52"><a href="ch-11.html#cb887-52" aria-hidden="true" tabindex="-1"></a>  <span class="do">## Convert data using as.matrix() </span></span>
<span id="cb887-53"><a href="ch-11.html#cb887-53" aria-hidden="true" tabindex="-1"></a>  cv_train_data <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(cv_train_data)</span>
<span id="cb887-54"><a href="ch-11.html#cb887-54" aria-hidden="true" tabindex="-1"></a>  cv_train_target <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(cv_train_target)</span>
<span id="cb887-55"><a href="ch-11.html#cb887-55" aria-hidden="true" tabindex="-1"></a>  cv_test_data <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(cv_test_data)</span>
<span id="cb887-56"><a href="ch-11.html#cb887-56" aria-hidden="true" tabindex="-1"></a>  cv_test_target <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(cv_test_target)</span>
<span id="cb887-57"><a href="ch-11.html#cb887-57" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb887-58"><a href="ch-11.html#cb887-58" aria-hidden="true" tabindex="-1"></a>  <span class="do">## train a model using the build_model() function we wrote previously  </span></span>
<span id="cb887-59"><a href="ch-11.html#cb887-59" aria-hidden="true" tabindex="-1"></a>  <span class="co"># cv_model &lt;- build_model()</span></span>
<span id="cb887-60"><a href="ch-11.html#cb887-60" aria-hidden="true" tabindex="-1"></a>    cv_model <span class="ot">&lt;-</span> <span class="fu">build_model</span>(<span class="at">X_train =</span> cv_train_data, <span class="at">y_train =</span> cv_train_target, </span>
<span id="cb887-61"><a href="ch-11.html#cb887-61" aria-hidden="true" tabindex="-1"></a>              <span class="at">num_units =</span> <span class="dv">20</span>,</span>
<span id="cb887-62"><a href="ch-11.html#cb887-62" aria-hidden="true" tabindex="-1"></a>              <span class="at">activation_type =</span> <span class="st">&quot;relu&quot;</span>,</span>
<span id="cb887-63"><a href="ch-11.html#cb887-63" aria-hidden="true" tabindex="-1"></a>              <span class="at">num_epochs =</span> <span class="dv">30</span>,</span>
<span id="cb887-64"><a href="ch-11.html#cb887-64" aria-hidden="true" tabindex="-1"></a>              <span class="at">batch_size =</span> <span class="dv">128</span>,</span>
<span id="cb887-65"><a href="ch-11.html#cb887-65" aria-hidden="true" tabindex="-1"></a>              <span class="at">val_size =</span> <span class="fl">0.15</span>)</span>
<span id="cb887-66"><a href="ch-11.html#cb887-66" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb887-67"><a href="ch-11.html#cb887-67" aria-hidden="true" tabindex="-1"></a>  <span class="co">#  get the evaluation error on the test folds </span></span>
<span id="cb887-68"><a href="ch-11.html#cb887-68" aria-hidden="true" tabindex="-1"></a>  eval_result <span class="ot">&lt;-</span> cv_model<span class="sc">$</span>model <span class="sc">%&gt;%</span> <span class="fu">evaluate</span>(cv_test_data, cv_test_target)</span>
<span id="cb887-69"><a href="ch-11.html#cb887-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb887-70"><a href="ch-11.html#cb887-70" aria-hidden="true" tabindex="-1"></a><span class="co">#   Store the results in the lists we made outside the loop </span></span>
<span id="cb887-71"><a href="ch-11.html#cb887-71" aria-hidden="true" tabindex="-1"></a>  cv_performance_list[[i]] <span class="ot">&lt;-</span> eval_result</span>
<span id="cb887-72"><a href="ch-11.html#cb887-72" aria-hidden="true" tabindex="-1"></a>  history_list[[i]] <span class="ot">&lt;-</span> cv_model<span class="sc">$</span>history</span>
<span id="cb887-73"><a href="ch-11.html#cb887-73" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">&quot;Evaluation error on the held out fold: &quot;</span> , eval_result<span class="sc">$</span>mean_squared_error,<span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb887-74"><a href="ch-11.html#cb887-74" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<div class="sourceCode" id="cb888"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb888-1"><a href="ch-11.html#cb888-1" aria-hidden="true" tabindex="-1"></a><span class="do">## CV Fold --&gt; 1/5</span></span>
<span id="cb888-2"><a href="ch-11.html#cb888-2" aria-hidden="true" tabindex="-1"></a><span class="do">## Model: &quot;sequential_1&quot;</span></span>
<span id="cb888-3"><a href="ch-11.html#cb888-3" aria-hidden="true" tabindex="-1"></a><span class="do">## ________________________________________________________________________________</span></span>
<span id="cb888-4"><a href="ch-11.html#cb888-4" aria-hidden="true" tabindex="-1"></a><span class="do">## Layer (type)                        Output Shape                    Param #     </span></span>
<span id="cb888-5"><a href="ch-11.html#cb888-5" aria-hidden="true" tabindex="-1"></a><span class="do">## ================================================================================</span></span>
<span id="cb888-6"><a href="ch-11.html#cb888-6" aria-hidden="true" tabindex="-1"></a><span class="do">## dense_2 (Dense)                     (None, 20)                      320         </span></span>
<span id="cb888-7"><a href="ch-11.html#cb888-7" aria-hidden="true" tabindex="-1"></a><span class="do">## ________________________________________________________________________________</span></span>
<span id="cb888-8"><a href="ch-11.html#cb888-8" aria-hidden="true" tabindex="-1"></a><span class="do">## dense_3 (Dense)                     (None, 1)                       21          </span></span>
<span id="cb888-9"><a href="ch-11.html#cb888-9" aria-hidden="true" tabindex="-1"></a><span class="do">## ================================================================================</span></span>
<span id="cb888-10"><a href="ch-11.html#cb888-10" aria-hidden="true" tabindex="-1"></a><span class="do">## Total params: 341</span></span>
<span id="cb888-11"><a href="ch-11.html#cb888-11" aria-hidden="true" tabindex="-1"></a><span class="do">## Trainable params: 341</span></span>
<span id="cb888-12"><a href="ch-11.html#cb888-12" aria-hidden="true" tabindex="-1"></a><span class="do">## Non-trainable params: 0</span></span>
<span id="cb888-13"><a href="ch-11.html#cb888-13" aria-hidden="true" tabindex="-1"></a><span class="do">## ________________________________________________________________________________</span></span>
<span id="cb888-14"><a href="ch-11.html#cb888-14" aria-hidden="true" tabindex="-1"></a><span class="do">## Evaluation error on the held out fold:  23.76635 </span></span>
<span id="cb888-15"><a href="ch-11.html#cb888-15" aria-hidden="true" tabindex="-1"></a><span class="do">## CV Fold --&gt; 2/5</span></span>
<span id="cb888-16"><a href="ch-11.html#cb888-16" aria-hidden="true" tabindex="-1"></a><span class="do">## Model: &quot;sequential_2&quot;</span></span>
<span id="cb888-17"><a href="ch-11.html#cb888-17" aria-hidden="true" tabindex="-1"></a><span class="do">## ________________________________________________________________________________</span></span>
<span id="cb888-18"><a href="ch-11.html#cb888-18" aria-hidden="true" tabindex="-1"></a><span class="do">## Layer (type)                        Output Shape                    Param #     </span></span>
<span id="cb888-19"><a href="ch-11.html#cb888-19" aria-hidden="true" tabindex="-1"></a><span class="do">## ================================================================================</span></span>
<span id="cb888-20"><a href="ch-11.html#cb888-20" aria-hidden="true" tabindex="-1"></a><span class="do">## dense_4 (Dense)                     (None, 20)                      320         </span></span>
<span id="cb888-21"><a href="ch-11.html#cb888-21" aria-hidden="true" tabindex="-1"></a><span class="do">## ________________________________________________________________________________</span></span>
<span id="cb888-22"><a href="ch-11.html#cb888-22" aria-hidden="true" tabindex="-1"></a><span class="do">## dense_5 (Dense)                     (None, 1)                       21          </span></span>
<span id="cb888-23"><a href="ch-11.html#cb888-23" aria-hidden="true" tabindex="-1"></a><span class="do">## ================================================================================</span></span>
<span id="cb888-24"><a href="ch-11.html#cb888-24" aria-hidden="true" tabindex="-1"></a><span class="do">## Total params: 341</span></span>
<span id="cb888-25"><a href="ch-11.html#cb888-25" aria-hidden="true" tabindex="-1"></a><span class="do">## Trainable params: 341</span></span>
<span id="cb888-26"><a href="ch-11.html#cb888-26" aria-hidden="true" tabindex="-1"></a><span class="do">## Non-trainable params: 0</span></span>
<span id="cb888-27"><a href="ch-11.html#cb888-27" aria-hidden="true" tabindex="-1"></a><span class="do">## ________________________________________________________________________________</span></span>
<span id="cb888-28"><a href="ch-11.html#cb888-28" aria-hidden="true" tabindex="-1"></a><span class="do">## Evaluation error on the held out fold:  25.21327 </span></span>
<span id="cb888-29"><a href="ch-11.html#cb888-29" aria-hidden="true" tabindex="-1"></a><span class="do">## CV Fold --&gt; 3/5</span></span>
<span id="cb888-30"><a href="ch-11.html#cb888-30" aria-hidden="true" tabindex="-1"></a><span class="do">## Model: &quot;sequential_3&quot;</span></span>
<span id="cb888-31"><a href="ch-11.html#cb888-31" aria-hidden="true" tabindex="-1"></a><span class="do">## ________________________________________________________________________________</span></span>
<span id="cb888-32"><a href="ch-11.html#cb888-32" aria-hidden="true" tabindex="-1"></a><span class="do">## Layer (type)                        Output Shape                    Param #     </span></span>
<span id="cb888-33"><a href="ch-11.html#cb888-33" aria-hidden="true" tabindex="-1"></a><span class="do">## ================================================================================</span></span>
<span id="cb888-34"><a href="ch-11.html#cb888-34" aria-hidden="true" tabindex="-1"></a><span class="do">## dense_6 (Dense)                     (None, 20)                      320         </span></span>
<span id="cb888-35"><a href="ch-11.html#cb888-35" aria-hidden="true" tabindex="-1"></a><span class="do">## ________________________________________________________________________________</span></span>
<span id="cb888-36"><a href="ch-11.html#cb888-36" aria-hidden="true" tabindex="-1"></a><span class="do">## dense_7 (Dense)                     (None, 1)                       21          </span></span>
<span id="cb888-37"><a href="ch-11.html#cb888-37" aria-hidden="true" tabindex="-1"></a><span class="do">## ================================================================================</span></span>
<span id="cb888-38"><a href="ch-11.html#cb888-38" aria-hidden="true" tabindex="-1"></a><span class="do">## Total params: 341</span></span>
<span id="cb888-39"><a href="ch-11.html#cb888-39" aria-hidden="true" tabindex="-1"></a><span class="do">## Trainable params: 341</span></span>
<span id="cb888-40"><a href="ch-11.html#cb888-40" aria-hidden="true" tabindex="-1"></a><span class="do">## Non-trainable params: 0</span></span>
<span id="cb888-41"><a href="ch-11.html#cb888-41" aria-hidden="true" tabindex="-1"></a><span class="do">## ________________________________________________________________________________</span></span>
<span id="cb888-42"><a href="ch-11.html#cb888-42" aria-hidden="true" tabindex="-1"></a><span class="do">## Evaluation error on the held out fold:  24.25686 </span></span>
<span id="cb888-43"><a href="ch-11.html#cb888-43" aria-hidden="true" tabindex="-1"></a><span class="do">## CV Fold --&gt; 4/5</span></span>
<span id="cb888-44"><a href="ch-11.html#cb888-44" aria-hidden="true" tabindex="-1"></a><span class="do">## Model: &quot;sequential_4&quot;</span></span>
<span id="cb888-45"><a href="ch-11.html#cb888-45" aria-hidden="true" tabindex="-1"></a><span class="do">## ________________________________________________________________________________</span></span>
<span id="cb888-46"><a href="ch-11.html#cb888-46" aria-hidden="true" tabindex="-1"></a><span class="do">## Layer (type)                        Output Shape                    Param #     </span></span>
<span id="cb888-47"><a href="ch-11.html#cb888-47" aria-hidden="true" tabindex="-1"></a><span class="do">## ================================================================================</span></span>
<span id="cb888-48"><a href="ch-11.html#cb888-48" aria-hidden="true" tabindex="-1"></a><span class="do">## dense_8 (Dense)                     (None, 20)                      320         </span></span>
<span id="cb888-49"><a href="ch-11.html#cb888-49" aria-hidden="true" tabindex="-1"></a><span class="do">## ________________________________________________________________________________</span></span>
<span id="cb888-50"><a href="ch-11.html#cb888-50" aria-hidden="true" tabindex="-1"></a><span class="do">## dense_9 (Dense)                     (None, 1)                       21          </span></span>
<span id="cb888-51"><a href="ch-11.html#cb888-51" aria-hidden="true" tabindex="-1"></a><span class="do">## ================================================================================</span></span>
<span id="cb888-52"><a href="ch-11.html#cb888-52" aria-hidden="true" tabindex="-1"></a><span class="do">## Total params: 341</span></span>
<span id="cb888-53"><a href="ch-11.html#cb888-53" aria-hidden="true" tabindex="-1"></a><span class="do">## Trainable params: 341</span></span>
<span id="cb888-54"><a href="ch-11.html#cb888-54" aria-hidden="true" tabindex="-1"></a><span class="do">## Non-trainable params: 0</span></span>
<span id="cb888-55"><a href="ch-11.html#cb888-55" aria-hidden="true" tabindex="-1"></a><span class="do">## ________________________________________________________________________________</span></span>
<span id="cb888-56"><a href="ch-11.html#cb888-56" aria-hidden="true" tabindex="-1"></a><span class="do">## Evaluation error on the held out fold:  24.77271 </span></span>
<span id="cb888-57"><a href="ch-11.html#cb888-57" aria-hidden="true" tabindex="-1"></a><span class="do">## CV Fold --&gt; 5/5</span></span>
<span id="cb888-58"><a href="ch-11.html#cb888-58" aria-hidden="true" tabindex="-1"></a><span class="do">## Model: &quot;sequential_5&quot;</span></span>
<span id="cb888-59"><a href="ch-11.html#cb888-59" aria-hidden="true" tabindex="-1"></a><span class="do">## ________________________________________________________________________________</span></span>
<span id="cb888-60"><a href="ch-11.html#cb888-60" aria-hidden="true" tabindex="-1"></a><span class="do">## Layer (type)                        Output Shape                    Param #     </span></span>
<span id="cb888-61"><a href="ch-11.html#cb888-61" aria-hidden="true" tabindex="-1"></a><span class="do">## ================================================================================</span></span>
<span id="cb888-62"><a href="ch-11.html#cb888-62" aria-hidden="true" tabindex="-1"></a><span class="do">## dense_10 (Dense)                    (None, 20)                      320         </span></span>
<span id="cb888-63"><a href="ch-11.html#cb888-63" aria-hidden="true" tabindex="-1"></a><span class="do">## ________________________________________________________________________________</span></span>
<span id="cb888-64"><a href="ch-11.html#cb888-64" aria-hidden="true" tabindex="-1"></a><span class="do">## dense_11 (Dense)                    (None, 1)                       21          </span></span>
<span id="cb888-65"><a href="ch-11.html#cb888-65" aria-hidden="true" tabindex="-1"></a><span class="do">## ================================================================================</span></span>
<span id="cb888-66"><a href="ch-11.html#cb888-66" aria-hidden="true" tabindex="-1"></a><span class="do">## Total params: 341</span></span>
<span id="cb888-67"><a href="ch-11.html#cb888-67" aria-hidden="true" tabindex="-1"></a><span class="do">## Trainable params: 341</span></span>
<span id="cb888-68"><a href="ch-11.html#cb888-68" aria-hidden="true" tabindex="-1"></a><span class="do">## Non-trainable params: 0</span></span>
<span id="cb888-69"><a href="ch-11.html#cb888-69" aria-hidden="true" tabindex="-1"></a><span class="do">## ________________________________________________________________________________</span></span>
<span id="cb888-70"><a href="ch-11.html#cb888-70" aria-hidden="true" tabindex="-1"></a><span class="do">## Evaluation error on the held out fold:  24.60175</span></span></code></pre></div>
<div class="sourceCode" id="cb889"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb889-1"><a href="ch-11.html#cb889-1" aria-hidden="true" tabindex="-1"></a>history_list <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">&quot;./data/history_list_11.rds&quot;</span>)</span>
<span id="cb889-2"><a href="ch-11.html#cb889-2" aria-hidden="true" tabindex="-1"></a>cv_performance_list <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">&quot;./data/cv_performance_list.rds&quot;</span>)</span></code></pre></div>
<p>After running this loop we would have trained 5 different models, on our cross validation folds, and logged the evaluation results in “cv_performance_list”. Next we want to plot the MSE (mean square error), across the 5 cross validation test folds. Use the list containing these results to make the plot. Taking an average of the cross validation test score (MSE) for all the different folds, we get the average cross validation loss, which can then be used in model tuning.</p>
<div class="sourceCode" id="cb890"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb890-1"><a href="ch-11.html#cb890-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Plot the training history for all the 5 folds </span></span>
<span id="cb890-2"><a href="ch-11.html#cb890-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>){</span>
<span id="cb890-3"><a href="ch-11.html#cb890-3" aria-hidden="true" tabindex="-1"></a>  plt<span class="ot">&lt;-</span><span class="fu">plot</span>(history_list[[i]])</span>
<span id="cb890-4"><a href="ch-11.html#cb890-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(plt)</span>
<span id="cb890-5"><a href="ch-11.html#cb890-5" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb890-6"><a href="ch-11.html#cb890-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb890-7"><a href="ch-11.html#cb890-7" aria-hidden="true" tabindex="-1"></a><span class="do">## plot MSE across cross validation test folds</span></span>
<span id="cb890-8"><a href="ch-11.html#cb890-8" aria-hidden="true" tabindex="-1"></a>loss_list <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="cn">NA</span>, <span class="dv">5</span>)</span>
<span id="cb890-9"><a href="ch-11.html#cb890-9" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>){</span>
<span id="cb890-10"><a href="ch-11.html#cb890-10" aria-hidden="true" tabindex="-1"></a>  loss_list[i] <span class="ot">&lt;-</span> cv_performance_list[[i]]<span class="sc">$</span>mean_squared_error</span>
<span id="cb890-11"><a href="ch-11.html#cb890-11" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb890-12"><a href="ch-11.html#cb890-12" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span> </span>
<span id="cb890-13"><a href="ch-11.html#cb890-13" aria-hidden="true" tabindex="-1"></a><span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>), loss_list), <span class="at">size =</span> <span class="dv">4</span>) <span class="sc">+</span></span>
<span id="cb890-14"><a href="ch-11.html#cb890-14" aria-hidden="true" tabindex="-1"></a><span class="fu">labs</span>(<span class="at">title=</span><span class="st">&quot;MSE on left out folds&quot;</span>,</span>
<span id="cb890-15"><a href="ch-11.html#cb890-15" aria-hidden="true" tabindex="-1"></a>        <span class="at">x =</span><span class="st">&quot;Cross-Validation Folds&quot;</span>, <span class="at">y =</span> <span class="st">&quot;Mean Squared Error&quot;</span>)</span>
<span id="cb890-16"><a href="ch-11.html#cb890-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb890-17"><a href="ch-11.html#cb890-17" aria-hidden="true" tabindex="-1"></a><span class="do">## compute the average MSE across folds</span></span>
<span id="cb890-18"><a href="ch-11.html#cb890-18" aria-hidden="true" tabindex="-1"></a>avg_cv_loss <span class="ot">&lt;-</span> <span class="fu">mean</span>(loss_list)</span>
<span id="cb890-19"><a href="ch-11.html#cb890-19" aria-hidden="true" tabindex="-1"></a>avg_cv_loss</span></code></pre></div>
<p>What is the average cross validation error obtained for this configuration of the network ?</p>
</div>
<div id="parameter-tuning" class="section level3" number="11.2.6">
<h3><span class="header-section-number">11.2.6</span> Parameter Tuning</h3>
<p>Here we will write a function that does the cross-validation for parameter tuning. The content of the cross-validation code remains the same as we have seen before. This is the same code written as a function that also takes the hyperparameter to be tuned as an argument.
Your task is to optimise the number of hidden units.
First we will organise all the steps done until now to write the function.</p>
<div class="sourceCode" id="cb891"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb891-1"><a href="ch-11.html#cb891-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Function Name: cross_validate_model()  </span></span>
<span id="cb891-2"><a href="ch-11.html#cb891-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Inputs: Training split, number of hidden units, and number of epochs  </span></span>
<span id="cb891-3"><a href="ch-11.html#cb891-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Output: The average cross validation loss across all 5 folds. </span></span>
<span id="cb891-4"><a href="ch-11.html#cb891-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb891-5"><a href="ch-11.html#cb891-5" aria-hidden="true" tabindex="-1"></a><span class="do">## Hint: All you have to do is organise the steps we followed in the crossvalidation section as a function to make it reproducible  </span></span>
<span id="cb891-6"><a href="ch-11.html#cb891-6" aria-hidden="true" tabindex="-1"></a>cross_validate_model <span class="ot">&lt;-</span> <span class="cf">function</span>(train_split, num_units, num_epochs){</span>
<span id="cb891-7"><a href="ch-11.html#cb891-7" aria-hidden="true" tabindex="-1"></a>   <span class="co">#Randomly shuffle the data</span></span>
<span id="cb891-8"><a href="ch-11.html#cb891-8" aria-hidden="true" tabindex="-1"></a>    cv_data <span class="ot">&lt;-</span> train_split </span>
<span id="cb891-9"><a href="ch-11.html#cb891-9" aria-hidden="true" tabindex="-1"></a>    cv_data <span class="ot">&lt;-</span> cv_data[<span class="fu">sample</span>(<span class="fu">nrow</span>(cv_data)),]</span>
<span id="cb891-10"><a href="ch-11.html#cb891-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb891-11"><a href="ch-11.html#cb891-11" aria-hidden="true" tabindex="-1"></a>    <span class="co">#Create 5 equally size folds</span></span>
<span id="cb891-12"><a href="ch-11.html#cb891-12" aria-hidden="true" tabindex="-1"></a>    folds <span class="ot">&lt;-</span> <span class="fu">cut</span>(<span class="fu">seq</span>(<span class="dv">1</span>,<span class="fu">nrow</span>(cv_data)),<span class="at">breaks=</span><span class="dv">5</span>,<span class="at">labels=</span><span class="cn">FALSE</span>)</span>
<span id="cb891-13"><a href="ch-11.html#cb891-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb891-14"><a href="ch-11.html#cb891-14" aria-hidden="true" tabindex="-1"></a>    history_list <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb891-15"><a href="ch-11.html#cb891-15" aria-hidden="true" tabindex="-1"></a>    cv_performance_list <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb891-16"><a href="ch-11.html#cb891-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb891-17"><a href="ch-11.html#cb891-17" aria-hidden="true" tabindex="-1"></a>    <span class="co">#Perform 5 fold cross validation</span></span>
<span id="cb891-18"><a href="ch-11.html#cb891-18" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>){</span>
<span id="cb891-19"><a href="ch-11.html#cb891-19" aria-hidden="true" tabindex="-1"></a>        <span class="fu">cat</span>(<span class="fu">sprintf</span>(<span class="st">&quot;CV Fold --&gt; %i/5</span><span class="sc">\n</span><span class="st">&quot;</span>, i))</span>
<span id="cb891-20"><a href="ch-11.html#cb891-20" aria-hidden="true" tabindex="-1"></a>        <span class="co">#Segement the data by fold using the which() function</span></span>
<span id="cb891-21"><a href="ch-11.html#cb891-21" aria-hidden="true" tabindex="-1"></a>        indices <span class="ot">&lt;-</span> <span class="fu">which</span>(folds<span class="sc">==</span>i,<span class="at">arr.ind=</span><span class="cn">TRUE</span>)</span>
<span id="cb891-22"><a href="ch-11.html#cb891-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb891-23"><a href="ch-11.html#cb891-23" aria-hidden="true" tabindex="-1"></a>        <span class="do">## indices is a vector with TRUE for the rows where the folds == i; and FALSE for the rest of the row</span></span>
<span id="cb891-24"><a href="ch-11.html#cb891-24" aria-hidden="true" tabindex="-1"></a>        <span class="do">## indices which are TRUE for a particular loop form the cross-validation test set for that loop  </span></span>
<span id="cb891-25"><a href="ch-11.html#cb891-25" aria-hidden="true" tabindex="-1"></a>        cv_test_data <span class="ot">&lt;-</span> cv_data[indices, ]</span>
<span id="cb891-26"><a href="ch-11.html#cb891-26" aria-hidden="true" tabindex="-1"></a>        cv_test_target <span class="ot">&lt;-</span> cv_test_data <span class="sc">%&gt;%</span> <span class="fu">select</span>(target_variable)</span>
<span id="cb891-27"><a href="ch-11.html#cb891-27" aria-hidden="true" tabindex="-1"></a>        cv_test_data <span class="ot">&lt;-</span> cv_test_data <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">-</span><span class="fu">one_of</span>(<span class="fu">c</span>(target_variable, time_cols)))</span>
<span id="cb891-28"><a href="ch-11.html#cb891-28" aria-hidden="true" tabindex="-1"></a>        cv_train_data <span class="ot">&lt;-</span> cv_data[<span class="sc">-</span>indices, ]</span>
<span id="cb891-29"><a href="ch-11.html#cb891-29" aria-hidden="true" tabindex="-1"></a>        cv_train_target <span class="ot">&lt;-</span> cv_train_data <span class="sc">%&gt;%</span> <span class="fu">select</span>(target_variable)</span>
<span id="cb891-30"><a href="ch-11.html#cb891-30" aria-hidden="true" tabindex="-1"></a>        cv_train_data <span class="ot">&lt;-</span> cv_train_data <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">-</span><span class="fu">one_of</span>(<span class="fu">c</span>(target_variable, time_cols)))</span>
<span id="cb891-31"><a href="ch-11.html#cb891-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb891-32"><a href="ch-11.html#cb891-32" aria-hidden="true" tabindex="-1"></a>        <span class="co"># scale and center using cv_train set </span></span>
<span id="cb891-33"><a href="ch-11.html#cb891-33" aria-hidden="true" tabindex="-1"></a>        <span class="co"># get the statistics (mean, variance, etc) of numeric cols </span></span>
<span id="cb891-34"><a href="ch-11.html#cb891-34" aria-hidden="true" tabindex="-1"></a>        cv_train_data_stat <span class="ot">&lt;-</span> <span class="fu">preProcess</span>(cv_train_data, <span class="at">method =</span> <span class="fu">c</span>(<span class="st">&quot;center&quot;</span>,<span class="st">&quot;scale&quot;</span>))  </span>
<span id="cb891-35"><a href="ch-11.html#cb891-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb891-36"><a href="ch-11.html#cb891-36" aria-hidden="true" tabindex="-1"></a>        <span class="co"># transform the train data to center and scale it </span></span>
<span id="cb891-37"><a href="ch-11.html#cb891-37" aria-hidden="true" tabindex="-1"></a>        cv_train_data <span class="ot">&lt;-</span> <span class="fu">predict</span>(cv_train_data_stat, cv_train_data)  </span>
<span id="cb891-38"><a href="ch-11.html#cb891-38" aria-hidden="true" tabindex="-1"></a>        cv_test_data <span class="ot">&lt;-</span> <span class="fu">predict</span>(cv_train_data_stat, cv_test_data)</span>
<span id="cb891-39"><a href="ch-11.html#cb891-39" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb891-40"><a href="ch-11.html#cb891-40" aria-hidden="true" tabindex="-1"></a>        <span class="co"># OR </span></span>
<span id="cb891-41"><a href="ch-11.html#cb891-41" aria-hidden="true" tabindex="-1"></a>        <span class="co"># scale_and_center&lt;- recipe(cv_train_data) %&gt;%</span></span>
<span id="cb891-42"><a href="ch-11.html#cb891-42" aria-hidden="true" tabindex="-1"></a>        <span class="co">#                             step_center(all_numeric()) %&gt;%</span></span>
<span id="cb891-43"><a href="ch-11.html#cb891-43" aria-hidden="true" tabindex="-1"></a>        <span class="co">#                             step_scale(all_numeric())</span></span>
<span id="cb891-44"><a href="ch-11.html#cb891-44" aria-hidden="true" tabindex="-1"></a>        <span class="co"># prep_recipe &lt;- prep(scale_and_center, training = cv_train_data)</span></span>
<span id="cb891-45"><a href="ch-11.html#cb891-45" aria-hidden="true" tabindex="-1"></a>        <span class="co"># cv_train_data &lt;- bake(prep_recipe, new_data = cv_train_data)</span></span>
<span id="cb891-46"><a href="ch-11.html#cb891-46" aria-hidden="true" tabindex="-1"></a>        <span class="co"># cv_test_data &lt;- bake(prep_recipe, new_data = cv_test_data)</span></span>
<span id="cb891-47"><a href="ch-11.html#cb891-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb891-48"><a href="ch-11.html#cb891-48" aria-hidden="true" tabindex="-1"></a>        <span class="co"># if(!missing(subset_predictors)){</span></span>
<span id="cb891-49"><a href="ch-11.html#cb891-49" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ## take a subset of predictors</span></span>
<span id="cb891-50"><a href="ch-11.html#cb891-50" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   cv_train_data &lt;- cv_train_data %&gt;% select(subset_predictors)</span></span>
<span id="cb891-51"><a href="ch-11.html#cb891-51" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   cv_test_data &lt;- cv_test_data %&gt;% select(subset_predictors)</span></span>
<span id="cb891-52"><a href="ch-11.html#cb891-52" aria-hidden="true" tabindex="-1"></a>        <span class="co"># }</span></span>
<span id="cb891-53"><a href="ch-11.html#cb891-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb891-54"><a href="ch-11.html#cb891-54" aria-hidden="true" tabindex="-1"></a>        cv_train_data <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(cv_train_data)</span>
<span id="cb891-55"><a href="ch-11.html#cb891-55" aria-hidden="true" tabindex="-1"></a>        cv_train_target <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(cv_train_target)</span>
<span id="cb891-56"><a href="ch-11.html#cb891-56" aria-hidden="true" tabindex="-1"></a>        cv_test_data <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(cv_test_data)</span>
<span id="cb891-57"><a href="ch-11.html#cb891-57" aria-hidden="true" tabindex="-1"></a>        cv_test_target <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(cv_test_target)</span>
<span id="cb891-58"><a href="ch-11.html#cb891-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb891-59"><a href="ch-11.html#cb891-59" aria-hidden="true" tabindex="-1"></a>        cv_model <span class="ot">&lt;-</span> <span class="fu">build_model</span>(<span class="at">X_train =</span> cv_train_data, <span class="at">y_train =</span> cv_train_target, </span>
<span id="cb891-60"><a href="ch-11.html#cb891-60" aria-hidden="true" tabindex="-1"></a>                  <span class="at">num_units =</span> num_units,</span>
<span id="cb891-61"><a href="ch-11.html#cb891-61" aria-hidden="true" tabindex="-1"></a>                  <span class="at">activation_type =</span> <span class="st">&quot;relu&quot;</span>,</span>
<span id="cb891-62"><a href="ch-11.html#cb891-62" aria-hidden="true" tabindex="-1"></a>                  <span class="at">num_epochs =</span> num_epochs,</span>
<span id="cb891-63"><a href="ch-11.html#cb891-63" aria-hidden="true" tabindex="-1"></a>                  <span class="at">batch_size =</span> <span class="dv">128</span>,</span>
<span id="cb891-64"><a href="ch-11.html#cb891-64" aria-hidden="true" tabindex="-1"></a>                  <span class="at">val_size =</span> <span class="fl">0.15</span>)</span>
<span id="cb891-65"><a href="ch-11.html#cb891-65" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb891-66"><a href="ch-11.html#cb891-66" aria-hidden="true" tabindex="-1"></a>        eval_result <span class="ot">&lt;-</span> cv_model<span class="sc">$</span>model <span class="sc">%&gt;%</span> <span class="fu">evaluate</span>(cv_test_data, cv_test_target)</span>
<span id="cb891-67"><a href="ch-11.html#cb891-67" aria-hidden="true" tabindex="-1"></a>        cv_performance_list[[i]] <span class="ot">&lt;-</span> eval_result</span>
<span id="cb891-68"><a href="ch-11.html#cb891-68" aria-hidden="true" tabindex="-1"></a>        <span class="fu">cat</span>(<span class="st">&quot;Evaluation error on the held out fold: &quot;</span> , eval_result<span class="sc">$</span>mean_squared_error,<span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb891-69"><a href="ch-11.html#cb891-69" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb891-70"><a href="ch-11.html#cb891-70" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb891-71"><a href="ch-11.html#cb891-71" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(cv_performance_list)</span>
<span id="cb891-72"><a href="ch-11.html#cb891-72" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p><img src="figures/11_output-loss1.png" />
<img src="figures/11_output-loss2.png" />
<img src="figures/11_output-loss3.png" />
<img src="figures/11_output-loss4.png" /></p>
<p><img src="figures/11_output-mse.png" /></p>
<p>Next you need to write a function to iterate over the list of hyper-parameters. In each iteration we iterate over a list of the possible number of hidden units, and compute the average cross-validation error.</p>
<div class="sourceCode" id="cb892"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb892-1"><a href="ch-11.html#cb892-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Function Name: tune_num_units()  </span></span>
<span id="cb892-2"><a href="ch-11.html#cb892-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Inputs: training split, num_units --&gt; a vector containing the possible values of hidden units  </span></span>
<span id="cb892-3"><a href="ch-11.html#cb892-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Output: List / vector containing the average cross validation loss for each possible value of hidden units  </span></span>
<span id="cb892-4"><a href="ch-11.html#cb892-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb892-5"><a href="ch-11.html#cb892-5" aria-hidden="true" tabindex="-1"></a>tune_num_units <span class="ot">&lt;-</span> <span class="cf">function</span>(train_split,  num_units){</span>
<span id="cb892-6"><a href="ch-11.html#cb892-6" aria-hidden="true" tabindex="-1"></a>  <span class="do">## create an empty list to store the average loss for each value in num_units </span></span>
<span id="cb892-7"><a href="ch-11.html#cb892-7" aria-hidden="true" tabindex="-1"></a>  avg_loss_list<span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="cn">NA</span>, <span class="fu">length</span>(num_units))</span>
<span id="cb892-8"><a href="ch-11.html#cb892-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb892-9"><a href="ch-11.html#cb892-9" aria-hidden="true" tabindex="-1"></a>  <span class="do">## write a loop to iterate over num_units and store the average cross validation loss </span></span>
<span id="cb892-10"><a href="ch-11.html#cb892-10" aria-hidden="true" tabindex="-1"></a>  p <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb892-11"><a href="ch-11.html#cb892-11" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (k <span class="cf">in</span> num_units){</span>
<span id="cb892-12"><a href="ch-11.html#cb892-12" aria-hidden="true" tabindex="-1"></a>    performance<span class="ot">&lt;-</span> <span class="fu">cross_validate_model</span>(<span class="at">train_split =</span> train_split, <span class="at">num_units =</span> k, <span class="at">num_epochs =</span> <span class="dv">30</span>)</span>
<span id="cb892-13"><a href="ch-11.html#cb892-13" aria-hidden="true" tabindex="-1"></a>    loss <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="cn">NA</span>,<span class="dv">5</span>)</span>
<span id="cb892-14"><a href="ch-11.html#cb892-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>) {</span>
<span id="cb892-15"><a href="ch-11.html#cb892-15" aria-hidden="true" tabindex="-1"></a>    loss[i] <span class="ot">&lt;-</span> performance[[i]]<span class="sc">$</span>mean_squared_error</span>
<span id="cb892-16"><a href="ch-11.html#cb892-16" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb892-17"><a href="ch-11.html#cb892-17" aria-hidden="true" tabindex="-1"></a>  avg_loss_list[p] <span class="ot">&lt;-</span> <span class="fu">mean</span>(loss)</span>
<span id="cb892-18"><a href="ch-11.html#cb892-18" aria-hidden="true" tabindex="-1"></a>  p <span class="ot">&lt;-</span> p<span class="sc">+</span><span class="dv">1</span> </span>
<span id="cb892-19"><a href="ch-11.html#cb892-19" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb892-20"><a href="ch-11.html#cb892-20" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb892-21"><a href="ch-11.html#cb892-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(avg_loss_list)</span>
<span id="cb892-22"><a href="ch-11.html#cb892-22" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb892-23"><a href="ch-11.html#cb892-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(avg_loss_list)</span>
<span id="cb892-24"><a href="ch-11.html#cb892-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb892-25"><a href="ch-11.html#cb892-25" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Now let’s consider the given vector “num_units” for tuning the number of hidden units</p>
<div class="sourceCode" id="cb893"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb893-1"><a href="ch-11.html#cb893-1" aria-hidden="true" tabindex="-1"></a><span class="co"># num_units &lt;- c(1,3,10,30,100)</span></span>
<span id="cb893-2"><a href="ch-11.html#cb893-2" aria-hidden="true" tabindex="-1"></a>num_units <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">3</span>,<span class="dv">10</span>,<span class="dv">30</span>,<span class="dv">100</span>)</span>
<span id="cb893-3"><a href="ch-11.html#cb893-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb893-4"><a href="ch-11.html#cb893-4" aria-hidden="true" tabindex="-1"></a><span class="do">## compute the average cross validation loss for each element in num_units using tune_num_units()</span></span>
<span id="cb893-5"><a href="ch-11.html#cb893-5" aria-hidden="true" tabindex="-1"></a><span class="co">#  Output is shown at bottom of this chapter due to its length.</span></span>
<span id="cb893-6"><a href="ch-11.html#cb893-6" aria-hidden="true" tabindex="-1"></a>tune_results <span class="ot">&lt;-</span> <span class="fu">tune_num_units</span>(<span class="at">train_split =</span> train_split, <span class="at">num_units =</span> num_units)</span></code></pre></div>
<div class="sourceCode" id="cb894"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb894-1"><a href="ch-11.html#cb894-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Print out the results </span></span>
<span id="cb894-2"><a href="ch-11.html#cb894-2" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(tune_results)</span></code></pre></div>
<div class="sourceCode" id="cb895"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb895-1"><a href="ch-11.html#cb895-1" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 31.07678 25.69231 24.78246 24.29657 23.89560</span></span></code></pre></div>
<div class="sourceCode" id="cb896"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb896-1"><a href="ch-11.html#cb896-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Plot the average cross validation loss, as a function of the num_units </span></span>
<span id="cb896-2"><a href="ch-11.html#cb896-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(num_units, tune_results, <span class="at">type =</span> <span class="st">&quot;b&quot;</span>)</span></code></pre></div>
<p><img src="figures/11_output-tune.png" /></p>
<div class="sourceCode" id="cb897"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb897-1"><a href="ch-11.html#cb897-1" aria-hidden="true" tabindex="-1"></a><span class="do">## What is the number of hidden units that gives the minimum loss ? </span></span>
<span id="cb897-2"><a href="ch-11.html#cb897-2" aria-hidden="true" tabindex="-1"></a>min_loss <span class="ot">&lt;-</span> <span class="fu">min</span>(tune_results)</span>
<span id="cb897-3"><a href="ch-11.html#cb897-3" aria-hidden="true" tabindex="-1"></a>min_loss_index <span class="ot">&lt;-</span> <span class="fu">which.min</span>(tune_results)</span>
<span id="cb897-4"><a href="ch-11.html#cb897-4" aria-hidden="true" tabindex="-1"></a>num_units_best <span class="ot">&lt;-</span> num_units[min_loss_index]</span>
<span id="cb897-5"><a href="ch-11.html#cb897-5" aria-hidden="true" tabindex="-1"></a><span class="fu">sprintf</span>(<span class="st">&quot;Number of units for minimal average cross validation error: %i&quot;</span>, num_units_best)</span></code></pre></div>
<div class="sourceCode" id="cb898"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb898-1"><a href="ch-11.html#cb898-1" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] &quot;Number of units for minimal average cross validation error: 100&quot;</span></span></code></pre></div>
<p>What is the most practical number of hidden units in your opinion? (Consider the tradeoff between the reduction in MSE loss with the increase in hidden units and the increase in training time and model complexity, and number of parameters to be learnt)</p>
<p>As one might suspect network with 100 hidden units gives the minimum loss, but it is only marginally better than a network with 30 hidden units. So, one might consider using 30 hidden units as it gives a reasonable tradeoff between model complexity and the cross validation loss. Also note that if we decrease the model complexity too much, the loss on cross-validation increases significantly.</p>
<p>Closing remarks: Finally, in practice, when you arrive at the optimal model parameters after cross-validation, you train a new model, using the entire training set, and use the initial held-out test set (20%) to evaluate the model’s performance on new data.</p>
<div class="sourceCode" id="cb899"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb899-1"><a href="ch-11.html#cb899-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Output of tune_results &lt;- tune_num_units(train_split = train_split, num_units = num_units)</span></span>
<span id="cb899-2"><a href="ch-11.html#cb899-2" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb899-3"><a href="ch-11.html#cb899-3" aria-hidden="true" tabindex="-1"></a><span class="do">## CV Fold --&gt; 1/5</span></span>
<span id="cb899-4"><a href="ch-11.html#cb899-4" aria-hidden="true" tabindex="-1"></a><span class="do">## Model: &quot;sequential_6&quot;</span></span>
<span id="cb899-5"><a href="ch-11.html#cb899-5" aria-hidden="true" tabindex="-1"></a><span class="do">## ________________________________________________________________________________</span></span>
<span id="cb899-6"><a href="ch-11.html#cb899-6" aria-hidden="true" tabindex="-1"></a><span class="do">## Layer (type)                        Output Shape                    Param #     </span></span>
<span id="cb899-7"><a href="ch-11.html#cb899-7" aria-hidden="true" tabindex="-1"></a><span class="do">## ================================================================================</span></span>
<span id="cb899-8"><a href="ch-11.html#cb899-8" aria-hidden="true" tabindex="-1"></a><span class="do">## dense_12 (Dense)                    (None, 1)                       16          </span></span>
<span id="cb899-9"><a href="ch-11.html#cb899-9" aria-hidden="true" tabindex="-1"></a><span class="do">## ________________________________________________________________________________</span></span>
<span id="cb899-10"><a href="ch-11.html#cb899-10" aria-hidden="true" tabindex="-1"></a><span class="do">## dense_13 (Dense)                    (None, 1)                       2           </span></span>
<span id="cb899-11"><a href="ch-11.html#cb899-11" aria-hidden="true" tabindex="-1"></a><span class="do">## ================================================================================</span></span>
<span id="cb899-12"><a href="ch-11.html#cb899-12" aria-hidden="true" tabindex="-1"></a><span class="do">## Total params: 18</span></span>
<span id="cb899-13"><a href="ch-11.html#cb899-13" aria-hidden="true" tabindex="-1"></a><span class="do">## Trainable params: 18</span></span>
<span id="cb899-14"><a href="ch-11.html#cb899-14" aria-hidden="true" tabindex="-1"></a><span class="do">## Non-trainable params: 0</span></span>
<span id="cb899-15"><a href="ch-11.html#cb899-15" aria-hidden="true" tabindex="-1"></a><span class="do">## ________________________________________________________________________________</span></span>
<span id="cb899-16"><a href="ch-11.html#cb899-16" aria-hidden="true" tabindex="-1"></a><span class="do">## Evaluation error on the held out fold:  34.77391 </span></span>
<span id="cb899-17"><a href="ch-11.html#cb899-17" aria-hidden="true" tabindex="-1"></a><span class="do">## CV Fold --&gt; 2/5</span></span>
<span id="cb899-18"><a href="ch-11.html#cb899-18" aria-hidden="true" tabindex="-1"></a><span class="do">## Model: &quot;sequential_7&quot;</span></span>
<span id="cb899-19"><a href="ch-11.html#cb899-19" aria-hidden="true" tabindex="-1"></a><span class="do">## ________________________________________________________________________________</span></span>
<span id="cb899-20"><a href="ch-11.html#cb899-20" aria-hidden="true" tabindex="-1"></a><span class="do">## Layer (type)                        Output Shape                    Param #     </span></span>
<span id="cb899-21"><a href="ch-11.html#cb899-21" aria-hidden="true" tabindex="-1"></a><span class="do">## ================================================================================</span></span>
<span id="cb899-22"><a href="ch-11.html#cb899-22" aria-hidden="true" tabindex="-1"></a><span class="do">## dense_14 (Dense)                    (None, 1)                       16          </span></span>
<span id="cb899-23"><a href="ch-11.html#cb899-23" aria-hidden="true" tabindex="-1"></a><span class="do">## ________________________________________________________________________________</span></span>
<span id="cb899-24"><a href="ch-11.html#cb899-24" aria-hidden="true" tabindex="-1"></a><span class="do">## dense_15 (Dense)                    (None, 1)                       2           </span></span>
<span id="cb899-25"><a href="ch-11.html#cb899-25" aria-hidden="true" tabindex="-1"></a><span class="do">## ================================================================================</span></span>
<span id="cb899-26"><a href="ch-11.html#cb899-26" aria-hidden="true" tabindex="-1"></a><span class="do">## Total params: 18</span></span>
<span id="cb899-27"><a href="ch-11.html#cb899-27" aria-hidden="true" tabindex="-1"></a><span class="do">## Trainable params: 18</span></span>
<span id="cb899-28"><a href="ch-11.html#cb899-28" aria-hidden="true" tabindex="-1"></a><span class="do">## Non-trainable params: 0</span></span>
<span id="cb899-29"><a href="ch-11.html#cb899-29" aria-hidden="true" tabindex="-1"></a><span class="do">## ________________________________________________________________________________</span></span>
<span id="cb899-30"><a href="ch-11.html#cb899-30" aria-hidden="true" tabindex="-1"></a><span class="do">## Evaluation error on the held out fold:  29.33935 </span></span>
<span id="cb899-31"><a href="ch-11.html#cb899-31" aria-hidden="true" tabindex="-1"></a><span class="do">## CV Fold --&gt; 3/5</span></span>
<span id="cb899-32"><a href="ch-11.html#cb899-32" aria-hidden="true" tabindex="-1"></a><span class="do">## Model: &quot;sequential_8&quot;</span></span>
<span id="cb899-33"><a href="ch-11.html#cb899-33" aria-hidden="true" tabindex="-1"></a><span class="do">## ________________________________________________________________________________</span></span>
<span id="cb899-34"><a href="ch-11.html#cb899-34" aria-hidden="true" tabindex="-1"></a><span class="do">## Layer (type)                        Output Shape                    Param #     </span></span>
<span id="cb899-35"><a href="ch-11.html#cb899-35" aria-hidden="true" tabindex="-1"></a><span class="do">## ================================================================================</span></span>
<span id="cb899-36"><a href="ch-11.html#cb899-36" aria-hidden="true" tabindex="-1"></a><span class="do">## dense_16 (Dense)                    (None, 1)                       16          </span></span>
<span id="cb899-37"><a href="ch-11.html#cb899-37" aria-hidden="true" tabindex="-1"></a><span class="do">## ________________________________________________________________________________</span></span>
<span id="cb899-38"><a href="ch-11.html#cb899-38" aria-hidden="true" tabindex="-1"></a><span class="do">## dense_17 (Dense)                    (None, 1)                       2           </span></span>
<span id="cb899-39"><a href="ch-11.html#cb899-39" aria-hidden="true" tabindex="-1"></a><span class="do">## ================================================================================</span></span>
<span id="cb899-40"><a href="ch-11.html#cb899-40" aria-hidden="true" tabindex="-1"></a><span class="do">## Total params: 18</span></span>
<span id="cb899-41"><a href="ch-11.html#cb899-41" aria-hidden="true" tabindex="-1"></a><span class="do">## Trainable params: 18</span></span>
<span id="cb899-42"><a href="ch-11.html#cb899-42" aria-hidden="true" tabindex="-1"></a><span class="do">## Non-trainable params: 0</span></span>
<span id="cb899-43"><a href="ch-11.html#cb899-43" aria-hidden="true" tabindex="-1"></a><span class="do">## ________________________________________________________________________________</span></span>
<span id="cb899-44"><a href="ch-11.html#cb899-44" aria-hidden="true" tabindex="-1"></a><span class="do">## Evaluation error on the held out fold:  28.22049 </span></span>
<span id="cb899-45"><a href="ch-11.html#cb899-45" aria-hidden="true" tabindex="-1"></a><span class="do">## CV Fold --&gt; 4/5</span></span>
<span id="cb899-46"><a href="ch-11.html#cb899-46" aria-hidden="true" tabindex="-1"></a><span class="do">## Model: &quot;sequential_9&quot;</span></span>
<span id="cb899-47"><a href="ch-11.html#cb899-47" aria-hidden="true" tabindex="-1"></a><span class="do">## ________________________________________________________________________________</span></span>
<span id="cb899-48"><a href="ch-11.html#cb899-48" aria-hidden="true" tabindex="-1"></a><span class="do">## Layer (type)                        Output Shape                    Param #     </span></span>
<span id="cb899-49"><a href="ch-11.html#cb899-49" aria-hidden="true" tabindex="-1"></a><span class="do">## ================================================================================</span></span>
<span id="cb899-50"><a href="ch-11.html#cb899-50" aria-hidden="true" tabindex="-1"></a><span class="do">## dense_18 (Dense)                    (None, 1)                       16          </span></span>
<span id="cb899-51"><a href="ch-11.html#cb899-51" aria-hidden="true" tabindex="-1"></a><span class="do">## ________________________________________________________________________________</span></span>
<span id="cb899-52"><a href="ch-11.html#cb899-52" aria-hidden="true" tabindex="-1"></a><span class="do">## dense_19 (Dense)                    (None, 1)                       2           </span></span>
<span id="cb899-53"><a href="ch-11.html#cb899-53" aria-hidden="true" tabindex="-1"></a><span class="do">## ================================================================================</span></span>
<span id="cb899-54"><a href="ch-11.html#cb899-54" aria-hidden="true" tabindex="-1"></a><span class="do">## Total params: 18</span></span>
<span id="cb899-55"><a href="ch-11.html#cb899-55" aria-hidden="true" tabindex="-1"></a><span class="do">## Trainable params: 18</span></span>
<span id="cb899-56"><a href="ch-11.html#cb899-56" aria-hidden="true" tabindex="-1"></a><span class="do">## Non-trainable params: 0</span></span>
<span id="cb899-57"><a href="ch-11.html#cb899-57" aria-hidden="true" tabindex="-1"></a><span class="do">## ________________________________________________________________________________</span></span>
<span id="cb899-58"><a href="ch-11.html#cb899-58" aria-hidden="true" tabindex="-1"></a><span class="do">## Evaluation error on the held out fold:  28.60611 </span></span>
<span id="cb899-59"><a href="ch-11.html#cb899-59" aria-hidden="true" tabindex="-1"></a><span class="do">## CV Fold --&gt; 5/5</span></span>
<span id="cb899-60"><a href="ch-11.html#cb899-60" aria-hidden="true" tabindex="-1"></a><span class="do">## Model: &quot;sequential_10&quot;</span></span>
<span id="cb899-61"><a href="ch-11.html#cb899-61" aria-hidden="true" tabindex="-1"></a><span class="do">## ________________________________________________________________________________</span></span>
<span id="cb899-62"><a href="ch-11.html#cb899-62" aria-hidden="true" tabindex="-1"></a><span class="do">## Layer (type)                        Output Shape                    Param #     </span></span>
<span id="cb899-63"><a href="ch-11.html#cb899-63" aria-hidden="true" tabindex="-1"></a><span class="do">## ================================================================================</span></span>
<span id="cb899-64"><a href="ch-11.html#cb899-64" aria-hidden="true" tabindex="-1"></a><span class="do">## dense_20 (Dense)                    (None, 1)                       16          </span></span>
<span id="cb899-65"><a href="ch-11.html#cb899-65" aria-hidden="true" tabindex="-1"></a><span class="do">## ________________________________________________________________________________</span></span>
<span id="cb899-66"><a href="ch-11.html#cb899-66" aria-hidden="true" tabindex="-1"></a><span class="do">## dense_21 (Dense)                    (None, 1)                       2           </span></span>
<span id="cb899-67"><a href="ch-11.html#cb899-67" aria-hidden="true" tabindex="-1"></a><span class="do">## ================================================================================</span></span>
<span id="cb899-68"><a href="ch-11.html#cb899-68" aria-hidden="true" tabindex="-1"></a><span class="do">## Total params: 18</span></span>
<span id="cb899-69"><a href="ch-11.html#cb899-69" aria-hidden="true" tabindex="-1"></a><span class="do">## Trainable params: 18</span></span>
<span id="cb899-70"><a href="ch-11.html#cb899-70" aria-hidden="true" tabindex="-1"></a><span class="do">## Non-trainable params: 0</span></span>
<span id="cb899-71"><a href="ch-11.html#cb899-71" aria-hidden="true" tabindex="-1"></a><span class="do">## ________________________________________________________________________________</span></span>
<span id="cb899-72"><a href="ch-11.html#cb899-72" aria-hidden="true" tabindex="-1"></a><span class="do">## Evaluation error on the held out fold:  34.44407 </span></span>
<span id="cb899-73"><a href="ch-11.html#cb899-73" aria-hidden="true" tabindex="-1"></a><span class="do">## CV Fold --&gt; 1/5</span></span>
<span id="cb899-74"><a href="ch-11.html#cb899-74" aria-hidden="true" tabindex="-1"></a><span class="do">## Model: &quot;sequential_11&quot;</span></span>
<span id="cb899-75"><a href="ch-11.html#cb899-75" aria-hidden="true" tabindex="-1"></a><span class="do">## ________________________________________________________________________________</span></span>
<span id="cb899-76"><a href="ch-11.html#cb899-76" aria-hidden="true" tabindex="-1"></a><span class="do">## Layer (type)                        Output Shape                    Param #     </span></span>
<span id="cb899-77"><a href="ch-11.html#cb899-77" aria-hidden="true" tabindex="-1"></a><span class="do">## ================================================================================</span></span>
<span id="cb899-78"><a href="ch-11.html#cb899-78" aria-hidden="true" tabindex="-1"></a><span class="do">## dense_22 (Dense)                    (None, 3)                       48          </span></span>
<span id="cb899-79"><a href="ch-11.html#cb899-79" aria-hidden="true" tabindex="-1"></a><span class="do">## ________________________________________________________________________________</span></span>
<span id="cb899-80"><a href="ch-11.html#cb899-80" aria-hidden="true" tabindex="-1"></a><span class="do">## dense_23 (Dense)                    (None, 1)                       4           </span></span>
<span id="cb899-81"><a href="ch-11.html#cb899-81" aria-hidden="true" tabindex="-1"></a><span class="do">## ================================================================================</span></span>
<span id="cb899-82"><a href="ch-11.html#cb899-82" aria-hidden="true" tabindex="-1"></a><span class="do">## Total params: 52</span></span>
<span id="cb899-83"><a href="ch-11.html#cb899-83" aria-hidden="true" tabindex="-1"></a><span class="do">## Trainable params: 52</span></span>
<span id="cb899-84"><a href="ch-11.html#cb899-84" aria-hidden="true" tabindex="-1"></a><span class="do">## Non-trainable params: 0</span></span>
<span id="cb899-85"><a href="ch-11.html#cb899-85" aria-hidden="true" tabindex="-1"></a><span class="do">## ________________________________________________________________________________</span></span>
<span id="cb899-86"><a href="ch-11.html#cb899-86" aria-hidden="true" tabindex="-1"></a><span class="do">## Evaluation error on the held out fold:  25.88199 </span></span>
<span id="cb899-87"><a href="ch-11.html#cb899-87" aria-hidden="true" tabindex="-1"></a><span class="do">## CV Fold --&gt; 2/5</span></span>
<span id="cb899-88"><a href="ch-11.html#cb899-88" aria-hidden="true" tabindex="-1"></a><span class="do">## Model: &quot;sequential_12&quot;</span></span>
<span id="cb899-89"><a href="ch-11.html#cb899-89" aria-hidden="true" tabindex="-1"></a><span class="do">## ________________________________________________________________________________</span></span>
<span id="cb899-90"><a href="ch-11.html#cb899-90" aria-hidden="true" tabindex="-1"></a><span class="do">## Layer (type)                        Output Shape                    Param #     </span></span>
<span id="cb899-91"><a href="ch-11.html#cb899-91" aria-hidden="true" tabindex="-1"></a><span class="do">## ================================================================================</span></span>
<span id="cb899-92"><a href="ch-11.html#cb899-92" aria-hidden="true" tabindex="-1"></a><span class="do">## dense_24 (Dense)                    (None, 3)                       48          </span></span>
<span id="cb899-93"><a href="ch-11.html#cb899-93" aria-hidden="true" tabindex="-1"></a><span class="do">## ________________________________________________________________________________</span></span>
<span id="cb899-94"><a href="ch-11.html#cb899-94" aria-hidden="true" tabindex="-1"></a><span class="do">## dense_25 (Dense)                    (None, 1)                       4           </span></span>
<span id="cb899-95"><a href="ch-11.html#cb899-95" aria-hidden="true" tabindex="-1"></a><span class="do">## ================================================================================</span></span>
<span id="cb899-96"><a href="ch-11.html#cb899-96" aria-hidden="true" tabindex="-1"></a><span class="do">## Total params: 52</span></span>
<span id="cb899-97"><a href="ch-11.html#cb899-97" aria-hidden="true" tabindex="-1"></a><span class="do">## Trainable params: 52</span></span>
<span id="cb899-98"><a href="ch-11.html#cb899-98" aria-hidden="true" tabindex="-1"></a><span class="do">## Non-trainable params: 0</span></span>
<span id="cb899-99"><a href="ch-11.html#cb899-99" aria-hidden="true" tabindex="-1"></a><span class="do">## ________________________________________________________________________________</span></span>
<span id="cb899-100"><a href="ch-11.html#cb899-100" aria-hidden="true" tabindex="-1"></a><span class="do">## Evaluation error on the held out fold:  25.98859 </span></span>
<span id="cb899-101"><a href="ch-11.html#cb899-101" aria-hidden="true" tabindex="-1"></a><span class="do">## CV Fold --&gt; 3/5</span></span>
<span id="cb899-102"><a href="ch-11.html#cb899-102" aria-hidden="true" tabindex="-1"></a><span class="do">## Model: &quot;sequential_13&quot;</span></span>
<span id="cb899-103"><a href="ch-11.html#cb899-103" aria-hidden="true" tabindex="-1"></a><span class="do">## ________________________________________________________________________________</span></span>
<span id="cb899-104"><a href="ch-11.html#cb899-104" aria-hidden="true" tabindex="-1"></a><span class="do">## Layer (type)                        Output Shape                    Param #     </span></span>
<span id="cb899-105"><a href="ch-11.html#cb899-105" aria-hidden="true" tabindex="-1"></a><span class="do">## ================================================================================</span></span>
<span id="cb899-106"><a href="ch-11.html#cb899-106" aria-hidden="true" tabindex="-1"></a><span class="do">## dense_26 (Dense)                    (None, 3)                       48          </span></span>
<span id="cb899-107"><a href="ch-11.html#cb899-107" aria-hidden="true" tabindex="-1"></a><span class="do">## ________________________________________________________________________________</span></span>
<span id="cb899-108"><a href="ch-11.html#cb899-108" aria-hidden="true" tabindex="-1"></a><span class="do">## dense_27 (Dense)                    (None, 1)                       4           </span></span>
<span id="cb899-109"><a href="ch-11.html#cb899-109" aria-hidden="true" tabindex="-1"></a><span class="do">## ================================================================================</span></span>
<span id="cb899-110"><a href="ch-11.html#cb899-110" aria-hidden="true" tabindex="-1"></a><span class="do">## Total params: 52</span></span>
<span id="cb899-111"><a href="ch-11.html#cb899-111" aria-hidden="true" tabindex="-1"></a><span class="do">## Trainable params: 52</span></span>
<span id="cb899-112"><a href="ch-11.html#cb899-112" aria-hidden="true" tabindex="-1"></a><span class="do">## Non-trainable params: 0</span></span>
<span id="cb899-113"><a href="ch-11.html#cb899-113" aria-hidden="true" tabindex="-1"></a><span class="do">## ________________________________________________________________________________</span></span>
<span id="cb899-114"><a href="ch-11.html#cb899-114" aria-hidden="true" tabindex="-1"></a><span class="do">## Evaluation error on the held out fold:  25.33782 </span></span>
<span id="cb899-115"><a href="ch-11.html#cb899-115" aria-hidden="true" tabindex="-1"></a><span class="do">## CV Fold --&gt; 4/5</span></span>
<span id="cb899-116"><a href="ch-11.html#cb899-116" aria-hidden="true" tabindex="-1"></a><span class="do">## Model: &quot;sequential_14&quot;</span></span>
<span id="cb899-117"><a href="ch-11.html#cb899-117" aria-hidden="true" tabindex="-1"></a><span class="do">## ________________________________________________________________________________</span></span>
<span id="cb899-118"><a href="ch-11.html#cb899-118" aria-hidden="true" tabindex="-1"></a><span class="do">## Layer (type)                        Output Shape                    Param #     </span></span>
<span id="cb899-119"><a href="ch-11.html#cb899-119" aria-hidden="true" tabindex="-1"></a><span class="do">## ================================================================================</span></span>
<span id="cb899-120"><a href="ch-11.html#cb899-120" aria-hidden="true" tabindex="-1"></a><span class="do">## dense_28 (Dense)                    (None, 3)                       48          </span></span>
<span id="cb899-121"><a href="ch-11.html#cb899-121" aria-hidden="true" tabindex="-1"></a><span class="do">## ________________________________________________________________________________</span></span>
<span id="cb899-122"><a href="ch-11.html#cb899-122" aria-hidden="true" tabindex="-1"></a><span class="do">## dense_29 (Dense)                    (None, 1)                       4           </span></span>
<span id="cb899-123"><a href="ch-11.html#cb899-123" aria-hidden="true" tabindex="-1"></a><span class="do">## ================================================================================</span></span>
<span id="cb899-124"><a href="ch-11.html#cb899-124" aria-hidden="true" tabindex="-1"></a><span class="do">## Total params: 52</span></span>
<span id="cb899-125"><a href="ch-11.html#cb899-125" aria-hidden="true" tabindex="-1"></a><span class="do">## Trainable params: 52</span></span>
<span id="cb899-126"><a href="ch-11.html#cb899-126" aria-hidden="true" tabindex="-1"></a><span class="do">## Non-trainable params: 0</span></span>
<span id="cb899-127"><a href="ch-11.html#cb899-127" aria-hidden="true" tabindex="-1"></a><span class="do">## ________________________________________________________________________________</span></span>
<span id="cb899-128"><a href="ch-11.html#cb899-128" aria-hidden="true" tabindex="-1"></a><span class="do">## Evaluation error on the held out fold:  25.62691 </span></span>
<span id="cb899-129"><a href="ch-11.html#cb899-129" aria-hidden="true" tabindex="-1"></a><span class="do">## CV Fold --&gt; 5/5</span></span>
<span id="cb899-130"><a href="ch-11.html#cb899-130" aria-hidden="true" tabindex="-1"></a><span class="do">## Model: &quot;sequential_15&quot;</span></span>
<span id="cb899-131"><a href="ch-11.html#cb899-131" aria-hidden="true" tabindex="-1"></a><span class="do">## ________________________________________________________________________________</span></span>
<span id="cb899-132"><a href="ch-11.html#cb899-132" aria-hidden="true" tabindex="-1"></a><span class="do">## Layer (type)                        Output Shape                    Param #     </span></span>
<span id="cb899-133"><a href="ch-11.html#cb899-133" aria-hidden="true" tabindex="-1"></a><span class="do">## ================================================================================</span></span>
<span id="cb899-134"><a href="ch-11.html#cb899-134" aria-hidden="true" tabindex="-1"></a><span class="do">## dense_30 (Dense)                    (None, 3)                       48          </span></span>
<span id="cb899-135"><a href="ch-11.html#cb899-135" aria-hidden="true" tabindex="-1"></a><span class="do">## ________________________________________________________________________________</span></span>
<span id="cb899-136"><a href="ch-11.html#cb899-136" aria-hidden="true" tabindex="-1"></a><span class="do">## dense_31 (Dense)                    (None, 1)                       4           </span></span>
<span id="cb899-137"><a href="ch-11.html#cb899-137" aria-hidden="true" tabindex="-1"></a><span class="do">## ================================================================================</span></span>
<span id="cb899-138"><a href="ch-11.html#cb899-138" aria-hidden="true" tabindex="-1"></a><span class="do">## Total params: 52</span></span>
<span id="cb899-139"><a href="ch-11.html#cb899-139" aria-hidden="true" tabindex="-1"></a><span class="do">## Trainable params: 52</span></span>
<span id="cb899-140"><a href="ch-11.html#cb899-140" aria-hidden="true" tabindex="-1"></a><span class="do">## Non-trainable params: 0</span></span>
<span id="cb899-141"><a href="ch-11.html#cb899-141" aria-hidden="true" tabindex="-1"></a><span class="do">## ________________________________________________________________________________</span></span>
<span id="cb899-142"><a href="ch-11.html#cb899-142" aria-hidden="true" tabindex="-1"></a><span class="do">## Evaluation error on the held out fold:  25.62623 </span></span>
<span id="cb899-143"><a href="ch-11.html#cb899-143" aria-hidden="true" tabindex="-1"></a><span class="do">## CV Fold --&gt; 1/5</span></span>
<span id="cb899-144"><a href="ch-11.html#cb899-144" aria-hidden="true" tabindex="-1"></a><span class="do">## Model: &quot;sequential_16&quot;</span></span>
<span id="cb899-145"><a href="ch-11.html#cb899-145" aria-hidden="true" tabindex="-1"></a><span class="do">## ________________________________________________________________________________</span></span>
<span id="cb899-146"><a href="ch-11.html#cb899-146" aria-hidden="true" tabindex="-1"></a><span class="do">## Layer (type)                        Output Shape                    Param #     </span></span>
<span id="cb899-147"><a href="ch-11.html#cb899-147" aria-hidden="true" tabindex="-1"></a><span class="do">## ================================================================================</span></span>
<span id="cb899-148"><a href="ch-11.html#cb899-148" aria-hidden="true" tabindex="-1"></a><span class="do">## dense_32 (Dense)                    (None, 10)                      160         </span></span>
<span id="cb899-149"><a href="ch-11.html#cb899-149" aria-hidden="true" tabindex="-1"></a><span class="do">## ________________________________________________________________________________</span></span>
<span id="cb899-150"><a href="ch-11.html#cb899-150" aria-hidden="true" tabindex="-1"></a><span class="do">## dense_33 (Dense)                    (None, 1)                       11          </span></span>
<span id="cb899-151"><a href="ch-11.html#cb899-151" aria-hidden="true" tabindex="-1"></a><span class="do">## ================================================================================</span></span>
<span id="cb899-152"><a href="ch-11.html#cb899-152" aria-hidden="true" tabindex="-1"></a><span class="do">## Total params: 171</span></span>
<span id="cb899-153"><a href="ch-11.html#cb899-153" aria-hidden="true" tabindex="-1"></a><span class="do">## Trainable params: 171</span></span>
<span id="cb899-154"><a href="ch-11.html#cb899-154" aria-hidden="true" tabindex="-1"></a><span class="do">## Non-trainable params: 0</span></span>
<span id="cb899-155"><a href="ch-11.html#cb899-155" aria-hidden="true" tabindex="-1"></a><span class="do">## ________________________________________________________________________________</span></span>
<span id="cb899-156"><a href="ch-11.html#cb899-156" aria-hidden="true" tabindex="-1"></a><span class="do">## Evaluation error on the held out fold:  24.59519 </span></span>
<span id="cb899-157"><a href="ch-11.html#cb899-157" aria-hidden="true" tabindex="-1"></a><span class="do">## CV Fold --&gt; 2/5</span></span>
<span id="cb899-158"><a href="ch-11.html#cb899-158" aria-hidden="true" tabindex="-1"></a><span class="do">## Model: &quot;sequential_17&quot;</span></span>
<span id="cb899-159"><a href="ch-11.html#cb899-159" aria-hidden="true" tabindex="-1"></a><span class="do">## ________________________________________________________________________________</span></span>
<span id="cb899-160"><a href="ch-11.html#cb899-160" aria-hidden="true" tabindex="-1"></a><span class="do">## Layer (type)                        Output Shape                    Param #     </span></span>
<span id="cb899-161"><a href="ch-11.html#cb899-161" aria-hidden="true" tabindex="-1"></a><span class="do">## ================================================================================</span></span>
<span id="cb899-162"><a href="ch-11.html#cb899-162" aria-hidden="true" tabindex="-1"></a><span class="do">## dense_34 (Dense)                    (None, 10)                      160         </span></span>
<span id="cb899-163"><a href="ch-11.html#cb899-163" aria-hidden="true" tabindex="-1"></a><span class="do">## ________________________________________________________________________________</span></span>
<span id="cb899-164"><a href="ch-11.html#cb899-164" aria-hidden="true" tabindex="-1"></a><span class="do">## dense_35 (Dense)                    (None, 1)                       11          </span></span>
<span id="cb899-165"><a href="ch-11.html#cb899-165" aria-hidden="true" tabindex="-1"></a><span class="do">## ================================================================================</span></span>
<span id="cb899-166"><a href="ch-11.html#cb899-166" aria-hidden="true" tabindex="-1"></a><span class="do">## Total params: 171</span></span>
<span id="cb899-167"><a href="ch-11.html#cb899-167" aria-hidden="true" tabindex="-1"></a><span class="do">## Trainable params: 171</span></span>
<span id="cb899-168"><a href="ch-11.html#cb899-168" aria-hidden="true" tabindex="-1"></a><span class="do">## Non-trainable params: 0</span></span>
<span id="cb899-169"><a href="ch-11.html#cb899-169" aria-hidden="true" tabindex="-1"></a><span class="do">## ________________________________________________________________________________</span></span>
<span id="cb899-170"><a href="ch-11.html#cb899-170" aria-hidden="true" tabindex="-1"></a><span class="do">## Evaluation error on the held out fold:  25.03098 </span></span>
<span id="cb899-171"><a href="ch-11.html#cb899-171" aria-hidden="true" tabindex="-1"></a><span class="do">## CV Fold --&gt; 3/5</span></span>
<span id="cb899-172"><a href="ch-11.html#cb899-172" aria-hidden="true" tabindex="-1"></a><span class="do">## Model: &quot;sequential_18&quot;</span></span>
<span id="cb899-173"><a href="ch-11.html#cb899-173" aria-hidden="true" tabindex="-1"></a><span class="do">## ________________________________________________________________________________</span></span>
<span id="cb899-174"><a href="ch-11.html#cb899-174" aria-hidden="true" tabindex="-1"></a><span class="do">## Layer (type)                        Output Shape                    Param #     </span></span>
<span id="cb899-175"><a href="ch-11.html#cb899-175" aria-hidden="true" tabindex="-1"></a><span class="do">## ================================================================================</span></span>
<span id="cb899-176"><a href="ch-11.html#cb899-176" aria-hidden="true" tabindex="-1"></a><span class="do">## dense_36 (Dense)                    (None, 10)                      160         </span></span>
<span id="cb899-177"><a href="ch-11.html#cb899-177" aria-hidden="true" tabindex="-1"></a><span class="do">## ________________________________________________________________________________</span></span>
<span id="cb899-178"><a href="ch-11.html#cb899-178" aria-hidden="true" tabindex="-1"></a><span class="do">## dense_37 (Dense)                    (None, 1)                       11          </span></span>
<span id="cb899-179"><a href="ch-11.html#cb899-179" aria-hidden="true" tabindex="-1"></a><span class="do">## ================================================================================</span></span>
<span id="cb899-180"><a href="ch-11.html#cb899-180" aria-hidden="true" tabindex="-1"></a><span class="do">## Total params: 171</span></span>
<span id="cb899-181"><a href="ch-11.html#cb899-181" aria-hidden="true" tabindex="-1"></a><span class="do">## Trainable params: 171</span></span>
<span id="cb899-182"><a href="ch-11.html#cb899-182" aria-hidden="true" tabindex="-1"></a><span class="do">## Non-trainable params: 0</span></span>
<span id="cb899-183"><a href="ch-11.html#cb899-183" aria-hidden="true" tabindex="-1"></a><span class="do">## ________________________________________________________________________________</span></span>
<span id="cb899-184"><a href="ch-11.html#cb899-184" aria-hidden="true" tabindex="-1"></a><span class="do">## Evaluation error on the held out fold:  24.29626 </span></span>
<span id="cb899-185"><a href="ch-11.html#cb899-185" aria-hidden="true" tabindex="-1"></a><span class="do">## CV Fold --&gt; 4/5</span></span>
<span id="cb899-186"><a href="ch-11.html#cb899-186" aria-hidden="true" tabindex="-1"></a><span class="do">## Model: &quot;sequential_19&quot;</span></span>
<span id="cb899-187"><a href="ch-11.html#cb899-187" aria-hidden="true" tabindex="-1"></a><span class="do">## ________________________________________________________________________________</span></span>
<span id="cb899-188"><a href="ch-11.html#cb899-188" aria-hidden="true" tabindex="-1"></a><span class="do">## Layer (type)                        Output Shape                    Param #     </span></span>
<span id="cb899-189"><a href="ch-11.html#cb899-189" aria-hidden="true" tabindex="-1"></a><span class="do">## ================================================================================</span></span>
<span id="cb899-190"><a href="ch-11.html#cb899-190" aria-hidden="true" tabindex="-1"></a><span class="do">## dense_38 (Dense)                    (None, 10)                      160         </span></span>
<span id="cb899-191"><a href="ch-11.html#cb899-191" aria-hidden="true" tabindex="-1"></a><span class="do">## ________________________________________________________________________________</span></span>
<span id="cb899-192"><a href="ch-11.html#cb899-192" aria-hidden="true" tabindex="-1"></a><span class="do">## dense_39 (Dense)                    (None, 1)                       11          </span></span>
<span id="cb899-193"><a href="ch-11.html#cb899-193" aria-hidden="true" tabindex="-1"></a><span class="do">## ================================================================================</span></span>
<span id="cb899-194"><a href="ch-11.html#cb899-194" aria-hidden="true" tabindex="-1"></a><span class="do">## Total params: 171</span></span>
<span id="cb899-195"><a href="ch-11.html#cb899-195" aria-hidden="true" tabindex="-1"></a><span class="do">## Trainable params: 171</span></span>
<span id="cb899-196"><a href="ch-11.html#cb899-196" aria-hidden="true" tabindex="-1"></a><span class="do">## Non-trainable params: 0</span></span>
<span id="cb899-197"><a href="ch-11.html#cb899-197" aria-hidden="true" tabindex="-1"></a><span class="do">## ________________________________________________________________________________</span></span>
<span id="cb899-198"><a href="ch-11.html#cb899-198" aria-hidden="true" tabindex="-1"></a><span class="do">## Evaluation error on the held out fold:  25.55116 </span></span>
<span id="cb899-199"><a href="ch-11.html#cb899-199" aria-hidden="true" tabindex="-1"></a><span class="do">## CV Fold --&gt; 5/5</span></span>
<span id="cb899-200"><a href="ch-11.html#cb899-200" aria-hidden="true" tabindex="-1"></a><span class="do">## Model: &quot;sequential_20&quot;</span></span>
<span id="cb899-201"><a href="ch-11.html#cb899-201" aria-hidden="true" tabindex="-1"></a><span class="do">## ________________________________________________________________________________</span></span>
<span id="cb899-202"><a href="ch-11.html#cb899-202" aria-hidden="true" tabindex="-1"></a><span class="do">## Layer (type)                        Output Shape                    Param #     </span></span>
<span id="cb899-203"><a href="ch-11.html#cb899-203" aria-hidden="true" tabindex="-1"></a><span class="do">## ================================================================================</span></span>
<span id="cb899-204"><a href="ch-11.html#cb899-204" aria-hidden="true" tabindex="-1"></a><span class="do">## dense_40 (Dense)                    (None, 10)                      160         </span></span>
<span id="cb899-205"><a href="ch-11.html#cb899-205" aria-hidden="true" tabindex="-1"></a><span class="do">## ________________________________________________________________________________</span></span>
<span id="cb899-206"><a href="ch-11.html#cb899-206" aria-hidden="true" tabindex="-1"></a><span class="do">## dense_41 (Dense)                    (None, 1)                       11          </span></span>
<span id="cb899-207"><a href="ch-11.html#cb899-207" aria-hidden="true" tabindex="-1"></a><span class="do">## ================================================================================</span></span>
<span id="cb899-208"><a href="ch-11.html#cb899-208" aria-hidden="true" tabindex="-1"></a><span class="do">## Total params: 171</span></span>
<span id="cb899-209"><a href="ch-11.html#cb899-209" aria-hidden="true" tabindex="-1"></a><span class="do">## Trainable params: 171</span></span>
<span id="cb899-210"><a href="ch-11.html#cb899-210" aria-hidden="true" tabindex="-1"></a><span class="do">## Non-trainable params: 0</span></span>
<span id="cb899-211"><a href="ch-11.html#cb899-211" aria-hidden="true" tabindex="-1"></a><span class="do">## ________________________________________________________________________________</span></span>
<span id="cb899-212"><a href="ch-11.html#cb899-212" aria-hidden="true" tabindex="-1"></a><span class="do">## Evaluation error on the held out fold:  24.43872 </span></span>
<span id="cb899-213"><a href="ch-11.html#cb899-213" aria-hidden="true" tabindex="-1"></a><span class="do">## CV Fold --&gt; 1/5</span></span>
<span id="cb899-214"><a href="ch-11.html#cb899-214" aria-hidden="true" tabindex="-1"></a><span class="do">## Model: &quot;sequential_21&quot;</span></span>
<span id="cb899-215"><a href="ch-11.html#cb899-215" aria-hidden="true" tabindex="-1"></a><span class="do">## ________________________________________________________________________________</span></span>
<span id="cb899-216"><a href="ch-11.html#cb899-216" aria-hidden="true" tabindex="-1"></a><span class="do">## Layer (type)                        Output Shape                    Param #     </span></span>
<span id="cb899-217"><a href="ch-11.html#cb899-217" aria-hidden="true" tabindex="-1"></a><span class="do">## ================================================================================</span></span>
<span id="cb899-218"><a href="ch-11.html#cb899-218" aria-hidden="true" tabindex="-1"></a><span class="do">## dense_42 (Dense)                    (None, 30)                      480         </span></span>
<span id="cb899-219"><a href="ch-11.html#cb899-219" aria-hidden="true" tabindex="-1"></a><span class="do">## ________________________________________________________________________________</span></span>
<span id="cb899-220"><a href="ch-11.html#cb899-220" aria-hidden="true" tabindex="-1"></a><span class="do">## dense_43 (Dense)                    (None, 1)                       31          </span></span>
<span id="cb899-221"><a href="ch-11.html#cb899-221" aria-hidden="true" tabindex="-1"></a><span class="do">## ================================================================================</span></span>
<span id="cb899-222"><a href="ch-11.html#cb899-222" aria-hidden="true" tabindex="-1"></a><span class="do">## Total params: 511</span></span>
<span id="cb899-223"><a href="ch-11.html#cb899-223" aria-hidden="true" tabindex="-1"></a><span class="do">## Trainable params: 511</span></span>
<span id="cb899-224"><a href="ch-11.html#cb899-224" aria-hidden="true" tabindex="-1"></a><span class="do">## Non-trainable params: 0</span></span>
<span id="cb899-225"><a href="ch-11.html#cb899-225" aria-hidden="true" tabindex="-1"></a><span class="do">## ________________________________________________________________________________</span></span>
<span id="cb899-226"><a href="ch-11.html#cb899-226" aria-hidden="true" tabindex="-1"></a><span class="do">## Evaluation error on the held out fold:  23.64743 </span></span>
<span id="cb899-227"><a href="ch-11.html#cb899-227" aria-hidden="true" tabindex="-1"></a><span class="do">## CV Fold --&gt; 2/5</span></span>
<span id="cb899-228"><a href="ch-11.html#cb899-228" aria-hidden="true" tabindex="-1"></a><span class="do">## Model: &quot;sequential_22&quot;</span></span>
<span id="cb899-229"><a href="ch-11.html#cb899-229" aria-hidden="true" tabindex="-1"></a><span class="do">## ________________________________________________________________________________</span></span>
<span id="cb899-230"><a href="ch-11.html#cb899-230" aria-hidden="true" tabindex="-1"></a><span class="do">## Layer (type)                        Output Shape                    Param #     </span></span>
<span id="cb899-231"><a href="ch-11.html#cb899-231" aria-hidden="true" tabindex="-1"></a><span class="do">## ================================================================================</span></span>
<span id="cb899-232"><a href="ch-11.html#cb899-232" aria-hidden="true" tabindex="-1"></a><span class="do">## dense_44 (Dense)                    (None, 30)                      480         </span></span>
<span id="cb899-233"><a href="ch-11.html#cb899-233" aria-hidden="true" tabindex="-1"></a><span class="do">## ________________________________________________________________________________</span></span>
<span id="cb899-234"><a href="ch-11.html#cb899-234" aria-hidden="true" tabindex="-1"></a><span class="do">## dense_45 (Dense)                    (None, 1)                       31          </span></span>
<span id="cb899-235"><a href="ch-11.html#cb899-235" aria-hidden="true" tabindex="-1"></a><span class="do">## ================================================================================</span></span>
<span id="cb899-236"><a href="ch-11.html#cb899-236" aria-hidden="true" tabindex="-1"></a><span class="do">## Total params: 511</span></span>
<span id="cb899-237"><a href="ch-11.html#cb899-237" aria-hidden="true" tabindex="-1"></a><span class="do">## Trainable params: 511</span></span>
<span id="cb899-238"><a href="ch-11.html#cb899-238" aria-hidden="true" tabindex="-1"></a><span class="do">## Non-trainable params: 0</span></span>
<span id="cb899-239"><a href="ch-11.html#cb899-239" aria-hidden="true" tabindex="-1"></a><span class="do">## ________________________________________________________________________________</span></span>
<span id="cb899-240"><a href="ch-11.html#cb899-240" aria-hidden="true" tabindex="-1"></a><span class="do">## Evaluation error on the held out fold:  24.02392 </span></span>
<span id="cb899-241"><a href="ch-11.html#cb899-241" aria-hidden="true" tabindex="-1"></a><span class="do">## CV Fold --&gt; 3/5</span></span>
<span id="cb899-242"><a href="ch-11.html#cb899-242" aria-hidden="true" tabindex="-1"></a><span class="do">## Model: &quot;sequential_23&quot;</span></span>
<span id="cb899-243"><a href="ch-11.html#cb899-243" aria-hidden="true" tabindex="-1"></a><span class="do">## ________________________________________________________________________________</span></span>
<span id="cb899-244"><a href="ch-11.html#cb899-244" aria-hidden="true" tabindex="-1"></a><span class="do">## Layer (type)                        Output Shape                    Param #     </span></span>
<span id="cb899-245"><a href="ch-11.html#cb899-245" aria-hidden="true" tabindex="-1"></a><span class="do">## ================================================================================</span></span>
<span id="cb899-246"><a href="ch-11.html#cb899-246" aria-hidden="true" tabindex="-1"></a><span class="do">## dense_46 (Dense)                    (None, 30)                      480         </span></span>
<span id="cb899-247"><a href="ch-11.html#cb899-247" aria-hidden="true" tabindex="-1"></a><span class="do">## ________________________________________________________________________________</span></span>
<span id="cb899-248"><a href="ch-11.html#cb899-248" aria-hidden="true" tabindex="-1"></a><span class="do">## dense_47 (Dense)                    (None, 1)                       31          </span></span>
<span id="cb899-249"><a href="ch-11.html#cb899-249" aria-hidden="true" tabindex="-1"></a><span class="do">## ================================================================================</span></span>
<span id="cb899-250"><a href="ch-11.html#cb899-250" aria-hidden="true" tabindex="-1"></a><span class="do">## Total params: 511</span></span>
<span id="cb899-251"><a href="ch-11.html#cb899-251" aria-hidden="true" tabindex="-1"></a><span class="do">## Trainable params: 511</span></span>
<span id="cb899-252"><a href="ch-11.html#cb899-252" aria-hidden="true" tabindex="-1"></a><span class="do">## Non-trainable params: 0</span></span>
<span id="cb899-253"><a href="ch-11.html#cb899-253" aria-hidden="true" tabindex="-1"></a><span class="do">## ________________________________________________________________________________</span></span>
<span id="cb899-254"><a href="ch-11.html#cb899-254" aria-hidden="true" tabindex="-1"></a><span class="do">## Evaluation error on the held out fold:  25.02493 </span></span>
<span id="cb899-255"><a href="ch-11.html#cb899-255" aria-hidden="true" tabindex="-1"></a><span class="do">## CV Fold --&gt; 4/5</span></span>
<span id="cb899-256"><a href="ch-11.html#cb899-256" aria-hidden="true" tabindex="-1"></a><span class="do">## Model: &quot;sequential_24&quot;</span></span>
<span id="cb899-257"><a href="ch-11.html#cb899-257" aria-hidden="true" tabindex="-1"></a><span class="do">## ________________________________________________________________________________</span></span>
<span id="cb899-258"><a href="ch-11.html#cb899-258" aria-hidden="true" tabindex="-1"></a><span class="do">## Layer (type)                        Output Shape                    Param #     </span></span>
<span id="cb899-259"><a href="ch-11.html#cb899-259" aria-hidden="true" tabindex="-1"></a><span class="do">## ================================================================================</span></span>
<span id="cb899-260"><a href="ch-11.html#cb899-260" aria-hidden="true" tabindex="-1"></a><span class="do">## dense_48 (Dense)                    (None, 30)                      480         </span></span>
<span id="cb899-261"><a href="ch-11.html#cb899-261" aria-hidden="true" tabindex="-1"></a><span class="do">## ________________________________________________________________________________</span></span>
<span id="cb899-262"><a href="ch-11.html#cb899-262" aria-hidden="true" tabindex="-1"></a><span class="do">## dense_49 (Dense)                    (None, 1)                       31          </span></span>
<span id="cb899-263"><a href="ch-11.html#cb899-263" aria-hidden="true" tabindex="-1"></a><span class="do">## ================================================================================</span></span>
<span id="cb899-264"><a href="ch-11.html#cb899-264" aria-hidden="true" tabindex="-1"></a><span class="do">## Total params: 511</span></span>
<span id="cb899-265"><a href="ch-11.html#cb899-265" aria-hidden="true" tabindex="-1"></a><span class="do">## Trainable params: 511</span></span>
<span id="cb899-266"><a href="ch-11.html#cb899-266" aria-hidden="true" tabindex="-1"></a><span class="do">## Non-trainable params: 0</span></span>
<span id="cb899-267"><a href="ch-11.html#cb899-267" aria-hidden="true" tabindex="-1"></a><span class="do">## ________________________________________________________________________________</span></span>
<span id="cb899-268"><a href="ch-11.html#cb899-268" aria-hidden="true" tabindex="-1"></a><span class="do">## Evaluation error on the held out fold:  24.03987 </span></span>
<span id="cb899-269"><a href="ch-11.html#cb899-269" aria-hidden="true" tabindex="-1"></a><span class="do">## CV Fold --&gt; 5/5</span></span>
<span id="cb899-270"><a href="ch-11.html#cb899-270" aria-hidden="true" tabindex="-1"></a><span class="do">## Model: &quot;sequential_25&quot;</span></span>
<span id="cb899-271"><a href="ch-11.html#cb899-271" aria-hidden="true" tabindex="-1"></a><span class="do">## ________________________________________________________________________________</span></span>
<span id="cb899-272"><a href="ch-11.html#cb899-272" aria-hidden="true" tabindex="-1"></a><span class="do">## Layer (type)                        Output Shape                    Param #     </span></span>
<span id="cb899-273"><a href="ch-11.html#cb899-273" aria-hidden="true" tabindex="-1"></a><span class="do">## ================================================================================</span></span>
<span id="cb899-274"><a href="ch-11.html#cb899-274" aria-hidden="true" tabindex="-1"></a><span class="do">## dense_50 (Dense)                    (None, 30)                      480         </span></span>
<span id="cb899-275"><a href="ch-11.html#cb899-275" aria-hidden="true" tabindex="-1"></a><span class="do">## ________________________________________________________________________________</span></span>
<span id="cb899-276"><a href="ch-11.html#cb899-276" aria-hidden="true" tabindex="-1"></a><span class="do">## dense_51 (Dense)                    (None, 1)                       31          </span></span>
<span id="cb899-277"><a href="ch-11.html#cb899-277" aria-hidden="true" tabindex="-1"></a><span class="do">## ================================================================================</span></span>
<span id="cb899-278"><a href="ch-11.html#cb899-278" aria-hidden="true" tabindex="-1"></a><span class="do">## Total params: 511</span></span>
<span id="cb899-279"><a href="ch-11.html#cb899-279" aria-hidden="true" tabindex="-1"></a><span class="do">## Trainable params: 511</span></span>
<span id="cb899-280"><a href="ch-11.html#cb899-280" aria-hidden="true" tabindex="-1"></a><span class="do">## Non-trainable params: 0</span></span>
<span id="cb899-281"><a href="ch-11.html#cb899-281" aria-hidden="true" tabindex="-1"></a><span class="do">## ________________________________________________________________________________</span></span>
<span id="cb899-282"><a href="ch-11.html#cb899-282" aria-hidden="true" tabindex="-1"></a><span class="do">## Evaluation error on the held out fold:  24.74669 </span></span>
<span id="cb899-283"><a href="ch-11.html#cb899-283" aria-hidden="true" tabindex="-1"></a><span class="do">## CV Fold --&gt; 1/5</span></span>
<span id="cb899-284"><a href="ch-11.html#cb899-284" aria-hidden="true" tabindex="-1"></a><span class="do">## Model: &quot;sequential_26&quot;</span></span>
<span id="cb899-285"><a href="ch-11.html#cb899-285" aria-hidden="true" tabindex="-1"></a><span class="do">## ________________________________________________________________________________</span></span>
<span id="cb899-286"><a href="ch-11.html#cb899-286" aria-hidden="true" tabindex="-1"></a><span class="do">## Layer (type)                        Output Shape                    Param #     </span></span>
<span id="cb899-287"><a href="ch-11.html#cb899-287" aria-hidden="true" tabindex="-1"></a><span class="do">## ================================================================================</span></span>
<span id="cb899-288"><a href="ch-11.html#cb899-288" aria-hidden="true" tabindex="-1"></a><span class="do">## dense_52 (Dense)                    (None, 100)                     1600        </span></span>
<span id="cb899-289"><a href="ch-11.html#cb899-289" aria-hidden="true" tabindex="-1"></a><span class="do">## ________________________________________________________________________________</span></span>
<span id="cb899-290"><a href="ch-11.html#cb899-290" aria-hidden="true" tabindex="-1"></a><span class="do">## dense_53 (Dense)                    (None, 1)                       101         </span></span>
<span id="cb899-291"><a href="ch-11.html#cb899-291" aria-hidden="true" tabindex="-1"></a><span class="do">## ================================================================================</span></span>
<span id="cb899-292"><a href="ch-11.html#cb899-292" aria-hidden="true" tabindex="-1"></a><span class="do">## Total params: 1,701</span></span>
<span id="cb899-293"><a href="ch-11.html#cb899-293" aria-hidden="true" tabindex="-1"></a><span class="do">## Trainable params: 1,701</span></span>
<span id="cb899-294"><a href="ch-11.html#cb899-294" aria-hidden="true" tabindex="-1"></a><span class="do">## Non-trainable params: 0</span></span>
<span id="cb899-295"><a href="ch-11.html#cb899-295" aria-hidden="true" tabindex="-1"></a><span class="do">## ________________________________________________________________________________</span></span>
<span id="cb899-296"><a href="ch-11.html#cb899-296" aria-hidden="true" tabindex="-1"></a><span class="do">## Evaluation error on the held out fold:  23.98048 </span></span>
<span id="cb899-297"><a href="ch-11.html#cb899-297" aria-hidden="true" tabindex="-1"></a><span class="do">## CV Fold --&gt; 2/5</span></span>
<span id="cb899-298"><a href="ch-11.html#cb899-298" aria-hidden="true" tabindex="-1"></a><span class="do">## Model: &quot;sequential_27&quot;</span></span>
<span id="cb899-299"><a href="ch-11.html#cb899-299" aria-hidden="true" tabindex="-1"></a><span class="do">## ________________________________________________________________________________</span></span>
<span id="cb899-300"><a href="ch-11.html#cb899-300" aria-hidden="true" tabindex="-1"></a><span class="do">## Layer (type)                        Output Shape                    Param #     </span></span>
<span id="cb899-301"><a href="ch-11.html#cb899-301" aria-hidden="true" tabindex="-1"></a><span class="do">## ================================================================================</span></span>
<span id="cb899-302"><a href="ch-11.html#cb899-302" aria-hidden="true" tabindex="-1"></a><span class="do">## dense_54 (Dense)                    (None, 100)                     1600        </span></span>
<span id="cb899-303"><a href="ch-11.html#cb899-303" aria-hidden="true" tabindex="-1"></a><span class="do">## ________________________________________________________________________________</span></span>
<span id="cb899-304"><a href="ch-11.html#cb899-304" aria-hidden="true" tabindex="-1"></a><span class="do">## dense_55 (Dense)                    (None, 1)                       101         </span></span>
<span id="cb899-305"><a href="ch-11.html#cb899-305" aria-hidden="true" tabindex="-1"></a><span class="do">## ================================================================================</span></span>
<span id="cb899-306"><a href="ch-11.html#cb899-306" aria-hidden="true" tabindex="-1"></a><span class="do">## Total params: 1,701</span></span>
<span id="cb899-307"><a href="ch-11.html#cb899-307" aria-hidden="true" tabindex="-1"></a><span class="do">## Trainable params: 1,701</span></span>
<span id="cb899-308"><a href="ch-11.html#cb899-308" aria-hidden="true" tabindex="-1"></a><span class="do">## Non-trainable params: 0</span></span>
<span id="cb899-309"><a href="ch-11.html#cb899-309" aria-hidden="true" tabindex="-1"></a><span class="do">## ________________________________________________________________________________</span></span>
<span id="cb899-310"><a href="ch-11.html#cb899-310" aria-hidden="true" tabindex="-1"></a><span class="do">## Evaluation error on the held out fold:  23.41279 </span></span>
<span id="cb899-311"><a href="ch-11.html#cb899-311" aria-hidden="true" tabindex="-1"></a><span class="do">## CV Fold --&gt; 3/5</span></span>
<span id="cb899-312"><a href="ch-11.html#cb899-312" aria-hidden="true" tabindex="-1"></a><span class="do">## Model: &quot;sequential_28&quot;</span></span>
<span id="cb899-313"><a href="ch-11.html#cb899-313" aria-hidden="true" tabindex="-1"></a><span class="do">## ________________________________________________________________________________</span></span>
<span id="cb899-314"><a href="ch-11.html#cb899-314" aria-hidden="true" tabindex="-1"></a><span class="do">## Layer (type)                        Output Shape                    Param #     </span></span>
<span id="cb899-315"><a href="ch-11.html#cb899-315" aria-hidden="true" tabindex="-1"></a><span class="do">## ================================================================================</span></span>
<span id="cb899-316"><a href="ch-11.html#cb899-316" aria-hidden="true" tabindex="-1"></a><span class="do">## dense_56 (Dense)                    (None, 100)                     1600        </span></span>
<span id="cb899-317"><a href="ch-11.html#cb899-317" aria-hidden="true" tabindex="-1"></a><span class="do">## ________________________________________________________________________________</span></span>
<span id="cb899-318"><a href="ch-11.html#cb899-318" aria-hidden="true" tabindex="-1"></a><span class="do">## dense_57 (Dense)                    (None, 1)                       101         </span></span>
<span id="cb899-319"><a href="ch-11.html#cb899-319" aria-hidden="true" tabindex="-1"></a><span class="do">## ================================================================================</span></span>
<span id="cb899-320"><a href="ch-11.html#cb899-320" aria-hidden="true" tabindex="-1"></a><span class="do">## Total params: 1,701</span></span>
<span id="cb899-321"><a href="ch-11.html#cb899-321" aria-hidden="true" tabindex="-1"></a><span class="do">## Trainable params: 1,701</span></span>
<span id="cb899-322"><a href="ch-11.html#cb899-322" aria-hidden="true" tabindex="-1"></a><span class="do">## Non-trainable params: 0</span></span>
<span id="cb899-323"><a href="ch-11.html#cb899-323" aria-hidden="true" tabindex="-1"></a><span class="do">## ________________________________________________________________________________</span></span>
<span id="cb899-324"><a href="ch-11.html#cb899-324" aria-hidden="true" tabindex="-1"></a><span class="do">## Evaluation error on the held out fold:  24.43465 </span></span>
<span id="cb899-325"><a href="ch-11.html#cb899-325" aria-hidden="true" tabindex="-1"></a><span class="do">## CV Fold --&gt; 4/5</span></span>
<span id="cb899-326"><a href="ch-11.html#cb899-326" aria-hidden="true" tabindex="-1"></a><span class="do">## Model: &quot;sequential_29&quot;</span></span>
<span id="cb899-327"><a href="ch-11.html#cb899-327" aria-hidden="true" tabindex="-1"></a><span class="do">## ________________________________________________________________________________</span></span>
<span id="cb899-328"><a href="ch-11.html#cb899-328" aria-hidden="true" tabindex="-1"></a><span class="do">## Layer (type)                        Output Shape                    Param #     </span></span>
<span id="cb899-329"><a href="ch-11.html#cb899-329" aria-hidden="true" tabindex="-1"></a><span class="do">## ================================================================================</span></span>
<span id="cb899-330"><a href="ch-11.html#cb899-330" aria-hidden="true" tabindex="-1"></a><span class="do">## dense_58 (Dense)                    (None, 100)                     1600        </span></span>
<span id="cb899-331"><a href="ch-11.html#cb899-331" aria-hidden="true" tabindex="-1"></a><span class="do">## ________________________________________________________________________________</span></span>
<span id="cb899-332"><a href="ch-11.html#cb899-332" aria-hidden="true" tabindex="-1"></a><span class="do">## dense_59 (Dense)                    (None, 1)                       101         </span></span>
<span id="cb899-333"><a href="ch-11.html#cb899-333" aria-hidden="true" tabindex="-1"></a><span class="do">## ================================================================================</span></span>
<span id="cb899-334"><a href="ch-11.html#cb899-334" aria-hidden="true" tabindex="-1"></a><span class="do">## Total params: 1,701</span></span>
<span id="cb899-335"><a href="ch-11.html#cb899-335" aria-hidden="true" tabindex="-1"></a><span class="do">## Trainable params: 1,701</span></span>
<span id="cb899-336"><a href="ch-11.html#cb899-336" aria-hidden="true" tabindex="-1"></a><span class="do">## Non-trainable params: 0</span></span>
<span id="cb899-337"><a href="ch-11.html#cb899-337" aria-hidden="true" tabindex="-1"></a><span class="do">## ________________________________________________________________________________</span></span>
<span id="cb899-338"><a href="ch-11.html#cb899-338" aria-hidden="true" tabindex="-1"></a><span class="do">## Evaluation error on the held out fold:  23.77185 </span></span>
<span id="cb899-339"><a href="ch-11.html#cb899-339" aria-hidden="true" tabindex="-1"></a><span class="do">## CV Fold --&gt; 5/5</span></span>
<span id="cb899-340"><a href="ch-11.html#cb899-340" aria-hidden="true" tabindex="-1"></a><span class="do">## Model: &quot;sequential_30&quot;</span></span>
<span id="cb899-341"><a href="ch-11.html#cb899-341" aria-hidden="true" tabindex="-1"></a><span class="do">## ________________________________________________________________________________</span></span>
<span id="cb899-342"><a href="ch-11.html#cb899-342" aria-hidden="true" tabindex="-1"></a><span class="do">## Layer (type)                        Output Shape                    Param #     </span></span>
<span id="cb899-343"><a href="ch-11.html#cb899-343" aria-hidden="true" tabindex="-1"></a><span class="do">## ================================================================================</span></span>
<span id="cb899-344"><a href="ch-11.html#cb899-344" aria-hidden="true" tabindex="-1"></a><span class="do">## dense_60 (Dense)                    (None, 100)                     1600        </span></span>
<span id="cb899-345"><a href="ch-11.html#cb899-345" aria-hidden="true" tabindex="-1"></a><span class="do">## ________________________________________________________________________________</span></span>
<span id="cb899-346"><a href="ch-11.html#cb899-346" aria-hidden="true" tabindex="-1"></a><span class="do">## dense_61 (Dense)                    (None, 1)                       101         </span></span>
<span id="cb899-347"><a href="ch-11.html#cb899-347" aria-hidden="true" tabindex="-1"></a><span class="do">## ================================================================================</span></span>
<span id="cb899-348"><a href="ch-11.html#cb899-348" aria-hidden="true" tabindex="-1"></a><span class="do">## Total params: 1,701</span></span>
<span id="cb899-349"><a href="ch-11.html#cb899-349" aria-hidden="true" tabindex="-1"></a><span class="do">## Trainable params: 1,701</span></span>
<span id="cb899-350"><a href="ch-11.html#cb899-350" aria-hidden="true" tabindex="-1"></a><span class="do">## Non-trainable params: 0</span></span>
<span id="cb899-351"><a href="ch-11.html#cb899-351" aria-hidden="true" tabindex="-1"></a><span class="do">## ________________________________________________________________________________</span></span>
<span id="cb899-352"><a href="ch-11.html#cb899-352" aria-hidden="true" tabindex="-1"></a><span class="do">## Evaluation error on the held out fold:  23.87822 </span></span>
<span id="cb899-353"><a href="ch-11.html#cb899-353" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 31.07678 25.69231 24.78246 24.29657 23.89560</span></span></code></pre></div>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="ch-10.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="ch-12.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
