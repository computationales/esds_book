<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 11 Application 2: Neural Networks and Hyperparameter Tuning | Environmental Systems Data Science</title>
  <meta name="description" content="Text book and exercises for the course Environmental System Data Science at ETH Zürich." />
  <meta name="generator" content="bookdown 0.21 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 11 Application 2: Neural Networks and Hyperparameter Tuning | Environmental Systems Data Science" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="Text book and exercises for the course Environmental System Data Science at ETH Zürich." />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 11 Application 2: Neural Networks and Hyperparameter Tuning | Environmental Systems Data Science" />
  
  <meta name="twitter:description" content="Text book and exercises for the course Environmental System Data Science at ETH Zürich." />
  

<meta name="author" content="Loïc Pellissier, Joshua Payne, Benjamin Stocker" />


<meta name="date" content="2021-03-25" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="ch-10.html"/>
<link rel="next" href="ch-12.html"/>
<script src="libs/header-attrs-2.6/header-attrs.js"></script>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />











<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Prerequisites</a>
<ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#course-description"><i class="fa fa-check"></i>Course Description</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#course-objectives"><i class="fa fa-check"></i>Course Objectives</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#content"><i class="fa fa-check"></i>Content</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#useful-prerequisites"><i class="fa fa-check"></i>Useful Prerequisites</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="ch-01.html"><a href="ch-01.html"><i class="fa fa-check"></i><b>1</b> Primers</a>
<ul>
<li class="chapter" data-level="1.1" data-path="ch-01.html"><a href="ch-01.html#introduction"><i class="fa fa-check"></i><b>1.1</b> Introduction</a>
<ul>
<li class="chapter" data-level="1.1.1" data-path="ch-01.html"><a href="ch-01.html#important-points-from-the-lecture"><i class="fa fa-check"></i><b>1.1.1</b> Important points from the lecture</a></li>
</ul></li>
<li class="chapter" data-level="1.2" data-path="ch-01.html"><a href="ch-01.html#tutorial"><i class="fa fa-check"></i><b>1.2</b> Tutorial</a>
<ul>
<li class="chapter" data-level="1.2.1" data-path="ch-01.html"><a href="ch-01.html#working-with-jupyter-notebook"><i class="fa fa-check"></i><b>1.2.1</b> Working with Jupyter notebook</a></li>
<li class="chapter" data-level="1.2.2" data-path="ch-01.html"><a href="ch-01.html#using-git-for-version-control"><i class="fa fa-check"></i><b>1.2.2</b> Using Git for version control</a></li>
<li class="chapter" data-level="1.2.3" data-path="ch-01.html"><a href="ch-01.html#basics-of-r-code"><i class="fa fa-check"></i><b>1.2.3</b> Basics of R code</a></li>
<li class="chapter" data-level="1.2.4" data-path="ch-01.html"><a href="ch-01.html#reading-data-into-r"><i class="fa fa-check"></i><b>1.2.4</b> Reading data into R</a></li>
<li class="chapter" data-level="1.2.5" data-path="ch-01.html"><a href="ch-01.html#r-objects"><i class="fa fa-check"></i><b>1.2.5</b> R Objects</a></li>
<li class="chapter" data-level="1.2.6" data-path="ch-01.html"><a href="ch-01.html#data-visualisation"><i class="fa fa-check"></i><b>1.2.6</b> Data visualisation</a></li>
<li class="chapter" data-level="1.2.7" data-path="ch-01.html"><a href="ch-01.html#example-code-loops"><i class="fa fa-check"></i><b>1.2.7</b> Example code: Loops</a></li>
<li class="chapter" data-level="1.2.8" data-path="ch-01.html"><a href="ch-01.html#where-to-find-help"><i class="fa fa-check"></i><b>1.2.8</b> Where to find Help</a></li>
<li class="chapter" data-level="1.2.9" data-path="ch-01.html"><a href="ch-01.html#further-reading"><i class="fa fa-check"></i><b>1.2.9</b> Further reading</a></li>
</ul></li>
<li class="chapter" data-level="1.3" data-path="ch-01.html"><a href="ch-01.html#exercise"><i class="fa fa-check"></i><b>1.3</b> Exercise</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="ch-02.html"><a href="ch-02.html"><i class="fa fa-check"></i><b>2</b> Data wrangling</a>
<ul>
<li class="chapter" data-level="2.1" data-path="ch-02.html"><a href="ch-02.html#introduction-1"><i class="fa fa-check"></i><b>2.1</b> Introduction</a>
<ul>
<li class="chapter" data-level="2.1.1" data-path="ch-02.html"><a href="ch-02.html#data-transformation-with-dplyr"><i class="fa fa-check"></i><b>2.1.1</b> Data transformation with dplyr</a></li>
<li class="chapter" data-level="2.1.2" data-path="ch-02.html"><a href="ch-02.html#data-visualisation-with-ggplot2"><i class="fa fa-check"></i><b>2.1.2</b> Data visualisation with ggplot2</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="ch-02.html"><a href="ch-02.html#tutorial-1"><i class="fa fa-check"></i><b>2.2</b> Tutorial</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="ch-02.html"><a href="ch-02.html#dataset-1-half-hourly-flux-data"><i class="fa fa-check"></i><b>2.2.1</b> Dataset 1 (half-hourly flux data)</a></li>
<li class="chapter" data-level="2.2.2" data-path="ch-02.html"><a href="ch-02.html#dataset-2-daily-flux-data"><i class="fa fa-check"></i><b>2.2.2</b> Dataset 2 (daily flux data)</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="ch-02.html"><a href="ch-02.html#exercise-1"><i class="fa fa-check"></i><b>2.3</b> Exercise</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="ch-03.html"><a href="ch-03.html"><i class="fa fa-check"></i><b>3</b> Data variety</a>
<ul>
<li class="chapter" data-level="3.1" data-path="ch-03.html"><a href="ch-03.html#introduction-2"><i class="fa fa-check"></i><b>3.1</b> Introduction</a>
<ul>
<li class="chapter" data-level="3.1.1" data-path="ch-03.html"><a href="ch-03.html#overview"><i class="fa fa-check"></i><b>3.1.1</b> Overview</a></li>
<li class="chapter" data-level="3.1.2" data-path="ch-03.html"><a href="ch-03.html#learning-objectives"><i class="fa fa-check"></i><b>3.1.2</b> Learning objectives</a></li>
<li class="chapter" data-level="3.1.3" data-path="ch-03.html"><a href="ch-03.html#key-points-of-the-lecture"><i class="fa fa-check"></i><b>3.1.3</b> Key points of the lecture</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="ch-03.html"><a href="ch-03.html#tutorial-2"><i class="fa fa-check"></i><b>3.2</b> Tutorial</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="ch-03.html"><a href="ch-03.html#overview-1"><i class="fa fa-check"></i><b>3.2.1</b> Overview</a></li>
<li class="chapter" data-level="3.2.2" data-path="ch-03.html"><a href="ch-03.html#modis-remote-download"><i class="fa fa-check"></i><b>3.2.2</b> MODIS remote download</a></li>
<li class="chapter" data-level="3.2.3" data-path="ch-03.html"><a href="ch-03.html#points-on-the-globe"><i class="fa fa-check"></i><b>3.2.3</b> Points on the globe</a></li>
<li class="chapter" data-level="3.2.4" data-path="ch-03.html"><a href="ch-03.html#shapefiles"><i class="fa fa-check"></i><b>3.2.4</b> Shapefiles</a></li>
<li class="chapter" data-level="3.2.5" data-path="ch-03.html"><a href="ch-03.html#rasters"><i class="fa fa-check"></i><b>3.2.5</b> Rasters</a></li>
<li class="chapter" data-level="3.2.6" data-path="ch-03.html"><a href="ch-03.html#key-points-of-the-tutorial"><i class="fa fa-check"></i><b>3.2.6</b> Key points of the tutorial</a></li>
<li class="chapter" data-level="3.2.7" data-path="ch-03.html"><a href="ch-03.html#bonus-species-occurrence-trait-data-and-pcas"><i class="fa fa-check"></i><b>3.2.7</b> Bonus: Species Occurrence, Trait Data and PCAs</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="ch-03.html"><a href="ch-03.html#exercise-2"><i class="fa fa-check"></i><b>3.3</b> Exercise</a>
<ul>
<li class="chapter" data-level="3.3.1" data-path="ch-03.html"><a href="ch-03.html#part-1-plotting-elevation-differences"><i class="fa fa-check"></i><b>3.3.1</b> Part 1: Plotting Elevation differences</a></li>
<li class="chapter" data-level="3.3.2" data-path="ch-03.html"><a href="ch-03.html#part-2-temperature-and-elevation-correlations"><i class="fa fa-check"></i><b>3.3.2</b> Part 2: Temperature and Elevation Correlations</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="ch-04.html"><a href="ch-04.html"><i class="fa fa-check"></i><b>4</b> Data Scraping</a>
<ul>
<li class="chapter" data-level="4.1" data-path="ch-04.html"><a href="ch-04.html#introduction-3"><i class="fa fa-check"></i><b>4.1</b> Introduction</a>
<ul>
<li class="chapter" data-level="4.1.1" data-path="ch-04.html"><a href="ch-04.html#theory"><i class="fa fa-check"></i><b>4.1.1</b> Theory</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="ch-04.html"><a href="ch-04.html#tutorial-3"><i class="fa fa-check"></i><b>4.2</b> Tutorial</a>
<ul>
<li class="chapter" data-level="4.2.1" data-path="ch-04.html"><a href="ch-04.html#r-packages-and-functions"><i class="fa fa-check"></i><b>4.2.1</b> R-Packages and Functions</a></li>
<li class="chapter" data-level="4.2.2" data-path="ch-04.html"><a href="ch-04.html#the-fishbase-website"><i class="fa fa-check"></i><b>4.2.2</b> The FishBase website</a></li>
<li class="chapter" data-level="4.2.3" data-path="ch-04.html"><a href="ch-04.html#accessing-fishbase"><i class="fa fa-check"></i><b>4.2.3</b> Accessing FishBase</a></li>
<li class="chapter" data-level="4.2.4" data-path="ch-04.html"><a href="ch-04.html#scraping-numbers"><i class="fa fa-check"></i><b>4.2.4</b> Scraping Numbers</a></li>
<li class="chapter" data-level="4.2.5" data-path="ch-04.html"><a href="ch-04.html#scraping-text-snippetrs"><i class="fa fa-check"></i><b>4.2.5</b> Scraping Text Snippetrs</a></li>
<li class="chapter" data-level="4.2.6" data-path="ch-04.html"><a href="ch-04.html#scraping-tables"><i class="fa fa-check"></i><b>4.2.6</b> Scraping Tables</a></li>
<li class="chapter" data-level="4.2.7" data-path="ch-04.html"><a href="ch-04.html#the-fishbase-package"><i class="fa fa-check"></i><b>4.2.7</b> The Fishbase Package</a></li>
<li class="chapter" data-level="4.2.8" data-path="ch-04.html"><a href="ch-04.html#summary"><i class="fa fa-check"></i><b>4.2.8</b> Summary</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="ch-04.html"><a href="ch-04.html#case-study"><i class="fa fa-check"></i><b>4.3</b> Case Study</a>
<ul>
<li class="chapter" data-level="4.3.1" data-path="ch-04.html"><a href="ch-04.html#creating-list-of-species"><i class="fa fa-check"></i><b>4.3.1</b> Creating List of Species</a></li>
<li class="chapter" data-level="4.3.2" data-path="ch-04.html"><a href="ch-04.html#extracting-iucn-status-for-all-species"><i class="fa fa-check"></i><b>4.3.2</b> Extracting IUCN Status for all species</a></li>
<li class="chapter" data-level="4.3.3" data-path="ch-04.html"><a href="ch-04.html#proportion-of-species-in-netherlands"><i class="fa fa-check"></i><b>4.3.3</b> Proportion of species in Netherlands</a></li>
<li class="chapter" data-level="4.3.4" data-path="ch-04.html"><a href="ch-04.html#cleaning-data-with-iucn-status"><i class="fa fa-check"></i><b>4.3.4</b> Cleaning data with IUCN Status</a></li>
<li class="chapter" data-level="4.3.5" data-path="ch-04.html"><a href="ch-04.html#maps-of-species-richness-and-red-list-species-proportions"><i class="fa fa-check"></i><b>4.3.5</b> Maps of species richness and Red List species proportions</a></li>
<li class="chapter" data-level="4.3.6" data-path="ch-04.html"><a href="ch-04.html#relation-of-basin-size-and-species-richness"><i class="fa fa-check"></i><b>4.3.6</b> Relation of basin size and species richness</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="ch-04.html"><a href="ch-04.html#exercise-3"><i class="fa fa-check"></i><b>4.4</b> Exercise</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="ch-05.html"><a href="ch-05.html"><i class="fa fa-check"></i><b>5</b> Catch-up</a>
<ul>
<li class="chapter" data-level="5.1" data-path="ch-05.html"><a href="ch-05.html#loops-in-r"><i class="fa fa-check"></i><b>5.1</b> Loops in R</a>
<ul>
<li class="chapter" data-level="5.1.1" data-path="ch-05.html"><a href="ch-05.html#some-simple-examples"><i class="fa fa-check"></i><b>5.1.1</b> Some simple examples</a></li>
<li class="chapter" data-level="5.1.2" data-path="ch-05.html"><a href="ch-05.html#nested-loops"><i class="fa fa-check"></i><b>5.1.2</b> Nested loops</a></li>
<li class="chapter" data-level="5.1.3" data-path="ch-05.html"><a href="ch-05.html#exercise-4"><i class="fa fa-check"></i><b>5.1.3</b> Exercise</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="ch-05.html"><a href="ch-05.html#functional-programming-using-purr"><i class="fa fa-check"></i><b>5.2</b> Functional programming using purr</a>
<ul>
<li class="chapter" data-level="5.2.1" data-path="ch-05.html"><a href="ch-05.html#shortcuts-in-a-purrr-function"><i class="fa fa-check"></i><b>5.2.1</b> Shortcuts in a <code>purrr</code> function</a></li>
<li class="chapter" data-level="5.2.2" data-path="ch-05.html"><a href="ch-05.html#workflow-nested-data-map-and-mutate"><i class="fa fa-check"></i><b>5.2.2</b> Workflow: nested data, map and mutate</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="ch-05.html"><a href="ch-05.html#string-manipulations"><i class="fa fa-check"></i><b>5.3</b> String Manipulations</a>
<ul>
<li class="chapter" data-level="5.3.1" data-path="ch-05.html"><a href="ch-05.html#introduction-to-strings"><i class="fa fa-check"></i><b>5.3.1</b> Introduction to strings</a></li>
<li class="chapter" data-level="5.3.2" data-path="ch-05.html"><a href="ch-05.html#matching-and-extracting-patterns"><i class="fa fa-check"></i><b>5.3.2</b> Matching and extracting patterns</a></li>
<li class="chapter" data-level="5.3.3" data-path="ch-05.html"><a href="ch-05.html#advanced-example"><i class="fa fa-check"></i><b>5.3.3</b> Advanced example</a></li>
</ul></li>
<li class="chapter" data-level="5.4" data-path="ch-05.html"><a href="ch-05.html#web-scraping-in-a-nut-shell"><i class="fa fa-check"></i><b>5.4</b> Web-scraping in a nut-shell</a></li>
<li class="chapter" data-level="5.5" data-path="ch-05.html"><a href="ch-05.html#tidyverses-filter-and-select"><i class="fa fa-check"></i><b>5.5</b> Tidyverse’s filter and select</a>
<ul>
<li class="chapter" data-level="5.5.1" data-path="ch-05.html"><a href="ch-05.html#introduction-4"><i class="fa fa-check"></i><b>5.5.1</b> Introduction</a></li>
<li class="chapter" data-level="5.5.2" data-path="ch-05.html"><a href="ch-05.html#select"><i class="fa fa-check"></i><b>5.5.2</b> Select()</a></li>
<li class="chapter" data-level="5.5.3" data-path="ch-05.html"><a href="ch-05.html#filter"><i class="fa fa-check"></i><b>5.5.3</b> Filter()</a></li>
<li class="chapter" data-level="5.5.4" data-path="ch-05.html"><a href="ch-05.html#exercises"><i class="fa fa-check"></i><b>5.5.4</b> Exercises</a></li>
<li class="chapter" data-level="5.5.5" data-path="ch-05.html"><a href="ch-05.html#solutions"><i class="fa fa-check"></i><b>5.5.5</b> Solutions</a></li>
</ul></li>
<li class="chapter" data-level="5.6" data-path="ch-05.html"><a href="ch-05.html#preparing-data-for-ggplot"><i class="fa fa-check"></i><b>5.6</b> Preparing data for ggplot()</a></li>
<li class="chapter" data-level="5.7" data-path="ch-05.html"><a href="ch-05.html#base-r-functions"><i class="fa fa-check"></i><b>5.7</b> Base R functions</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="ch-06.html"><a href="ch-06.html"><i class="fa fa-check"></i><b>6</b> Supervised Machine Learning I</a>
<ul>
<li class="chapter" data-level="6.1" data-path="ch-06.html"><a href="ch-06.html#introduction-5"><i class="fa fa-check"></i><b>6.1</b> Introduction</a>
<ul>
<li class="chapter" data-level="6.1.1" data-path="ch-06.html"><a href="ch-06.html#learning-objectives-1"><i class="fa fa-check"></i><b>6.1.1</b> Learning objectives</a></li>
<li class="chapter" data-level="6.1.2" data-path="ch-06.html"><a href="ch-06.html#important-points-from-the-lecture-1"><i class="fa fa-check"></i><b>6.1.2</b> Important points from the lecture</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="ch-06.html"><a href="ch-06.html#tutorial-4"><i class="fa fa-check"></i><b>6.2</b> Tutorial</a>
<ul>
<li class="chapter" data-level="6.2.1" data-path="ch-06.html"><a href="ch-06.html#linear-regression"><i class="fa fa-check"></i><b>6.2.1</b> Linear regression</a></li>
<li class="chapter" data-level="6.2.2" data-path="ch-06.html"><a href="ch-06.html#k-nearest-neighbours"><i class="fa fa-check"></i><b>6.2.2</b> K-nearest neighbours</a></li>
<li class="chapter" data-level="6.2.3" data-path="ch-06.html"><a href="ch-06.html#essential-methods-for-the-modelling-process"><i class="fa fa-check"></i><b>6.2.3</b> Essential methods for the modelling process</a></li>
<li class="chapter" data-level="6.2.4" data-path="ch-06.html"><a href="ch-06.html#bonus"><i class="fa fa-check"></i><b>6.2.4</b> Bonus</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="ch-06.html"><a href="ch-06.html#exercise-5"><i class="fa fa-check"></i><b>6.3</b> Exercise</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="ch-07.html"><a href="ch-07.html"><i class="fa fa-check"></i><b>7</b> Supervised Machine Learning II</a>
<ul>
<li class="chapter" data-level="7.1" data-path="ch-07.html"><a href="ch-07.html#introduction-6"><i class="fa fa-check"></i><b>7.1</b> Introduction</a>
<ul>
<li class="chapter" data-level="7.1.1" data-path="ch-07.html"><a href="ch-07.html#leaerning-objectives"><i class="fa fa-check"></i><b>7.1.1</b> Leaerning objectives</a></li>
<li class="chapter" data-level="7.1.2" data-path="ch-07.html"><a href="ch-07.html#key-points-from-the-lecture"><i class="fa fa-check"></i><b>7.1.2</b> Key points from the lecture</a></li>
</ul></li>
<li class="chapter" data-level="7.2" data-path="ch-07.html"><a href="ch-07.html#tutorial-5"><i class="fa fa-check"></i><b>7.2</b> Tutorial</a>
<ul>
<li class="chapter" data-level="7.2.1" data-path="ch-07.html"><a href="ch-07.html#model-training-and-the-loss-function"><i class="fa fa-check"></i><b>7.2.1</b> Model training and the loss function</a></li>
<li class="chapter" data-level="7.2.2" data-path="ch-07.html"><a href="ch-07.html#putting-it-all-together"><i class="fa fa-check"></i><b>7.2.2</b> Putting it all together</a></li>
<li class="chapter" data-level="7.2.3" data-path="ch-07.html"><a href="ch-07.html#model-evaluation"><i class="fa fa-check"></i><b>7.2.3</b> Model evaluation</a></li>
<li class="chapter" data-level="7.2.4" data-path="ch-07.html"><a href="ch-07.html#model-interpretation"><i class="fa fa-check"></i><b>7.2.4</b> Model interpretation</a></li>
</ul></li>
<li class="chapter" data-level="7.3" data-path="ch-07.html"><a href="ch-07.html#exercise-6"><i class="fa fa-check"></i><b>7.3</b> Exercise</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="ch-08.html"><a href="ch-08.html"><i class="fa fa-check"></i><b>8</b> Application 1: Variable selection</a>
<ul>
<li class="chapter" data-level="8.1" data-path="ch-08.html"><a href="ch-08.html#introduction-7"><i class="fa fa-check"></i><b>8.1</b> Introduction</a></li>
<li class="chapter" data-level="8.2" data-path="ch-08.html"><a href="ch-08.html#application"><i class="fa fa-check"></i><b>8.2</b> Application</a>
<ul>
<li class="chapter" data-level="8.2.1" data-path="ch-08.html"><a href="ch-08.html#warm-up-1-nested-for-loop"><i class="fa fa-check"></i><b>8.2.1</b> Warm-up 1: Nested for-loop</a></li>
<li class="chapter" data-level="8.2.2" data-path="ch-08.html"><a href="ch-08.html#warm-up-2-find-the-best-single-predictor"><i class="fa fa-check"></i><b>8.2.2</b> Warm-up 2: Find the best single predictor</a></li>
<li class="chapter" data-level="8.2.3" data-path="ch-08.html"><a href="ch-08.html#full-stepwise-regression"><i class="fa fa-check"></i><b>8.2.3</b> Full stepwise regression</a></li>
<li class="chapter" data-level="8.2.4" data-path="ch-08.html"><a href="ch-08.html#bonus-stepwise-regression-out-of-the-box"><i class="fa fa-check"></i><b>8.2.4</b> Bonus: Stepwise regression out-of-the-box</a></li>
<li class="chapter" data-level="8.2.5" data-path="ch-08.html"><a href="ch-08.html#bonus-best-subset-selection"><i class="fa fa-check"></i><b>8.2.5</b> Bonus: Best Subset Selection</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="9" data-path="ch-09.html"><a href="ch-09.html"><i class="fa fa-check"></i><b>9</b> Supervised Neural Networks I</a>
<ul>
<li class="chapter" data-level="9.1" data-path="ch-09.html"><a href="ch-09.html#introduction-8"><i class="fa fa-check"></i><b>9.1</b> Introduction</a>
<ul>
<li class="chapter" data-level="9.1.1" data-path="ch-09.html"><a href="ch-09.html#learning-objectives-2"><i class="fa fa-check"></i><b>9.1.1</b> Learning objectives</a></li>
<li class="chapter" data-level="9.1.2" data-path="ch-09.html"><a href="ch-09.html#important-points-from-the-lecture-2"><i class="fa fa-check"></i><b>9.1.2</b> Important points from the lecture</a></li>
</ul></li>
<li class="chapter" data-level="9.2" data-path="ch-09.html"><a href="ch-09.html#tutorial-6"><i class="fa fa-check"></i><b>9.2</b> Tutorial</a>
<ul>
<li class="chapter" data-level="9.2.1" data-path="ch-09.html"><a href="ch-09.html#set-up"><i class="fa fa-check"></i><b>9.2.1</b> Set-up</a></li>
<li class="chapter" data-level="9.2.2" data-path="ch-09.html"><a href="ch-09.html#keras-for-linear-models"><i class="fa fa-check"></i><b>9.2.2</b> Keras for linear models</a></li>
<li class="chapter" data-level="9.2.3" data-path="ch-09.html"><a href="ch-09.html#tuning-learning-rate"><i class="fa fa-check"></i><b>9.2.3</b> Tuning learning rate</a></li>
<li class="chapter" data-level="9.2.4" data-path="ch-09.html"><a href="ch-09.html#logistic-regression"><i class="fa fa-check"></i><b>9.2.4</b> Logistic Regression</a></li>
</ul></li>
<li class="chapter" data-level="9.3" data-path="ch-09.html"><a href="ch-09.html#exercise-7"><i class="fa fa-check"></i><b>9.3</b> Exercise</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="ch-10.html"><a href="ch-10.html"><i class="fa fa-check"></i><b>10</b> Supervised Neural Networks II</a>
<ul>
<li class="chapter" data-level="10.1" data-path="ch-10.html"><a href="ch-10.html#introduction-9"><i class="fa fa-check"></i><b>10.1</b> Introduction</a>
<ul>
<li class="chapter" data-level="10.1.1" data-path="ch-10.html"><a href="ch-10.html#learning-objectives-3"><i class="fa fa-check"></i><b>10.1.1</b> Learning objectives</a></li>
<li class="chapter" data-level="10.1.2" data-path="ch-10.html"><a href="ch-10.html#important-points-from-the-lecture-3"><i class="fa fa-check"></i><b>10.1.2</b> Important points from the lecture</a></li>
</ul></li>
<li class="chapter" data-level="10.2" data-path="ch-10.html"><a href="ch-10.html#tutorial-7"><i class="fa fa-check"></i><b>10.2</b> Tutorial</a>
<ul>
<li class="chapter" data-level="10.2.1" data-path="ch-10.html"><a href="ch-10.html#import-libraries-1"><i class="fa fa-check"></i><b>10.2.1</b> Import libraries</a></li>
<li class="chapter" data-level="10.2.2" data-path="ch-10.html"><a href="ch-10.html#construct-a-toy-dataset"><i class="fa fa-check"></i><b>10.2.2</b> Construct a toy dataset</a></li>
<li class="chapter" data-level="10.2.3" data-path="ch-10.html"><a href="ch-10.html#build-and-train-nn"><i class="fa fa-check"></i><b>10.2.3</b> Build and train NN</a></li>
<li class="chapter" data-level="10.2.4" data-path="ch-10.html"><a href="ch-10.html#model-performance"><i class="fa fa-check"></i><b>10.2.4</b> Model performance</a></li>
<li class="chapter" data-level="10.2.5" data-path="ch-10.html"><a href="ch-10.html#influence-of-nn-architecture"><i class="fa fa-check"></i><b>10.2.5</b> Influence of NN architecture</a></li>
</ul></li>
<li class="chapter" data-level="10.3" data-path="ch-10.html"><a href="ch-10.html#exercise-8"><i class="fa fa-check"></i><b>10.3</b> Exercise</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="ch-11.html"><a href="ch-11.html"><i class="fa fa-check"></i><b>11</b> Application 2: Neural Networks and Hyperparameter Tuning</a>
<ul>
<li class="chapter" data-level="11.1" data-path="ch-11.html"><a href="ch-11.html#introduction-10"><i class="fa fa-check"></i><b>11.1</b> Introduction</a>
<ul>
<li class="chapter" data-level="11.1.1" data-path="ch-11.html"><a href="ch-11.html#learning-goals"><i class="fa fa-check"></i><b>11.1.1</b> Learning Goals</a></li>
<li class="chapter" data-level="11.1.2" data-path="ch-11.html"><a href="ch-11.html#key-points-from-previous-lectures"><i class="fa fa-check"></i><b>11.1.2</b> Key Points from Previous Lectures</a></li>
</ul></li>
<li class="chapter" data-level="11.2" data-path="ch-11.html"><a href="ch-11.html#application-1"><i class="fa fa-check"></i><b>11.2</b> Application</a>
<ul>
<li class="chapter" data-level="11.2.1" data-path="ch-11.html"><a href="ch-11.html#problem-statement"><i class="fa fa-check"></i><b>11.2.1</b> Problem Statement</a></li>
<li class="chapter" data-level="11.2.2" data-path="ch-11.html"><a href="ch-11.html#data-preparation"><i class="fa fa-check"></i><b>11.2.2</b> Data preparation</a></li>
<li class="chapter" data-level="11.2.3" data-path="ch-11.html"><a href="ch-11.html#center-and-scale"><i class="fa fa-check"></i><b>11.2.3</b> Center and scale</a></li>
<li class="chapter" data-level="11.2.4" data-path="ch-11.html"><a href="ch-11.html#building-a-simple-model-with-keras-subtask-1"><i class="fa fa-check"></i><b>11.2.4</b> Building a simple model with keras ( SubTask 1)</a></li>
<li class="chapter" data-level="11.2.5" data-path="ch-11.html"><a href="ch-11.html#cross-validation"><i class="fa fa-check"></i><b>11.2.5</b> Cross validation</a></li>
<li class="chapter" data-level="11.2.6" data-path="ch-11.html"><a href="ch-11.html#parameter-tuning"><i class="fa fa-check"></i><b>11.2.6</b> Parameter Tuning</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="12" data-path="ch-12.html"><a href="ch-12.html"><i class="fa fa-check"></i><b>12</b> Supervised Deep Learning I</a>
<ul>
<li class="chapter" data-level="12.1" data-path="ch-12.html"><a href="ch-12.html#introduction-11"><i class="fa fa-check"></i><b>12.1</b> Introduction</a>
<ul>
<li class="chapter" data-level="12.1.1" data-path="ch-12.html"><a href="ch-12.html#learning-objectives-4"><i class="fa fa-check"></i><b>12.1.1</b> Learning objectives</a></li>
</ul></li>
<li class="chapter" data-level="12.2" data-path="ch-12.html"><a href="ch-12.html#tutorial-8"><i class="fa fa-check"></i><b>12.2</b> Tutorial</a>
<ul>
<li class="chapter" data-level="12.2.1" data-path="ch-12.html"><a href="ch-12.html#building-blocks-of-cnns"><i class="fa fa-check"></i><b>12.2.1</b> Building Blocks of CNNs</a></li>
<li class="chapter" data-level="12.2.2" data-path="ch-12.html"><a href="ch-12.html#build-the-model"><i class="fa fa-check"></i><b>12.2.2</b> Build the model</a></li>
<li class="chapter" data-level="12.2.3" data-path="ch-12.html"><a href="ch-12.html#compile-and-train-the-model"><i class="fa fa-check"></i><b>12.2.3</b> Compile and train the model</a></li>
<li class="chapter" data-level="12.2.4" data-path="ch-12.html"><a href="ch-12.html#reduce-overfitting"><i class="fa fa-check"></i><b>12.2.4</b> Reduce Overfitting</a></li>
<li class="chapter" data-level="12.2.5" data-path="ch-12.html"><a href="ch-12.html#visualizing-a-cnn"><i class="fa fa-check"></i><b>12.2.5</b> Visualizing a CNN</a></li>
</ul></li>
<li class="chapter" data-level="12.3" data-path="ch-12.html"><a href="ch-12.html#exercise-9"><i class="fa fa-check"></i><b>12.3</b> Exercise</a>
<ul>
<li class="chapter" data-level="12.3.1" data-path="ch-12.html"><a href="ch-12.html#import-libraries-and-data"><i class="fa fa-check"></i><b>12.3.1</b> Import libraries and data</a></li>
<li class="chapter" data-level="12.3.2" data-path="ch-12.html"><a href="ch-12.html#tasks"><i class="fa fa-check"></i><b>12.3.2</b> Tasks</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="13" data-path="ch-13.html"><a href="ch-13.html"><i class="fa fa-check"></i><b>13</b> Supervised Deep Learning II</a>
<ul>
<li class="chapter" data-level="13.1" data-path="ch-13.html"><a href="ch-13.html#introduction-12"><i class="fa fa-check"></i><b>13.1</b> Introduction</a>
<ul>
<li class="chapter" data-level="13.1.1" data-path="ch-13.html"><a href="ch-13.html#learning-objectives-5"><i class="fa fa-check"></i><b>13.1.1</b> Learning objectives</a></li>
</ul></li>
<li class="chapter" data-level="13.2" data-path="ch-13.html"><a href="ch-13.html#tutorial-9"><i class="fa fa-check"></i><b>13.2</b> Tutorial</a>
<ul>
<li class="chapter" data-level="13.2.1" data-path="ch-13.html"><a href="ch-13.html#dataset"><i class="fa fa-check"></i><b>13.2.1</b> Dataset</a></li>
<li class="chapter" data-level="13.2.2" data-path="ch-13.html"><a href="ch-13.html#naive-models-old-world"><i class="fa fa-check"></i><b>13.2.2</b> Naive models (Old World)</a></li>
<li class="chapter" data-level="13.2.3" data-path="ch-13.html"><a href="ch-13.html#neural-networks-new-world"><i class="fa fa-check"></i><b>13.2.3</b> Neural Networks (New World)</a></li>
<li class="chapter" data-level="13.2.4" data-path="ch-13.html"><a href="ch-13.html#model-comparison"><i class="fa fa-check"></i><b>13.2.4</b> Model Comparison</a></li>
</ul></li>
<li class="chapter" data-level="13.3" data-path="ch-13.html"><a href="ch-13.html#exercise-10"><i class="fa fa-check"></i><b>13.3</b> Exercise</a>
<ul>
<li class="chapter" data-level="13.3.1" data-path="ch-13.html"><a href="ch-13.html#import-libraries-2"><i class="fa fa-check"></i><b>13.3.1</b> Import libraries</a></li>
<li class="chapter" data-level="13.3.2" data-path="ch-13.html"><a href="ch-13.html#load-data"><i class="fa fa-check"></i><b>13.3.2</b> Load data</a></li>
<li class="chapter" data-level="13.3.3" data-path="ch-13.html"><a href="ch-13.html#preprocess-ndvi-images"><i class="fa fa-check"></i><b>13.3.3</b> Preprocess NDVI images</a></li>
<li class="chapter" data-level="13.3.4" data-path="ch-13.html"><a href="ch-13.html#part-1"><i class="fa fa-check"></i><b>13.3.4</b> Part 1</a></li>
<li class="chapter" data-level="13.3.5" data-path="ch-13.html"><a href="ch-13.html#part-2"><i class="fa fa-check"></i><b>13.3.5</b> Part 2</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Environmental Systems Data Science</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="ch-11" class="section level1" number="11">
<h1><span class="header-section-number">Chapter 11</span> Application 2: Neural Networks and Hyperparameter Tuning</h1>
<p>The goal of this application is to put the concepts that we have learnt over all these weeks into practice. The task at hand is to predict the productivity of vegetation (<code>GPP_NT_VUT_REF</code>), using an artificial neural network. For this task we will be using the <code>FLX_CH-Lae_FLUXNET2015_FULLSET_HH_2004-2014_1-3_CLEAN</code> data, that we obtained after the data wrangling tutorial</p>
<div id="introduction-10" class="section level2" number="11.1">
<h2><span class="header-section-number">11.1</span> Introduction</h2>
<div id="learning-goals" class="section level3" number="11.1.1">
<h3><span class="header-section-number">11.1.1</span> Learning Goals</h3>
<p>After this exercise session you shall be able to</p>
<ul>
<li>Create training and testing splits (80/20)</li>
<li>Center and scale your data features (pre-processing)</li>
<li>Use KFold cross-validation for hyper-parameter tuning</li>
<li>Build and train a simple, 1 hidden layer NN for regression tasks</li>
<li>Optimise the number of hidden layer units.</li>
<li>Evaluate feature importance and its effects on the model performance (maybe as bonus?)</li>
</ul>
</div>
<div id="key-points-from-previous-lectures" class="section level3" number="11.1.2">
<h3><span class="header-section-number">11.1.2</span> Key Points from Previous Lectures</h3>
<ul>
<li><p>It is always worthwhile to perform an initial exploratory analysis of your data, e.g. to identify outliers, missing values, etc.</p></li>
<li><p>To train a statistical model using machine learning, we split our data into training and testing sets. Sometimes we also include a validation set.</p></li>
<li><p>Testing data is set aside at the initial split and not “touched” during model training. It is key to test a model’s predictive power or whether it is overfitted.</p></li>
<li><p>Validation data is used for determining the loss during model training. The reason for distinguishing between testing and validation data is to assure we’re not misleading model training by some peculiarities of the validation data and we get an assessment of generalisability based on data that was not seen during model training.</p></li>
<li><p>Loss is a measure of how well our trained model predicts training labels. Loss is high when predictions are poor. Loss is low when predictions are good.</p></li>
<li><p>Model training minimises the loss. In other words, it optimises the agreement between predicted and observed values.</p></li>
<li><p>There are several ways to measure loss. RMSE (Root Mean Squared Error) is one such measure. It is used in regression problems.<br />
</p></li>
<li><p>Gradient descent is a method that searches for model parameters that minimize loss.</p></li>
<li><p>Machine learning algorithms have hyper-parameters. These are parameters that are set by the user rather than learned during training. An example is the learning rate in gradient descent. In the case of Aritificial Neural Networks, this can be the number of nodes per hidden layer, or the number of hidden layers.</p></li>
<li><p>To tune a model, you can set hyperparameters that determine model structure or calibrate the coefficients.</p></li>
<li><p>Generalisability refers to the model’s performance on data not seen during the training - the testing data.</p></li>
<li><p>To avoid overfitting, model generalisability is desired already during model training. One method to do this is cross validation.</p></li>
<li><p>Data leakage is when data from the testing dataset creeps into the training data. To avoid this the testing set must be left completely untouched!</p></li>
</ul>
</div>
</div>
<div id="application-1" class="section level2" number="11.2">
<h2><span class="header-section-number">11.2</span> Application</h2>
<div id="problem-statement" class="section level3" number="11.2.1">
<h3><span class="header-section-number">11.2.1</span> Problem Statement</h3>
<p>For this exercise we can use the reduced and cleaned dataset with half-hourly data from Chapter <a href="ch-02.html#ch-02">2</a>. The task is to predict the <em>productivity of vegetation (GPP)</em>, using all the other features as predictor variables.</p>
<p><strong>GPP_NT_VUT_REF</strong> from the dataset is the target variable and rest of the columns can be used as the input predictor variables. For the sake of limiting the task complexity, we assume the data to be IID generated, and treat each row in the dataset as an independent observation.</p>
<ul>
<li>Use these inputs to create a neural network with just one hidden layer.</li>
<li>Use cross validation to optimise hyper-parameters such as number of hidden nodes, choice of activation function etc.</li>
<li>Use mean squared error (MSE) loss as a metric for monitoring the performance, plot the MSE loss as a function of the number of epochs.</li>
<li>Plot the MSE loss as a funtion of the hyperparameters used.</li>
<li><em>The list of tasks mentioned here are not exhaustive, you’ll be guided through the application and asked questions along the way!</em></li>
</ul>
</div>
<div id="data-preparation" class="section level3" number="11.2.2">
<h3><span class="header-section-number">11.2.2</span> Data preparation</h3>
<div class="sourceCode" id="cb942"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb942-1"><a href="ch-11.html#cb942-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Loading the required libraries </span></span>
<span id="cb942-2"><a href="ch-11.html#cb942-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(keras)</span>
<span id="cb942-3"><a href="ch-11.html#cb942-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(reticulate)</span>
<span id="cb942-4"><a href="ch-11.html#cb942-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(caret)</span>
<span id="cb942-5"><a href="ch-11.html#cb942-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb942-6"><a href="ch-11.html#cb942-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(recipes)</span>
<span id="cb942-7"><a href="ch-11.html#cb942-7" aria-hidden="true" tabindex="-1"></a><span class="fu">use_condaenv</span>()</span></code></pre></div>
<div class="sourceCode" id="cb943"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb943-1"><a href="ch-11.html#cb943-1" aria-hidden="true" tabindex="-1"></a><span class="do">### Read in the .csv file as a dataframe </span></span>
<span id="cb943-2"><a href="ch-11.html#cb943-2" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">&quot;./data/FLX_CH-Lae_FLUXNET2015_FULLSET_HH_2004-2014_1-3_CLEAN.csv&quot;</span>)</span>
<span id="cb943-3"><a href="ch-11.html#cb943-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb943-4"><a href="ch-11.html#cb943-4" aria-hidden="true" tabindex="-1"></a><span class="do">### Things to check when preprocessing </span></span>
<span id="cb943-5"><a href="ch-11.html#cb943-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Look at the structure and shape of the data (print it out using str())</span></span>
<span id="cb943-6"><a href="ch-11.html#cb943-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert time-stamp columns using as.POSIXct() to convert them from a character to date-time object </span></span>
<span id="cb943-7"><a href="ch-11.html#cb943-7" aria-hidden="true" tabindex="-1"></a><span class="co"># As we treat the observations as IID, we don&#39;t really need the time-stamp values as a feature variable, but we still retain them as they will be used for some time series plots later. </span></span>
<span id="cb943-8"><a href="ch-11.html#cb943-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb943-9"><a href="ch-11.html#cb943-9" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(df)</span></code></pre></div>
<pre><code>## [1] 192864     19</code></pre>
<div class="sourceCode" id="cb945"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb945-1"><a href="ch-11.html#cb945-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(df)</span></code></pre></div>
<pre><code>## &#39;data.frame&#39;:    192864 obs. of  19 variables:
##  $ TIMESTAMP_START: chr  &quot;2004-01-01T00:00:00Z&quot; &quot;2004-01-01T00:30:00Z&quot; &quot;2004-01-01T01:00:00Z&quot; &quot;2004-01-01T01:30:00Z&quot; ...
##  $ TIMESTAMP_END  : chr  &quot;2004-01-01T00:30:00Z&quot; &quot;2004-01-01T01:00:00Z&quot; &quot;2004-01-01T01:30:00Z&quot; &quot;2004-01-01T02:00:00Z&quot; ...
##  $ TA_F           : num  NA NA NA NA NA NA NA NA NA NA ...
##  $ SW_IN_F        : num  NA NA NA NA NA NA NA NA NA NA ...
##  $ LW_IN_F        : num  304 304 281 281 281 ...
##  $ VPD_F          : num  NA NA NA NA NA NA NA NA NA NA ...
##  $ PA_F           : num  93.3 93.3 93.3 93.3 93.3 ...
##  $ P_F            : num  0.014 0.014 0 0 0 0 0 0 0 0 ...
##  $ WS_F           : num  NA NA NA NA NA NA NA NA NA NA ...
##  $ CO2_F_MDS      : num  NA NA NA NA NA NA NA NA NA NA ...
##  $ PPFD_IN        : num  NA NA NA NA NA NA NA NA NA NA ...
##  $ GPP_NT_VUT_REF : num  NA NA NA NA NA NA NA NA NA NA ...
##  $ SWC_F_MDS_1    : num  NA NA NA NA NA NA NA NA NA NA ...
##  $ SWC_F_MDS_2    : num  NA NA NA NA NA NA NA NA NA NA ...
##  $ SWC_F_MDS_3    : num  NA NA NA NA NA NA NA NA NA NA ...
##  $ WD             : num  NA NA NA NA NA NA NA NA NA NA ...
##  $ RH             : num  NA NA NA NA NA NA NA NA NA NA ...
##  $ NIGHT          : int  1 1 1 1 1 1 1 1 1 1 ...
##  $ NEE_VUT_REF_QC : int  3 3 3 3 3 3 3 3 3 3 ...</code></pre>
<div class="sourceCode" id="cb947"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb947-1"><a href="ch-11.html#cb947-1" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>TIMESTAMP_START <span class="ot">&lt;-</span> <span class="fu">as.POSIXct</span>(df<span class="sc">$</span>TIMESTAMP_START, <span class="at">format =</span> <span class="st">&quot;%Y-%m-%dT%TZ&quot;</span>)</span>
<span id="cb947-2"><a href="ch-11.html#cb947-2" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>TIMESTAMP_END <span class="ot">&lt;-</span> <span class="fu">as.POSIXct</span>(df<span class="sc">$</span>TIMESTAMP_END, <span class="at">format =</span> <span class="st">&quot;%Y-%m-%dT%TZ&quot;</span>)</span>
<span id="cb947-3"><a href="ch-11.html#cb947-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb947-4"><a href="ch-11.html#cb947-4" aria-hidden="true" tabindex="-1"></a><span class="do">### Check the structure of your data again (print it out using str())</span></span>
<span id="cb947-5"><a href="ch-11.html#cb947-5" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(df)</span></code></pre></div>
<pre><code>## &#39;data.frame&#39;:    192864 obs. of  19 variables:
##  $ TIMESTAMP_START: POSIXct, format: &quot;2004-01-01 00:00:00&quot; &quot;2004-01-01 00:30:00&quot; ...
##  $ TIMESTAMP_END  : POSIXct, format: &quot;2004-01-01 00:30:00&quot; &quot;2004-01-01 01:00:00&quot; ...
##  $ TA_F           : num  NA NA NA NA NA NA NA NA NA NA ...
##  $ SW_IN_F        : num  NA NA NA NA NA NA NA NA NA NA ...
##  $ LW_IN_F        : num  304 304 281 281 281 ...
##  $ VPD_F          : num  NA NA NA NA NA NA NA NA NA NA ...
##  $ PA_F           : num  93.3 93.3 93.3 93.3 93.3 ...
##  $ P_F            : num  0.014 0.014 0 0 0 0 0 0 0 0 ...
##  $ WS_F           : num  NA NA NA NA NA NA NA NA NA NA ...
##  $ CO2_F_MDS      : num  NA NA NA NA NA NA NA NA NA NA ...
##  $ PPFD_IN        : num  NA NA NA NA NA NA NA NA NA NA ...
##  $ GPP_NT_VUT_REF : num  NA NA NA NA NA NA NA NA NA NA ...
##  $ SWC_F_MDS_1    : num  NA NA NA NA NA NA NA NA NA NA ...
##  $ SWC_F_MDS_2    : num  NA NA NA NA NA NA NA NA NA NA ...
##  $ SWC_F_MDS_3    : num  NA NA NA NA NA NA NA NA NA NA ...
##  $ WD             : num  NA NA NA NA NA NA NA NA NA NA ...
##  $ RH             : num  NA NA NA NA NA NA NA NA NA NA ...
##  $ NIGHT          : int  1 1 1 1 1 1 1 1 1 1 ...
##  $ NEE_VUT_REF_QC : int  3 3 3 3 3 3 3 3 3 3 ...</code></pre>
<p>Recall the tutorial on <em>data wrangling</em>. We alreadt performed some data-preprocessing there. We had replaced the missing value flag -9999 by NAs for the target variable <strong>GPP_NT_VUT_REF</strong>.
We had used the categorical variable <strong>NEE_VUT_REF_QC</strong>, representing the quality control, to further edit some of the values of the target variable <strong>GPP_NT_VUT_REF</strong>. For all those rows where <span class="math inline">\(NEE\_VUT\_REF\_QC \in \{3,4\}\)</span>, i.e. poor quality of measurements, we have already replaced the target variable <strong>GPP_NT_VUT_REF</strong> with NAs.</p>
<p>Thus we remove all the rows where the target variable is NA. As the target GPP_NT_VUT_REF is missing, we cannot learn or test against this data, so we remove all the rows where the target variable is missing. After we do this, the information that we previously encoded in NEE_VUT_REF_QC has already been used to filter out the rows with poor quality control measures. The variable NEE_VUT_REF_QC does not carry any additional information that would be helpful in predicting the target varibale. Consequently, we can discard this variable.</p>
<p>Side Note: NEE_VUT_REF_QC was the only categorical feature in our dataset, and by discarding it we got lucky. Neural networks in keras require input data in the form of matrices, and if we had any other categorical variables present in our data, we would have to encode these e.g. One-Hot Encoding vectors</p>
<div class="sourceCode" id="cb949"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb949-1"><a href="ch-11.html#cb949-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Drop rows with NAs for GPP_NT_VUT_REF, and discard the column NEE_VUT_REF_QC</span></span>
<span id="cb949-2"><a href="ch-11.html#cb949-2" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span> </span>
<span id="cb949-3"><a href="ch-11.html#cb949-3" aria-hidden="true" tabindex="-1"></a>            <span class="fu">drop_na</span>(<span class="fu">any_of</span>(<span class="st">&quot;GPP_NT_VUT_REF&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb949-4"><a href="ch-11.html#cb949-4" aria-hidden="true" tabindex="-1"></a>            <span class="fu">select</span>(<span class="sc">-</span><span class="st">&quot;NEE_VUT_REF_QC&quot;</span>)</span>
<span id="cb949-5"><a href="ch-11.html#cb949-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb949-6"><a href="ch-11.html#cb949-6" aria-hidden="true" tabindex="-1"></a><span class="do">## Print the dimensionality of the data frame now to check how many rows have been deleted, and the num of columns remaining </span></span>
<span id="cb949-7"><a href="ch-11.html#cb949-7" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(df)</span></code></pre></div>
<pre><code>## [1] 176132     18</code></pre>
<div class="sourceCode" id="cb951"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb951-1"><a href="ch-11.html#cb951-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Print the summary() of your dataframe for some more information about your variables  </span></span>
<span id="cb951-2"><a href="ch-11.html#cb951-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(df)</span></code></pre></div>
<pre><code>##  TIMESTAMP_START               TIMESTAMP_END                      TA_F        
##  Min.   :2004-03-31 11:00:00   Min.   :2004-03-31 11:30:00   Min.   :-17.200  
##  1st Qu.:2007-02-04 11:52:30   1st Qu.:2007-02-04 12:22:30   1st Qu.:  1.343  
##  Median :2009-10-01 17:15:00   Median :2009-10-01 17:45:00   Median :  7.760  
##  Mean   :2009-09-26 02:34:05   Mean   :2009-09-26 03:04:06   Mean   :  7.628  
##  3rd Qu.:2012-05-19 19:37:30   3rd Qu.:2012-05-19 20:07:30   3rd Qu.: 13.660  
##  Max.   :2014-12-31 23:30:00   Max.   :2015-01-01 00:00:00   Max.   : 31.820  
##  NA&#39;s   :20                    NA&#39;s   :20                    NA&#39;s   :4937     
##     SW_IN_F            LW_IN_F          VPD_F             PA_F      
##  Min.   :   0.000   Min.   :135.4   Min.   : 0.000   Min.   :89.57  
##  1st Qu.:   0.000   1st Qu.:275.4   1st Qu.: 0.183   1st Qu.:92.86  
##  Median :   2.072   Median :310.5   Median : 1.643   Median :93.34  
##  Mean   : 134.206   Mean   :304.2   Mean   : 3.228   Mean   :93.26  
##  3rd Qu.: 167.901   3rd Qu.:337.2   3rd Qu.: 4.723   3rd Qu.:93.75  
##  Max.   :1074.410   Max.   :423.9   Max.   :34.391   Max.   :95.32  
##  NA&#39;s   :4961                       NA&#39;s   :4937                    
##       P_F              WS_F          CO2_F_MDS        PPFD_IN        
##  Min.   :0.0000   Min.   : 0.004   Min.   :210.8   Min.   :   3.399  
##  1st Qu.:0.0000   1st Qu.: 1.174   1st Qu.:370.7   1st Qu.:   4.114  
##  Median :0.0000   Median : 2.065   Median :386.5   Median :   6.831  
##  Mean   :0.0656   Mean   : 2.502   Mean   :395.8   Mean   : 281.226  
##  3rd Qu.:0.0590   3rd Qu.: 3.377   3rd Qu.:401.6   3rd Qu.: 341.000  
##  Max.   :3.5510   Max.   :13.249   Max.   :999.4   Max.   :2170.000  
##                   NA&#39;s   :4039     NA&#39;s   :81      NA&#39;s   :5172      
##  GPP_NT_VUT_REF      SWC_F_MDS_1     SWC_F_MDS_2      SWC_F_MDS_3   
##  Min.   :-35.4686   Min.   : 7.70   Min.   : 6.532   Min.   : 7.32  
##  1st Qu.: -0.3901   1st Qu.:18.46   1st Qu.:17.280   1st Qu.:18.59  
##  Median :  1.6599   Median :21.09   Median :21.910   Median :21.46  
##  Mean   :  4.8678   Mean   :21.41   Mean   :21.143   Mean   :21.20  
##  3rd Qu.:  7.7467   3rd Qu.:24.83   3rd Qu.:24.580   3rd Qu.:23.92  
##  Max.   : 61.1749   Max.   :32.74   Max.   :32.086   Max.   :31.79  
##                     NA&#39;s   :23377   NA&#39;s   :13115    NA&#39;s   :13168  
##        WD                RH             NIGHT       
##  Min.   :  0.062   Min.   : 17.09   Min.   :0.0000  
##  1st Qu.:101.198   1st Qu.: 65.74   1st Qu.:0.0000  
##  Median :227.899   Median : 81.80   Median :0.0000  
##  Mean   :188.123   Mean   : 78.89   Mean   :0.4871  
##  3rd Qu.:259.823   3rd Qu.: 97.10   3rd Qu.:1.0000  
##  Max.   :359.987   Max.   :100.00   Max.   :1.0000  
##  NA&#39;s   :3442      NA&#39;s   :6017</code></pre>
<p>We see that there are still a few variables with NAs. Let’s see how many NAs each column has and what would be the number of rows in the resulting dataframe if we drop all rows with NAs</p>
<div class="sourceCode" id="cb953"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb953-1"><a href="ch-11.html#cb953-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Compute how many rows have NA values for each column, and report the result for each column, print the result </span></span>
<span id="cb953-2"><a href="ch-11.html#cb953-2" aria-hidden="true" tabindex="-1"></a><span class="co"># e.g. </span></span>
<span id="cb953-3"><a href="ch-11.html#cb953-3" aria-hidden="true" tabindex="-1"></a><span class="co"># TIMESTAMP_START                 0</span></span>
<span id="cb953-4"><a href="ch-11.html#cb953-4" aria-hidden="true" tabindex="-1"></a><span class="co"># TIMESTAMP_START0TIMESTAMP_END   0</span></span>
<span id="cb953-5"><a href="ch-11.html#cb953-5" aria-hidden="true" tabindex="-1"></a><span class="co"># TA_F                            abc</span></span>
<span id="cb953-6"><a href="ch-11.html#cb953-6" aria-hidden="true" tabindex="-1"></a><span class="co"># .</span></span>
<span id="cb953-7"><a href="ch-11.html#cb953-7" aria-hidden="true" tabindex="-1"></a><span class="co"># . </span></span>
<span id="cb953-8"><a href="ch-11.html#cb953-8" aria-hidden="true" tabindex="-1"></a><span class="co"># . </span></span>
<span id="cb953-9"><a href="ch-11.html#cb953-9" aria-hidden="true" tabindex="-1"></a><span class="co"># NIGHT                           xyz</span></span>
<span id="cb953-10"><a href="ch-11.html#cb953-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb953-11"><a href="ch-11.html#cb953-11" aria-hidden="true" tabindex="-1"></a><span class="fu">colSums</span>(<span class="fu">is.na</span>(df))</span></code></pre></div>
<pre><code>## TIMESTAMP_START   TIMESTAMP_END            TA_F         SW_IN_F         LW_IN_F 
##              20              20            4937            4961               0 
##           VPD_F            PA_F             P_F            WS_F       CO2_F_MDS 
##            4937               0               0            4039              81 
##         PPFD_IN  GPP_NT_VUT_REF     SWC_F_MDS_1     SWC_F_MDS_2     SWC_F_MDS_3 
##            5172               0           23377           13115           13168 
##              WD              RH           NIGHT 
##            3442            6017               0</code></pre>
<div class="sourceCode" id="cb955"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb955-1"><a href="ch-11.html#cb955-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Compute the rows we will be left with, if we drop all rows where even 1 column contains NA, print the result</span></span>
<span id="cb955-2"><a href="ch-11.html#cb955-2" aria-hidden="true" tabindex="-1"></a><span class="fu">nrow</span>(df <span class="sc">%&gt;%</span> <span class="fu">drop_na</span>())</span></code></pre></div>
<pre><code>## [1] 147359</code></pre>
<p>The number of rows with NAs are not that large compared to the current size of the dataset. So we can afford to discard these rows without reducing the size of our dataset by much, and we still have enough data to carry out analysis.</p>
<p><em>Sidenote:</em> It can happen in some cases that by doing so we lose a majority of our dataset, because each row has atleast 1 column with NA. If the number of rows reduced significantly by this operation, we would use some data imputation technique to fill-in these NA values. But also note that by doing so, we are introducing some bias to our model, by the data imputation technique we choose.</p>
<div class="sourceCode" id="cb957"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb957-1"><a href="ch-11.html#cb957-1" aria-hidden="true" tabindex="-1"></a><span class="do">## drop all the rows with NAs</span></span>
<span id="cb957-2"><a href="ch-11.html#cb957-2" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span>  df <span class="sc">%&gt;%</span> <span class="fu">drop_na</span>()</span>
<span id="cb957-3"><a href="ch-11.html#cb957-3" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(df)</span></code></pre></div>
<pre><code>## &#39;data.frame&#39;:    147359 obs. of  18 variables:
##  $ TIMESTAMP_START: POSIXct, format: &quot;2004-09-20 10:30:00&quot; &quot;2004-09-20 11:00:00&quot; ...
##  $ TIMESTAMP_END  : POSIXct, format: &quot;2004-09-20 11:00:00&quot; &quot;2004-09-20 11:30:00&quot; ...
##  $ TA_F           : num  13.3 13.4 13.8 14.5 14 ...
##  $ SW_IN_F        : num  561 462 536 672 390 ...
##  $ LW_IN_F        : num  346 346 346 346 346 ...
##  $ VPD_F          : num  2.87 3.35 3.71 4.58 4.25 ...
##  $ PA_F           : num  93.6 93.6 93.6 93.6 93.6 ...
##  $ P_F            : num  0.019 0.019 0.019 0.019 0.019 0 0 0 0 0 ...
##  $ WS_F           : num  2.29 2.86 2.42 2.91 2.87 ...
##  $ CO2_F_MDS      : num  356 355 354 353 352 ...
##  $ PPFD_IN        : num  1078 889 1030 1292 750 ...
##  $ GPP_NT_VUT_REF : num  21.1 19.4 22.4 30.9 16.9 ...
##  $ SWC_F_MDS_1    : num  16.4 16.4 16.4 16.4 16.4 ...
##  $ SWC_F_MDS_2    : num  14.4 14.4 14.4 14.4 14.4 ...
##  $ SWC_F_MDS_3    : num  16.7 16.7 16.7 16.7 16.7 ...
##  $ WD             : num  244 252 248 249 256 ...
##  $ RH             : num  81.2 78.2 76.5 72.2 73.4 ...
##  $ NIGHT          : int  0 0 0 0 0 0 0 0 0 0 ...</code></pre>
<div class="sourceCode" id="cb959"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb959-1"><a href="ch-11.html#cb959-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Here we create a few variabels to reference different columns that might make preprocessing a little easier for us</span></span>
<span id="cb959-2"><a href="ch-11.html#cb959-2" aria-hidden="true" tabindex="-1"></a><span class="do">## Feel free to use or not use them in the subsequent steps; If you wish to use them, uncomment the lines below </span></span>
<span id="cb959-3"><a href="ch-11.html#cb959-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb959-4"><a href="ch-11.html#cb959-4" aria-hidden="true" tabindex="-1"></a>time_cols <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;TIMESTAMP_START&quot;</span>,<span class="st">&quot;TIMESTAMP_END&quot;</span>)</span>
<span id="cb959-5"><a href="ch-11.html#cb959-5" aria-hidden="true" tabindex="-1"></a>target_variable <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;GPP_NT_VUT_REF&quot;</span>)</span>
<span id="cb959-6"><a href="ch-11.html#cb959-6" aria-hidden="true" tabindex="-1"></a>column_names <span class="ot">&lt;-</span> <span class="fu">colnames</span>(df)</span>
<span id="cb959-7"><a href="ch-11.html#cb959-7" aria-hidden="true" tabindex="-1"></a>predictors <span class="ot">&lt;-</span> column_names[<span class="sc">!</span> column_names <span class="sc">%in%</span> <span class="fu">c</span>(target_variable, time_cols)] <span class="do">## time stamp columns and the target variables are not used as predictors</span></span></code></pre></div>
<p>Next, we create indices to split the entire dataset into train and test (80/20) split.</p>
<p>The 80% of our data will be used to train the models and the rest 20% will be our held-out test set to evaluate the performance of the model.</p>
<div class="sourceCode" id="cb960"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb960-1"><a href="ch-11.html#cb960-1" aria-hidden="true" tabindex="-1"></a><span class="do">## set seed for reproducibility </span></span>
<span id="cb960-2"><a href="ch-11.html#cb960-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">2020</span>)</span>
<span id="cb960-3"><a href="ch-11.html#cb960-3" aria-hidden="true" tabindex="-1"></a><span class="do">## First shuffle the dataset (Hint: sample() )</span></span>
<span id="cb960-4"><a href="ch-11.html#cb960-4" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> df[<span class="fu">sample</span>(<span class="fu">nrow</span>(df)),]</span>
<span id="cb960-5"><a href="ch-11.html#cb960-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb960-6"><a href="ch-11.html#cb960-6" aria-hidden="true" tabindex="-1"></a><span class="do">## get indices for train_data into train and test splits (Hint: sample() )</span></span>
<span id="cb960-7"><a href="ch-11.html#cb960-7" aria-hidden="true" tabindex="-1"></a>ind <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="dv">2</span>, <span class="fu">nrow</span>(df), <span class="at">replace=</span><span class="cn">TRUE</span>, <span class="at">prob =</span> <span class="fu">c</span>(<span class="fl">0.8</span>,<span class="fl">0.2</span>))</span>
<span id="cb960-8"><a href="ch-11.html#cb960-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb960-9"><a href="ch-11.html#cb960-9" aria-hidden="true" tabindex="-1"></a><span class="do">## Use the  indicies to get test and train splits</span></span>
<span id="cb960-10"><a href="ch-11.html#cb960-10" aria-hidden="true" tabindex="-1"></a>train_split <span class="ot">&lt;-</span> df[ind <span class="sc">==</span> <span class="dv">1</span>, ] <span class="do">## include all columns </span></span>
<span id="cb960-11"><a href="ch-11.html#cb960-11" aria-hidden="true" tabindex="-1"></a>test_split <span class="ot">&lt;-</span> df[ind <span class="sc">==</span> <span class="dv">2</span>, ]  <span class="do">## include all columns </span></span></code></pre></div>
<p>Next we separate the target variable from the predictors.</p>
<div class="sourceCode" id="cb961"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb961-1"><a href="ch-11.html#cb961-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Save time stamps for the test and train splits, as a separate data frame for time-series plots </span></span>
<span id="cb961-2"><a href="ch-11.html#cb961-2" aria-hidden="true" tabindex="-1"></a>train_data_time <span class="ot">&lt;-</span> train_split<span class="sc">$</span>TIMESTAMP_START</span>
<span id="cb961-3"><a href="ch-11.html#cb961-3" aria-hidden="true" tabindex="-1"></a>test_data_time <span class="ot">&lt;-</span> test_split<span class="sc">$</span>TIMESTAMP_START</span>
<span id="cb961-4"><a href="ch-11.html#cb961-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb961-5"><a href="ch-11.html#cb961-5" aria-hidden="true" tabindex="-1"></a><span class="do">## Separate the splits to get train_data, train_target, test_data and test_target. After this you should have 4 corresponding dataframes. Also drop the time stamp columns from the train data and test data as we treat the observations as IID. ( we have stored them separately for plots )</span></span>
<span id="cb961-6"><a href="ch-11.html#cb961-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb961-7"><a href="ch-11.html#cb961-7" aria-hidden="true" tabindex="-1"></a>train_target <span class="ot">&lt;-</span>  train_split <span class="sc">%&gt;%</span> <span class="fu">select</span>(target_variable)</span>
<span id="cb961-8"><a href="ch-11.html#cb961-8" aria-hidden="true" tabindex="-1"></a>test_target <span class="ot">&lt;-</span> test_split <span class="sc">%&gt;%</span> <span class="fu">select</span>(target_variable)</span>
<span id="cb961-9"><a href="ch-11.html#cb961-9" aria-hidden="true" tabindex="-1"></a>train_data <span class="ot">&lt;-</span> train_split <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">-</span><span class="fu">one_of</span>(<span class="fu">c</span>(target_variable, time_cols)))</span>
<span id="cb961-10"><a href="ch-11.html#cb961-10" aria-hidden="true" tabindex="-1"></a>test_data <span class="ot">&lt;-</span> test_split <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">-</span><span class="fu">one_of</span>(<span class="fu">c</span>(target_variable, time_cols)))</span></code></pre></div>
</div>
<div id="center-and-scale" class="section level3" number="11.2.3">
<h3><span class="header-section-number">11.2.3</span> Center and scale</h3>
<p>Take care to extract the centering and scaling parameters from the training set and use them to center and scale your test data.</p>
<p>If you use the entire data set to get the centering and scaling parameters, we actually use information from the test-data, which is something we don’t have access to in real life. Thus doing so results in <em>information leak</em> from the test data, and we may get results more optimistic than our model’s true predictions. Follow the steps below to carry out centering and scaling in a proper way:</p>
<ul>
<li>Extract normalisation parameters from train data for numeric predictors</li>
<li>Normalize train data using these parameters</li>
<li>Normalize test data using the parameters extracted from train data</li>
<li>Generally we only normalize the numeric variables and not the factors</li>
</ul>
<div class="sourceCode" id="cb962"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb962-1"><a href="ch-11.html#cb962-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Make use of recipe() or any other function you wish, to scale and center each of the columns</span></span>
<span id="cb962-2"><a href="ch-11.html#cb962-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb962-3"><a href="ch-11.html#cb962-3" aria-hidden="true" tabindex="-1"></a>train_data_stat <span class="ot">&lt;-</span> <span class="fu">preProcess</span>(train_data, <span class="at">method =</span> <span class="fu">c</span>(<span class="st">&quot;center&quot;</span>,<span class="st">&quot;scale&quot;</span>))    <span class="co"># get the statistics (mean, variance, etc) of numeric cols</span></span>
<span id="cb962-4"><a href="ch-11.html#cb962-4" aria-hidden="true" tabindex="-1"></a>train_data[, predictors] <span class="ot">&lt;-</span> <span class="fu">predict</span>(train_data_stat, train_data)  <span class="co"># transform the train data to center and scale it</span></span>
<span id="cb962-5"><a href="ch-11.html#cb962-5" aria-hidden="true" tabindex="-1"></a>test_data[, predictors] <span class="ot">&lt;-</span> <span class="fu">predict</span>(train_data_stat, test_data)    <span class="co"># transform the test data to center and scale it</span></span>
<span id="cb962-6"><a href="ch-11.html#cb962-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb962-7"><a href="ch-11.html#cb962-7" aria-hidden="true" tabindex="-1"></a><span class="co"># OR </span></span>
<span id="cb962-8"><a href="ch-11.html#cb962-8" aria-hidden="true" tabindex="-1"></a><span class="co"># scale_and_center&lt;- recipe(train_data) %&gt;%</span></span>
<span id="cb962-9"><a href="ch-11.html#cb962-9" aria-hidden="true" tabindex="-1"></a><span class="co">#                             step_center(all_numeric()) %&gt;%</span></span>
<span id="cb962-10"><a href="ch-11.html#cb962-10" aria-hidden="true" tabindex="-1"></a><span class="co">#                             step_scale(all_numeric())</span></span>
<span id="cb962-11"><a href="ch-11.html#cb962-11" aria-hidden="true" tabindex="-1"></a><span class="co"># prep_recipe &lt;- prep(scale_and_center, training = train_data)</span></span>
<span id="cb962-12"><a href="ch-11.html#cb962-12" aria-hidden="true" tabindex="-1"></a><span class="co"># train_data &lt;- bake(prep_recipe, new_data = train_data)</span></span>
<span id="cb962-13"><a href="ch-11.html#cb962-13" aria-hidden="true" tabindex="-1"></a><span class="co"># test_data &lt;- bake(prep_recipe, new_data = test_data)</span></span>
<span id="cb962-14"><a href="ch-11.html#cb962-14" aria-hidden="true" tabindex="-1"></a><span class="do">## Display the summary of train data and test data</span></span>
<span id="cb962-15"><a href="ch-11.html#cb962-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb962-16"><a href="ch-11.html#cb962-16" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(train_data)</span></code></pre></div>
<pre><code>##       TA_F              SW_IN_F           LW_IN_F            VPD_F        
##  Min.   :-3.060457   Min.   :-0.5789   Min.   :-3.5661   Min.   :-0.7796  
##  1st Qu.:-0.780679   1st Qu.:-0.5789   1st Qu.:-0.6326   1st Qu.:-0.7324  
##  Median : 0.009549   Median :-0.5699   Median : 0.1346   Median :-0.3835  
##  Mean   : 0.000000   Mean   : 0.0000   Mean   : 0.0000   Mean   : 0.0000  
##  3rd Qu.: 0.754696   3rd Qu.: 0.1320   3rd Qu.: 0.7059   3rd Qu.: 0.3525  
##  Max.   : 2.913139   Max.   : 4.1296   Max.   : 2.5089   Max.   : 7.6274  
##       PA_F              P_F                WS_F           CO2_F_MDS       
##  Min.   :-5.0145   Min.   :-0.42423   Min.   :-1.3771   Min.   :-3.25904  
##  1st Qu.:-0.5387   1st Qu.:-0.42423   1st Qu.:-0.7413   1st Qu.:-0.45944  
##  Median : 0.1125   Median :-0.42423   Median :-0.2449   Median :-0.17508  
##  Mean   : 0.0000   Mean   : 0.00000   Mean   : 0.0000   Mean   : 0.00000  
##  3rd Qu.: 0.6665   3rd Qu.:-0.05758   3rd Qu.: 0.4887   3rd Qu.: 0.09885  
##  Max.   : 2.8018   Max.   :22.82538   Max.   : 5.8574   Max.   :10.75816  
##     PPFD_IN         SWC_F_MDS_1        SWC_F_MDS_2       SWC_F_MDS_3      
##  Min.   :-0.5762   Min.   :-3.05457   Min.   :-2.7359   Min.   :-2.85562  
##  1st Qu.:-0.5747   1st Qu.:-0.65643   1st Qu.:-0.9232   1st Qu.:-0.73051  
##  Median :-0.5703   Median :-0.07342   Median : 0.1761   Median : 0.09538  
##  Mean   : 0.0000   Mean   : 0.00000   Mean   : 0.0000   Mean   : 0.00000  
##  3rd Qu.: 0.1094   3rd Qu.: 0.75978   3rd Qu.: 0.8025   3rd Qu.: 0.76656  
##  Max.   : 3.9780   Max.   : 2.53661   Max.   : 2.5792   Max.   : 3.08002  
##        WD                RH              NIGHT        
##  Min.   :-2.2394   Min.   :-3.3916   Min.   :-0.9929  
##  1st Qu.:-1.0374   1st Qu.:-0.7089   1st Qu.:-0.9929  
##  Median : 0.4765   Median : 0.1596   Median :-0.9929  
##  Mean   : 0.0000   Mean   : 0.0000   Mean   : 0.0000  
##  3rd Qu.: 0.8454   3rd Qu.: 0.9760   3rd Qu.: 1.0072  
##  Max.   : 2.0289   Max.   : 1.1513   Max.   : 1.0072</code></pre>
<div class="sourceCode" id="cb964"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb964-1"><a href="ch-11.html#cb964-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(test_data)</span></code></pre></div>
<pre><code>##       TA_F              SW_IN_F             LW_IN_F         
##  Min.   :-3.070392   Min.   :-0.578946   Min.   :-3.552293  
##  1st Qu.:-0.779717   1st Qu.:-0.578946   1st Qu.:-0.627825  
##  Median : 0.009549   Median :-0.570013   Median : 0.130448  
##  Mean   :-0.001176   Mean   :-0.005419   Mean   : 0.003758  
##  3rd Qu.: 0.744761   3rd Qu.: 0.123708   3rd Qu.: 0.708232  
##  Max.   : 2.874640   Max.   : 4.016686   Max.   : 2.440105  
##      VPD_F                PA_F               P_F                 WS_F         
##  Min.   :-0.779555   Min.   :-4.91526   Min.   :-0.424230   Min.   :-1.37322  
##  1st Qu.:-0.730726   1st Qu.:-0.55369   1st Qu.:-0.424230   1st Qu.:-0.74022  
##  Median :-0.385253   Median : 0.10027   Median :-0.424230   Median :-0.24598  
##  Mean   :-0.004544   Mean   :-0.01492   Mean   :-0.000549   Mean   : 0.00082  
##  3rd Qu.: 0.341994   3rd Qu.: 0.65363   3rd Qu.:-0.064126   3rd Qu.: 0.48985  
##  Max.   : 7.529397   Max.   : 2.76643   Max.   :18.170222   Max.   : 5.94527  
##    CO2_F_MDS            PPFD_IN           SWC_F_MDS_1       
##  Min.   :-3.295506   Min.   :-0.576178   Min.   :-3.054568  
##  1st Qu.:-0.458830   1st Qu.:-0.574746   1st Qu.:-0.651968  
##  Median :-0.177207   Median :-0.570787   Median :-0.071414  
##  Mean   :-0.009249   Mean   :-0.004924   Mean   : 0.001539  
##  3rd Qu.: 0.088947   3rd Qu.: 0.099883   3rd Qu.: 0.756992  
##  Max.   : 8.781045   Max.   : 3.956999   Max.   : 2.498653  
##   SWC_F_MDS_2         SWC_F_MDS_3              WD           
##  Min.   :-2.745440   Min.   :-2.852743   Min.   :-2.238485  
##  1st Qu.:-0.914273   1st Qu.:-0.739137   1st Qu.:-1.042938  
##  Median : 0.192258   Median : 0.103430   Median : 0.464562  
##  Mean   : 0.003838   Mean   : 0.005371   Mean   :-0.003873  
##  3rd Qu.: 0.811308   3rd Qu.: 0.769719   3rd Qu.: 0.845376  
##  Max.   : 2.601783   Max.   : 2.841916   Max.   : 2.029098  
##        RH                NIGHT          
##  Min.   :-3.377916   Min.   :-0.992870  
##  1st Qu.:-0.703431   1st Qu.:-0.992870  
##  Median : 0.165051   Median :-0.992870  
##  Mean   : 0.003356   Mean   : 0.004844  
##  3rd Qu.: 0.970520   3rd Qu.: 1.007173  
##  Max.   : 1.151339   Max.   : 1.007173</code></pre>
<p>Are all of the columns in the training set are centered perfectly with a mean = 0.0000? Yes!
Are all of the columns in the testing set are centered perfectly with a mean = 0.0000? No!</p>
<p>Explanation: This is because the mean of the training set is used to center it, thus that is centered perfectly. Using the statistics of the train data, we centered the test data, thus we can see the data is not exactly centered, but it is normalized enough to bring all features to 1 scale and to not affect the predictions at test time.</p>
</div>
<div id="building-a-simple-model-with-keras-subtask-1" class="section level3" number="11.2.4">
<h3><span class="header-section-number">11.2.4</span> Building a simple model with keras ( SubTask 1)</h3>
<p>To train keras models, the input data needs to be as a R matrix or arrays. Since all our featues are numeric, we can safely convert the train and test datasets to matrices.</p>
<div class="sourceCode" id="cb966"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb966-1"><a href="ch-11.html#cb966-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Convert the &quot;train_data&quot;, &quot;train_targets&quot;, &quot;test_data&quot; and &quot;test_targets&quot;, to matrix using as.matrix()  </span></span>
<span id="cb966-2"><a href="ch-11.html#cb966-2" aria-hidden="true" tabindex="-1"></a>train_data <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(train_data)</span>
<span id="cb966-3"><a href="ch-11.html#cb966-3" aria-hidden="true" tabindex="-1"></a>train_target <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(train_target)</span>
<span id="cb966-4"><a href="ch-11.html#cb966-4" aria-hidden="true" tabindex="-1"></a>test_data <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(test_data)</span>
<span id="cb966-5"><a href="ch-11.html#cb966-5" aria-hidden="true" tabindex="-1"></a>test_target <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(test_target)</span></code></pre></div>
<p>Now we can build a sequential model with keras. Define a model with 1 hidden layer with 20 units, and 1 output unit, for the target variable. Remember to specify a non-linear activation such as Sigmoid or ReLU for the hidden layer, and a linear activation function for the output unit (as it is a regression task). If we don’t specify a non-linear activation we will just be training a linear mapping!
When compliling the model take care to use appropriate optimiser, loss and evaluation metric. Use mean squared error as the loss, and mean absolute error as the evaluation metric</p>
<p><em>Side Note</em>: Since our model is not very deep in this application (only 1 hidden layer), we can use any of the non-linear activations (tanh, sigmoid, or ReLu), but in practice when we train deep neural networks (with a large number of hidden layers) we prefer to use ReLU as the activation function, as it does not suffer from the problem of Vanishing or Exploding gradients (which happens if we use sigmoid or tanh). In a nutshell : In a network of n hidden layers, n derivatives will be multiplied together. If the derivatives are large then the gradient will increase exponentially as we propagate down the model until they eventually explode, and this is what we call the problem of exploding gradient. Alternatively, if the derivatives are small then the gradient will decrease exponentially as we propagate through the model until it eventually vanishes, and this is the vanishing gradient problem. [Source for the interested] (<a href="https://towardsdatascience.com/the-vanishing-exploding-gradient-problem-in-deep-neural-networks-191358470c11" class="uri">https://towardsdatascience.com/the-vanishing-exploding-gradient-problem-in-deep-neural-networks-191358470c11</a>).</p>
<div class="sourceCode" id="cb967"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb967-1"><a href="ch-11.html#cb967-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Define and compile the model </span></span>
<span id="cb967-2"><a href="ch-11.html#cb967-2" aria-hidden="true" tabindex="-1"></a>model <span class="ot">&lt;-</span> <span class="fu">keras_model_sequential</span>()</span>
<span id="cb967-3"><a href="ch-11.html#cb967-3" aria-hidden="true" tabindex="-1"></a>model <span class="sc">%&gt;%</span> </span>
<span id="cb967-4"><a href="ch-11.html#cb967-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">layer_dense</span>(<span class="at">units =</span> <span class="dv">20</span>, <span class="at">activation =</span> <span class="st">&#39;relu&#39;</span>, <span class="at">input_shape =</span> <span class="fu">ncol</span>(train_data)) <span class="sc">%&gt;%</span></span>
<span id="cb967-5"><a href="ch-11.html#cb967-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">layer_dense</span>(<span class="at">units =</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb967-6"><a href="ch-11.html#cb967-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">compile</span>( <span class="at">optimizer =</span> <span class="fu">optimizer_adam</span>(<span class="at">lr=</span><span class="fl">0.001</span>),</span>
<span id="cb967-7"><a href="ch-11.html#cb967-7" aria-hidden="true" tabindex="-1"></a>           <span class="at">loss =</span> <span class="st">&#39;mse&#39;</span>,</span>
<span id="cb967-8"><a href="ch-11.html#cb967-8" aria-hidden="true" tabindex="-1"></a>           <span class="at">metrics =</span> <span class="fu">list</span>(<span class="st">&#39;mae&#39;</span>))</span>
<span id="cb967-9"><a href="ch-11.html#cb967-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb967-10"><a href="ch-11.html#cb967-10" aria-hidden="true" tabindex="-1"></a><span class="do">## Print the summary of the model using summary()</span></span>
<span id="cb967-11"><a href="ch-11.html#cb967-11" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model)</span></code></pre></div>
<div class="sourceCode" id="cb968"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb968-1"><a href="ch-11.html#cb968-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Model: &quot;sequential&quot;</span></span>
<span id="cb968-2"><a href="ch-11.html#cb968-2" aria-hidden="true" tabindex="-1"></a><span class="do">## ________________________________________________________________________________</span></span>
<span id="cb968-3"><a href="ch-11.html#cb968-3" aria-hidden="true" tabindex="-1"></a><span class="do">## Layer (type)                        Output Shape                    Param #     </span></span>
<span id="cb968-4"><a href="ch-11.html#cb968-4" aria-hidden="true" tabindex="-1"></a><span class="do">## ================================================================================</span></span>
<span id="cb968-5"><a href="ch-11.html#cb968-5" aria-hidden="true" tabindex="-1"></a><span class="do">## dense (Dense)                       (None, 20)                      320         </span></span>
<span id="cb968-6"><a href="ch-11.html#cb968-6" aria-hidden="true" tabindex="-1"></a><span class="do">## ________________________________________________________________________________</span></span>
<span id="cb968-7"><a href="ch-11.html#cb968-7" aria-hidden="true" tabindex="-1"></a><span class="do">## dense_1 (Dense)                     (None, 1)                       21          </span></span>
<span id="cb968-8"><a href="ch-11.html#cb968-8" aria-hidden="true" tabindex="-1"></a><span class="do">## ================================================================================</span></span>
<span id="cb968-9"><a href="ch-11.html#cb968-9" aria-hidden="true" tabindex="-1"></a><span class="do">## Total params: 341</span></span>
<span id="cb968-10"><a href="ch-11.html#cb968-10" aria-hidden="true" tabindex="-1"></a><span class="do">## Trainable params: 341</span></span>
<span id="cb968-11"><a href="ch-11.html#cb968-11" aria-hidden="true" tabindex="-1"></a><span class="do">## Non-trainable params: 0</span></span>
<span id="cb968-12"><a href="ch-11.html#cb968-12" aria-hidden="true" tabindex="-1"></a><span class="do">## ________________________________________________________________________________</span></span></code></pre></div>
<p>How many training parameters are needed? Can you account for the total number of parameters at each layer?
The network needs 341 parameters. These are split as Layer 1: 320 parameters – (20x15) weight and (20x1) bias matrix, and Layer 2: 21 parameters – (20x1) weight matrix and (1x1) bias unit.</p>
<div class="sourceCode" id="cb969"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb969-1"><a href="ch-11.html#cb969-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Fit the model and store the training history. Use a reasonable batch_size, epochs, and validation_split</span></span>
<span id="cb969-2"><a href="ch-11.html#cb969-2" aria-hidden="true" tabindex="-1"></a><span class="do">## The validation split here is a portion of the training data that is kept apart to evaluate the loss and evaluation metric at the end of each epoch. The model will set apart this fraction of the training data, will not train on it, and will evaluate the loss and any model metrics on this data at the end of each epoch. The validation data is selected from the last samples in the x and y data provided, before shuffling. This is useful for stopping training after a certain number of epochs if we see the validation error increasing with training. We can also program the model to do so, this is called Early Stopping. </span></span>
<span id="cb969-3"><a href="ch-11.html#cb969-3" aria-hidden="true" tabindex="-1"></a><span class="do">## This can be done by using a training callback for early stopping: callback_early_stopping()</span></span>
<span id="cb969-4"><a href="ch-11.html#cb969-4" aria-hidden="true" tabindex="-1"></a><span class="do">## More info on training callbacks: https://keras.rstudio.com/articles/training_callbacks.html</span></span>
<span id="cb969-5"><a href="ch-11.html#cb969-5" aria-hidden="true" tabindex="-1"></a><span class="do">## More info on the fit function https://keras.rstudio.com/reference/fit.html</span></span>
<span id="cb969-6"><a href="ch-11.html#cb969-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb969-7"><a href="ch-11.html#cb969-7" aria-hidden="true" tabindex="-1"></a><span class="do">## You can choose the number of epochs to train, manually by monitoring the validation loss while training and selecting the number of epochs where the validation loss starts to increase. Alternatively you can use early stopping to pause the model training at an optimal point for you. Choose whatever method you feel is best! </span></span>
<span id="cb969-8"><a href="ch-11.html#cb969-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb969-9"><a href="ch-11.html#cb969-9" aria-hidden="true" tabindex="-1"></a>history <span class="ot">&lt;-</span> <span class="fu">fit</span>(</span>
<span id="cb969-10"><a href="ch-11.html#cb969-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">object           =</span> model, </span>
<span id="cb969-11"><a href="ch-11.html#cb969-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">x                =</span> train_data, </span>
<span id="cb969-12"><a href="ch-11.html#cb969-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">y                =</span> train_target,</span>
<span id="cb969-13"><a href="ch-11.html#cb969-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">batch_size       =</span> <span class="dv">128</span>, </span>
<span id="cb969-14"><a href="ch-11.html#cb969-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">validation_split =</span> <span class="fl">0.15</span>, </span>
<span id="cb969-15"><a href="ch-11.html#cb969-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">epochs =</span> <span class="dv">50</span>,</span>
<span id="cb969-16"><a href="ch-11.html#cb969-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">shuffle =</span> <span class="cn">TRUE</span>, </span>
<span id="cb969-17"><a href="ch-11.html#cb969-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">callbacks =</span> <span class="fu">list</span>(<span class="fu">callback_early_stopping</span>( <span class="at">monitor =</span> <span class="st">&quot;val_loss&quot;</span>,  <span class="at">patience =</span> <span class="dv">0</span>))</span>
<span id="cb969-18"><a href="ch-11.html#cb969-18" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb969-19"><a href="ch-11.html#cb969-19" aria-hidden="true" tabindex="-1"></a><span class="do">##  Patience : number of epochs with no improvement after which training will be stopped.</span></span></code></pre></div>
<p>Now that the model training is complete we can look at the history, plot the training history, and look at our trained weights. Pay attention to the trained weight matrices and try to recoginse the transformation weights and the bias units.</p>
<div class="sourceCode" id="cb970"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb970-1"><a href="ch-11.html#cb970-1" aria-hidden="true" tabindex="-1"></a><span class="co"># print(history)</span></span>
<span id="cb970-2"><a href="ch-11.html#cb970-2" aria-hidden="true" tabindex="-1"></a><span class="co"># plot history </span></span>
<span id="cb970-3"><a href="ch-11.html#cb970-3" aria-hidden="true" tabindex="-1"></a><span class="co"># plot(history, metrics = c(&quot;loss&quot;), smooth = getOption(&quot;keras.plot.history.smooth&quot;, TRUE))</span></span>
<span id="cb970-4"><a href="ch-11.html#cb970-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb970-5"><a href="ch-11.html#cb970-5" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(history, <span class="at">smooth =</span> <span class="fu">getOption</span>(<span class="st">&quot;keras.plot.history.smooth&quot;</span>, <span class="cn">TRUE</span>))</span>
<span id="cb970-6"><a href="ch-11.html#cb970-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb970-7"><a href="ch-11.html#cb970-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Get weights of model</span></span>
<span id="cb970-8"><a href="ch-11.html#cb970-8" aria-hidden="true" tabindex="-1"></a><span class="fu">get_weights</span>(model)</span></code></pre></div>
<p><img src="figures/11_output-history.png" /></p>
<div class="sourceCode" id="cb971"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb971-1"><a href="ch-11.html#cb971-1" aria-hidden="true" tabindex="-1"></a><span class="do">## [[1]]</span></span>
<span id="cb971-2"><a href="ch-11.html#cb971-2" aria-hidden="true" tabindex="-1"></a><span class="do">##               [,1]        [,2]        [,3]        [,4]       [,5]       [,6]</span></span>
<span id="cb971-3"><a href="ch-11.html#cb971-3" aria-hidden="true" tabindex="-1"></a><span class="do">##  [1,]  2.869463682  2.19894099 -2.60152483  0.51017755  8.1782951 -0.1264951</span></span>
<span id="cb971-4"><a href="ch-11.html#cb971-4" aria-hidden="true" tabindex="-1"></a><span class="do">##  [2,] -0.257749677 -6.38722610 -0.26673290  0.12389217  1.9635506  5.5812244</span></span>
<span id="cb971-5"><a href="ch-11.html#cb971-5" aria-hidden="true" tabindex="-1"></a><span class="do">##  [3,] -0.810692906 -0.22325119  3.41061616  1.36443913  1.3101629  9.2959471</span></span>
<span id="cb971-6"><a href="ch-11.html#cb971-6" aria-hidden="true" tabindex="-1"></a><span class="do">##  [4,] -3.332208872 -3.74554729  0.69165123 -2.23075891  1.1527030 -7.5465598</span></span>
<span id="cb971-7"><a href="ch-11.html#cb971-7" aria-hidden="true" tabindex="-1"></a><span class="do">##  [5,]  0.009921599 -0.57942855  0.06560050  0.35118413  1.8717020  0.5662153</span></span>
<span id="cb971-8"><a href="ch-11.html#cb971-8" aria-hidden="true" tabindex="-1"></a><span class="do">##  [6,] -0.639508903 -0.51970196 -7.03948593 -0.35604978 -1.0026512  0.5032421</span></span>
<span id="cb971-9"><a href="ch-11.html#cb971-9" aria-hidden="true" tabindex="-1"></a><span class="do">##  [7,]  0.117622830  0.18488406 -0.07820407 -0.74191588  0.4872454  1.5795393</span></span>
<span id="cb971-10"><a href="ch-11.html#cb971-10" aria-hidden="true" tabindex="-1"></a><span class="do">##  [8,] -1.078623652  0.32196170 -0.07609604 -0.92650974 -2.3898470  1.1969419</span></span>
<span id="cb971-11"><a href="ch-11.html#cb971-11" aria-hidden="true" tabindex="-1"></a><span class="do">##  [9,] -0.291276693 -7.54775238 -0.15960379 -0.36234933  2.0654554 -0.3033638</span></span>
<span id="cb971-12"><a href="ch-11.html#cb971-12" aria-hidden="true" tabindex="-1"></a><span class="do">## [10,] -0.354794204  0.27889904 -1.32088995 -0.26132381  6.1111360 -0.0110246</span></span>
<span id="cb971-13"><a href="ch-11.html#cb971-13" aria-hidden="true" tabindex="-1"></a><span class="do">## [11,] -0.075735129 -0.51960874 -1.08324683  1.22804534 -9.2768269 -0.3711588</span></span>
<span id="cb971-14"><a href="ch-11.html#cb971-14" aria-hidden="true" tabindex="-1"></a><span class="do">## [12,]  0.058648713  0.01862233  1.23881853  0.08873922  0.6291698 -0.2280734</span></span>
<span id="cb971-15"><a href="ch-11.html#cb971-15" aria-hidden="true" tabindex="-1"></a><span class="do">## [13,] -0.219447121  0.06975523 -0.28102785  0.84798932  0.1717782  5.7479606</span></span>
<span id="cb971-16"><a href="ch-11.html#cb971-16" aria-hidden="true" tabindex="-1"></a><span class="do">## [14,] -0.777138412 -2.31531525  7.50002480 -2.60044813  7.6696396 -6.5305896</span></span>
<span id="cb971-17"><a href="ch-11.html#cb971-17" aria-hidden="true" tabindex="-1"></a><span class="do">## [15,] -1.614494205 -0.05201649 -0.51413023 -0.94068855 -2.0706074 -3.8512673</span></span>
<span id="cb971-18"><a href="ch-11.html#cb971-18" aria-hidden="true" tabindex="-1"></a><span class="do">##              [,7]         [,8]         [,9]       [,10]       [,11]</span></span>
<span id="cb971-19"><a href="ch-11.html#cb971-19" aria-hidden="true" tabindex="-1"></a><span class="do">##  [1,]  0.04682195 -0.052829422  1.172855377  6.30979824  0.52859932</span></span>
<span id="cb971-20"><a href="ch-11.html#cb971-20" aria-hidden="true" tabindex="-1"></a><span class="do">##  [2,] -0.22194999 -0.243081853 -2.264952421  3.04037237 -0.95039535</span></span>
<span id="cb971-21"><a href="ch-11.html#cb971-21" aria-hidden="true" tabindex="-1"></a><span class="do">##  [3,]  0.14613368  0.332655936  0.491766244  4.90739346 -0.50222224</span></span>
<span id="cb971-22"><a href="ch-11.html#cb971-22" aria-hidden="true" tabindex="-1"></a><span class="do">##  [4,]  0.05983398 -0.335039854 -2.523161650 -4.82348061 -0.73482287</span></span>
<span id="cb971-23"><a href="ch-11.html#cb971-23" aria-hidden="true" tabindex="-1"></a><span class="do">##  [5,]  0.20005836 -0.089846745  0.515249848 -0.01903337  0.29309896</span></span>
<span id="cb971-24"><a href="ch-11.html#cb971-24" aria-hidden="true" tabindex="-1"></a><span class="do">##  [6,] -0.76276135 -0.172726154  0.191874042  1.01086140 -0.50880861</span></span>
<span id="cb971-25"><a href="ch-11.html#cb971-25" aria-hidden="true" tabindex="-1"></a><span class="do">##  [7,] -0.27699345  0.031146886 -0.068503618 -1.35167754 -0.09551523</span></span>
<span id="cb971-26"><a href="ch-11.html#cb971-26" aria-hidden="true" tabindex="-1"></a><span class="do">##  [8,] -0.19921121 -0.050250128 -1.608266592 -1.96596658 -0.53051108</span></span>
<span id="cb971-27"><a href="ch-11.html#cb971-27" aria-hidden="true" tabindex="-1"></a><span class="do">##  [9,] -0.29272005 -0.153516173 -1.579962850  1.97364700 -1.06721187</span></span>
<span id="cb971-28"><a href="ch-11.html#cb971-28" aria-hidden="true" tabindex="-1"></a><span class="do">## [10,] -0.35709265 -0.048273247  0.995545089 -1.33178234  0.56702429</span></span>
<span id="cb971-29"><a href="ch-11.html#cb971-29" aria-hidden="true" tabindex="-1"></a><span class="do">## [11,] -0.38769460  0.195704937  1.311706424  1.23969197  0.12406404</span></span>
<span id="cb971-30"><a href="ch-11.html#cb971-30" aria-hidden="true" tabindex="-1"></a><span class="do">## [12,]  0.48858991 -0.010217057  0.085440978 -0.37758657  0.27877322</span></span>
<span id="cb971-31"><a href="ch-11.html#cb971-31" aria-hidden="true" tabindex="-1"></a><span class="do">## [13,] -0.09290090  0.005608748  0.484116018 -1.63200808  0.39846551</span></span>
<span id="cb971-32"><a href="ch-11.html#cb971-32" aria-hidden="true" tabindex="-1"></a><span class="do">## [14,]  0.25080982 -0.011659722 -1.215049624 -1.07155561 -0.32186502</span></span>
<span id="cb971-33"><a href="ch-11.html#cb971-33" aria-hidden="true" tabindex="-1"></a><span class="do">## [15,] -0.06362370  0.235450491  0.007811341 -8.73015308 -0.52522039</span></span>
<span id="cb971-34"><a href="ch-11.html#cb971-34" aria-hidden="true" tabindex="-1"></a><span class="do">##              [,12]        [,13]      [,14]       [,15]        [,16]       [,17]</span></span>
<span id="cb971-35"><a href="ch-11.html#cb971-35" aria-hidden="true" tabindex="-1"></a><span class="do">##  [1,] -0.711098015 -0.155946359 -5.3655915   7.3770199  0.293657303 -0.19214493</span></span>
<span id="cb971-36"><a href="ch-11.html#cb971-36" aria-hidden="true" tabindex="-1"></a><span class="do">##  [2,] -0.365851760  0.089299537  1.3707904  -5.9960160 -0.127565414 -0.53482211</span></span>
<span id="cb971-37"><a href="ch-11.html#cb971-37" aria-hidden="true" tabindex="-1"></a><span class="do">##  [3,]  0.055914585 -0.007191619 -2.1241577   4.7871284 -0.239663601 -0.07870594</span></span>
<span id="cb971-38"><a href="ch-11.html#cb971-38" aria-hidden="true" tabindex="-1"></a><span class="do">##  [4,] -0.827158570  0.168920189 -4.2775497  -7.5697961  0.079768963 -0.42832005</span></span>
<span id="cb971-39"><a href="ch-11.html#cb971-39" aria-hidden="true" tabindex="-1"></a><span class="do">##  [5,] -0.786235392 -0.258505225 -0.2865027  -0.2799671 -0.104162373 -0.08785495</span></span>
<span id="cb971-40"><a href="ch-11.html#cb971-40" aria-hidden="true" tabindex="-1"></a><span class="do">##  [6,] -0.007873034 -0.371807247 -4.7030549   0.5258003 -0.060212884 -0.01263460</span></span>
<span id="cb971-41"><a href="ch-11.html#cb971-41" aria-hidden="true" tabindex="-1"></a><span class="do">##  [7,]  0.003547309 -0.341258347  5.6166472  -1.9062901 -0.028141027  0.04434934</span></span>
<span id="cb971-42"><a href="ch-11.html#cb971-42" aria-hidden="true" tabindex="-1"></a><span class="do">##  [8,] -0.368607908 -0.188798785 -2.9444225  -1.5065690  0.002863772 -0.20875025</span></span>
<span id="cb971-43"><a href="ch-11.html#cb971-43" aria-hidden="true" tabindex="-1"></a><span class="do">##  [9,] -0.495464146  0.092135318  2.9440861  -4.1805649 -0.266763061 -0.20316155</span></span>
<span id="cb971-44"><a href="ch-11.html#cb971-44" aria-hidden="true" tabindex="-1"></a><span class="do">## [10,] -0.042366728 -0.102412179  0.4786149  -0.9693843  0.136674106 -0.17017232</span></span>
<span id="cb971-45"><a href="ch-11.html#cb971-45" aria-hidden="true" tabindex="-1"></a><span class="do">## [11,] -0.495398074 -0.109507836  1.6707268   1.7287951 -0.145421311  0.10051851</span></span>
<span id="cb971-46"><a href="ch-11.html#cb971-46" aria-hidden="true" tabindex="-1"></a><span class="do">## [12,] -0.254084796  0.439668804  2.7467921  -1.3010908  0.075597413  0.29256424</span></span>
<span id="cb971-47"><a href="ch-11.html#cb971-47" aria-hidden="true" tabindex="-1"></a><span class="do">## [13,] -0.634631693  0.172714919  1.5466242  -1.5283233  0.020010771 -0.13009861</span></span>
<span id="cb971-48"><a href="ch-11.html#cb971-48" aria-hidden="true" tabindex="-1"></a><span class="do">## [14,]  0.059612643  0.105869599 -6.3877649  -1.9179984 -0.045273066 -0.40067214</span></span>
<span id="cb971-49"><a href="ch-11.html#cb971-49" aria-hidden="true" tabindex="-1"></a><span class="do">## [15,]  0.231342480 -0.376736462 -1.6059383 -10.0494280 -0.094165772  0.14342698</span></span>
<span id="cb971-50"><a href="ch-11.html#cb971-50" aria-hidden="true" tabindex="-1"></a><span class="do">##             [,18]       [,19]      [,20]</span></span>
<span id="cb971-51"><a href="ch-11.html#cb971-51" aria-hidden="true" tabindex="-1"></a><span class="do">##  [1,]   5.5032167 -0.46716672 -0.6539110</span></span>
<span id="cb971-52"><a href="ch-11.html#cb971-52" aria-hidden="true" tabindex="-1"></a><span class="do">##  [2,]   1.9781926 -0.42978939  0.3046646</span></span>
<span id="cb971-53"><a href="ch-11.html#cb971-53" aria-hidden="true" tabindex="-1"></a><span class="do">##  [3,]   0.1271483  0.47976965 -0.2256196</span></span>
<span id="cb971-54"><a href="ch-11.html#cb971-54" aria-hidden="true" tabindex="-1"></a><span class="do">##  [4,] -12.0853949 -0.80036938  0.4287973</span></span>
<span id="cb971-55"><a href="ch-11.html#cb971-55" aria-hidden="true" tabindex="-1"></a><span class="do">##  [5,]   0.9761505 -0.22349076  0.2876348</span></span>
<span id="cb971-56"><a href="ch-11.html#cb971-56" aria-hidden="true" tabindex="-1"></a><span class="do">##  [6,]  -2.0184972 -0.84300071 -0.2434829</span></span>
<span id="cb971-57"><a href="ch-11.html#cb971-57" aria-hidden="true" tabindex="-1"></a><span class="do">##  [7,]  -2.3686037  0.22000718 -0.4334196</span></span>
<span id="cb971-58"><a href="ch-11.html#cb971-58" aria-hidden="true" tabindex="-1"></a><span class="do">##  [8,]  -6.2144308 -0.28150293 -0.5173919</span></span>
<span id="cb971-59"><a href="ch-11.html#cb971-59" aria-hidden="true" tabindex="-1"></a><span class="do">##  [9,]   0.8613948 -0.59269583  0.3008582</span></span>
<span id="cb971-60"><a href="ch-11.html#cb971-60" aria-hidden="true" tabindex="-1"></a><span class="do">## [10,]   0.1340202  0.15566082  0.1325917</span></span>
<span id="cb971-61"><a href="ch-11.html#cb971-61" aria-hidden="true" tabindex="-1"></a><span class="do">## [11,]   0.9494711 -0.08530131  0.1096366</span></span>
<span id="cb971-62"><a href="ch-11.html#cb971-62" aria-hidden="true" tabindex="-1"></a><span class="do">## [12,]   0.4856019  0.75556695  0.5051430</span></span>
<span id="cb971-63"><a href="ch-11.html#cb971-63" aria-hidden="true" tabindex="-1"></a><span class="do">## [13,]  -1.7481350 -0.40033895  0.7129067</span></span>
<span id="cb971-64"><a href="ch-11.html#cb971-64" aria-hidden="true" tabindex="-1"></a><span class="do">## [14,]  -5.9514213 -0.21660900  0.1049089</span></span>
<span id="cb971-65"><a href="ch-11.html#cb971-65" aria-hidden="true" tabindex="-1"></a><span class="do">## [15,]  -2.7778580  0.19276462 -0.3107617</span></span>
<span id="cb971-66"><a href="ch-11.html#cb971-66" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb971-67"><a href="ch-11.html#cb971-67" aria-hidden="true" tabindex="-1"></a><span class="do">## [[2]]</span></span>
<span id="cb971-68"><a href="ch-11.html#cb971-68" aria-hidden="true" tabindex="-1"></a><span class="do">##  [1]  -9.184246   1.047771 -20.209112  -8.611093 -19.685486 -16.133827</span></span>
<span id="cb971-69"><a href="ch-11.html#cb971-69" aria-hidden="true" tabindex="-1"></a><span class="do">##  [7]  -2.834236  -1.757904 -15.453846  -6.230545  -7.671953  -6.257191</span></span>
<span id="cb971-70"><a href="ch-11.html#cb971-70" aria-hidden="true" tabindex="-1"></a><span class="do">## [13]  -2.829708 -21.390947 -14.927919  -1.536069  -2.516061 -11.184190</span></span>
<span id="cb971-71"><a href="ch-11.html#cb971-71" aria-hidden="true" tabindex="-1"></a><span class="do">## [19]  -5.883048  -4.925455</span></span>
<span id="cb971-72"><a href="ch-11.html#cb971-72" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb971-73"><a href="ch-11.html#cb971-73" aria-hidden="true" tabindex="-1"></a><span class="do">## [[3]]</span></span>
<span id="cb971-74"><a href="ch-11.html#cb971-74" aria-hidden="true" tabindex="-1"></a><span class="do">##              [,1]</span></span>
<span id="cb971-75"><a href="ch-11.html#cb971-75" aria-hidden="true" tabindex="-1"></a><span class="do">##  [1,]  0.47884747</span></span>
<span id="cb971-76"><a href="ch-11.html#cb971-76" aria-hidden="true" tabindex="-1"></a><span class="do">##  [2,] -0.44409966</span></span>
<span id="cb971-77"><a href="ch-11.html#cb971-77" aria-hidden="true" tabindex="-1"></a><span class="do">##  [3,]  0.72907656</span></span>
<span id="cb971-78"><a href="ch-11.html#cb971-78" aria-hidden="true" tabindex="-1"></a><span class="do">##  [4,]  0.12370997</span></span>
<span id="cb971-79"><a href="ch-11.html#cb971-79" aria-hidden="true" tabindex="-1"></a><span class="do">##  [5,] -0.52531523</span></span>
<span id="cb971-80"><a href="ch-11.html#cb971-80" aria-hidden="true" tabindex="-1"></a><span class="do">##  [6,]  0.34080574</span></span>
<span id="cb971-81"><a href="ch-11.html#cb971-81" aria-hidden="true" tabindex="-1"></a><span class="do">##  [7,]  0.41197014</span></span>
<span id="cb971-82"><a href="ch-11.html#cb971-82" aria-hidden="true" tabindex="-1"></a><span class="do">##  [8,] -0.07848634</span></span>
<span id="cb971-83"><a href="ch-11.html#cb971-83" aria-hidden="true" tabindex="-1"></a><span class="do">##  [9,] -2.98452473</span></span>
<span id="cb971-84"><a href="ch-11.html#cb971-84" aria-hidden="true" tabindex="-1"></a><span class="do">## [10,]  0.82209224</span></span>
<span id="cb971-85"><a href="ch-11.html#cb971-85" aria-hidden="true" tabindex="-1"></a><span class="do">## [11,] -0.90803719</span></span>
<span id="cb971-86"><a href="ch-11.html#cb971-86" aria-hidden="true" tabindex="-1"></a><span class="do">## [12,] -0.10138759</span></span>
<span id="cb971-87"><a href="ch-11.html#cb971-87" aria-hidden="true" tabindex="-1"></a><span class="do">## [13,] -0.12153122</span></span>
<span id="cb971-88"><a href="ch-11.html#cb971-88" aria-hidden="true" tabindex="-1"></a><span class="do">## [14,] -0.31301230</span></span>
<span id="cb971-89"><a href="ch-11.html#cb971-89" aria-hidden="true" tabindex="-1"></a><span class="do">## [15,] -0.70200449</span></span>
<span id="cb971-90"><a href="ch-11.html#cb971-90" aria-hidden="true" tabindex="-1"></a><span class="do">## [16,]  0.04088609</span></span>
<span id="cb971-91"><a href="ch-11.html#cb971-91" aria-hidden="true" tabindex="-1"></a><span class="do">## [17,]  0.11272940</span></span>
<span id="cb971-92"><a href="ch-11.html#cb971-92" aria-hidden="true" tabindex="-1"></a><span class="do">## [18,]  0.19971827</span></span>
<span id="cb971-93"><a href="ch-11.html#cb971-93" aria-hidden="true" tabindex="-1"></a><span class="do">## [19,]  0.26930034</span></span>
<span id="cb971-94"><a href="ch-11.html#cb971-94" aria-hidden="true" tabindex="-1"></a><span class="do">## [20,] -0.10159779</span></span>
<span id="cb971-95"><a href="ch-11.html#cb971-95" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb971-96"><a href="ch-11.html#cb971-96" aria-hidden="true" tabindex="-1"></a><span class="do">## [[4]]</span></span>
<span id="cb971-97"><a href="ch-11.html#cb971-97" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 4.201512</span></span></code></pre></div>
<p>Now we can evaluate our model predictions on the held-out testing set.</p>
<div class="sourceCode" id="cb972"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb972-1"><a href="ch-11.html#cb972-1" aria-hidden="true" tabindex="-1"></a><span class="do">## make predictions and evaluate using test set </span></span>
<span id="cb972-2"><a href="ch-11.html#cb972-2" aria-hidden="true" tabindex="-1"></a>test_data_predictions <span class="ot">&lt;-</span> <span class="fu">predict</span>(model, test_data)</span>
<span id="cb972-3"><a href="ch-11.html#cb972-3" aria-hidden="true" tabindex="-1"></a>eval_result <span class="ot">&lt;-</span> model <span class="sc">%&gt;%</span> <span class="fu">evaluate</span>(test_data, test_target)</span>
<span id="cb972-4"><a href="ch-11.html#cb972-4" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(eval_result)</span></code></pre></div>
<div class="sourceCode" id="cb973"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb973-1"><a href="ch-11.html#cb973-1" aria-hidden="true" tabindex="-1"></a><span class="do">## $loss</span></span>
<span id="cb973-2"><a href="ch-11.html#cb973-2" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 26.00271</span></span>
<span id="cb973-3"><a href="ch-11.html#cb973-3" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb973-4"><a href="ch-11.html#cb973-4" aria-hidden="true" tabindex="-1"></a><span class="do">## $mean_absolute_error</span></span>
<span id="cb973-5"><a href="ch-11.html#cb973-5" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 3.288165</span></span></code></pre></div>
<p><img src="figures/11_output-test.png" /></p>
<p>Next we can plot the model predictions with along with the ground truth for the test and training dataset. Check if the model predictions actually follow the trend in the data.</p>
<div class="sourceCode" id="cb974"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb974-1"><a href="ch-11.html#cb974-1" aria-hidden="true" tabindex="-1"></a><span class="do">## plot the test data observations along with the test data predictions. Use color red for predictions, and blue for the observed data.</span></span>
<span id="cb974-2"><a href="ch-11.html#cb974-2" aria-hidden="true" tabindex="-1"></a>plt_1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>() <span class="sc">+</span> <span class="fu">geom_line</span>(<span class="at">data =</span> test_split, <span class="fu">aes</span>(<span class="at">x =</span> test_data_time, <span class="at">y =</span> test_data_predictions), <span class="at">col =</span> <span class="fu">alpha</span>(<span class="st">&quot;red&quot;</span>, <span class="fl">0.8</span>)) <span class="sc">+</span> <span class="fu">geom_line</span>(<span class="at">data =</span> test_split, <span class="fu">aes</span>(<span class="at">x =</span> test_data_time, <span class="at">y =</span> test_target),<span class="at">col=</span><span class="fu">alpha</span>(<span class="st">&quot;blue&quot;</span>,<span class="fl">0.3</span>))</span>
<span id="cb974-3"><a href="ch-11.html#cb974-3" aria-hidden="true" tabindex="-1"></a>plt_1</span>
<span id="cb974-4"><a href="ch-11.html#cb974-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb974-5"><a href="ch-11.html#cb974-5" aria-hidden="true" tabindex="-1"></a><span class="do">## plot the train data observations along with the train data predictions. Use color red for predictions, and blue for the observed data.</span></span>
<span id="cb974-6"><a href="ch-11.html#cb974-6" aria-hidden="true" tabindex="-1"></a>train_data_predictions <span class="ot">&lt;-</span> <span class="fu">predict</span>(model, train_data)</span>
<span id="cb974-7"><a href="ch-11.html#cb974-7" aria-hidden="true" tabindex="-1"></a>plt_2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>() <span class="sc">+</span> <span class="fu">geom_line</span>(<span class="at">data =</span> train_split, <span class="fu">aes</span>(<span class="at">x =</span> train_data_time, <span class="at">y =</span> train_data_predictions), <span class="at">col =</span> <span class="fu">alpha</span>(<span class="st">&quot;red&quot;</span>, <span class="fl">0.8</span>)) <span class="sc">+</span> <span class="fu">geom_line</span>(<span class="at">data =</span> train_split, <span class="fu">aes</span>(<span class="at">x =</span> train_data_time, <span class="at">y =</span> train_target),<span class="at">col=</span><span class="fu">alpha</span>(<span class="st">&quot;blue&quot;</span>,<span class="fl">0.15</span>))</span>
<span id="cb974-8"><a href="ch-11.html#cb974-8" aria-hidden="true" tabindex="-1"></a>plt_2</span>
<span id="cb974-9"><a href="ch-11.html#cb974-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb974-10"><a href="ch-11.html#cb974-10" aria-hidden="true" tabindex="-1"></a><span class="do">## Hint: For both the plots above, edit the alpha value such that the test data observations and the test data predictions both can be seen even with overlap </span></span></code></pre></div>
<p><img src="figures/11_output-train.png" /></p>
<p>Nice! From our domain knowledge we know that the target varible GPP_NT_VUT_REF cannot be negative, but our dataset contains some negative observations because of noisy measurements. From the plot we see that the model learns the trends in the data, without learning the noise.</p>
<p>Finally let’s make a plot of our predictions v/s observed data. In an ideal world this should be a straight line y=x, giving us a Pearson’s correlation coefficient of 1, but because of the noise in data we can expect some deviations from the ideal result.</p>
<div class="sourceCode" id="cb975"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb975-1"><a href="ch-11.html#cb975-1" aria-hidden="true" tabindex="-1"></a><span class="do">## plot test set predictions v/s test set observations (from the test dataset)</span></span>
<span id="cb975-2"><a href="ch-11.html#cb975-2" aria-hidden="true" tabindex="-1"></a>plt3 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(test_split, <span class="fu">aes</span>(<span class="at">x =</span> test_target, <span class="at">y=</span>test_data_predictions)) <span class="sc">+</span> <span class="fu">geom_point</span>() </span>
<span id="cb975-3"><a href="ch-11.html#cb975-3" aria-hidden="true" tabindex="-1"></a>plt3</span></code></pre></div>
<p><img src="figures/11_output-scatter.png" /></p>
<p>What is the Pearson’s correlation coefficient obtained for this?</p>
<div class="sourceCode" id="cb976"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb976-1"><a href="ch-11.html#cb976-1" aria-hidden="true" tabindex="-1"></a><span class="do">## compute the correlation coefficient</span></span>
<span id="cb976-2"><a href="ch-11.html#cb976-2" aria-hidden="true" tabindex="-1"></a>r2 <span class="ot">&lt;-</span> <span class="cf">function</span> (p, q) {<span class="fu">cor</span>(p, q)<span class="sc">^</span><span class="dv">2</span>}</span>
<span id="cb976-3"><a href="ch-11.html#cb976-3" aria-hidden="true" tabindex="-1"></a><span class="fu">r2</span>(test_target, test_data_predictions)</span></code></pre></div>
<div class="sourceCode" id="cb977"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb977-1"><a href="ch-11.html#cb977-1" aria-hidden="true" tabindex="-1"></a><span class="do">##                     [,1]</span></span>
<span id="cb977-2"><a href="ch-11.html#cb977-2" aria-hidden="true" tabindex="-1"></a><span class="do">## GPP_NT_VUT_REF 0.6658682</span></span></code></pre></div>
<p>Having done this we have an idea of how well our model generalises against unseen data. But, to optimise the hyperparameters of the network we should not use the performance on the test set to select these hyperparameters. If we tune our model hyper-parameters using results from the test set, then the performance of our best model on the test set underestimates the true risk of our model. In the following steps we do the same things as we have discusses until now, but with 5-fold cross validation. We will do cross validation “by-hand,” as we try to avoid using caret here, and doing so by hand gives us a more fine grain control.</p>
<p>Let’s put the model creating and training in a function which takes the different hyper-parameters as inputs. This will make it easier to build a model from inside a cross validation loop.</p>
<p>Write a function, that does all the above steps, and returns a trained model. This will come in handy when we perform cross-validation.</p>
<div class="sourceCode" id="cb978"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb978-1"><a href="ch-11.html#cb978-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Function name: build_model()  </span></span>
<span id="cb978-2"><a href="ch-11.html#cb978-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Inputs: Training data, Training target, number of hidden units, activation type, number of epochs, batch size and validation size  </span></span>
<span id="cb978-3"><a href="ch-11.html#cb978-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Output: List of 2 objects --&gt; trained model, and the training history </span></span>
<span id="cb978-4"><a href="ch-11.html#cb978-4" aria-hidden="true" tabindex="-1"></a><span class="do">## We also return the training history in case we want to make plots of the training process for each of the folds  </span></span>
<span id="cb978-5"><a href="ch-11.html#cb978-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb978-6"><a href="ch-11.html#cb978-6" aria-hidden="true" tabindex="-1"></a>build_model <span class="ot">&lt;-</span> <span class="cf">function</span>(X_train, y_train,</span>
<span id="cb978-7"><a href="ch-11.html#cb978-7" aria-hidden="true" tabindex="-1"></a>                        num_units, </span>
<span id="cb978-8"><a href="ch-11.html#cb978-8" aria-hidden="true" tabindex="-1"></a>                        activation_type,</span>
<span id="cb978-9"><a href="ch-11.html#cb978-9" aria-hidden="true" tabindex="-1"></a>                        num_epochs,</span>
<span id="cb978-10"><a href="ch-11.html#cb978-10" aria-hidden="true" tabindex="-1"></a>                        batch_size,</span>
<span id="cb978-11"><a href="ch-11.html#cb978-11" aria-hidden="true" tabindex="-1"></a>                        val_size){</span>
<span id="cb978-12"><a href="ch-11.html#cb978-12" aria-hidden="true" tabindex="-1"></a>  model <span class="ot">&lt;-</span> <span class="fu">keras_model_sequential</span>()</span>
<span id="cb978-13"><a href="ch-11.html#cb978-13" aria-hidden="true" tabindex="-1"></a>  model <span class="sc">%&gt;%</span> </span>
<span id="cb978-14"><a href="ch-11.html#cb978-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">layer_dense</span>(<span class="at">units =</span> num_units, <span class="at">activation =</span> activation_type, <span class="at">input_shape =</span> <span class="fu">ncol</span>(X_train)) <span class="sc">%&gt;%</span></span>
<span id="cb978-15"><a href="ch-11.html#cb978-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">layer_dense</span>(<span class="at">units =</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb978-16"><a href="ch-11.html#cb978-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">compile</span>( <span class="at">optimizer =</span> <span class="fu">optimizer_adam</span>(<span class="at">lr=</span><span class="fl">0.001</span>),</span>
<span id="cb978-17"><a href="ch-11.html#cb978-17" aria-hidden="true" tabindex="-1"></a>             <span class="at">loss =</span> <span class="st">&#39;mean_squared_error&#39;</span>, </span>
<span id="cb978-18"><a href="ch-11.html#cb978-18" aria-hidden="true" tabindex="-1"></a>             <span class="at">metrics =</span> <span class="st">&#39;mean_squared_error&#39;</span>)</span>
<span id="cb978-19"><a href="ch-11.html#cb978-19" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb978-20"><a href="ch-11.html#cb978-20" aria-hidden="true" tabindex="-1"></a>  history <span class="ot">&lt;-</span> <span class="fu">fit</span>(</span>
<span id="cb978-21"><a href="ch-11.html#cb978-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">object           =</span> model, </span>
<span id="cb978-22"><a href="ch-11.html#cb978-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">x                =</span> X_train, </span>
<span id="cb978-23"><a href="ch-11.html#cb978-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">y                =</span> y_train,</span>
<span id="cb978-24"><a href="ch-11.html#cb978-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">batch_size       =</span> batch_size, </span>
<span id="cb978-25"><a href="ch-11.html#cb978-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">epochs           =</span> num_epochs,</span>
<span id="cb978-26"><a href="ch-11.html#cb978-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">validation_split =</span> val_size,</span>
<span id="cb978-27"><a href="ch-11.html#cb978-27" aria-hidden="true" tabindex="-1"></a>    <span class="at">shuffle =</span> <span class="cn">TRUE</span>, </span>
<span id="cb978-28"><a href="ch-11.html#cb978-28" aria-hidden="true" tabindex="-1"></a>    <span class="at">callbacks =</span> <span class="fu">list</span>(<span class="fu">callback_early_stopping</span>( <span class="at">monitor =</span> <span class="st">&quot;val_loss&quot;</span>,  <span class="at">patience =</span> <span class="dv">0</span>))</span>
<span id="cb978-29"><a href="ch-11.html#cb978-29" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb978-30"><a href="ch-11.html#cb978-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb978-31"><a href="ch-11.html#cb978-31" aria-hidden="true" tabindex="-1"></a>  trained_model <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="st">&quot;model&quot;</span> <span class="ot">=</span> model, <span class="st">&quot;history&quot;</span> <span class="ot">=</span> history)</span>
<span id="cb978-32"><a href="ch-11.html#cb978-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(trained_model)</span>
<span id="cb978-33"><a href="ch-11.html#cb978-33" aria-hidden="true" tabindex="-1"></a>}  </span></code></pre></div>
</div>
<div id="cross-validation" class="section level3" number="11.2.5">
<h3><span class="header-section-number">11.2.5</span> Cross validation</h3>
<p>In this section you will perform 5-Fold CV, “by - hand”</p>
<div class="sourceCode" id="cb979"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb979-1"><a href="ch-11.html#cb979-1" aria-hidden="true" tabindex="-1"></a><span class="co"># We prepare our cross validation splits. First we randomly shuffle the initial train set. </span></span>
<span id="cb979-2"><a href="ch-11.html#cb979-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Note: Use the data that we obtained from the train split, from before we centered and scaled the data. </span></span>
<span id="cb979-3"><a href="ch-11.html#cb979-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Using the already centered and scaled data, will introduce information leak into out cross-validation folds </span></span>
<span id="cb979-4"><a href="ch-11.html#cb979-4" aria-hidden="true" tabindex="-1"></a>cv_data <span class="ot">&lt;-</span> train_split </span>
<span id="cb979-5"><a href="ch-11.html#cb979-5" aria-hidden="true" tabindex="-1"></a>cv_data <span class="ot">&lt;-</span> cv_data[<span class="fu">sample</span>(<span class="fu">nrow</span>(cv_data)),]</span>
<span id="cb979-6"><a href="ch-11.html#cb979-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb979-7"><a href="ch-11.html#cb979-7" aria-hidden="true" tabindex="-1"></a><span class="co">#Create 5 equally size folds</span></span>
<span id="cb979-8"><a href="ch-11.html#cb979-8" aria-hidden="true" tabindex="-1"></a><span class="do">## hint: folds &lt;- cut(seq(1,nrow(cv_data)),breaks=5,labels=FALSE)</span></span>
<span id="cb979-9"><a href="ch-11.html#cb979-9" aria-hidden="true" tabindex="-1"></a>folds <span class="ot">&lt;-</span> <span class="fu">cut</span>(<span class="fu">seq</span>(<span class="dv">1</span>,<span class="fu">nrow</span>(cv_data)),<span class="at">breaks=</span><span class="dv">5</span>,<span class="at">labels=</span><span class="cn">FALSE</span>)</span>
<span id="cb979-10"><a href="ch-11.html#cb979-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb979-11"><a href="ch-11.html#cb979-11" aria-hidden="true" tabindex="-1"></a><span class="do">## create a list, to store the results across different folds</span></span>
<span id="cb979-12"><a href="ch-11.html#cb979-12" aria-hidden="true" tabindex="-1"></a>history_list <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb979-13"><a href="ch-11.html#cb979-13" aria-hidden="true" tabindex="-1"></a>cv_performance_list <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb979-14"><a href="ch-11.html#cb979-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb979-15"><a href="ch-11.html#cb979-15" aria-hidden="true" tabindex="-1"></a><span class="co">#Perform 5 fold cross validation</span></span>
<span id="cb979-16"><a href="ch-11.html#cb979-16" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>){</span>
<span id="cb979-17"><a href="ch-11.html#cb979-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="fu">sprintf</span>(<span class="st">&quot;CV Fold --&gt; %i/5</span><span class="sc">\n</span><span class="st">&quot;</span>, i))</span>
<span id="cb979-18"><a href="ch-11.html#cb979-18" aria-hidden="true" tabindex="-1"></a>  <span class="co">#Segement the data by fold </span></span>
<span id="cb979-19"><a href="ch-11.html#cb979-19" aria-hidden="true" tabindex="-1"></a>  <span class="do">## hint : indices &lt;- which(folds==i,arr.ind=TRUE)</span></span>
<span id="cb979-20"><a href="ch-11.html#cb979-20" aria-hidden="true" tabindex="-1"></a>  indices <span class="ot">&lt;-</span> <span class="fu">which</span>(folds<span class="sc">==</span>i,<span class="at">arr.ind=</span><span class="cn">TRUE</span>)</span>
<span id="cb979-21"><a href="ch-11.html#cb979-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb979-22"><a href="ch-11.html#cb979-22" aria-hidden="true" tabindex="-1"></a>  <span class="do">## indices is a vector with TRUE for the rows where the folds == i; and FALSE for the rest of the row</span></span>
<span id="cb979-23"><a href="ch-11.html#cb979-23" aria-hidden="true" tabindex="-1"></a>  <span class="do">## indices which are TRUE for a particular loop form the cross-validation test set for that loop  </span></span>
<span id="cb979-24"><a href="ch-11.html#cb979-24" aria-hidden="true" tabindex="-1"></a>  <span class="do">## Segment data as cv_test_data and cv_train data using the indices. </span></span>
<span id="cb979-25"><a href="ch-11.html#cb979-25" aria-hidden="true" tabindex="-1"></a>  <span class="do">## Now we just repeat the steps we did previously</span></span>
<span id="cb979-26"><a href="ch-11.html#cb979-26" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb979-27"><a href="ch-11.html#cb979-27" aria-hidden="true" tabindex="-1"></a>  <span class="do">## Seperate out the cv_test_data, cv_test_targets, cv_train_data, cv_train_targets. We won&#39;t be making any time series plots when cross-validating, so we can drop the timestamp columns</span></span>
<span id="cb979-28"><a href="ch-11.html#cb979-28" aria-hidden="true" tabindex="-1"></a>  cv_test_data <span class="ot">&lt;-</span> cv_data[indices, ]</span>
<span id="cb979-29"><a href="ch-11.html#cb979-29" aria-hidden="true" tabindex="-1"></a>  cv_test_target <span class="ot">&lt;-</span> cv_test_data <span class="sc">%&gt;%</span> <span class="fu">select</span>(target_variable)</span>
<span id="cb979-30"><a href="ch-11.html#cb979-30" aria-hidden="true" tabindex="-1"></a>  cv_test_data <span class="ot">&lt;-</span> cv_test_data <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">-</span><span class="fu">one_of</span>(<span class="fu">c</span>(target_variable, time_cols)))</span>
<span id="cb979-31"><a href="ch-11.html#cb979-31" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb979-32"><a href="ch-11.html#cb979-32" aria-hidden="true" tabindex="-1"></a>  cv_train_data <span class="ot">&lt;-</span> cv_data[<span class="sc">-</span>indices, ]</span>
<span id="cb979-33"><a href="ch-11.html#cb979-33" aria-hidden="true" tabindex="-1"></a>  cv_train_target <span class="ot">&lt;-</span> cv_train_data <span class="sc">%&gt;%</span> <span class="fu">select</span>(target_variable)</span>
<span id="cb979-34"><a href="ch-11.html#cb979-34" aria-hidden="true" tabindex="-1"></a>  cv_train_data <span class="ot">&lt;-</span> cv_train_data <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">-</span><span class="fu">one_of</span>(<span class="fu">c</span>(target_variable, time_cols)))</span>
<span id="cb979-35"><a href="ch-11.html#cb979-35" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb979-36"><a href="ch-11.html#cb979-36" aria-hidden="true" tabindex="-1"></a>  <span class="co"># scale and center using cv_train_data </span></span>
<span id="cb979-37"><a href="ch-11.html#cb979-37" aria-hidden="true" tabindex="-1"></a>  <span class="co"># get the statistics (mean, variance, etc) of numeric cols </span></span>
<span id="cb979-38"><a href="ch-11.html#cb979-38" aria-hidden="true" tabindex="-1"></a>  cv_train_data_stat <span class="ot">&lt;-</span> <span class="fu">preProcess</span>(cv_train_data, <span class="at">method =</span> <span class="fu">c</span>(<span class="st">&quot;center&quot;</span>,<span class="st">&quot;scale&quot;</span>))  </span>
<span id="cb979-39"><a href="ch-11.html#cb979-39" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb979-40"><a href="ch-11.html#cb979-40" aria-hidden="true" tabindex="-1"></a>  <span class="co"># transform the cv_train_data and cv_test_data to center and scale it </span></span>
<span id="cb979-41"><a href="ch-11.html#cb979-41" aria-hidden="true" tabindex="-1"></a>  cv_train_data[, predictors] <span class="ot">&lt;-</span> <span class="fu">predict</span>(cv_train_data_stat, cv_train_data)  </span>
<span id="cb979-42"><a href="ch-11.html#cb979-42" aria-hidden="true" tabindex="-1"></a>  cv_test_data[, predictors] <span class="ot">&lt;-</span> <span class="fu">predict</span>(cv_train_data_stat, cv_test_data)</span>
<span id="cb979-43"><a href="ch-11.html#cb979-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb979-44"><a href="ch-11.html#cb979-44" aria-hidden="true" tabindex="-1"></a>  <span class="co"># OR</span></span>
<span id="cb979-45"><a href="ch-11.html#cb979-45" aria-hidden="true" tabindex="-1"></a>  <span class="co"># scale_and_center&lt;- recipe(cv_train_data) %&gt;%</span></span>
<span id="cb979-46"><a href="ch-11.html#cb979-46" aria-hidden="true" tabindex="-1"></a>  <span class="co">#                             step_center(all_numeric()) %&gt;%</span></span>
<span id="cb979-47"><a href="ch-11.html#cb979-47" aria-hidden="true" tabindex="-1"></a>  <span class="co">#                             step_scale(all_numeric())</span></span>
<span id="cb979-48"><a href="ch-11.html#cb979-48" aria-hidden="true" tabindex="-1"></a>  <span class="co"># prep_recipe &lt;- prep(scale_and_center, training = cv_train_data)</span></span>
<span id="cb979-49"><a href="ch-11.html#cb979-49" aria-hidden="true" tabindex="-1"></a>  <span class="co"># cv_train_data &lt;- bake(prep_recipe, new_data = cv_train_data)</span></span>
<span id="cb979-50"><a href="ch-11.html#cb979-50" aria-hidden="true" tabindex="-1"></a>  <span class="co"># cv_test_data &lt;- bake(prep_recipe, new_data = cv_test_data)</span></span>
<span id="cb979-51"><a href="ch-11.html#cb979-51" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb979-52"><a href="ch-11.html#cb979-52" aria-hidden="true" tabindex="-1"></a>  <span class="do">## Convert data using as.matrix() </span></span>
<span id="cb979-53"><a href="ch-11.html#cb979-53" aria-hidden="true" tabindex="-1"></a>  cv_train_data <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(cv_train_data)</span>
<span id="cb979-54"><a href="ch-11.html#cb979-54" aria-hidden="true" tabindex="-1"></a>  cv_train_target <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(cv_train_target)</span>
<span id="cb979-55"><a href="ch-11.html#cb979-55" aria-hidden="true" tabindex="-1"></a>  cv_test_data <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(cv_test_data)</span>
<span id="cb979-56"><a href="ch-11.html#cb979-56" aria-hidden="true" tabindex="-1"></a>  cv_test_target <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(cv_test_target)</span>
<span id="cb979-57"><a href="ch-11.html#cb979-57" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb979-58"><a href="ch-11.html#cb979-58" aria-hidden="true" tabindex="-1"></a>  <span class="do">## train a model using the build_model() function we wrote previously  </span></span>
<span id="cb979-59"><a href="ch-11.html#cb979-59" aria-hidden="true" tabindex="-1"></a>  <span class="co"># cv_model &lt;- build_model()</span></span>
<span id="cb979-60"><a href="ch-11.html#cb979-60" aria-hidden="true" tabindex="-1"></a>    cv_model <span class="ot">&lt;-</span> <span class="fu">build_model</span>(<span class="at">X_train =</span> cv_train_data, <span class="at">y_train =</span> cv_train_target, </span>
<span id="cb979-61"><a href="ch-11.html#cb979-61" aria-hidden="true" tabindex="-1"></a>              <span class="at">num_units =</span> <span class="dv">20</span>,</span>
<span id="cb979-62"><a href="ch-11.html#cb979-62" aria-hidden="true" tabindex="-1"></a>              <span class="at">activation_type =</span> <span class="st">&quot;relu&quot;</span>,</span>
<span id="cb979-63"><a href="ch-11.html#cb979-63" aria-hidden="true" tabindex="-1"></a>              <span class="at">num_epochs =</span> <span class="dv">30</span>,</span>
<span id="cb979-64"><a href="ch-11.html#cb979-64" aria-hidden="true" tabindex="-1"></a>              <span class="at">batch_size =</span> <span class="dv">128</span>,</span>
<span id="cb979-65"><a href="ch-11.html#cb979-65" aria-hidden="true" tabindex="-1"></a>              <span class="at">val_size =</span> <span class="fl">0.15</span>)</span>
<span id="cb979-66"><a href="ch-11.html#cb979-66" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb979-67"><a href="ch-11.html#cb979-67" aria-hidden="true" tabindex="-1"></a>  <span class="co">#  get the evaluation error on the test folds </span></span>
<span id="cb979-68"><a href="ch-11.html#cb979-68" aria-hidden="true" tabindex="-1"></a>  eval_result <span class="ot">&lt;-</span> cv_model<span class="sc">$</span>model <span class="sc">%&gt;%</span> <span class="fu">evaluate</span>(cv_test_data, cv_test_target)</span>
<span id="cb979-69"><a href="ch-11.html#cb979-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb979-70"><a href="ch-11.html#cb979-70" aria-hidden="true" tabindex="-1"></a><span class="co">#   Store the results in the lists we made outside the loop </span></span>
<span id="cb979-71"><a href="ch-11.html#cb979-71" aria-hidden="true" tabindex="-1"></a>  cv_performance_list[[i]] <span class="ot">&lt;-</span> eval_result</span>
<span id="cb979-72"><a href="ch-11.html#cb979-72" aria-hidden="true" tabindex="-1"></a>  history_list[[i]] <span class="ot">&lt;-</span> cv_model<span class="sc">$</span>history</span>
<span id="cb979-73"><a href="ch-11.html#cb979-73" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">&quot;Evaluation error on the held out fold: &quot;</span> , eval_result<span class="sc">$</span>mean_squared_error,<span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb979-74"><a href="ch-11.html#cb979-74" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<div class="sourceCode" id="cb980"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb980-1"><a href="ch-11.html#cb980-1" aria-hidden="true" tabindex="-1"></a><span class="do">## CV Fold --&gt; 1/5</span></span>
<span id="cb980-2"><a href="ch-11.html#cb980-2" aria-hidden="true" tabindex="-1"></a><span class="do">## Model: &quot;sequential_1&quot;</span></span>
<span id="cb980-3"><a href="ch-11.html#cb980-3" aria-hidden="true" tabindex="-1"></a><span class="do">## ________________________________________________________________________________</span></span>
<span id="cb980-4"><a href="ch-11.html#cb980-4" aria-hidden="true" tabindex="-1"></a><span class="do">## Layer (type)                        Output Shape                    Param #     </span></span>
<span id="cb980-5"><a href="ch-11.html#cb980-5" aria-hidden="true" tabindex="-1"></a><span class="do">## ================================================================================</span></span>
<span id="cb980-6"><a href="ch-11.html#cb980-6" aria-hidden="true" tabindex="-1"></a><span class="do">## dense_2 (Dense)                     (None, 20)                      320         </span></span>
<span id="cb980-7"><a href="ch-11.html#cb980-7" aria-hidden="true" tabindex="-1"></a><span class="do">## ________________________________________________________________________________</span></span>
<span id="cb980-8"><a href="ch-11.html#cb980-8" aria-hidden="true" tabindex="-1"></a><span class="do">## dense_3 (Dense)                     (None, 1)                       21          </span></span>
<span id="cb980-9"><a href="ch-11.html#cb980-9" aria-hidden="true" tabindex="-1"></a><span class="do">## ================================================================================</span></span>
<span id="cb980-10"><a href="ch-11.html#cb980-10" aria-hidden="true" tabindex="-1"></a><span class="do">## Total params: 341</span></span>
<span id="cb980-11"><a href="ch-11.html#cb980-11" aria-hidden="true" tabindex="-1"></a><span class="do">## Trainable params: 341</span></span>
<span id="cb980-12"><a href="ch-11.html#cb980-12" aria-hidden="true" tabindex="-1"></a><span class="do">## Non-trainable params: 0</span></span>
<span id="cb980-13"><a href="ch-11.html#cb980-13" aria-hidden="true" tabindex="-1"></a><span class="do">## ________________________________________________________________________________</span></span>
<span id="cb980-14"><a href="ch-11.html#cb980-14" aria-hidden="true" tabindex="-1"></a><span class="do">## Evaluation error on the held out fold:  23.76635 </span></span>
<span id="cb980-15"><a href="ch-11.html#cb980-15" aria-hidden="true" tabindex="-1"></a><span class="do">## CV Fold --&gt; 2/5</span></span>
<span id="cb980-16"><a href="ch-11.html#cb980-16" aria-hidden="true" tabindex="-1"></a><span class="do">## Model: &quot;sequential_2&quot;</span></span>
<span id="cb980-17"><a href="ch-11.html#cb980-17" aria-hidden="true" tabindex="-1"></a><span class="do">## ________________________________________________________________________________</span></span>
<span id="cb980-18"><a href="ch-11.html#cb980-18" aria-hidden="true" tabindex="-1"></a><span class="do">## Layer (type)                        Output Shape                    Param #     </span></span>
<span id="cb980-19"><a href="ch-11.html#cb980-19" aria-hidden="true" tabindex="-1"></a><span class="do">## ================================================================================</span></span>
<span id="cb980-20"><a href="ch-11.html#cb980-20" aria-hidden="true" tabindex="-1"></a><span class="do">## dense_4 (Dense)                     (None, 20)                      320         </span></span>
<span id="cb980-21"><a href="ch-11.html#cb980-21" aria-hidden="true" tabindex="-1"></a><span class="do">## ________________________________________________________________________________</span></span>
<span id="cb980-22"><a href="ch-11.html#cb980-22" aria-hidden="true" tabindex="-1"></a><span class="do">## dense_5 (Dense)                     (None, 1)                       21          </span></span>
<span id="cb980-23"><a href="ch-11.html#cb980-23" aria-hidden="true" tabindex="-1"></a><span class="do">## ================================================================================</span></span>
<span id="cb980-24"><a href="ch-11.html#cb980-24" aria-hidden="true" tabindex="-1"></a><span class="do">## Total params: 341</span></span>
<span id="cb980-25"><a href="ch-11.html#cb980-25" aria-hidden="true" tabindex="-1"></a><span class="do">## Trainable params: 341</span></span>
<span id="cb980-26"><a href="ch-11.html#cb980-26" aria-hidden="true" tabindex="-1"></a><span class="do">## Non-trainable params: 0</span></span>
<span id="cb980-27"><a href="ch-11.html#cb980-27" aria-hidden="true" tabindex="-1"></a><span class="do">## ________________________________________________________________________________</span></span>
<span id="cb980-28"><a href="ch-11.html#cb980-28" aria-hidden="true" tabindex="-1"></a><span class="do">## Evaluation error on the held out fold:  25.21327 </span></span>
<span id="cb980-29"><a href="ch-11.html#cb980-29" aria-hidden="true" tabindex="-1"></a><span class="do">## CV Fold --&gt; 3/5</span></span>
<span id="cb980-30"><a href="ch-11.html#cb980-30" aria-hidden="true" tabindex="-1"></a><span class="do">## Model: &quot;sequential_3&quot;</span></span>
<span id="cb980-31"><a href="ch-11.html#cb980-31" aria-hidden="true" tabindex="-1"></a><span class="do">## ________________________________________________________________________________</span></span>
<span id="cb980-32"><a href="ch-11.html#cb980-32" aria-hidden="true" tabindex="-1"></a><span class="do">## Layer (type)                        Output Shape                    Param #     </span></span>
<span id="cb980-33"><a href="ch-11.html#cb980-33" aria-hidden="true" tabindex="-1"></a><span class="do">## ================================================================================</span></span>
<span id="cb980-34"><a href="ch-11.html#cb980-34" aria-hidden="true" tabindex="-1"></a><span class="do">## dense_6 (Dense)                     (None, 20)                      320         </span></span>
<span id="cb980-35"><a href="ch-11.html#cb980-35" aria-hidden="true" tabindex="-1"></a><span class="do">## ________________________________________________________________________________</span></span>
<span id="cb980-36"><a href="ch-11.html#cb980-36" aria-hidden="true" tabindex="-1"></a><span class="do">## dense_7 (Dense)                     (None, 1)                       21          </span></span>
<span id="cb980-37"><a href="ch-11.html#cb980-37" aria-hidden="true" tabindex="-1"></a><span class="do">## ================================================================================</span></span>
<span id="cb980-38"><a href="ch-11.html#cb980-38" aria-hidden="true" tabindex="-1"></a><span class="do">## Total params: 341</span></span>
<span id="cb980-39"><a href="ch-11.html#cb980-39" aria-hidden="true" tabindex="-1"></a><span class="do">## Trainable params: 341</span></span>
<span id="cb980-40"><a href="ch-11.html#cb980-40" aria-hidden="true" tabindex="-1"></a><span class="do">## Non-trainable params: 0</span></span>
<span id="cb980-41"><a href="ch-11.html#cb980-41" aria-hidden="true" tabindex="-1"></a><span class="do">## ________________________________________________________________________________</span></span>
<span id="cb980-42"><a href="ch-11.html#cb980-42" aria-hidden="true" tabindex="-1"></a><span class="do">## Evaluation error on the held out fold:  24.25686 </span></span>
<span id="cb980-43"><a href="ch-11.html#cb980-43" aria-hidden="true" tabindex="-1"></a><span class="do">## CV Fold --&gt; 4/5</span></span>
<span id="cb980-44"><a href="ch-11.html#cb980-44" aria-hidden="true" tabindex="-1"></a><span class="do">## Model: &quot;sequential_4&quot;</span></span>
<span id="cb980-45"><a href="ch-11.html#cb980-45" aria-hidden="true" tabindex="-1"></a><span class="do">## ________________________________________________________________________________</span></span>
<span id="cb980-46"><a href="ch-11.html#cb980-46" aria-hidden="true" tabindex="-1"></a><span class="do">## Layer (type)                        Output Shape                    Param #     </span></span>
<span id="cb980-47"><a href="ch-11.html#cb980-47" aria-hidden="true" tabindex="-1"></a><span class="do">## ================================================================================</span></span>
<span id="cb980-48"><a href="ch-11.html#cb980-48" aria-hidden="true" tabindex="-1"></a><span class="do">## dense_8 (Dense)                     (None, 20)                      320         </span></span>
<span id="cb980-49"><a href="ch-11.html#cb980-49" aria-hidden="true" tabindex="-1"></a><span class="do">## ________________________________________________________________________________</span></span>
<span id="cb980-50"><a href="ch-11.html#cb980-50" aria-hidden="true" tabindex="-1"></a><span class="do">## dense_9 (Dense)                     (None, 1)                       21          </span></span>
<span id="cb980-51"><a href="ch-11.html#cb980-51" aria-hidden="true" tabindex="-1"></a><span class="do">## ================================================================================</span></span>
<span id="cb980-52"><a href="ch-11.html#cb980-52" aria-hidden="true" tabindex="-1"></a><span class="do">## Total params: 341</span></span>
<span id="cb980-53"><a href="ch-11.html#cb980-53" aria-hidden="true" tabindex="-1"></a><span class="do">## Trainable params: 341</span></span>
<span id="cb980-54"><a href="ch-11.html#cb980-54" aria-hidden="true" tabindex="-1"></a><span class="do">## Non-trainable params: 0</span></span>
<span id="cb980-55"><a href="ch-11.html#cb980-55" aria-hidden="true" tabindex="-1"></a><span class="do">## ________________________________________________________________________________</span></span>
<span id="cb980-56"><a href="ch-11.html#cb980-56" aria-hidden="true" tabindex="-1"></a><span class="do">## Evaluation error on the held out fold:  24.77271 </span></span>
<span id="cb980-57"><a href="ch-11.html#cb980-57" aria-hidden="true" tabindex="-1"></a><span class="do">## CV Fold --&gt; 5/5</span></span>
<span id="cb980-58"><a href="ch-11.html#cb980-58" aria-hidden="true" tabindex="-1"></a><span class="do">## Model: &quot;sequential_5&quot;</span></span>
<span id="cb980-59"><a href="ch-11.html#cb980-59" aria-hidden="true" tabindex="-1"></a><span class="do">## ________________________________________________________________________________</span></span>
<span id="cb980-60"><a href="ch-11.html#cb980-60" aria-hidden="true" tabindex="-1"></a><span class="do">## Layer (type)                        Output Shape                    Param #     </span></span>
<span id="cb980-61"><a href="ch-11.html#cb980-61" aria-hidden="true" tabindex="-1"></a><span class="do">## ================================================================================</span></span>
<span id="cb980-62"><a href="ch-11.html#cb980-62" aria-hidden="true" tabindex="-1"></a><span class="do">## dense_10 (Dense)                    (None, 20)                      320         </span></span>
<span id="cb980-63"><a href="ch-11.html#cb980-63" aria-hidden="true" tabindex="-1"></a><span class="do">## ________________________________________________________________________________</span></span>
<span id="cb980-64"><a href="ch-11.html#cb980-64" aria-hidden="true" tabindex="-1"></a><span class="do">## dense_11 (Dense)                    (None, 1)                       21          </span></span>
<span id="cb980-65"><a href="ch-11.html#cb980-65" aria-hidden="true" tabindex="-1"></a><span class="do">## ================================================================================</span></span>
<span id="cb980-66"><a href="ch-11.html#cb980-66" aria-hidden="true" tabindex="-1"></a><span class="do">## Total params: 341</span></span>
<span id="cb980-67"><a href="ch-11.html#cb980-67" aria-hidden="true" tabindex="-1"></a><span class="do">## Trainable params: 341</span></span>
<span id="cb980-68"><a href="ch-11.html#cb980-68" aria-hidden="true" tabindex="-1"></a><span class="do">## Non-trainable params: 0</span></span>
<span id="cb980-69"><a href="ch-11.html#cb980-69" aria-hidden="true" tabindex="-1"></a><span class="do">## ________________________________________________________________________________</span></span>
<span id="cb980-70"><a href="ch-11.html#cb980-70" aria-hidden="true" tabindex="-1"></a><span class="do">## Evaluation error on the held out fold:  24.60175</span></span></code></pre></div>
<div class="sourceCode" id="cb981"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb981-1"><a href="ch-11.html#cb981-1" aria-hidden="true" tabindex="-1"></a>history_list <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">&quot;./data/history_list_11.rds&quot;</span>)</span>
<span id="cb981-2"><a href="ch-11.html#cb981-2" aria-hidden="true" tabindex="-1"></a>cv_performance_list <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">&quot;./data/cv_performance_list.rds&quot;</span>)</span></code></pre></div>
<p>After running this loop we would have trained 5 different models, on our cross validation folds, and logged the evaluation results in “cv_performance_list.” Next we want to plot the MSE (mean square error), across the 5 cross validation test folds. Use the list containing these results to make the plot. Taking an average of the cross validation test score (MSE) for all the different folds, we get the average cross validation loss, which can then be used in model tuning.</p>
<div class="sourceCode" id="cb982"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb982-1"><a href="ch-11.html#cb982-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Plot the training history for all the 5 folds </span></span>
<span id="cb982-2"><a href="ch-11.html#cb982-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>){</span>
<span id="cb982-3"><a href="ch-11.html#cb982-3" aria-hidden="true" tabindex="-1"></a>  plt<span class="ot">&lt;-</span><span class="fu">plot</span>(history_list[[i]], <span class="at">metrics =</span> <span class="fu">c</span>(<span class="st">&quot;loss&quot;</span>),  <span class="at">smooth =</span> <span class="fu">getOption</span>(<span class="st">&quot;keras.plot.history.smooth&quot;</span>, <span class="cn">TRUE</span>))</span>
<span id="cb982-4"><a href="ch-11.html#cb982-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(plt)</span>
<span id="cb982-5"><a href="ch-11.html#cb982-5" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb982-6"><a href="ch-11.html#cb982-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb982-7"><a href="ch-11.html#cb982-7" aria-hidden="true" tabindex="-1"></a><span class="do">## plot MSE across cross validation test folds</span></span>
<span id="cb982-8"><a href="ch-11.html#cb982-8" aria-hidden="true" tabindex="-1"></a>loss_list <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="cn">NA</span>, <span class="dv">5</span>)</span>
<span id="cb982-9"><a href="ch-11.html#cb982-9" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>){</span>
<span id="cb982-10"><a href="ch-11.html#cb982-10" aria-hidden="true" tabindex="-1"></a>  loss_list[i] <span class="ot">&lt;-</span> cv_performance_list[[i]]<span class="sc">$</span>mean_squared_error</span>
<span id="cb982-11"><a href="ch-11.html#cb982-11" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb982-12"><a href="ch-11.html#cb982-12" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span> </span>
<span id="cb982-13"><a href="ch-11.html#cb982-13" aria-hidden="true" tabindex="-1"></a><span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>), loss_list), <span class="at">size =</span> <span class="dv">4</span>) <span class="sc">+</span></span>
<span id="cb982-14"><a href="ch-11.html#cb982-14" aria-hidden="true" tabindex="-1"></a><span class="fu">labs</span>(<span class="at">title=</span><span class="st">&quot;MSE on left out folds&quot;</span>,</span>
<span id="cb982-15"><a href="ch-11.html#cb982-15" aria-hidden="true" tabindex="-1"></a>        <span class="at">x =</span><span class="st">&quot;Cross-Validation Folds&quot;</span>, <span class="at">y =</span> <span class="st">&quot;Mean Squared Error&quot;</span>)</span>
<span id="cb982-16"><a href="ch-11.html#cb982-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb982-17"><a href="ch-11.html#cb982-17" aria-hidden="true" tabindex="-1"></a><span class="do">## compute the average MSE across folds</span></span>
<span id="cb982-18"><a href="ch-11.html#cb982-18" aria-hidden="true" tabindex="-1"></a>avg_cv_loss <span class="ot">&lt;-</span> <span class="fu">mean</span>(loss_list)</span>
<span id="cb982-19"><a href="ch-11.html#cb982-19" aria-hidden="true" tabindex="-1"></a>avg_cv_loss</span></code></pre></div>
<p>What is the average cross validation error obtained for this configuration of the network ?</p>
</div>
<div id="parameter-tuning" class="section level3" number="11.2.6">
<h3><span class="header-section-number">11.2.6</span> Parameter Tuning</h3>
<p>Here we will write a function that does the cross-validation for paramater tuning. The content of the cross-validation code remains the same as we have seen before. This is the same code written as a function that also takes the hyper-parameter to be tuned as an argument.
Your task is to optimise the number of hidden units.
First we will orgainse all the steps done until now to write the function.</p>
<div class="sourceCode" id="cb983"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb983-1"><a href="ch-11.html#cb983-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Function Name: cross_validate_model()  </span></span>
<span id="cb983-2"><a href="ch-11.html#cb983-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Inputs: Training split, number of hidden units, and number of epochs  </span></span>
<span id="cb983-3"><a href="ch-11.html#cb983-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Output: The avergae cross validation loss across all 5 folds. </span></span>
<span id="cb983-4"><a href="ch-11.html#cb983-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb983-5"><a href="ch-11.html#cb983-5" aria-hidden="true" tabindex="-1"></a><span class="do">## Hint: All you have to do is organise the steps we followed in the crossvalidation section as a function to make it reproducible  </span></span>
<span id="cb983-6"><a href="ch-11.html#cb983-6" aria-hidden="true" tabindex="-1"></a>cross_validate_model <span class="ot">&lt;-</span> <span class="cf">function</span>(train_split, num_units, num_epochs){</span>
<span id="cb983-7"><a href="ch-11.html#cb983-7" aria-hidden="true" tabindex="-1"></a>   <span class="co">#Randomly shuffle the data</span></span>
<span id="cb983-8"><a href="ch-11.html#cb983-8" aria-hidden="true" tabindex="-1"></a>    cv_data <span class="ot">&lt;-</span> train_split </span>
<span id="cb983-9"><a href="ch-11.html#cb983-9" aria-hidden="true" tabindex="-1"></a>    cv_data <span class="ot">&lt;-</span> cv_data[<span class="fu">sample</span>(<span class="fu">nrow</span>(cv_data)),]</span>
<span id="cb983-10"><a href="ch-11.html#cb983-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb983-11"><a href="ch-11.html#cb983-11" aria-hidden="true" tabindex="-1"></a>    <span class="co">#Create 5 equally size folds</span></span>
<span id="cb983-12"><a href="ch-11.html#cb983-12" aria-hidden="true" tabindex="-1"></a>    folds <span class="ot">&lt;-</span> <span class="fu">cut</span>(<span class="fu">seq</span>(<span class="dv">1</span>,<span class="fu">nrow</span>(cv_data)),<span class="at">breaks=</span><span class="dv">5</span>,<span class="at">labels=</span><span class="cn">FALSE</span>)</span>
<span id="cb983-13"><a href="ch-11.html#cb983-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb983-14"><a href="ch-11.html#cb983-14" aria-hidden="true" tabindex="-1"></a>    history_list <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb983-15"><a href="ch-11.html#cb983-15" aria-hidden="true" tabindex="-1"></a>    cv_performance_list <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb983-16"><a href="ch-11.html#cb983-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb983-17"><a href="ch-11.html#cb983-17" aria-hidden="true" tabindex="-1"></a>    <span class="co">#Perform 5 fold cross validation</span></span>
<span id="cb983-18"><a href="ch-11.html#cb983-18" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>){</span>
<span id="cb983-19"><a href="ch-11.html#cb983-19" aria-hidden="true" tabindex="-1"></a>        <span class="fu">cat</span>(<span class="fu">sprintf</span>(<span class="st">&quot;CV Fold --&gt; %i/5</span><span class="sc">\n</span><span class="st">&quot;</span>, i))</span>
<span id="cb983-20"><a href="ch-11.html#cb983-20" aria-hidden="true" tabindex="-1"></a>        <span class="co">#Segement the data by fold using the which() function</span></span>
<span id="cb983-21"><a href="ch-11.html#cb983-21" aria-hidden="true" tabindex="-1"></a>        indices <span class="ot">&lt;-</span> <span class="fu">which</span>(folds<span class="sc">==</span>i,<span class="at">arr.ind=</span><span class="cn">TRUE</span>)</span>
<span id="cb983-22"><a href="ch-11.html#cb983-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb983-23"><a href="ch-11.html#cb983-23" aria-hidden="true" tabindex="-1"></a>        <span class="do">## indices is a vector with TRUE for the rows where the folds == i; and FALSE for the rest of the row</span></span>
<span id="cb983-24"><a href="ch-11.html#cb983-24" aria-hidden="true" tabindex="-1"></a>        <span class="do">## indices which are TRUE for a particular loop form the cross-validation test set for that loop  </span></span>
<span id="cb983-25"><a href="ch-11.html#cb983-25" aria-hidden="true" tabindex="-1"></a>        cv_test_data <span class="ot">&lt;-</span> cv_data[indices, ]</span>
<span id="cb983-26"><a href="ch-11.html#cb983-26" aria-hidden="true" tabindex="-1"></a>        cv_test_target <span class="ot">&lt;-</span> cv_test_data <span class="sc">%&gt;%</span> <span class="fu">select</span>(target_variable)</span>
<span id="cb983-27"><a href="ch-11.html#cb983-27" aria-hidden="true" tabindex="-1"></a>        cv_test_data <span class="ot">&lt;-</span> cv_test_data <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">-</span><span class="fu">one_of</span>(<span class="fu">c</span>(target_variable, time_cols)))</span>
<span id="cb983-28"><a href="ch-11.html#cb983-28" aria-hidden="true" tabindex="-1"></a>        cv_train_data <span class="ot">&lt;-</span> cv_data[<span class="sc">-</span>indices, ]</span>
<span id="cb983-29"><a href="ch-11.html#cb983-29" aria-hidden="true" tabindex="-1"></a>        cv_train_target <span class="ot">&lt;-</span> cv_train_data <span class="sc">%&gt;%</span> <span class="fu">select</span>(target_variable)</span>
<span id="cb983-30"><a href="ch-11.html#cb983-30" aria-hidden="true" tabindex="-1"></a>        cv_train_data <span class="ot">&lt;-</span> cv_train_data <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">-</span><span class="fu">one_of</span>(<span class="fu">c</span>(target_variable, time_cols)))</span>
<span id="cb983-31"><a href="ch-11.html#cb983-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb983-32"><a href="ch-11.html#cb983-32" aria-hidden="true" tabindex="-1"></a>        <span class="co"># scale and center using cv_train set </span></span>
<span id="cb983-33"><a href="ch-11.html#cb983-33" aria-hidden="true" tabindex="-1"></a>        <span class="co"># get the statistics (mean, variance, etc) of numeric cols </span></span>
<span id="cb983-34"><a href="ch-11.html#cb983-34" aria-hidden="true" tabindex="-1"></a>        cv_train_data_stat <span class="ot">&lt;-</span> <span class="fu">preProcess</span>(cv_train_data, <span class="at">method =</span> <span class="fu">c</span>(<span class="st">&quot;center&quot;</span>,<span class="st">&quot;scale&quot;</span>))  </span>
<span id="cb983-35"><a href="ch-11.html#cb983-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb983-36"><a href="ch-11.html#cb983-36" aria-hidden="true" tabindex="-1"></a>        <span class="co"># transform the train data to center and scale it </span></span>
<span id="cb983-37"><a href="ch-11.html#cb983-37" aria-hidden="true" tabindex="-1"></a>        cv_train_data <span class="ot">&lt;-</span> <span class="fu">predict</span>(cv_train_data_stat, cv_train_data)  </span>
<span id="cb983-38"><a href="ch-11.html#cb983-38" aria-hidden="true" tabindex="-1"></a>        cv_test_data <span class="ot">&lt;-</span> <span class="fu">predict</span>(cv_train_data_stat, cv_test_data)</span>
<span id="cb983-39"><a href="ch-11.html#cb983-39" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb983-40"><a href="ch-11.html#cb983-40" aria-hidden="true" tabindex="-1"></a>        <span class="co"># OR </span></span>
<span id="cb983-41"><a href="ch-11.html#cb983-41" aria-hidden="true" tabindex="-1"></a>        <span class="co"># scale_and_center&lt;- recipe(cv_train_data) %&gt;%</span></span>
<span id="cb983-42"><a href="ch-11.html#cb983-42" aria-hidden="true" tabindex="-1"></a>        <span class="co">#                             step_center(all_numeric()) %&gt;%</span></span>
<span id="cb983-43"><a href="ch-11.html#cb983-43" aria-hidden="true" tabindex="-1"></a>        <span class="co">#                             step_scale(all_numeric())</span></span>
<span id="cb983-44"><a href="ch-11.html#cb983-44" aria-hidden="true" tabindex="-1"></a>        <span class="co"># prep_recipe &lt;- prep(scale_and_center, training = cv_train_data)</span></span>
<span id="cb983-45"><a href="ch-11.html#cb983-45" aria-hidden="true" tabindex="-1"></a>        <span class="co"># cv_train_data &lt;- bake(prep_recipe, new_data = cv_train_data)</span></span>
<span id="cb983-46"><a href="ch-11.html#cb983-46" aria-hidden="true" tabindex="-1"></a>        <span class="co"># cv_test_data &lt;- bake(prep_recipe, new_data = cv_test_data)</span></span>
<span id="cb983-47"><a href="ch-11.html#cb983-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb983-48"><a href="ch-11.html#cb983-48" aria-hidden="true" tabindex="-1"></a>        <span class="co"># if(!missing(subset_predictors)){</span></span>
<span id="cb983-49"><a href="ch-11.html#cb983-49" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ## take a subset of predictors</span></span>
<span id="cb983-50"><a href="ch-11.html#cb983-50" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   cv_train_data &lt;- cv_train_data %&gt;% select(subset_predictors)</span></span>
<span id="cb983-51"><a href="ch-11.html#cb983-51" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   cv_test_data &lt;- cv_test_data %&gt;% select(subset_predictors)</span></span>
<span id="cb983-52"><a href="ch-11.html#cb983-52" aria-hidden="true" tabindex="-1"></a>        <span class="co"># }</span></span>
<span id="cb983-53"><a href="ch-11.html#cb983-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb983-54"><a href="ch-11.html#cb983-54" aria-hidden="true" tabindex="-1"></a>        cv_train_data <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(cv_train_data)</span>
<span id="cb983-55"><a href="ch-11.html#cb983-55" aria-hidden="true" tabindex="-1"></a>        cv_train_target <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(cv_train_target)</span>
<span id="cb983-56"><a href="ch-11.html#cb983-56" aria-hidden="true" tabindex="-1"></a>        cv_test_data <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(cv_test_data)</span>
<span id="cb983-57"><a href="ch-11.html#cb983-57" aria-hidden="true" tabindex="-1"></a>        cv_test_target <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(cv_test_target)</span>
<span id="cb983-58"><a href="ch-11.html#cb983-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb983-59"><a href="ch-11.html#cb983-59" aria-hidden="true" tabindex="-1"></a>        cv_model <span class="ot">&lt;-</span> <span class="fu">build_model</span>(<span class="at">X_train =</span> cv_train_data, <span class="at">y_train =</span> cv_train_target, </span>
<span id="cb983-60"><a href="ch-11.html#cb983-60" aria-hidden="true" tabindex="-1"></a>                  <span class="at">num_units =</span> num_units,</span>
<span id="cb983-61"><a href="ch-11.html#cb983-61" aria-hidden="true" tabindex="-1"></a>                  <span class="at">activation_type =</span> <span class="st">&quot;relu&quot;</span>,</span>
<span id="cb983-62"><a href="ch-11.html#cb983-62" aria-hidden="true" tabindex="-1"></a>                  <span class="at">num_epochs =</span> num_epochs,</span>
<span id="cb983-63"><a href="ch-11.html#cb983-63" aria-hidden="true" tabindex="-1"></a>                  <span class="at">batch_size =</span> <span class="dv">128</span>,</span>
<span id="cb983-64"><a href="ch-11.html#cb983-64" aria-hidden="true" tabindex="-1"></a>                  <span class="at">val_size =</span> <span class="fl">0.15</span>)</span>
<span id="cb983-65"><a href="ch-11.html#cb983-65" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb983-66"><a href="ch-11.html#cb983-66" aria-hidden="true" tabindex="-1"></a>        eval_result <span class="ot">&lt;-</span> cv_model<span class="sc">$</span>model <span class="sc">%&gt;%</span> <span class="fu">evaluate</span>(cv_test_data, cv_test_target)</span>
<span id="cb983-67"><a href="ch-11.html#cb983-67" aria-hidden="true" tabindex="-1"></a>        cv_performance_list[[i]] <span class="ot">&lt;-</span> eval_result</span>
<span id="cb983-68"><a href="ch-11.html#cb983-68" aria-hidden="true" tabindex="-1"></a>        <span class="fu">cat</span>(<span class="st">&quot;Evaluation error on the held out fold: &quot;</span> , eval_result<span class="sc">$</span>mean_squared_error,<span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb983-69"><a href="ch-11.html#cb983-69" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb983-70"><a href="ch-11.html#cb983-70" aria-hidden="true" tabindex="-1"></a>    }</span></code></pre></div>
<p><img src="figures/11_output-loss1.png" />
<img src="figures/11_output-loss2.png" />
<img src="figures/11_output-loss3.png" />
<img src="figures/11_output-loss4.png" /></p>
<div class="sourceCode" id="cb984"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb984-1"><a href="ch-11.html#cb984-1" aria-hidden="true" tabindex="-1"></a>loss_list <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="cn">NA</span>, <span class="dv">5</span>)</span>
<span id="cb984-2"><a href="ch-11.html#cb984-2" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>){</span>
<span id="cb984-3"><a href="ch-11.html#cb984-3" aria-hidden="true" tabindex="-1"></a>    loss_list[i] <span class="ot">&lt;-</span> cv_performance_list[[i]]<span class="sc">$</span>mean_squared_error</span>
<span id="cb984-4"><a href="ch-11.html#cb984-4" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb984-5"><a href="ch-11.html#cb984-5" aria-hidden="true" tabindex="-1"></a>  avg_cv_loss <span class="ot">&lt;-</span> <span class="fu">mean</span>(loss_list)</span>
<span id="cb984-6"><a href="ch-11.html#cb984-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(avg_cv_loss)</span>
<span id="cb984-7"><a href="ch-11.html#cb984-7" aria-hidden="true" tabindex="-1"></a><span class="er">}</span></span></code></pre></div>
<p><img src="figures/11_output-mse.png" /></p>
<p>Next you need to write a function to iterate over the list of hyper-parameters. In each iteration we iterate over a list of the possible number of hidden units, and compute the average cross-validation error.</p>
<div class="sourceCode" id="cb985"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb985-1"><a href="ch-11.html#cb985-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Function Name: tune_num_units()  </span></span>
<span id="cb985-2"><a href="ch-11.html#cb985-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Inputs: training split, num_units --&gt; a vector containing the possible values of hidden units  </span></span>
<span id="cb985-3"><a href="ch-11.html#cb985-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Output: List / vector containing the average cross validation loss for each possible value of hidden units  </span></span>
<span id="cb985-4"><a href="ch-11.html#cb985-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb985-5"><a href="ch-11.html#cb985-5" aria-hidden="true" tabindex="-1"></a>tune_num_units <span class="ot">&lt;-</span> <span class="cf">function</span>(train_split,  num_units){</span>
<span id="cb985-6"><a href="ch-11.html#cb985-6" aria-hidden="true" tabindex="-1"></a>  <span class="do">## create an empty list to store the average loss for each value in num_units </span></span>
<span id="cb985-7"><a href="ch-11.html#cb985-7" aria-hidden="true" tabindex="-1"></a>  avg_loss_list<span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="cn">NA</span>, <span class="fu">length</span>(num_units))</span>
<span id="cb985-8"><a href="ch-11.html#cb985-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb985-9"><a href="ch-11.html#cb985-9" aria-hidden="true" tabindex="-1"></a>  <span class="do">## write a loop to iterate over num_units and store the average cross validation loss </span></span>
<span id="cb985-10"><a href="ch-11.html#cb985-10" aria-hidden="true" tabindex="-1"></a>  p <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb985-11"><a href="ch-11.html#cb985-11" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (k <span class="cf">in</span> num_units){</span>
<span id="cb985-12"><a href="ch-11.html#cb985-12" aria-hidden="true" tabindex="-1"></a>    loss <span class="ot">&lt;-</span> <span class="fu">cross_validate_model</span>(<span class="at">train_split =</span> train_split, <span class="at">num_units =</span> k, <span class="at">num_epochs =</span> <span class="dv">30</span>)</span>
<span id="cb985-13"><a href="ch-11.html#cb985-13" aria-hidden="true" tabindex="-1"></a>    avg_loss_list[p] <span class="ot">&lt;-</span> loss</span>
<span id="cb985-14"><a href="ch-11.html#cb985-14" aria-hidden="true" tabindex="-1"></a>    p <span class="ot">&lt;-</span> p<span class="sc">+</span><span class="dv">1</span> </span>
<span id="cb985-15"><a href="ch-11.html#cb985-15" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb985-16"><a href="ch-11.html#cb985-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(avg_loss_list)</span>
<span id="cb985-17"><a href="ch-11.html#cb985-17" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb985-18"><a href="ch-11.html#cb985-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(avg_loss_list)</span>
<span id="cb985-19"><a href="ch-11.html#cb985-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb985-20"><a href="ch-11.html#cb985-20" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<div class="sourceCode" id="cb986"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb986-1"><a href="ch-11.html#cb986-1" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 24.52219</span></span></code></pre></div>
<p>Now let’s consider the given vector “num_units” for tuning the number of hidden units</p>
<div class="sourceCode" id="cb987"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb987-1"><a href="ch-11.html#cb987-1" aria-hidden="true" tabindex="-1"></a><span class="co"># num_units &lt;- c(1,3,10,30,100)</span></span>
<span id="cb987-2"><a href="ch-11.html#cb987-2" aria-hidden="true" tabindex="-1"></a>num_units <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">3</span>,<span class="dv">10</span>,<span class="dv">30</span>,<span class="dv">100</span>)</span>
<span id="cb987-3"><a href="ch-11.html#cb987-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb987-4"><a href="ch-11.html#cb987-4" aria-hidden="true" tabindex="-1"></a><span class="do">## compute the average cross validation loss for each element in num_units using tune_num_units()</span></span>
<span id="cb987-5"><a href="ch-11.html#cb987-5" aria-hidden="true" tabindex="-1"></a><span class="co">#  Output is shown at bottom of this chapter due to its length.</span></span>
<span id="cb987-6"><a href="ch-11.html#cb987-6" aria-hidden="true" tabindex="-1"></a>tune_results <span class="ot">&lt;-</span> <span class="fu">tune_num_units</span>(<span class="at">train_split =</span> train_split, <span class="at">num_units =</span> num_units)</span></code></pre></div>
<div class="sourceCode" id="cb988"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb988-1"><a href="ch-11.html#cb988-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Print out the results </span></span>
<span id="cb988-2"><a href="ch-11.html#cb988-2" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(tune_results)</span></code></pre></div>
<div class="sourceCode" id="cb989"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb989-1"><a href="ch-11.html#cb989-1" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 31.07678 25.69231 24.78246 24.29657 23.89560</span></span></code></pre></div>
<div class="sourceCode" id="cb990"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb990-1"><a href="ch-11.html#cb990-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Plot the average cross validation loss, as a function of the num_units </span></span>
<span id="cb990-2"><a href="ch-11.html#cb990-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(num_units, tune_results, <span class="at">type =</span> <span class="st">&quot;b&quot;</span>)</span></code></pre></div>
<p><img src="figures/11_output-tune.png" /></p>
<div class="sourceCode" id="cb991"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb991-1"><a href="ch-11.html#cb991-1" aria-hidden="true" tabindex="-1"></a><span class="do">## What is the number of hidden units that gives the minimum loss ? </span></span>
<span id="cb991-2"><a href="ch-11.html#cb991-2" aria-hidden="true" tabindex="-1"></a>min_loss <span class="ot">&lt;-</span> <span class="fu">min</span>(tune_results)</span>
<span id="cb991-3"><a href="ch-11.html#cb991-3" aria-hidden="true" tabindex="-1"></a>min_loss_index <span class="ot">&lt;-</span> <span class="fu">which.min</span>(tune_results)</span>
<span id="cb991-4"><a href="ch-11.html#cb991-4" aria-hidden="true" tabindex="-1"></a>num_units_best <span class="ot">&lt;-</span> num_units[min_loss_index]</span>
<span id="cb991-5"><a href="ch-11.html#cb991-5" aria-hidden="true" tabindex="-1"></a><span class="fu">sprintf</span>(<span class="st">&quot;Number of units for mininmal average cross validation error: %i&quot;</span>, num_units_best)</span></code></pre></div>
<div class="sourceCode" id="cb992"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb992-1"><a href="ch-11.html#cb992-1" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] &quot;Number of units for mininmal average cross validation error: 100&quot;</span></span></code></pre></div>
<p>What is the most practical number of hidden units in your opinion? (Consider the tradeoff between the reduction in MSE loss with the increase in hidden units and the increase in training time and model complexity, and number of parameters to be learnt)</p>
<p>As one might suspect network with 100 hidden units gives the minimum loss, but it is only marginally better than a network with 30 hidden units. So, one might consider using 30 hidden units as it gives a reasonable tradeoff between model complexity and the cross validation loss. Also note that if we decrease the model complexity too much, the loss on cross-validation increases significantly.</p>
<p>Closing remarks: Finally, in practice, when you arrive at the optimal model parameters after cross-validation, you train a new model, using the entire training set, and use the initial held-out test set (20%) to evaluate the model’s performance on new data.</p>
<div class="sourceCode" id="cb993"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb993-1"><a href="ch-11.html#cb993-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Output of tune_results &lt;- tune_num_units(train_split = train_split, num_units = num_units)</span></span>
<span id="cb993-2"><a href="ch-11.html#cb993-2" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb993-3"><a href="ch-11.html#cb993-3" aria-hidden="true" tabindex="-1"></a><span class="do">## CV Fold --&gt; 1/5</span></span>
<span id="cb993-4"><a href="ch-11.html#cb993-4" aria-hidden="true" tabindex="-1"></a><span class="do">## Model: &quot;sequential_6&quot;</span></span>
<span id="cb993-5"><a href="ch-11.html#cb993-5" aria-hidden="true" tabindex="-1"></a><span class="do">## ________________________________________________________________________________</span></span>
<span id="cb993-6"><a href="ch-11.html#cb993-6" aria-hidden="true" tabindex="-1"></a><span class="do">## Layer (type)                        Output Shape                    Param #     </span></span>
<span id="cb993-7"><a href="ch-11.html#cb993-7" aria-hidden="true" tabindex="-1"></a><span class="do">## ================================================================================</span></span>
<span id="cb993-8"><a href="ch-11.html#cb993-8" aria-hidden="true" tabindex="-1"></a><span class="do">## dense_12 (Dense)                    (None, 1)                       16          </span></span>
<span id="cb993-9"><a href="ch-11.html#cb993-9" aria-hidden="true" tabindex="-1"></a><span class="do">## ________________________________________________________________________________</span></span>
<span id="cb993-10"><a href="ch-11.html#cb993-10" aria-hidden="true" tabindex="-1"></a><span class="do">## dense_13 (Dense)                    (None, 1)                       2           </span></span>
<span id="cb993-11"><a href="ch-11.html#cb993-11" aria-hidden="true" tabindex="-1"></a><span class="do">## ================================================================================</span></span>
<span id="cb993-12"><a href="ch-11.html#cb993-12" aria-hidden="true" tabindex="-1"></a><span class="do">## Total params: 18</span></span>
<span id="cb993-13"><a href="ch-11.html#cb993-13" aria-hidden="true" tabindex="-1"></a><span class="do">## Trainable params: 18</span></span>
<span id="cb993-14"><a href="ch-11.html#cb993-14" aria-hidden="true" tabindex="-1"></a><span class="do">## Non-trainable params: 0</span></span>
<span id="cb993-15"><a href="ch-11.html#cb993-15" aria-hidden="true" tabindex="-1"></a><span class="do">## ________________________________________________________________________________</span></span>
<span id="cb993-16"><a href="ch-11.html#cb993-16" aria-hidden="true" tabindex="-1"></a><span class="do">## Evaluation error on the held out fold:  34.77391 </span></span>
<span id="cb993-17"><a href="ch-11.html#cb993-17" aria-hidden="true" tabindex="-1"></a><span class="do">## CV Fold --&gt; 2/5</span></span>
<span id="cb993-18"><a href="ch-11.html#cb993-18" aria-hidden="true" tabindex="-1"></a><span class="do">## Model: &quot;sequential_7&quot;</span></span>
<span id="cb993-19"><a href="ch-11.html#cb993-19" aria-hidden="true" tabindex="-1"></a><span class="do">## ________________________________________________________________________________</span></span>
<span id="cb993-20"><a href="ch-11.html#cb993-20" aria-hidden="true" tabindex="-1"></a><span class="do">## Layer (type)                        Output Shape                    Param #     </span></span>
<span id="cb993-21"><a href="ch-11.html#cb993-21" aria-hidden="true" tabindex="-1"></a><span class="do">## ================================================================================</span></span>
<span id="cb993-22"><a href="ch-11.html#cb993-22" aria-hidden="true" tabindex="-1"></a><span class="do">## dense_14 (Dense)                    (None, 1)                       16          </span></span>
<span id="cb993-23"><a href="ch-11.html#cb993-23" aria-hidden="true" tabindex="-1"></a><span class="do">## ________________________________________________________________________________</span></span>
<span id="cb993-24"><a href="ch-11.html#cb993-24" aria-hidden="true" tabindex="-1"></a><span class="do">## dense_15 (Dense)                    (None, 1)                       2           </span></span>
<span id="cb993-25"><a href="ch-11.html#cb993-25" aria-hidden="true" tabindex="-1"></a><span class="do">## ================================================================================</span></span>
<span id="cb993-26"><a href="ch-11.html#cb993-26" aria-hidden="true" tabindex="-1"></a><span class="do">## Total params: 18</span></span>
<span id="cb993-27"><a href="ch-11.html#cb993-27" aria-hidden="true" tabindex="-1"></a><span class="do">## Trainable params: 18</span></span>
<span id="cb993-28"><a href="ch-11.html#cb993-28" aria-hidden="true" tabindex="-1"></a><span class="do">## Non-trainable params: 0</span></span>
<span id="cb993-29"><a href="ch-11.html#cb993-29" aria-hidden="true" tabindex="-1"></a><span class="do">## ________________________________________________________________________________</span></span>
<span id="cb993-30"><a href="ch-11.html#cb993-30" aria-hidden="true" tabindex="-1"></a><span class="do">## Evaluation error on the held out fold:  29.33935 </span></span>
<span id="cb993-31"><a href="ch-11.html#cb993-31" aria-hidden="true" tabindex="-1"></a><span class="do">## CV Fold --&gt; 3/5</span></span>
<span id="cb993-32"><a href="ch-11.html#cb993-32" aria-hidden="true" tabindex="-1"></a><span class="do">## Model: &quot;sequential_8&quot;</span></span>
<span id="cb993-33"><a href="ch-11.html#cb993-33" aria-hidden="true" tabindex="-1"></a><span class="do">## ________________________________________________________________________________</span></span>
<span id="cb993-34"><a href="ch-11.html#cb993-34" aria-hidden="true" tabindex="-1"></a><span class="do">## Layer (type)                        Output Shape                    Param #     </span></span>
<span id="cb993-35"><a href="ch-11.html#cb993-35" aria-hidden="true" tabindex="-1"></a><span class="do">## ================================================================================</span></span>
<span id="cb993-36"><a href="ch-11.html#cb993-36" aria-hidden="true" tabindex="-1"></a><span class="do">## dense_16 (Dense)                    (None, 1)                       16          </span></span>
<span id="cb993-37"><a href="ch-11.html#cb993-37" aria-hidden="true" tabindex="-1"></a><span class="do">## ________________________________________________________________________________</span></span>
<span id="cb993-38"><a href="ch-11.html#cb993-38" aria-hidden="true" tabindex="-1"></a><span class="do">## dense_17 (Dense)                    (None, 1)                       2           </span></span>
<span id="cb993-39"><a href="ch-11.html#cb993-39" aria-hidden="true" tabindex="-1"></a><span class="do">## ================================================================================</span></span>
<span id="cb993-40"><a href="ch-11.html#cb993-40" aria-hidden="true" tabindex="-1"></a><span class="do">## Total params: 18</span></span>
<span id="cb993-41"><a href="ch-11.html#cb993-41" aria-hidden="true" tabindex="-1"></a><span class="do">## Trainable params: 18</span></span>
<span id="cb993-42"><a href="ch-11.html#cb993-42" aria-hidden="true" tabindex="-1"></a><span class="do">## Non-trainable params: 0</span></span>
<span id="cb993-43"><a href="ch-11.html#cb993-43" aria-hidden="true" tabindex="-1"></a><span class="do">## ________________________________________________________________________________</span></span>
<span id="cb993-44"><a href="ch-11.html#cb993-44" aria-hidden="true" tabindex="-1"></a><span class="do">## Evaluation error on the held out fold:  28.22049 </span></span>
<span id="cb993-45"><a href="ch-11.html#cb993-45" aria-hidden="true" tabindex="-1"></a><span class="do">## CV Fold --&gt; 4/5</span></span>
<span id="cb993-46"><a href="ch-11.html#cb993-46" aria-hidden="true" tabindex="-1"></a><span class="do">## Model: &quot;sequential_9&quot;</span></span>
<span id="cb993-47"><a href="ch-11.html#cb993-47" aria-hidden="true" tabindex="-1"></a><span class="do">## ________________________________________________________________________________</span></span>
<span id="cb993-48"><a href="ch-11.html#cb993-48" aria-hidden="true" tabindex="-1"></a><span class="do">## Layer (type)                        Output Shape                    Param #     </span></span>
<span id="cb993-49"><a href="ch-11.html#cb993-49" aria-hidden="true" tabindex="-1"></a><span class="do">## ================================================================================</span></span>
<span id="cb993-50"><a href="ch-11.html#cb993-50" aria-hidden="true" tabindex="-1"></a><span class="do">## dense_18 (Dense)                    (None, 1)                       16          </span></span>
<span id="cb993-51"><a href="ch-11.html#cb993-51" aria-hidden="true" tabindex="-1"></a><span class="do">## ________________________________________________________________________________</span></span>
<span id="cb993-52"><a href="ch-11.html#cb993-52" aria-hidden="true" tabindex="-1"></a><span class="do">## dense_19 (Dense)                    (None, 1)                       2           </span></span>
<span id="cb993-53"><a href="ch-11.html#cb993-53" aria-hidden="true" tabindex="-1"></a><span class="do">## ================================================================================</span></span>
<span id="cb993-54"><a href="ch-11.html#cb993-54" aria-hidden="true" tabindex="-1"></a><span class="do">## Total params: 18</span></span>
<span id="cb993-55"><a href="ch-11.html#cb993-55" aria-hidden="true" tabindex="-1"></a><span class="do">## Trainable params: 18</span></span>
<span id="cb993-56"><a href="ch-11.html#cb993-56" aria-hidden="true" tabindex="-1"></a><span class="do">## Non-trainable params: 0</span></span>
<span id="cb993-57"><a href="ch-11.html#cb993-57" aria-hidden="true" tabindex="-1"></a><span class="do">## ________________________________________________________________________________</span></span>
<span id="cb993-58"><a href="ch-11.html#cb993-58" aria-hidden="true" tabindex="-1"></a><span class="do">## Evaluation error on the held out fold:  28.60611 </span></span>
<span id="cb993-59"><a href="ch-11.html#cb993-59" aria-hidden="true" tabindex="-1"></a><span class="do">## CV Fold --&gt; 5/5</span></span>
<span id="cb993-60"><a href="ch-11.html#cb993-60" aria-hidden="true" tabindex="-1"></a><span class="do">## Model: &quot;sequential_10&quot;</span></span>
<span id="cb993-61"><a href="ch-11.html#cb993-61" aria-hidden="true" tabindex="-1"></a><span class="do">## ________________________________________________________________________________</span></span>
<span id="cb993-62"><a href="ch-11.html#cb993-62" aria-hidden="true" tabindex="-1"></a><span class="do">## Layer (type)                        Output Shape                    Param #     </span></span>
<span id="cb993-63"><a href="ch-11.html#cb993-63" aria-hidden="true" tabindex="-1"></a><span class="do">## ================================================================================</span></span>
<span id="cb993-64"><a href="ch-11.html#cb993-64" aria-hidden="true" tabindex="-1"></a><span class="do">## dense_20 (Dense)                    (None, 1)                       16          </span></span>
<span id="cb993-65"><a href="ch-11.html#cb993-65" aria-hidden="true" tabindex="-1"></a><span class="do">## ________________________________________________________________________________</span></span>
<span id="cb993-66"><a href="ch-11.html#cb993-66" aria-hidden="true" tabindex="-1"></a><span class="do">## dense_21 (Dense)                    (None, 1)                       2           </span></span>
<span id="cb993-67"><a href="ch-11.html#cb993-67" aria-hidden="true" tabindex="-1"></a><span class="do">## ================================================================================</span></span>
<span id="cb993-68"><a href="ch-11.html#cb993-68" aria-hidden="true" tabindex="-1"></a><span class="do">## Total params: 18</span></span>
<span id="cb993-69"><a href="ch-11.html#cb993-69" aria-hidden="true" tabindex="-1"></a><span class="do">## Trainable params: 18</span></span>
<span id="cb993-70"><a href="ch-11.html#cb993-70" aria-hidden="true" tabindex="-1"></a><span class="do">## Non-trainable params: 0</span></span>
<span id="cb993-71"><a href="ch-11.html#cb993-71" aria-hidden="true" tabindex="-1"></a><span class="do">## ________________________________________________________________________________</span></span>
<span id="cb993-72"><a href="ch-11.html#cb993-72" aria-hidden="true" tabindex="-1"></a><span class="do">## Evaluation error on the held out fold:  34.44407 </span></span>
<span id="cb993-73"><a href="ch-11.html#cb993-73" aria-hidden="true" tabindex="-1"></a><span class="do">## CV Fold --&gt; 1/5</span></span>
<span id="cb993-74"><a href="ch-11.html#cb993-74" aria-hidden="true" tabindex="-1"></a><span class="do">## Model: &quot;sequential_11&quot;</span></span>
<span id="cb993-75"><a href="ch-11.html#cb993-75" aria-hidden="true" tabindex="-1"></a><span class="do">## ________________________________________________________________________________</span></span>
<span id="cb993-76"><a href="ch-11.html#cb993-76" aria-hidden="true" tabindex="-1"></a><span class="do">## Layer (type)                        Output Shape                    Param #     </span></span>
<span id="cb993-77"><a href="ch-11.html#cb993-77" aria-hidden="true" tabindex="-1"></a><span class="do">## ================================================================================</span></span>
<span id="cb993-78"><a href="ch-11.html#cb993-78" aria-hidden="true" tabindex="-1"></a><span class="do">## dense_22 (Dense)                    (None, 3)                       48          </span></span>
<span id="cb993-79"><a href="ch-11.html#cb993-79" aria-hidden="true" tabindex="-1"></a><span class="do">## ________________________________________________________________________________</span></span>
<span id="cb993-80"><a href="ch-11.html#cb993-80" aria-hidden="true" tabindex="-1"></a><span class="do">## dense_23 (Dense)                    (None, 1)                       4           </span></span>
<span id="cb993-81"><a href="ch-11.html#cb993-81" aria-hidden="true" tabindex="-1"></a><span class="do">## ================================================================================</span></span>
<span id="cb993-82"><a href="ch-11.html#cb993-82" aria-hidden="true" tabindex="-1"></a><span class="do">## Total params: 52</span></span>
<span id="cb993-83"><a href="ch-11.html#cb993-83" aria-hidden="true" tabindex="-1"></a><span class="do">## Trainable params: 52</span></span>
<span id="cb993-84"><a href="ch-11.html#cb993-84" aria-hidden="true" tabindex="-1"></a><span class="do">## Non-trainable params: 0</span></span>
<span id="cb993-85"><a href="ch-11.html#cb993-85" aria-hidden="true" tabindex="-1"></a><span class="do">## ________________________________________________________________________________</span></span>
<span id="cb993-86"><a href="ch-11.html#cb993-86" aria-hidden="true" tabindex="-1"></a><span class="do">## Evaluation error on the held out fold:  25.88199 </span></span>
<span id="cb993-87"><a href="ch-11.html#cb993-87" aria-hidden="true" tabindex="-1"></a><span class="do">## CV Fold --&gt; 2/5</span></span>
<span id="cb993-88"><a href="ch-11.html#cb993-88" aria-hidden="true" tabindex="-1"></a><span class="do">## Model: &quot;sequential_12&quot;</span></span>
<span id="cb993-89"><a href="ch-11.html#cb993-89" aria-hidden="true" tabindex="-1"></a><span class="do">## ________________________________________________________________________________</span></span>
<span id="cb993-90"><a href="ch-11.html#cb993-90" aria-hidden="true" tabindex="-1"></a><span class="do">## Layer (type)                        Output Shape                    Param #     </span></span>
<span id="cb993-91"><a href="ch-11.html#cb993-91" aria-hidden="true" tabindex="-1"></a><span class="do">## ================================================================================</span></span>
<span id="cb993-92"><a href="ch-11.html#cb993-92" aria-hidden="true" tabindex="-1"></a><span class="do">## dense_24 (Dense)                    (None, 3)                       48          </span></span>
<span id="cb993-93"><a href="ch-11.html#cb993-93" aria-hidden="true" tabindex="-1"></a><span class="do">## ________________________________________________________________________________</span></span>
<span id="cb993-94"><a href="ch-11.html#cb993-94" aria-hidden="true" tabindex="-1"></a><span class="do">## dense_25 (Dense)                    (None, 1)                       4           </span></span>
<span id="cb993-95"><a href="ch-11.html#cb993-95" aria-hidden="true" tabindex="-1"></a><span class="do">## ================================================================================</span></span>
<span id="cb993-96"><a href="ch-11.html#cb993-96" aria-hidden="true" tabindex="-1"></a><span class="do">## Total params: 52</span></span>
<span id="cb993-97"><a href="ch-11.html#cb993-97" aria-hidden="true" tabindex="-1"></a><span class="do">## Trainable params: 52</span></span>
<span id="cb993-98"><a href="ch-11.html#cb993-98" aria-hidden="true" tabindex="-1"></a><span class="do">## Non-trainable params: 0</span></span>
<span id="cb993-99"><a href="ch-11.html#cb993-99" aria-hidden="true" tabindex="-1"></a><span class="do">## ________________________________________________________________________________</span></span>
<span id="cb993-100"><a href="ch-11.html#cb993-100" aria-hidden="true" tabindex="-1"></a><span class="do">## Evaluation error on the held out fold:  25.98859 </span></span>
<span id="cb993-101"><a href="ch-11.html#cb993-101" aria-hidden="true" tabindex="-1"></a><span class="do">## CV Fold --&gt; 3/5</span></span>
<span id="cb993-102"><a href="ch-11.html#cb993-102" aria-hidden="true" tabindex="-1"></a><span class="do">## Model: &quot;sequential_13&quot;</span></span>
<span id="cb993-103"><a href="ch-11.html#cb993-103" aria-hidden="true" tabindex="-1"></a><span class="do">## ________________________________________________________________________________</span></span>
<span id="cb993-104"><a href="ch-11.html#cb993-104" aria-hidden="true" tabindex="-1"></a><span class="do">## Layer (type)                        Output Shape                    Param #     </span></span>
<span id="cb993-105"><a href="ch-11.html#cb993-105" aria-hidden="true" tabindex="-1"></a><span class="do">## ================================================================================</span></span>
<span id="cb993-106"><a href="ch-11.html#cb993-106" aria-hidden="true" tabindex="-1"></a><span class="do">## dense_26 (Dense)                    (None, 3)                       48          </span></span>
<span id="cb993-107"><a href="ch-11.html#cb993-107" aria-hidden="true" tabindex="-1"></a><span class="do">## ________________________________________________________________________________</span></span>
<span id="cb993-108"><a href="ch-11.html#cb993-108" aria-hidden="true" tabindex="-1"></a><span class="do">## dense_27 (Dense)                    (None, 1)                       4           </span></span>
<span id="cb993-109"><a href="ch-11.html#cb993-109" aria-hidden="true" tabindex="-1"></a><span class="do">## ================================================================================</span></span>
<span id="cb993-110"><a href="ch-11.html#cb993-110" aria-hidden="true" tabindex="-1"></a><span class="do">## Total params: 52</span></span>
<span id="cb993-111"><a href="ch-11.html#cb993-111" aria-hidden="true" tabindex="-1"></a><span class="do">## Trainable params: 52</span></span>
<span id="cb993-112"><a href="ch-11.html#cb993-112" aria-hidden="true" tabindex="-1"></a><span class="do">## Non-trainable params: 0</span></span>
<span id="cb993-113"><a href="ch-11.html#cb993-113" aria-hidden="true" tabindex="-1"></a><span class="do">## ________________________________________________________________________________</span></span>
<span id="cb993-114"><a href="ch-11.html#cb993-114" aria-hidden="true" tabindex="-1"></a><span class="do">## Evaluation error on the held out fold:  25.33782 </span></span>
<span id="cb993-115"><a href="ch-11.html#cb993-115" aria-hidden="true" tabindex="-1"></a><span class="do">## CV Fold --&gt; 4/5</span></span>
<span id="cb993-116"><a href="ch-11.html#cb993-116" aria-hidden="true" tabindex="-1"></a><span class="do">## Model: &quot;sequential_14&quot;</span></span>
<span id="cb993-117"><a href="ch-11.html#cb993-117" aria-hidden="true" tabindex="-1"></a><span class="do">## ________________________________________________________________________________</span></span>
<span id="cb993-118"><a href="ch-11.html#cb993-118" aria-hidden="true" tabindex="-1"></a><span class="do">## Layer (type)                        Output Shape                    Param #     </span></span>
<span id="cb993-119"><a href="ch-11.html#cb993-119" aria-hidden="true" tabindex="-1"></a><span class="do">## ================================================================================</span></span>
<span id="cb993-120"><a href="ch-11.html#cb993-120" aria-hidden="true" tabindex="-1"></a><span class="do">## dense_28 (Dense)                    (None, 3)                       48          </span></span>
<span id="cb993-121"><a href="ch-11.html#cb993-121" aria-hidden="true" tabindex="-1"></a><span class="do">## ________________________________________________________________________________</span></span>
<span id="cb993-122"><a href="ch-11.html#cb993-122" aria-hidden="true" tabindex="-1"></a><span class="do">## dense_29 (Dense)                    (None, 1)                       4           </span></span>
<span id="cb993-123"><a href="ch-11.html#cb993-123" aria-hidden="true" tabindex="-1"></a><span class="do">## ================================================================================</span></span>
<span id="cb993-124"><a href="ch-11.html#cb993-124" aria-hidden="true" tabindex="-1"></a><span class="do">## Total params: 52</span></span>
<span id="cb993-125"><a href="ch-11.html#cb993-125" aria-hidden="true" tabindex="-1"></a><span class="do">## Trainable params: 52</span></span>
<span id="cb993-126"><a href="ch-11.html#cb993-126" aria-hidden="true" tabindex="-1"></a><span class="do">## Non-trainable params: 0</span></span>
<span id="cb993-127"><a href="ch-11.html#cb993-127" aria-hidden="true" tabindex="-1"></a><span class="do">## ________________________________________________________________________________</span></span>
<span id="cb993-128"><a href="ch-11.html#cb993-128" aria-hidden="true" tabindex="-1"></a><span class="do">## Evaluation error on the held out fold:  25.62691 </span></span>
<span id="cb993-129"><a href="ch-11.html#cb993-129" aria-hidden="true" tabindex="-1"></a><span class="do">## CV Fold --&gt; 5/5</span></span>
<span id="cb993-130"><a href="ch-11.html#cb993-130" aria-hidden="true" tabindex="-1"></a><span class="do">## Model: &quot;sequential_15&quot;</span></span>
<span id="cb993-131"><a href="ch-11.html#cb993-131" aria-hidden="true" tabindex="-1"></a><span class="do">## ________________________________________________________________________________</span></span>
<span id="cb993-132"><a href="ch-11.html#cb993-132" aria-hidden="true" tabindex="-1"></a><span class="do">## Layer (type)                        Output Shape                    Param #     </span></span>
<span id="cb993-133"><a href="ch-11.html#cb993-133" aria-hidden="true" tabindex="-1"></a><span class="do">## ================================================================================</span></span>
<span id="cb993-134"><a href="ch-11.html#cb993-134" aria-hidden="true" tabindex="-1"></a><span class="do">## dense_30 (Dense)                    (None, 3)                       48          </span></span>
<span id="cb993-135"><a href="ch-11.html#cb993-135" aria-hidden="true" tabindex="-1"></a><span class="do">## ________________________________________________________________________________</span></span>
<span id="cb993-136"><a href="ch-11.html#cb993-136" aria-hidden="true" tabindex="-1"></a><span class="do">## dense_31 (Dense)                    (None, 1)                       4           </span></span>
<span id="cb993-137"><a href="ch-11.html#cb993-137" aria-hidden="true" tabindex="-1"></a><span class="do">## ================================================================================</span></span>
<span id="cb993-138"><a href="ch-11.html#cb993-138" aria-hidden="true" tabindex="-1"></a><span class="do">## Total params: 52</span></span>
<span id="cb993-139"><a href="ch-11.html#cb993-139" aria-hidden="true" tabindex="-1"></a><span class="do">## Trainable params: 52</span></span>
<span id="cb993-140"><a href="ch-11.html#cb993-140" aria-hidden="true" tabindex="-1"></a><span class="do">## Non-trainable params: 0</span></span>
<span id="cb993-141"><a href="ch-11.html#cb993-141" aria-hidden="true" tabindex="-1"></a><span class="do">## ________________________________________________________________________________</span></span>
<span id="cb993-142"><a href="ch-11.html#cb993-142" aria-hidden="true" tabindex="-1"></a><span class="do">## Evaluation error on the held out fold:  25.62623 </span></span>
<span id="cb993-143"><a href="ch-11.html#cb993-143" aria-hidden="true" tabindex="-1"></a><span class="do">## CV Fold --&gt; 1/5</span></span>
<span id="cb993-144"><a href="ch-11.html#cb993-144" aria-hidden="true" tabindex="-1"></a><span class="do">## Model: &quot;sequential_16&quot;</span></span>
<span id="cb993-145"><a href="ch-11.html#cb993-145" aria-hidden="true" tabindex="-1"></a><span class="do">## ________________________________________________________________________________</span></span>
<span id="cb993-146"><a href="ch-11.html#cb993-146" aria-hidden="true" tabindex="-1"></a><span class="do">## Layer (type)                        Output Shape                    Param #     </span></span>
<span id="cb993-147"><a href="ch-11.html#cb993-147" aria-hidden="true" tabindex="-1"></a><span class="do">## ================================================================================</span></span>
<span id="cb993-148"><a href="ch-11.html#cb993-148" aria-hidden="true" tabindex="-1"></a><span class="do">## dense_32 (Dense)                    (None, 10)                      160         </span></span>
<span id="cb993-149"><a href="ch-11.html#cb993-149" aria-hidden="true" tabindex="-1"></a><span class="do">## ________________________________________________________________________________</span></span>
<span id="cb993-150"><a href="ch-11.html#cb993-150" aria-hidden="true" tabindex="-1"></a><span class="do">## dense_33 (Dense)                    (None, 1)                       11          </span></span>
<span id="cb993-151"><a href="ch-11.html#cb993-151" aria-hidden="true" tabindex="-1"></a><span class="do">## ================================================================================</span></span>
<span id="cb993-152"><a href="ch-11.html#cb993-152" aria-hidden="true" tabindex="-1"></a><span class="do">## Total params: 171</span></span>
<span id="cb993-153"><a href="ch-11.html#cb993-153" aria-hidden="true" tabindex="-1"></a><span class="do">## Trainable params: 171</span></span>
<span id="cb993-154"><a href="ch-11.html#cb993-154" aria-hidden="true" tabindex="-1"></a><span class="do">## Non-trainable params: 0</span></span>
<span id="cb993-155"><a href="ch-11.html#cb993-155" aria-hidden="true" tabindex="-1"></a><span class="do">## ________________________________________________________________________________</span></span>
<span id="cb993-156"><a href="ch-11.html#cb993-156" aria-hidden="true" tabindex="-1"></a><span class="do">## Evaluation error on the held out fold:  24.59519 </span></span>
<span id="cb993-157"><a href="ch-11.html#cb993-157" aria-hidden="true" tabindex="-1"></a><span class="do">## CV Fold --&gt; 2/5</span></span>
<span id="cb993-158"><a href="ch-11.html#cb993-158" aria-hidden="true" tabindex="-1"></a><span class="do">## Model: &quot;sequential_17&quot;</span></span>
<span id="cb993-159"><a href="ch-11.html#cb993-159" aria-hidden="true" tabindex="-1"></a><span class="do">## ________________________________________________________________________________</span></span>
<span id="cb993-160"><a href="ch-11.html#cb993-160" aria-hidden="true" tabindex="-1"></a><span class="do">## Layer (type)                        Output Shape                    Param #     </span></span>
<span id="cb993-161"><a href="ch-11.html#cb993-161" aria-hidden="true" tabindex="-1"></a><span class="do">## ================================================================================</span></span>
<span id="cb993-162"><a href="ch-11.html#cb993-162" aria-hidden="true" tabindex="-1"></a><span class="do">## dense_34 (Dense)                    (None, 10)                      160         </span></span>
<span id="cb993-163"><a href="ch-11.html#cb993-163" aria-hidden="true" tabindex="-1"></a><span class="do">## ________________________________________________________________________________</span></span>
<span id="cb993-164"><a href="ch-11.html#cb993-164" aria-hidden="true" tabindex="-1"></a><span class="do">## dense_35 (Dense)                    (None, 1)                       11          </span></span>
<span id="cb993-165"><a href="ch-11.html#cb993-165" aria-hidden="true" tabindex="-1"></a><span class="do">## ================================================================================</span></span>
<span id="cb993-166"><a href="ch-11.html#cb993-166" aria-hidden="true" tabindex="-1"></a><span class="do">## Total params: 171</span></span>
<span id="cb993-167"><a href="ch-11.html#cb993-167" aria-hidden="true" tabindex="-1"></a><span class="do">## Trainable params: 171</span></span>
<span id="cb993-168"><a href="ch-11.html#cb993-168" aria-hidden="true" tabindex="-1"></a><span class="do">## Non-trainable params: 0</span></span>
<span id="cb993-169"><a href="ch-11.html#cb993-169" aria-hidden="true" tabindex="-1"></a><span class="do">## ________________________________________________________________________________</span></span>
<span id="cb993-170"><a href="ch-11.html#cb993-170" aria-hidden="true" tabindex="-1"></a><span class="do">## Evaluation error on the held out fold:  25.03098 </span></span>
<span id="cb993-171"><a href="ch-11.html#cb993-171" aria-hidden="true" tabindex="-1"></a><span class="do">## CV Fold --&gt; 3/5</span></span>
<span id="cb993-172"><a href="ch-11.html#cb993-172" aria-hidden="true" tabindex="-1"></a><span class="do">## Model: &quot;sequential_18&quot;</span></span>
<span id="cb993-173"><a href="ch-11.html#cb993-173" aria-hidden="true" tabindex="-1"></a><span class="do">## ________________________________________________________________________________</span></span>
<span id="cb993-174"><a href="ch-11.html#cb993-174" aria-hidden="true" tabindex="-1"></a><span class="do">## Layer (type)                        Output Shape                    Param #     </span></span>
<span id="cb993-175"><a href="ch-11.html#cb993-175" aria-hidden="true" tabindex="-1"></a><span class="do">## ================================================================================</span></span>
<span id="cb993-176"><a href="ch-11.html#cb993-176" aria-hidden="true" tabindex="-1"></a><span class="do">## dense_36 (Dense)                    (None, 10)                      160         </span></span>
<span id="cb993-177"><a href="ch-11.html#cb993-177" aria-hidden="true" tabindex="-1"></a><span class="do">## ________________________________________________________________________________</span></span>
<span id="cb993-178"><a href="ch-11.html#cb993-178" aria-hidden="true" tabindex="-1"></a><span class="do">## dense_37 (Dense)                    (None, 1)                       11          </span></span>
<span id="cb993-179"><a href="ch-11.html#cb993-179" aria-hidden="true" tabindex="-1"></a><span class="do">## ================================================================================</span></span>
<span id="cb993-180"><a href="ch-11.html#cb993-180" aria-hidden="true" tabindex="-1"></a><span class="do">## Total params: 171</span></span>
<span id="cb993-181"><a href="ch-11.html#cb993-181" aria-hidden="true" tabindex="-1"></a><span class="do">## Trainable params: 171</span></span>
<span id="cb993-182"><a href="ch-11.html#cb993-182" aria-hidden="true" tabindex="-1"></a><span class="do">## Non-trainable params: 0</span></span>
<span id="cb993-183"><a href="ch-11.html#cb993-183" aria-hidden="true" tabindex="-1"></a><span class="do">## ________________________________________________________________________________</span></span>
<span id="cb993-184"><a href="ch-11.html#cb993-184" aria-hidden="true" tabindex="-1"></a><span class="do">## Evaluation error on the held out fold:  24.29626 </span></span>
<span id="cb993-185"><a href="ch-11.html#cb993-185" aria-hidden="true" tabindex="-1"></a><span class="do">## CV Fold --&gt; 4/5</span></span>
<span id="cb993-186"><a href="ch-11.html#cb993-186" aria-hidden="true" tabindex="-1"></a><span class="do">## Model: &quot;sequential_19&quot;</span></span>
<span id="cb993-187"><a href="ch-11.html#cb993-187" aria-hidden="true" tabindex="-1"></a><span class="do">## ________________________________________________________________________________</span></span>
<span id="cb993-188"><a href="ch-11.html#cb993-188" aria-hidden="true" tabindex="-1"></a><span class="do">## Layer (type)                        Output Shape                    Param #     </span></span>
<span id="cb993-189"><a href="ch-11.html#cb993-189" aria-hidden="true" tabindex="-1"></a><span class="do">## ================================================================================</span></span>
<span id="cb993-190"><a href="ch-11.html#cb993-190" aria-hidden="true" tabindex="-1"></a><span class="do">## dense_38 (Dense)                    (None, 10)                      160         </span></span>
<span id="cb993-191"><a href="ch-11.html#cb993-191" aria-hidden="true" tabindex="-1"></a><span class="do">## ________________________________________________________________________________</span></span>
<span id="cb993-192"><a href="ch-11.html#cb993-192" aria-hidden="true" tabindex="-1"></a><span class="do">## dense_39 (Dense)                    (None, 1)                       11          </span></span>
<span id="cb993-193"><a href="ch-11.html#cb993-193" aria-hidden="true" tabindex="-1"></a><span class="do">## ================================================================================</span></span>
<span id="cb993-194"><a href="ch-11.html#cb993-194" aria-hidden="true" tabindex="-1"></a><span class="do">## Total params: 171</span></span>
<span id="cb993-195"><a href="ch-11.html#cb993-195" aria-hidden="true" tabindex="-1"></a><span class="do">## Trainable params: 171</span></span>
<span id="cb993-196"><a href="ch-11.html#cb993-196" aria-hidden="true" tabindex="-1"></a><span class="do">## Non-trainable params: 0</span></span>
<span id="cb993-197"><a href="ch-11.html#cb993-197" aria-hidden="true" tabindex="-1"></a><span class="do">## ________________________________________________________________________________</span></span>
<span id="cb993-198"><a href="ch-11.html#cb993-198" aria-hidden="true" tabindex="-1"></a><span class="do">## Evaluation error on the held out fold:  25.55116 </span></span>
<span id="cb993-199"><a href="ch-11.html#cb993-199" aria-hidden="true" tabindex="-1"></a><span class="do">## CV Fold --&gt; 5/5</span></span>
<span id="cb993-200"><a href="ch-11.html#cb993-200" aria-hidden="true" tabindex="-1"></a><span class="do">## Model: &quot;sequential_20&quot;</span></span>
<span id="cb993-201"><a href="ch-11.html#cb993-201" aria-hidden="true" tabindex="-1"></a><span class="do">## ________________________________________________________________________________</span></span>
<span id="cb993-202"><a href="ch-11.html#cb993-202" aria-hidden="true" tabindex="-1"></a><span class="do">## Layer (type)                        Output Shape                    Param #     </span></span>
<span id="cb993-203"><a href="ch-11.html#cb993-203" aria-hidden="true" tabindex="-1"></a><span class="do">## ================================================================================</span></span>
<span id="cb993-204"><a href="ch-11.html#cb993-204" aria-hidden="true" tabindex="-1"></a><span class="do">## dense_40 (Dense)                    (None, 10)                      160         </span></span>
<span id="cb993-205"><a href="ch-11.html#cb993-205" aria-hidden="true" tabindex="-1"></a><span class="do">## ________________________________________________________________________________</span></span>
<span id="cb993-206"><a href="ch-11.html#cb993-206" aria-hidden="true" tabindex="-1"></a><span class="do">## dense_41 (Dense)                    (None, 1)                       11          </span></span>
<span id="cb993-207"><a href="ch-11.html#cb993-207" aria-hidden="true" tabindex="-1"></a><span class="do">## ================================================================================</span></span>
<span id="cb993-208"><a href="ch-11.html#cb993-208" aria-hidden="true" tabindex="-1"></a><span class="do">## Total params: 171</span></span>
<span id="cb993-209"><a href="ch-11.html#cb993-209" aria-hidden="true" tabindex="-1"></a><span class="do">## Trainable params: 171</span></span>
<span id="cb993-210"><a href="ch-11.html#cb993-210" aria-hidden="true" tabindex="-1"></a><span class="do">## Non-trainable params: 0</span></span>
<span id="cb993-211"><a href="ch-11.html#cb993-211" aria-hidden="true" tabindex="-1"></a><span class="do">## ________________________________________________________________________________</span></span>
<span id="cb993-212"><a href="ch-11.html#cb993-212" aria-hidden="true" tabindex="-1"></a><span class="do">## Evaluation error on the held out fold:  24.43872 </span></span>
<span id="cb993-213"><a href="ch-11.html#cb993-213" aria-hidden="true" tabindex="-1"></a><span class="do">## CV Fold --&gt; 1/5</span></span>
<span id="cb993-214"><a href="ch-11.html#cb993-214" aria-hidden="true" tabindex="-1"></a><span class="do">## Model: &quot;sequential_21&quot;</span></span>
<span id="cb993-215"><a href="ch-11.html#cb993-215" aria-hidden="true" tabindex="-1"></a><span class="do">## ________________________________________________________________________________</span></span>
<span id="cb993-216"><a href="ch-11.html#cb993-216" aria-hidden="true" tabindex="-1"></a><span class="do">## Layer (type)                        Output Shape                    Param #     </span></span>
<span id="cb993-217"><a href="ch-11.html#cb993-217" aria-hidden="true" tabindex="-1"></a><span class="do">## ================================================================================</span></span>
<span id="cb993-218"><a href="ch-11.html#cb993-218" aria-hidden="true" tabindex="-1"></a><span class="do">## dense_42 (Dense)                    (None, 30)                      480         </span></span>
<span id="cb993-219"><a href="ch-11.html#cb993-219" aria-hidden="true" tabindex="-1"></a><span class="do">## ________________________________________________________________________________</span></span>
<span id="cb993-220"><a href="ch-11.html#cb993-220" aria-hidden="true" tabindex="-1"></a><span class="do">## dense_43 (Dense)                    (None, 1)                       31          </span></span>
<span id="cb993-221"><a href="ch-11.html#cb993-221" aria-hidden="true" tabindex="-1"></a><span class="do">## ================================================================================</span></span>
<span id="cb993-222"><a href="ch-11.html#cb993-222" aria-hidden="true" tabindex="-1"></a><span class="do">## Total params: 511</span></span>
<span id="cb993-223"><a href="ch-11.html#cb993-223" aria-hidden="true" tabindex="-1"></a><span class="do">## Trainable params: 511</span></span>
<span id="cb993-224"><a href="ch-11.html#cb993-224" aria-hidden="true" tabindex="-1"></a><span class="do">## Non-trainable params: 0</span></span>
<span id="cb993-225"><a href="ch-11.html#cb993-225" aria-hidden="true" tabindex="-1"></a><span class="do">## ________________________________________________________________________________</span></span>
<span id="cb993-226"><a href="ch-11.html#cb993-226" aria-hidden="true" tabindex="-1"></a><span class="do">## Evaluation error on the held out fold:  23.64743 </span></span>
<span id="cb993-227"><a href="ch-11.html#cb993-227" aria-hidden="true" tabindex="-1"></a><span class="do">## CV Fold --&gt; 2/5</span></span>
<span id="cb993-228"><a href="ch-11.html#cb993-228" aria-hidden="true" tabindex="-1"></a><span class="do">## Model: &quot;sequential_22&quot;</span></span>
<span id="cb993-229"><a href="ch-11.html#cb993-229" aria-hidden="true" tabindex="-1"></a><span class="do">## ________________________________________________________________________________</span></span>
<span id="cb993-230"><a href="ch-11.html#cb993-230" aria-hidden="true" tabindex="-1"></a><span class="do">## Layer (type)                        Output Shape                    Param #     </span></span>
<span id="cb993-231"><a href="ch-11.html#cb993-231" aria-hidden="true" tabindex="-1"></a><span class="do">## ================================================================================</span></span>
<span id="cb993-232"><a href="ch-11.html#cb993-232" aria-hidden="true" tabindex="-1"></a><span class="do">## dense_44 (Dense)                    (None, 30)                      480         </span></span>
<span id="cb993-233"><a href="ch-11.html#cb993-233" aria-hidden="true" tabindex="-1"></a><span class="do">## ________________________________________________________________________________</span></span>
<span id="cb993-234"><a href="ch-11.html#cb993-234" aria-hidden="true" tabindex="-1"></a><span class="do">## dense_45 (Dense)                    (None, 1)                       31          </span></span>
<span id="cb993-235"><a href="ch-11.html#cb993-235" aria-hidden="true" tabindex="-1"></a><span class="do">## ================================================================================</span></span>
<span id="cb993-236"><a href="ch-11.html#cb993-236" aria-hidden="true" tabindex="-1"></a><span class="do">## Total params: 511</span></span>
<span id="cb993-237"><a href="ch-11.html#cb993-237" aria-hidden="true" tabindex="-1"></a><span class="do">## Trainable params: 511</span></span>
<span id="cb993-238"><a href="ch-11.html#cb993-238" aria-hidden="true" tabindex="-1"></a><span class="do">## Non-trainable params: 0</span></span>
<span id="cb993-239"><a href="ch-11.html#cb993-239" aria-hidden="true" tabindex="-1"></a><span class="do">## ________________________________________________________________________________</span></span>
<span id="cb993-240"><a href="ch-11.html#cb993-240" aria-hidden="true" tabindex="-1"></a><span class="do">## Evaluation error on the held out fold:  24.02392 </span></span>
<span id="cb993-241"><a href="ch-11.html#cb993-241" aria-hidden="true" tabindex="-1"></a><span class="do">## CV Fold --&gt; 3/5</span></span>
<span id="cb993-242"><a href="ch-11.html#cb993-242" aria-hidden="true" tabindex="-1"></a><span class="do">## Model: &quot;sequential_23&quot;</span></span>
<span id="cb993-243"><a href="ch-11.html#cb993-243" aria-hidden="true" tabindex="-1"></a><span class="do">## ________________________________________________________________________________</span></span>
<span id="cb993-244"><a href="ch-11.html#cb993-244" aria-hidden="true" tabindex="-1"></a><span class="do">## Layer (type)                        Output Shape                    Param #     </span></span>
<span id="cb993-245"><a href="ch-11.html#cb993-245" aria-hidden="true" tabindex="-1"></a><span class="do">## ================================================================================</span></span>
<span id="cb993-246"><a href="ch-11.html#cb993-246" aria-hidden="true" tabindex="-1"></a><span class="do">## dense_46 (Dense)                    (None, 30)                      480         </span></span>
<span id="cb993-247"><a href="ch-11.html#cb993-247" aria-hidden="true" tabindex="-1"></a><span class="do">## ________________________________________________________________________________</span></span>
<span id="cb993-248"><a href="ch-11.html#cb993-248" aria-hidden="true" tabindex="-1"></a><span class="do">## dense_47 (Dense)                    (None, 1)                       31          </span></span>
<span id="cb993-249"><a href="ch-11.html#cb993-249" aria-hidden="true" tabindex="-1"></a><span class="do">## ================================================================================</span></span>
<span id="cb993-250"><a href="ch-11.html#cb993-250" aria-hidden="true" tabindex="-1"></a><span class="do">## Total params: 511</span></span>
<span id="cb993-251"><a href="ch-11.html#cb993-251" aria-hidden="true" tabindex="-1"></a><span class="do">## Trainable params: 511</span></span>
<span id="cb993-252"><a href="ch-11.html#cb993-252" aria-hidden="true" tabindex="-1"></a><span class="do">## Non-trainable params: 0</span></span>
<span id="cb993-253"><a href="ch-11.html#cb993-253" aria-hidden="true" tabindex="-1"></a><span class="do">## ________________________________________________________________________________</span></span>
<span id="cb993-254"><a href="ch-11.html#cb993-254" aria-hidden="true" tabindex="-1"></a><span class="do">## Evaluation error on the held out fold:  25.02493 </span></span>
<span id="cb993-255"><a href="ch-11.html#cb993-255" aria-hidden="true" tabindex="-1"></a><span class="do">## CV Fold --&gt; 4/5</span></span>
<span id="cb993-256"><a href="ch-11.html#cb993-256" aria-hidden="true" tabindex="-1"></a><span class="do">## Model: &quot;sequential_24&quot;</span></span>
<span id="cb993-257"><a href="ch-11.html#cb993-257" aria-hidden="true" tabindex="-1"></a><span class="do">## ________________________________________________________________________________</span></span>
<span id="cb993-258"><a href="ch-11.html#cb993-258" aria-hidden="true" tabindex="-1"></a><span class="do">## Layer (type)                        Output Shape                    Param #     </span></span>
<span id="cb993-259"><a href="ch-11.html#cb993-259" aria-hidden="true" tabindex="-1"></a><span class="do">## ================================================================================</span></span>
<span id="cb993-260"><a href="ch-11.html#cb993-260" aria-hidden="true" tabindex="-1"></a><span class="do">## dense_48 (Dense)                    (None, 30)                      480         </span></span>
<span id="cb993-261"><a href="ch-11.html#cb993-261" aria-hidden="true" tabindex="-1"></a><span class="do">## ________________________________________________________________________________</span></span>
<span id="cb993-262"><a href="ch-11.html#cb993-262" aria-hidden="true" tabindex="-1"></a><span class="do">## dense_49 (Dense)                    (None, 1)                       31          </span></span>
<span id="cb993-263"><a href="ch-11.html#cb993-263" aria-hidden="true" tabindex="-1"></a><span class="do">## ================================================================================</span></span>
<span id="cb993-264"><a href="ch-11.html#cb993-264" aria-hidden="true" tabindex="-1"></a><span class="do">## Total params: 511</span></span>
<span id="cb993-265"><a href="ch-11.html#cb993-265" aria-hidden="true" tabindex="-1"></a><span class="do">## Trainable params: 511</span></span>
<span id="cb993-266"><a href="ch-11.html#cb993-266" aria-hidden="true" tabindex="-1"></a><span class="do">## Non-trainable params: 0</span></span>
<span id="cb993-267"><a href="ch-11.html#cb993-267" aria-hidden="true" tabindex="-1"></a><span class="do">## ________________________________________________________________________________</span></span>
<span id="cb993-268"><a href="ch-11.html#cb993-268" aria-hidden="true" tabindex="-1"></a><span class="do">## Evaluation error on the held out fold:  24.03987 </span></span>
<span id="cb993-269"><a href="ch-11.html#cb993-269" aria-hidden="true" tabindex="-1"></a><span class="do">## CV Fold --&gt; 5/5</span></span>
<span id="cb993-270"><a href="ch-11.html#cb993-270" aria-hidden="true" tabindex="-1"></a><span class="do">## Model: &quot;sequential_25&quot;</span></span>
<span id="cb993-271"><a href="ch-11.html#cb993-271" aria-hidden="true" tabindex="-1"></a><span class="do">## ________________________________________________________________________________</span></span>
<span id="cb993-272"><a href="ch-11.html#cb993-272" aria-hidden="true" tabindex="-1"></a><span class="do">## Layer (type)                        Output Shape                    Param #     </span></span>
<span id="cb993-273"><a href="ch-11.html#cb993-273" aria-hidden="true" tabindex="-1"></a><span class="do">## ================================================================================</span></span>
<span id="cb993-274"><a href="ch-11.html#cb993-274" aria-hidden="true" tabindex="-1"></a><span class="do">## dense_50 (Dense)                    (None, 30)                      480         </span></span>
<span id="cb993-275"><a href="ch-11.html#cb993-275" aria-hidden="true" tabindex="-1"></a><span class="do">## ________________________________________________________________________________</span></span>
<span id="cb993-276"><a href="ch-11.html#cb993-276" aria-hidden="true" tabindex="-1"></a><span class="do">## dense_51 (Dense)                    (None, 1)                       31          </span></span>
<span id="cb993-277"><a href="ch-11.html#cb993-277" aria-hidden="true" tabindex="-1"></a><span class="do">## ================================================================================</span></span>
<span id="cb993-278"><a href="ch-11.html#cb993-278" aria-hidden="true" tabindex="-1"></a><span class="do">## Total params: 511</span></span>
<span id="cb993-279"><a href="ch-11.html#cb993-279" aria-hidden="true" tabindex="-1"></a><span class="do">## Trainable params: 511</span></span>
<span id="cb993-280"><a href="ch-11.html#cb993-280" aria-hidden="true" tabindex="-1"></a><span class="do">## Non-trainable params: 0</span></span>
<span id="cb993-281"><a href="ch-11.html#cb993-281" aria-hidden="true" tabindex="-1"></a><span class="do">## ________________________________________________________________________________</span></span>
<span id="cb993-282"><a href="ch-11.html#cb993-282" aria-hidden="true" tabindex="-1"></a><span class="do">## Evaluation error on the held out fold:  24.74669 </span></span>
<span id="cb993-283"><a href="ch-11.html#cb993-283" aria-hidden="true" tabindex="-1"></a><span class="do">## CV Fold --&gt; 1/5</span></span>
<span id="cb993-284"><a href="ch-11.html#cb993-284" aria-hidden="true" tabindex="-1"></a><span class="do">## Model: &quot;sequential_26&quot;</span></span>
<span id="cb993-285"><a href="ch-11.html#cb993-285" aria-hidden="true" tabindex="-1"></a><span class="do">## ________________________________________________________________________________</span></span>
<span id="cb993-286"><a href="ch-11.html#cb993-286" aria-hidden="true" tabindex="-1"></a><span class="do">## Layer (type)                        Output Shape                    Param #     </span></span>
<span id="cb993-287"><a href="ch-11.html#cb993-287" aria-hidden="true" tabindex="-1"></a><span class="do">## ================================================================================</span></span>
<span id="cb993-288"><a href="ch-11.html#cb993-288" aria-hidden="true" tabindex="-1"></a><span class="do">## dense_52 (Dense)                    (None, 100)                     1600        </span></span>
<span id="cb993-289"><a href="ch-11.html#cb993-289" aria-hidden="true" tabindex="-1"></a><span class="do">## ________________________________________________________________________________</span></span>
<span id="cb993-290"><a href="ch-11.html#cb993-290" aria-hidden="true" tabindex="-1"></a><span class="do">## dense_53 (Dense)                    (None, 1)                       101         </span></span>
<span id="cb993-291"><a href="ch-11.html#cb993-291" aria-hidden="true" tabindex="-1"></a><span class="do">## ================================================================================</span></span>
<span id="cb993-292"><a href="ch-11.html#cb993-292" aria-hidden="true" tabindex="-1"></a><span class="do">## Total params: 1,701</span></span>
<span id="cb993-293"><a href="ch-11.html#cb993-293" aria-hidden="true" tabindex="-1"></a><span class="do">## Trainable params: 1,701</span></span>
<span id="cb993-294"><a href="ch-11.html#cb993-294" aria-hidden="true" tabindex="-1"></a><span class="do">## Non-trainable params: 0</span></span>
<span id="cb993-295"><a href="ch-11.html#cb993-295" aria-hidden="true" tabindex="-1"></a><span class="do">## ________________________________________________________________________________</span></span>
<span id="cb993-296"><a href="ch-11.html#cb993-296" aria-hidden="true" tabindex="-1"></a><span class="do">## Evaluation error on the held out fold:  23.98048 </span></span>
<span id="cb993-297"><a href="ch-11.html#cb993-297" aria-hidden="true" tabindex="-1"></a><span class="do">## CV Fold --&gt; 2/5</span></span>
<span id="cb993-298"><a href="ch-11.html#cb993-298" aria-hidden="true" tabindex="-1"></a><span class="do">## Model: &quot;sequential_27&quot;</span></span>
<span id="cb993-299"><a href="ch-11.html#cb993-299" aria-hidden="true" tabindex="-1"></a><span class="do">## ________________________________________________________________________________</span></span>
<span id="cb993-300"><a href="ch-11.html#cb993-300" aria-hidden="true" tabindex="-1"></a><span class="do">## Layer (type)                        Output Shape                    Param #     </span></span>
<span id="cb993-301"><a href="ch-11.html#cb993-301" aria-hidden="true" tabindex="-1"></a><span class="do">## ================================================================================</span></span>
<span id="cb993-302"><a href="ch-11.html#cb993-302" aria-hidden="true" tabindex="-1"></a><span class="do">## dense_54 (Dense)                    (None, 100)                     1600        </span></span>
<span id="cb993-303"><a href="ch-11.html#cb993-303" aria-hidden="true" tabindex="-1"></a><span class="do">## ________________________________________________________________________________</span></span>
<span id="cb993-304"><a href="ch-11.html#cb993-304" aria-hidden="true" tabindex="-1"></a><span class="do">## dense_55 (Dense)                    (None, 1)                       101         </span></span>
<span id="cb993-305"><a href="ch-11.html#cb993-305" aria-hidden="true" tabindex="-1"></a><span class="do">## ================================================================================</span></span>
<span id="cb993-306"><a href="ch-11.html#cb993-306" aria-hidden="true" tabindex="-1"></a><span class="do">## Total params: 1,701</span></span>
<span id="cb993-307"><a href="ch-11.html#cb993-307" aria-hidden="true" tabindex="-1"></a><span class="do">## Trainable params: 1,701</span></span>
<span id="cb993-308"><a href="ch-11.html#cb993-308" aria-hidden="true" tabindex="-1"></a><span class="do">## Non-trainable params: 0</span></span>
<span id="cb993-309"><a href="ch-11.html#cb993-309" aria-hidden="true" tabindex="-1"></a><span class="do">## ________________________________________________________________________________</span></span>
<span id="cb993-310"><a href="ch-11.html#cb993-310" aria-hidden="true" tabindex="-1"></a><span class="do">## Evaluation error on the held out fold:  23.41279 </span></span>
<span id="cb993-311"><a href="ch-11.html#cb993-311" aria-hidden="true" tabindex="-1"></a><span class="do">## CV Fold --&gt; 3/5</span></span>
<span id="cb993-312"><a href="ch-11.html#cb993-312" aria-hidden="true" tabindex="-1"></a><span class="do">## Model: &quot;sequential_28&quot;</span></span>
<span id="cb993-313"><a href="ch-11.html#cb993-313" aria-hidden="true" tabindex="-1"></a><span class="do">## ________________________________________________________________________________</span></span>
<span id="cb993-314"><a href="ch-11.html#cb993-314" aria-hidden="true" tabindex="-1"></a><span class="do">## Layer (type)                        Output Shape                    Param #     </span></span>
<span id="cb993-315"><a href="ch-11.html#cb993-315" aria-hidden="true" tabindex="-1"></a><span class="do">## ================================================================================</span></span>
<span id="cb993-316"><a href="ch-11.html#cb993-316" aria-hidden="true" tabindex="-1"></a><span class="do">## dense_56 (Dense)                    (None, 100)                     1600        </span></span>
<span id="cb993-317"><a href="ch-11.html#cb993-317" aria-hidden="true" tabindex="-1"></a><span class="do">## ________________________________________________________________________________</span></span>
<span id="cb993-318"><a href="ch-11.html#cb993-318" aria-hidden="true" tabindex="-1"></a><span class="do">## dense_57 (Dense)                    (None, 1)                       101         </span></span>
<span id="cb993-319"><a href="ch-11.html#cb993-319" aria-hidden="true" tabindex="-1"></a><span class="do">## ================================================================================</span></span>
<span id="cb993-320"><a href="ch-11.html#cb993-320" aria-hidden="true" tabindex="-1"></a><span class="do">## Total params: 1,701</span></span>
<span id="cb993-321"><a href="ch-11.html#cb993-321" aria-hidden="true" tabindex="-1"></a><span class="do">## Trainable params: 1,701</span></span>
<span id="cb993-322"><a href="ch-11.html#cb993-322" aria-hidden="true" tabindex="-1"></a><span class="do">## Non-trainable params: 0</span></span>
<span id="cb993-323"><a href="ch-11.html#cb993-323" aria-hidden="true" tabindex="-1"></a><span class="do">## ________________________________________________________________________________</span></span>
<span id="cb993-324"><a href="ch-11.html#cb993-324" aria-hidden="true" tabindex="-1"></a><span class="do">## Evaluation error on the held out fold:  24.43465 </span></span>
<span id="cb993-325"><a href="ch-11.html#cb993-325" aria-hidden="true" tabindex="-1"></a><span class="do">## CV Fold --&gt; 4/5</span></span>
<span id="cb993-326"><a href="ch-11.html#cb993-326" aria-hidden="true" tabindex="-1"></a><span class="do">## Model: &quot;sequential_29&quot;</span></span>
<span id="cb993-327"><a href="ch-11.html#cb993-327" aria-hidden="true" tabindex="-1"></a><span class="do">## ________________________________________________________________________________</span></span>
<span id="cb993-328"><a href="ch-11.html#cb993-328" aria-hidden="true" tabindex="-1"></a><span class="do">## Layer (type)                        Output Shape                    Param #     </span></span>
<span id="cb993-329"><a href="ch-11.html#cb993-329" aria-hidden="true" tabindex="-1"></a><span class="do">## ================================================================================</span></span>
<span id="cb993-330"><a href="ch-11.html#cb993-330" aria-hidden="true" tabindex="-1"></a><span class="do">## dense_58 (Dense)                    (None, 100)                     1600        </span></span>
<span id="cb993-331"><a href="ch-11.html#cb993-331" aria-hidden="true" tabindex="-1"></a><span class="do">## ________________________________________________________________________________</span></span>
<span id="cb993-332"><a href="ch-11.html#cb993-332" aria-hidden="true" tabindex="-1"></a><span class="do">## dense_59 (Dense)                    (None, 1)                       101         </span></span>
<span id="cb993-333"><a href="ch-11.html#cb993-333" aria-hidden="true" tabindex="-1"></a><span class="do">## ================================================================================</span></span>
<span id="cb993-334"><a href="ch-11.html#cb993-334" aria-hidden="true" tabindex="-1"></a><span class="do">## Total params: 1,701</span></span>
<span id="cb993-335"><a href="ch-11.html#cb993-335" aria-hidden="true" tabindex="-1"></a><span class="do">## Trainable params: 1,701</span></span>
<span id="cb993-336"><a href="ch-11.html#cb993-336" aria-hidden="true" tabindex="-1"></a><span class="do">## Non-trainable params: 0</span></span>
<span id="cb993-337"><a href="ch-11.html#cb993-337" aria-hidden="true" tabindex="-1"></a><span class="do">## ________________________________________________________________________________</span></span>
<span id="cb993-338"><a href="ch-11.html#cb993-338" aria-hidden="true" tabindex="-1"></a><span class="do">## Evaluation error on the held out fold:  23.77185 </span></span>
<span id="cb993-339"><a href="ch-11.html#cb993-339" aria-hidden="true" tabindex="-1"></a><span class="do">## CV Fold --&gt; 5/5</span></span>
<span id="cb993-340"><a href="ch-11.html#cb993-340" aria-hidden="true" tabindex="-1"></a><span class="do">## Model: &quot;sequential_30&quot;</span></span>
<span id="cb993-341"><a href="ch-11.html#cb993-341" aria-hidden="true" tabindex="-1"></a><span class="do">## ________________________________________________________________________________</span></span>
<span id="cb993-342"><a href="ch-11.html#cb993-342" aria-hidden="true" tabindex="-1"></a><span class="do">## Layer (type)                        Output Shape                    Param #     </span></span>
<span id="cb993-343"><a href="ch-11.html#cb993-343" aria-hidden="true" tabindex="-1"></a><span class="do">## ================================================================================</span></span>
<span id="cb993-344"><a href="ch-11.html#cb993-344" aria-hidden="true" tabindex="-1"></a><span class="do">## dense_60 (Dense)                    (None, 100)                     1600        </span></span>
<span id="cb993-345"><a href="ch-11.html#cb993-345" aria-hidden="true" tabindex="-1"></a><span class="do">## ________________________________________________________________________________</span></span>
<span id="cb993-346"><a href="ch-11.html#cb993-346" aria-hidden="true" tabindex="-1"></a><span class="do">## dense_61 (Dense)                    (None, 1)                       101         </span></span>
<span id="cb993-347"><a href="ch-11.html#cb993-347" aria-hidden="true" tabindex="-1"></a><span class="do">## ================================================================================</span></span>
<span id="cb993-348"><a href="ch-11.html#cb993-348" aria-hidden="true" tabindex="-1"></a><span class="do">## Total params: 1,701</span></span>
<span id="cb993-349"><a href="ch-11.html#cb993-349" aria-hidden="true" tabindex="-1"></a><span class="do">## Trainable params: 1,701</span></span>
<span id="cb993-350"><a href="ch-11.html#cb993-350" aria-hidden="true" tabindex="-1"></a><span class="do">## Non-trainable params: 0</span></span>
<span id="cb993-351"><a href="ch-11.html#cb993-351" aria-hidden="true" tabindex="-1"></a><span class="do">## ________________________________________________________________________________</span></span>
<span id="cb993-352"><a href="ch-11.html#cb993-352" aria-hidden="true" tabindex="-1"></a><span class="do">## Evaluation error on the held out fold:  23.87822 </span></span>
<span id="cb993-353"><a href="ch-11.html#cb993-353" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 31.07678 25.69231 24.78246 24.29657 23.89560</span></span></code></pre></div>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="ch-10.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="ch-12.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
