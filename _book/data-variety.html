<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 4 Data variety | Environmental Systems Data Science</title>
  <meta name="description" content="Text book and exercises. ETH Zürich" />
  <meta name="generator" content="bookdown 0.21 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 4 Data variety | Environmental Systems Data Science" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="Text book and exercises. ETH Zürich" />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 4 Data variety | Environmental Systems Data Science" />
  
  <meta name="twitter:description" content="Text book and exercises. ETH Zürich" />
  

<meta name="author" content="Loïc Pellissier, Joshua Payne, Benjamin Stocker" />


<meta name="date" content="2021-02-02" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="data-wrangling.html"/>
<link rel="next" href="data-scraping.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script src="libs/accessible-code-block-0.0.1/empty-anchor.js"></script>
<link href="libs/anchor-sections-1.0/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0/anchor-sections.js"></script>


<style type="text/css">
code.sourceCode > span { display: inline-block; line-height: 1.25; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Environmental Systems Data Science</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Prerequisites</a></li>
<li class="chapter" data-level="2" data-path="primers.html"><a href="primers.html"><i class="fa fa-check"></i><b>2</b> Primers</a></li>
<li class="chapter" data-level="3" data-path="data-wrangling.html"><a href="data-wrangling.html"><i class="fa fa-check"></i><b>3</b> Data wrangling</a></li>
<li class="chapter" data-level="4" data-path="data-variety.html"><a href="data-variety.html"><i class="fa fa-check"></i><b>4</b> Data variety</a><ul>
<li class="chapter" data-level="4.1" data-path="data-variety.html"><a href="data-variety.html#introduction"><i class="fa fa-check"></i><b>4.1</b> Introduction</a><ul>
<li class="chapter" data-level="4.1.1" data-path="data-variety.html"><a href="data-variety.html#overview"><i class="fa fa-check"></i><b>4.1.1</b> Overview</a></li>
<li class="chapter" data-level="4.1.2" data-path="data-variety.html"><a href="data-variety.html#learning-objectives"><i class="fa fa-check"></i><b>4.1.2</b> Learning objectives</a></li>
<li class="chapter" data-level="4.1.3" data-path="data-variety.html"><a href="data-variety.html#key-points-of-the-lecture"><i class="fa fa-check"></i><b>4.1.3</b> Key points of the lecture</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="data-variety.html"><a href="data-variety.html#tutorial"><i class="fa fa-check"></i><b>4.2</b> Tutorial</a><ul>
<li class="chapter" data-level="4.2.1" data-path="data-variety.html"><a href="data-variety.html#overview-1"><i class="fa fa-check"></i><b>4.2.1</b> Overview</a></li>
<li class="chapter" data-level="4.2.2" data-path="data-variety.html"><a href="data-variety.html#modis-remote-download"><i class="fa fa-check"></i><b>4.2.2</b> MODIS remote download</a></li>
<li class="chapter" data-level="4.2.3" data-path="data-variety.html"><a href="data-variety.html#points-on-the-globe"><i class="fa fa-check"></i><b>4.2.3</b> Points on the globe</a></li>
<li class="chapter" data-level="4.2.4" data-path="data-variety.html"><a href="data-variety.html#shapefiles"><i class="fa fa-check"></i><b>4.2.4</b> Shapefiles</a></li>
<li class="chapter" data-level="4.2.5" data-path="data-variety.html"><a href="data-variety.html#rasters"><i class="fa fa-check"></i><b>4.2.5</b> Rasters</a></li>
<li class="chapter" data-level="4.2.6" data-path="data-variety.html"><a href="data-variety.html#key-points-of-the-tutorial"><i class="fa fa-check"></i><b>4.2.6</b> Key points of the tutorial</a></li>
<li class="chapter" data-level="4.2.7" data-path="data-variety.html"><a href="data-variety.html#bonus-species-occurrence-trait-data-and-pcas"><i class="fa fa-check"></i><b>4.2.7</b> Bonus: Species Occurrence, Trait Data and PCAs</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="data-scraping.html"><a href="data-scraping.html"><i class="fa fa-check"></i><b>5</b> Data Scraping</a><ul>
<li class="chapter" data-level="5.1" data-path="data-scraping.html"><a href="data-scraping.html#introduction-1"><i class="fa fa-check"></i><b>5.1</b> Introduction</a></li>
<li class="chapter" data-level="5.2" data-path="data-scraping.html"><a href="data-scraping.html#theory"><i class="fa fa-check"></i><b>5.2</b> Theory</a></li>
<li class="chapter" data-level="5.3" data-path="data-scraping.html"><a href="data-scraping.html#web-scraping-applied"><i class="fa fa-check"></i><b>5.3</b> Web Scraping Applied</a><ul>
<li class="chapter" data-level="5.3.1" data-path="data-scraping.html"><a href="data-scraping.html#r-packages-and-functions"><i class="fa fa-check"></i><b>5.3.1</b> R-Packages and Functions</a></li>
<li class="chapter" data-level="5.3.2" data-path="data-scraping.html"><a href="data-scraping.html#the-fishbase-website"><i class="fa fa-check"></i><b>5.3.2</b> The FishBase website</a></li>
<li class="chapter" data-level="5.3.3" data-path="data-scraping.html"><a href="data-scraping.html#scraping-numbers"><i class="fa fa-check"></i><b>5.3.3</b> Scraping Numbers</a></li>
<li class="chapter" data-level="5.3.4" data-path="data-scraping.html"><a href="data-scraping.html#scraping-text-snippetrs"><i class="fa fa-check"></i><b>5.3.4</b> Scraping Text Snippetrs</a></li>
<li class="chapter" data-level="5.3.5" data-path="data-scraping.html"><a href="data-scraping.html#scraping-tables"><i class="fa fa-check"></i><b>5.3.5</b> Scraping Tables</a></li>
<li class="chapter" data-level="5.3.6" data-path="data-scraping.html"><a href="data-scraping.html#the-fishbase-package"><i class="fa fa-check"></i><b>5.3.6</b> The Fishbase Package</a></li>
<li class="chapter" data-level="5.3.7" data-path="data-scraping.html"><a href="data-scraping.html#summary"><i class="fa fa-check"></i><b>5.3.7</b> Summary</a></li>
</ul></li>
<li class="chapter" data-level="5.4" data-path="data-scraping.html"><a href="data-scraping.html#case-study-species-richness-and-red-list-species-proportions"><i class="fa fa-check"></i><b>5.4</b> Case Study: Species Richness and Red List species proportions</a><ul>
<li class="chapter" data-level="5.4.1" data-path="data-scraping.html"><a href="data-scraping.html#creating-list-of-species"><i class="fa fa-check"></i><b>5.4.1</b> Creating List of Species</a></li>
<li class="chapter" data-level="5.4.2" data-path="data-scraping.html"><a href="data-scraping.html#extracting-iucn-status-for-all-species"><i class="fa fa-check"></i><b>5.4.2</b> Extracting IUCN Status for all species</a></li>
<li class="chapter" data-level="5.4.3" data-path="data-scraping.html"><a href="data-scraping.html#proportion-of-species-in-netherlands"><i class="fa fa-check"></i><b>5.4.3</b> Proportion of species in Netherlands</a></li>
<li class="chapter" data-level="5.4.4" data-path="data-scraping.html"><a href="data-scraping.html#maps-of-species-richness-and-red-list-species-proportions"><i class="fa fa-check"></i><b>5.4.4</b> Maps of species richness and Red List species proportions</a></li>
<li class="chapter" data-level="5.4.5" data-path="data-scraping.html"><a href="data-scraping.html#relation-of-basin-size-and-species-richness"><i class="fa fa-check"></i><b>5.4.5</b> Relation of basin size and species richness</a></li>
</ul></li>
<li class="chapter" data-level="5.5" data-path="data-scraping.html"><a href="data-scraping.html#references"><i class="fa fa-check"></i><b>5.5</b> References</a></li>
<li class="chapter" data-level="5.6" data-path="data-scraping.html"><a href="data-scraping.html#exercise"><i class="fa fa-check"></i><b>5.6</b> Exercise</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="catch-up.html"><a href="catch-up.html"><i class="fa fa-check"></i><b>6</b> Catch-up</a></li>
<li class="chapter" data-level="7" data-path="supervised-machine-learning-basics-i.html"><a href="supervised-machine-learning-basics-i.html"><i class="fa fa-check"></i><b>7</b> Supervised machine learning basics I</a><ul>
<li class="chapter" data-level="7.1" data-path="supervised-machine-learning-basics-i.html"><a href="supervised-machine-learning-basics-i.html#introduction-2"><i class="fa fa-check"></i><b>7.1</b> Introduction</a><ul>
<li class="chapter" data-level="7.1.1" data-path="supervised-machine-learning-basics-i.html"><a href="supervised-machine-learning-basics-i.html#learning-objectives-1"><i class="fa fa-check"></i><b>7.1.1</b> Learning objectives</a></li>
<li class="chapter" data-level="7.1.2" data-path="supervised-machine-learning-basics-i.html"><a href="supervised-machine-learning-basics-i.html#important-points-from-the-lecture"><i class="fa fa-check"></i><b>7.1.2</b> Important points from the lecture</a></li>
</ul></li>
<li class="chapter" data-level="7.2" data-path="supervised-machine-learning-basics-i.html"><a href="supervised-machine-learning-basics-i.html#tutorial-1"><i class="fa fa-check"></i><b>7.2</b> Tutorial</a><ul>
<li class="chapter" data-level="7.2.1" data-path="supervised-machine-learning-basics-i.html"><a href="supervised-machine-learning-basics-i.html#linear-regression"><i class="fa fa-check"></i><b>7.2.1</b> Linear regression</a></li>
<li class="chapter" data-level="7.2.2" data-path="supervised-machine-learning-basics-i.html"><a href="supervised-machine-learning-basics-i.html#k-nearest-neighbours"><i class="fa fa-check"></i><b>7.2.2</b> K-nearest neighbours</a></li>
<li class="chapter" data-level="7.2.3" data-path="supervised-machine-learning-basics-i.html"><a href="supervised-machine-learning-basics-i.html#essential-methods-for-the-modelling-process"><i class="fa fa-check"></i><b>7.2.3</b> Essential methods for the modelling process</a></li>
<li class="chapter" data-level="7.2.4" data-path="supervised-machine-learning-basics-i.html"><a href="supervised-machine-learning-basics-i.html#bonus"><i class="fa fa-check"></i><b>7.2.4</b> Bonus</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="8" data-path="supervised-machine-learning-methods-ii.html"><a href="supervised-machine-learning-methods-ii.html"><i class="fa fa-check"></i><b>8</b> Supervised machine learning methods II</a></li>
<li class="chapter" data-level="9" data-path="application-1-variable-selection.html"><a href="application-1-variable-selection.html"><i class="fa fa-check"></i><b>9</b> Application 1: Variable selection</a><ul>
<li class="chapter" data-level="9.1" data-path="application-1-variable-selection.html"><a href="application-1-variable-selection.html#introduction-3"><i class="fa fa-check"></i><b>9.1</b> Introduction</a></li>
<li class="chapter" data-level="9.2" data-path="application-1-variable-selection.html"><a href="application-1-variable-selection.html#warm-up-1-nested-for-loop"><i class="fa fa-check"></i><b>9.2</b> Warm-up 1: Nested for-loop</a></li>
<li class="chapter" data-level="9.3" data-path="application-1-variable-selection.html"><a href="application-1-variable-selection.html#warm-up-2-find-the-best-single-predictor"><i class="fa fa-check"></i><b>9.3</b> Warm-up 2: Find the best single predictor</a></li>
<li class="chapter" data-level="9.4" data-path="application-1-variable-selection.html"><a href="application-1-variable-selection.html#full-stepwise-regression"><i class="fa fa-check"></i><b>9.4</b> Full stepwise regression</a></li>
<li class="chapter" data-level="9.5" data-path="application-1-variable-selection.html"><a href="application-1-variable-selection.html#bonus-stepwise-regression-out-of-the-box"><i class="fa fa-check"></i><b>9.5</b> Bonus: Stepwise regression out-of-the-box</a></li>
<li class="chapter" data-level="9.6" data-path="application-1-variable-selection.html"><a href="application-1-variable-selection.html#warm-up-2-find-the-best-single-predictor-1"><i class="fa fa-check"></i><b>9.6</b> Warm-up 2: Find the best single predictor</a></li>
<li class="chapter" data-level="9.7" data-path="application-1-variable-selection.html"><a href="application-1-variable-selection.html#full-stepwise-regression-1"><i class="fa fa-check"></i><b>9.7</b> Full stepwise regression</a></li>
<li class="chapter" data-level="9.8" data-path="application-1-variable-selection.html"><a href="application-1-variable-selection.html#bonus-stepwise-regression-out-of-the-box-1"><i class="fa fa-check"></i><b>9.8</b> <span>BONUS</span> Stepwise regression out-of-the-box</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="xxx.html"><a href="xxx.html"><i class="fa fa-check"></i><b>10</b> XXX</a></li>
<li class="chapter" data-level="11" data-path="xxx-1.html"><a href="xxx-1.html"><i class="fa fa-check"></i><b>11</b> XXX</a></li>
<li class="chapter" data-level="12" data-path="xxx-2.html"><a href="xxx-2.html"><i class="fa fa-check"></i><b>12</b> XXX</a></li>
<li class="chapter" data-level="13" data-path="xxx-3.html"><a href="xxx-3.html"><i class="fa fa-check"></i><b>13</b> XXX</a></li>
<li class="chapter" data-level="14" data-path="xxx-4.html"><a href="xxx-4.html"><i class="fa fa-check"></i><b>14</b> XXX</a></li>
<li class="chapter" data-level="15" data-path="xxx-5.html"><a href="xxx-5.html"><i class="fa fa-check"></i><b>15</b> XXX</a></li>
<li class="chapter" data-level="" data-path="references-1.html"><a href="references-1.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Environmental Systems Data Science</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="data-variety" class="section level1">
<h1><span class="header-section-number">Chapter 4</span> Data variety</h1>
<div id="introduction" class="section level2">
<h2><span class="header-section-number">4.1</span> Introduction</h2>
<div id="overview" class="section level3">
<h3><span class="header-section-number">4.1.1</span> Overview</h3>
<p>In this practical we look at data variety in environmental sciences. We start with the data from one eddy covariance measurement site in Switzerland which we had already encountered in Chapter 1, and complement it with a different type of data (remote sensing data). Specifically, we download remote sensing data that measures vegetation greenness data, quantified by the normalised difference vegetation index, NDVI. We are interested in this data for example, because we expect ecosystem photosynthesis (gross primary production), measured at the eddy covariance tower, to covary with NDVI. Such covariation can provide powerful information for modelling. For example, we can train a machine learning model with the observed covariation between measured GPP and NDVI at eddy covariance sites and use that model to scale GPP up in space (NDVI is available for the whole globe, while GPP can only be measured locally.) You will actually be doing this kind of modelling in session 13. For now, we focus on working with the spatial aspects of the data (since remote sensing data is inherently spatial) and introduce you to the toolset to work with spatial, in particular, geo-spatial data.</p>
<p>To get you familiar with spatial data types we will use a variety of data from freely accessible sites. We can investigate abiotic and biotic conditions in these locations. We’ll be plotting the Eddy towers you have already encountered in the first two chapters and extracting values for these locations from other data. By doing this we can show that the climate at these sites spans a gradient temperature and landcover. There are also biotic components that could explain variation in productivity among sites, including species composition and functional traits of plants.</p>
</div>
<div id="learning-objectives" class="section level3">
<h3><span class="header-section-number">4.1.2</span> Learning objectives</h3>
<p>After this learning unit, you will be able to …</p>
<ul>
<li>explain the possible sources of data in environmental sciences;</li>
<li>understand the range of operations applied to data from basic to complex;</li>
<li>read various types of data in R and apply basic operations;</li>
<li>understand the structure of spatial data, including rasters and shapefiles;</li>
<li>apply a range of operations to prepare data for analyses.</li>
</ul>
</div>
<div id="key-points-of-the-lecture" class="section level3">
<h3><span class="header-section-number">4.1.3</span> Key points of the lecture</h3>
<p>Data operations range in complexity, here they are listed from simplest to extremely complex:</p>
<ul>
<li>Statistical operations</li>
<li>Similarity metrics</li>
<li>Ordinations</li>
<li>Clustering</li>
<li>Classifications</li>
<li>Regressions</li>
<li>Neural network deep learning</li>
</ul>
<p>Examples of methods for the computing differences between datasets:</p>
<ul>
<li><em>Euclidean distance</em> is used for the simple quantification of variation</li>
<li><em>PCA</em> is a valuable tool to explore variation and reduce dimension</li>
<li><em>Hamming distance</em> helps measure the difference between strings</li>
<li><em>Jaccard index</em> describes the similarity between two or more binary data sets</li>
</ul>
<p>Machine learning is loosely defined as any learning done by a computer. It can be divided into…</p>
<ul>
<li><em>Unsupervised learning</em>: without explanatory data, which uses clustering to obtain a categorical output</li>
<li><em>Supervised learning</em>: with explanatory data, which uses either classification also resulting in a categorical output, or regression when a numerical output is required</li>
</ul>
<p>Data errors are divided into errors of accuracy and precision. If data is inaccurate, it strays from the true value. If data is imprecise, individual data points are variable under the same conditions. Systematic errors and inaccurate data is much harder to correct!</p>
<p>Errors can arise throughout the data science workflow.</p>
<ul>
<li><em>Inherent error</em> refers to the error present in the source documents and data.</li>
<li><em>Operational error</em> is created after data collection.</li>
</ul>
<p>Data can be cleaned from errors by looking for:</p>
<ul>
<li>Non-uniform data</li>
<li>Missing data</li>
<li>Duplicated data</li>
<li>Outliers</li>
<li>Measurement errors</li>
</ul>
<p>Quantifying uncertainty is extremely important, as undetectable errors will persist even after data cleaning. Examples of uncertainty quantification include…</p>
<ul>
<li>Confidence interval (CI)</li>
<li>Prediction interval</li>
</ul>
<p>Error propagation is used for datasets containing different uncertainties to determine the overall uncertainty.</p>
</div>
</div>
<div id="tutorial" class="section level2">
<h2><span class="header-section-number">4.2</span> Tutorial</h2>
<div id="overview-1" class="section level3">
<h3><span class="header-section-number">4.2.1</span> Overview</h3>
<p>In this practical, you will be downloading and getting to know spatial data. There are three types of spatial data:</p>
<ul>
<li>points;</li>
<li>shapefiles;</li>
<li>rasters.</li>
</ul>
<p>The first part of this practical is mandatory and will start with a little introduction on downloading remote sensing data for our tower sites and seeing what kinds of information we can gather from this. Then we will get into the nitty-gritty aspects of the afore mentioned spatial data types.</p>
<p>The second part is the bonus part, there we will discuss trait data and the principal component analysis (PCA), which is a method to reduce the dimensions of datasets.</p>
</div>
<div id="modis-remote-download" class="section level3">
<h3><span class="header-section-number">4.2.2</span> MODIS remote download</h3>
<p>We’ll be starting off this tutorial with an example on using remote sensing data. We’ll focus on a Fluxnet site already familiar to you: CH-Lae. The Lägern site is located on a mountain in the Swiss Plateau NW of Zürich and is surrounded by managed mixed deciduous mountain forests. The forest is highly diverse and dominated by beech. In the following figures, you can get an impression of the tower and its surroundings.</p>
<p><img src="figures/site1.jpg" />
<img src="figures/site2.jpg" />
<img src="figures/site3.jpg" /></p>
<p>As always we start by loading <code>tidyverse</code>and our fluxnet site data.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="data-variety.html#cb4-1"></a><span class="kw">library</span>(tidyverse)</span>
<span id="cb4-2"><a href="data-variety.html#cb4-2"></a>df_sites &lt;-<span class="st"> </span><span class="kw">read_csv</span>(<span class="st">&quot;./data/fluxnet_site_info_reduced.csv&quot;</span>)</span></code></pre></div>
<p>Since for this section we will only be working with the Lägern site we can directly extract its latitude and longitude.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="data-variety.html#cb5-1"></a>lon_lae &lt;-<span class="st"> </span>df_sites <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb5-2"><a href="data-variety.html#cb5-2"></a><span class="st">  </span><span class="kw">filter</span>(site <span class="op">==</span><span class="st"> &quot;CH-Lae&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb5-3"><a href="data-variety.html#cb5-3"></a><span class="st">  </span><span class="kw">pull</span>(lon)</span>
<span id="cb5-4"><a href="data-variety.html#cb5-4"></a></span>
<span id="cb5-5"><a href="data-variety.html#cb5-5"></a>lat_lae &lt;-<span class="st"> </span>df_sites <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb5-6"><a href="data-variety.html#cb5-6"></a><span class="st">  </span><span class="kw">filter</span>(site <span class="op">==</span><span class="st"> &quot;CH-Lae&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb5-7"><a href="data-variety.html#cb5-7"></a><span class="st">  </span><span class="kw">pull</span>(lat)</span></code></pre></div>
<p>In this first analysis, we want to complement temporal data measured by the Fluxnet tower with remote sensing data. <em>Remote sensing</em> is the detection or monitoring of physical characteristics of the Earth’s surface by measuring reflected and emitted radiation at a distance. Data is collected in the form of images by special cameras typically from aircrafts or satellites. With this method, a huge amount of global data at large spatial scales gets easily accessible and therefore represents a useful method for the monitoring of ecosystems. However, this remotely acquired data requires validation from ground measurements, which can be done for example using the Eddy towers from the previous practicals.</p>
<p>One of these satellite remote sensing instruments is MODIS (Moderate Resolution Imaging Spectroradiometer). Terra MODIS and Aqua MODIS are viewing the entire Earth’s surface every 1 to 2 days, acquiring data in 36 spectral bands, or groups of wavelengths.</p>
<p>You used to have to visit an website to be able to download the data file by file, which was a long and tedious process. Luckily, now we have access to tools that make it much more straightforward to download remote sensing data from satellites. It provides Atmosphere, Ocean, Cryosphere and Land data series. The <code>MODISTools</code> package provides a programmatic interface to the <a href="https://modis.gsfc.nasa.gov/">MODIS Land Products Subsets web services</a> allows for easy downloads of “MODIS” time series (of single pixels or small regions of interest) directly to your R workspace or your computer.</p>
<ul>
<li>Using the <code>mt_...()</code> functions of the MODISTools we can check which products are available in MODIS, how the product we are searching for is called, and what temporal and spatial resolutions are available.</li>
<li><code>t_products()</code> lists all available products from MODIS with their temporal and spatial resolution. Products are parent categories of variables measured by the satellites, such as vegetation indices.</li>
<li><code>mt_bands()</code> requires the entry of a product chosen from “products” and list the available data variables that are represented by the different actually measured wavelengths.</li>
<li>Finally, <code>mt_dates()</code> lists all dates of which data from the chosen product and band are available.</li>
</ul>
<p>We will make use of this by loading NDVI data around our towers directly from MODIS.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="data-variety.html#cb6-1"></a><span class="kw">library</span>(MODISTools)</span>
<span id="cb6-2"><a href="data-variety.html#cb6-2"></a>products &lt;-<span class="st"> </span><span class="kw">mt_products</span>() <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">as_tibble</span>()</span>
<span id="cb6-3"><a href="data-variety.html#cb6-3"></a>bands &lt;-<span class="st"> </span><span class="kw">mt_bands</span>(<span class="dt">product =</span> <span class="st">&quot;MOD13Q1&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">as_tibble</span>()</span>
<span id="cb6-4"><a href="data-variety.html#cb6-4"></a>dates &lt;-<span class="st"> </span><span class="kw">mt_dates</span>(<span class="dt">product =</span> <span class="st">&quot;MOD13Q1&quot;</span>, <span class="dt">lat =</span> lat_lae, <span class="dt">lon =</span> lon_lae) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">as_tibble</span>()</span></code></pre></div>
<p>Now, we’ll get the NDVI data for 6 years for a square of 2km x 2km around the tower site. We use the function <code>mt_subset()</code> for this. The parameters of this function download a subset of data within the chosen product (here ‘MOD13Q1’). We specify the location as latitude and longitude, and the band we chose, which is at 250m spatial resolution and 16-day temporal resolution. The time period can be chosen as a subset of “dates” and must be provided in the form of start and end date. We will be looking at the beginning of 2009 to the end of 2014. <code>km_lr</code> and <code>km_ab</code> define the kilometers to the left and right of the location and kilometers above and below respectively. Since these values are being rounded to the nearest integer, we chose this minimum of 1, corresponding to 2km<sup>2</sup>. Sitename is used in writing data to file, internal gives the command whether the data should be returned as an internal structure. The progress setting defines whether the download progress should be shown or not.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="data-variety.html#cb7-1"></a>df_ndvi &lt;-<span class="st"> </span><span class="kw">mt_subset</span>(<span class="dt">product =</span> <span class="st">&quot;MOD13Q1&quot;</span>,            <span class="co"># the chosen product</span></span>
<span id="cb7-2"><a href="data-variety.html#cb7-2"></a>                  <span class="dt">lat =</span> lat_lae,                     <span class="co"># desired lat/lon</span></span>
<span id="cb7-3"><a href="data-variety.html#cb7-3"></a>                  <span class="dt">lon =</span> lon_lae,</span>
<span id="cb7-4"><a href="data-variety.html#cb7-4"></a>                  <span class="dt">band =</span> <span class="st">&quot;250m_16_days_NDVI&quot;</span>,        <span class="co"># chosen band defining spatial and temporal scale</span></span>
<span id="cb7-5"><a href="data-variety.html#cb7-5"></a>                  <span class="dt">start =</span> <span class="st">&quot;2009-01-01&quot;</span>,              <span class="co"># start date: 1st Jan 2009</span></span>
<span id="cb7-6"><a href="data-variety.html#cb7-6"></a>                  <span class="dt">end =</span> <span class="st">&quot;2014-12-19&quot;</span>,                <span class="co"># end date: 19th Dec 2014</span></span>
<span id="cb7-7"><a href="data-variety.html#cb7-7"></a>                  <span class="dt">km_lr =</span> <span class="dv">1</span>,                         <span class="co"># kilometers left &amp; right of the chosen location (lat/lon above)</span></span>
<span id="cb7-8"><a href="data-variety.html#cb7-8"></a>                  <span class="dt">km_ab =</span> <span class="dv">1</span>,                         <span class="co"># kilometers above and below the location</span></span>
<span id="cb7-9"><a href="data-variety.html#cb7-9"></a>                  <span class="dt">site_name =</span> <span class="st">&quot;CH-Lae&quot;</span>,              <span class="co"># the site name we want to give the data</span></span>
<span id="cb7-10"><a href="data-variety.html#cb7-10"></a>                  <span class="dt">internal =</span> <span class="ot">TRUE</span>,</span>
<span id="cb7-11"><a href="data-variety.html#cb7-11"></a>                  <span class="dt">progress =</span> <span class="ot">FALSE</span></span>
<span id="cb7-12"><a href="data-variety.html#cb7-12"></a>                  ) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb7-13"><a href="data-variety.html#cb7-13"></a><span class="st">  </span><span class="kw">as_tibble</span>()</span></code></pre></div>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="data-variety.html#cb8-1"></a><span class="kw">head</span>(df_ndvi)</span></code></pre></div>
<pre><code>## # A tibble: 6 x 21
##   xllcorner yllcorner cellsize nrows ncols band  units scale latitude longitude
##   &lt;chr&gt;     &lt;chr&gt;     &lt;chr&gt;    &lt;int&gt; &lt;int&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;    &lt;dbl&gt;     &lt;dbl&gt;
## 1 627557.11 5278290.… 231.656…     9     9 250m… NDVI… 0.00…     47.5      8.36
## 2 627557.11 5278290.… 231.656…     9     9 250m… NDVI… 0.00…     47.5      8.36
## 3 627557.11 5278290.… 231.656…     9     9 250m… NDVI… 0.00…     47.5      8.36
## 4 627557.11 5278290.… 231.656…     9     9 250m… NDVI… 0.00…     47.5      8.36
## 5 627557.11 5278290.… 231.656…     9     9 250m… NDVI… 0.00…     47.5      8.36
## 6 627557.11 5278290.… 231.656…     9     9 250m… NDVI… 0.00…     47.5      8.36
## # … with 11 more variables: site &lt;chr&gt;, product &lt;chr&gt;, start &lt;chr&gt;, end &lt;chr&gt;,
## #   complete &lt;lgl&gt;, modis_date &lt;chr&gt;, calendar_date &lt;chr&gt;, tile &lt;chr&gt;,
## #   proc_date &lt;chr&gt;, pixel &lt;int&gt;, value &lt;int&gt;</code></pre>
<p>This dataframe takes some effort to make sense of. Let’s make our lives a little easier and put this data into a useful spatial context. For that it needs to be converted to a raster. This is a key spatial data type and will be described in more detail in the section Raster below.
MODISTools provides a handy integrated function for converting the data to a raster <code>mt_to_raster()</code>.</p>
<pre><code>## Warning in showSRID(uprojargs, format = &quot;PROJ&quot;, multiline = &quot;NO&quot;, prefer_proj =
## prefer_proj): Discarded ellps unknown in Proj4 definition: +proj=sinu +lon_0=0
## +x_0=0 +y_0=0 +R=6371007.181 +units=m +no_defs +type=crs</code></pre>
<pre><code>## Warning in showSRID(uprojargs, format = &quot;PROJ&quot;, multiline = &quot;NO&quot;, prefer_proj =
## prefer_proj): Discarded datum unknown in Proj4 definition</code></pre>
<pre><code>## Warning in showSRID(SRS_string, format = &quot;PROJ&quot;, multiline = &quot;NO&quot;, prefer_proj
## = prefer_proj): Discarded ellps unknown in Proj4 definition: +proj=sinu +lon_0=0
## +x_0=0 +y_0=0 +R=6371007.181 +units=m +no_defs +type=crs</code></pre>
<pre><code>## Warning in showSRID(SRS_string, format = &quot;PROJ&quot;, multiline = &quot;NO&quot;, prefer_proj =
## prefer_proj): Discarded datum unknown in Proj4 definition</code></pre>
<pre><code>## Warning in showSRID(uprojargs, format = &quot;PROJ&quot;, multiline = &quot;NO&quot;, prefer_proj =
## prefer_proj): Discarded ellps unknown in Proj4 definition: +proj=sinu +lon_0=0
## +x_0=0 +y_0=0 +R=6371007.181 +units=m +no_defs +type=crs</code></pre>
<pre><code>## Warning in showSRID(uprojargs, format = &quot;PROJ&quot;, multiline = &quot;NO&quot;, prefer_proj =
## prefer_proj): Discarded datum unknown in Proj4 definition</code></pre>
<p>By plotting the data we can verify that we loaded a square of NDVI data around our tower for every 16-day time step.
We plot four images in the winter season.</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="data-variety.html#cb16-1"></a><span class="kw">plot</span>(raster_ndvi[[<span class="dv">1</span><span class="op">:</span><span class="dv">4</span>]], <span class="dt">zlim=</span><span class="kw">c</span>(<span class="op">-</span><span class="fl">0.1</span>, <span class="fl">0.95</span>))</span></code></pre></div>
<p><img src="esds_book_files/figure-html/unnamed-chunk-10-1.png" width="672" /></p>
<p>Just out of interest let’s calculate the minimum and maximum of these plots.</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="data-variety.html#cb17-1"></a>min_winter &lt;-<span class="st"> </span><span class="kw">min</span>(<span class="kw">minValue</span>(raster_ndvi[[<span class="dv">1</span><span class="op">:</span><span class="dv">4</span>]]))</span>
<span id="cb17-2"><a href="data-variety.html#cb17-2"></a>max_winter &lt;-<span class="st"> </span><span class="kw">max</span>(<span class="kw">maxValue</span>(raster_ndvi[[<span class="dv">1</span><span class="op">:</span><span class="dv">4</span>]]))</span>
<span id="cb17-3"><a href="data-variety.html#cb17-3"></a><span class="kw">paste0</span>(<span class="st">&quot;Minimum Winter:&quot;</span>, <span class="dt">sep=</span><span class="st">&quot; &quot;</span>, min_winter)</span></code></pre></div>
<pre><code>## [1] &quot;Minimum Winter: -0.0679177447153291&quot;</code></pre>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="data-variety.html#cb19-1"></a><span class="kw">paste0</span>(<span class="st">&quot;Maximum Winter:&quot;</span>, <span class="dt">sep=</span><span class="st">&quot; &quot;</span>, max_winter)</span></code></pre></div>
<pre><code>## [1] &quot;Maximum Winter: 0.683717115657303&quot;</code></pre>
<p>We do the same for the summer season.</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="data-variety.html#cb21-1"></a><span class="kw">plot</span>(raster_ndvi[[<span class="dv">13</span><span class="op">:</span><span class="dv">16</span>]], <span class="dt">zlim=</span><span class="kw">c</span>(<span class="op">-</span><span class="fl">0.1</span>, <span class="fl">0.95</span>))</span></code></pre></div>
<p><img src="esds_book_files/figure-html/unnamed-chunk-12-1.png" width="672" /></p>
<p>We compute minimum and maximum.</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="data-variety.html#cb22-1"></a>min_summer &lt;-<span class="st"> </span><span class="kw">min</span>(<span class="kw">minValue</span>(raster_ndvi[[<span class="dv">13</span><span class="op">:</span><span class="dv">16</span>]]))</span>
<span id="cb22-2"><a href="data-variety.html#cb22-2"></a>max_summer &lt;-<span class="st"> </span><span class="kw">max</span>(<span class="kw">maxValue</span>(raster_ndvi[[<span class="dv">13</span><span class="op">:</span><span class="dv">16</span>]]))</span>
<span id="cb22-3"><a href="data-variety.html#cb22-3"></a><span class="kw">paste0</span>(<span class="st">&quot;Minimum Summer:&quot;</span>, <span class="dt">sep=</span><span class="st">&quot; &quot;</span>, min_summer)</span></code></pre></div>
<pre><code>## [1] &quot;Minimum Summer: 0.569610980491112&quot;</code></pre>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="data-variety.html#cb24-1"></a><span class="kw">paste0</span>(<span class="st">&quot;Maximum Summer:&quot;</span>, <span class="dt">sep=</span><span class="st">&quot; &quot;</span>, max_summer)</span></code></pre></div>
<pre><code>## [1] &quot;Maximum Summer: 0.903467898529256&quot;</code></pre>
<p>From the two plots, we can clearly distinguish summer and winter time steps due to the differences in NDVI. Summer NDVI is much higher since our tower site is located in the Northern hemisphere where leaves get lost during winter for many vegetation types. Heterogeneity in winter is higher which might be due to conifers that don’t lose their leaves.</p>
<p>However, we are also interested in the mean across all (spatial) pixels for each date. To clarify this means we collapse the pixel dimension into a single mean value for each date. This is can done using <code>group_by()</code> in combination with <code>summarise()</code>, which were explained in chapter 2.</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="data-variety.html#cb26-1"></a><span class="kw">library</span>(lubridate) <span class="co"># lubridate is loaded to work with dates</span></span>
<span id="cb26-2"><a href="data-variety.html#cb26-2"></a></span>
<span id="cb26-3"><a href="data-variety.html#cb26-3"></a><span class="co">## first determine the scaling factor that is to be applied to the NDVI values. This has practical reasons: reduces disk space</span></span>
<span id="cb26-4"><a href="data-variety.html#cb26-4"></a>scale_factor &lt;-<span class="st"> </span>bands <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb26-5"><a href="data-variety.html#cb26-5"></a><span class="st">  </span><span class="kw">filter</span>(band <span class="op">==</span><span class="st"> &quot;250m_16_days_NDVI&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb26-6"><a href="data-variety.html#cb26-6"></a><span class="st">  </span><span class="kw">pull</span>(scale_factor) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb26-7"><a href="data-variety.html#cb26-7"></a><span class="st">  </span><span class="kw">as.numeric</span>()</span>
<span id="cb26-8"><a href="data-variety.html#cb26-8"></a>  </span>
<span id="cb26-9"><a href="data-variety.html#cb26-9"></a>df_ndvi_spatialmean &lt;-<span class="st"> </span>df_ndvi <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb26-10"><a href="data-variety.html#cb26-10"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">calendar_date =</span> <span class="kw">ymd</span>(calendar_date)) <span class="op">%&gt;%</span><span class="st">  </span><span class="co"># make the dates into comprehensible values not X.yyyy.mm.dd</span></span>
<span id="cb26-11"><a href="data-variety.html#cb26-11"></a><span class="st">  </span><span class="kw">group_by</span>(calendar_date) <span class="op">%&gt;%</span><span class="st">                     </span><span class="co"># group the data by day </span></span>
<span id="cb26-12"><a href="data-variety.html#cb26-12"></a><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">mean =</span> <span class="kw">mean</span>(value), <span class="dt">min =</span> <span class="kw">min</span>(value), <span class="dt">max =</span> <span class="kw">max</span>(value)) <span class="op">%&gt;%</span><span class="st">   </span><span class="co"># calculate mean, min and max across pixels</span></span>
<span id="cb26-13"><a href="data-variety.html#cb26-13"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">mean =</span> mean <span class="op">*</span><span class="st"> </span>scale_factor, <span class="dt">min =</span> min <span class="op">*</span><span class="st"> </span>scale_factor, <span class="dt">max =</span> max <span class="op">*</span><span class="st"> </span>scale_factor)  <span class="co"># apply scale_factor (see )</span></span></code></pre></div>
<p>We can now plot our NDVI time series across our years (2009 to 2014) using the means we calculated above.</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="data-variety.html#cb27-1"></a>df_ndvi_spatialmean <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb27-2"><a href="data-variety.html#cb27-2"></a><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> calendar_date)) <span class="op">+</span></span>
<span id="cb27-3"><a href="data-variety.html#cb27-3"></a><span class="st">  </span><span class="kw">geom_ribbon</span>(<span class="kw">aes</span>(<span class="dt">ymin =</span> min, <span class="dt">ymax =</span> max), <span class="dt">fill =</span> <span class="st">&quot;grey70&quot;</span>) <span class="op">+</span></span>
<span id="cb27-4"><a href="data-variety.html#cb27-4"></a><span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">y =</span> mean))</span></code></pre></div>
<p><img src="esds_book_files/figure-html/unnamed-chunk-15-1.png" width="672" /></p>
<p>After having aggregated the data to the mean NDVI across all 81 pixels for each date, we have reduced the dimensions of the data frame to only one (time). It now has a structure that can easily be combined with the time series data from the eddy covariance tower (each site is a point in space).</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="data-variety.html#cb28-1"></a><span class="co"># this can now be combined to the data frame with flux data that also has dates along rows</span></span>
<span id="cb28-2"><a href="data-variety.html#cb28-2"></a>ddf_ch_lae &lt;-<span class="st"> </span><span class="kw">read_csv</span>(<span class="st">&quot;./data/ddf_ch_lae.csv&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="data-variety.html#cb29-1"></a><span class="co"># now we can combine the two data frames along dates. </span></span>
<span id="cb29-2"><a href="data-variety.html#cb29-2"></a>ddf_ch_lae_ndvi &lt;-<span class="st"> </span>ddf_ch_lae <span class="op">%&gt;%</span></span>
<span id="cb29-3"><a href="data-variety.html#cb29-3"></a><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">rename</span>(<span class="dt">date =</span> TIMESTAMP) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb29-4"><a href="data-variety.html#cb29-4"></a><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">mutate</span>(<span class="dt">year =</span> <span class="kw">year</span>(date)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb29-5"><a href="data-variety.html#cb29-5"></a><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">filter</span>(year <span class="op">%in%</span><span class="st"> </span><span class="dv">2009</span><span class="op">:</span><span class="dv">2014</span>) <span class="op">%&gt;%</span><span class="st">  </span><span class="co"># NDVI data was downloaded only for these years</span></span>
<span id="cb29-6"><a href="data-variety.html#cb29-6"></a><span class="st">  </span><span class="kw">left_join</span>(df_ndvi_spatialmean <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">rename</span>(<span class="dt">date =</span> calendar_date), <span class="dt">by =</span> <span class="st">&quot;date&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb29-7"><a href="data-variety.html#cb29-7"></a><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">select</span>(<span class="op">-</span>year)</span></code></pre></div>
<p>NDVI data is provided every 16 days. In order to predict values at other time steps, we can fit a cubic smoothing spline to our daily values. (Cubic smoothing splines embody a curve fitting technique that blends the ideas of cubic splines and curvature minimization to create an effective data modeling tool for noisy data. Traditional interpolating cubic splines represent the tabulated data as a piece-wise continuous curve which passes through each value in the data table. The curve spanning each data interval is represented by a cubic polynomial, with the requirement that the endpoints of adjacent cubic polynomials match in location and in their first and second derivatives).</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="data-variety.html#cb30-1"></a>ddf_ch_lae_ndvi &lt;-<span class="st"> </span>ddf_ch_lae_ndvi <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb30-2"><a href="data-variety.html#cb30-2"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">date_dec =</span> <span class="kw">decimal_date</span>(date))</span>
<span id="cb30-3"><a href="data-variety.html#cb30-3"></a></span>
<span id="cb30-4"><a href="data-variety.html#cb30-4"></a>df_nona &lt;-<span class="st"> </span>ddf_ch_lae_ndvi <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb30-5"><a href="data-variety.html#cb30-5"></a><span class="st">  </span><span class="kw">drop_na</span>()</span>
<span id="cb30-6"><a href="data-variety.html#cb30-6"></a></span>
<span id="cb30-7"><a href="data-variety.html#cb30-7"></a>out_spline &lt;-<span class="st"> </span><span class="kw">smooth.spline</span>( df_nona<span class="op">$</span>date_dec, df_nona<span class="op">$</span>mean, <span class="dt">spar=</span><span class="fl">0.1</span> )</span>
<span id="cb30-8"><a href="data-variety.html#cb30-8"></a>vals_spline &lt;-<span class="st"> </span><span class="kw">predict</span>( out_spline, ddf_ch_lae_ndvi<span class="op">$</span>date_dec )<span class="op">$</span>y</span>
<span id="cb30-9"><a href="data-variety.html#cb30-9"></a></span>
<span id="cb30-10"><a href="data-variety.html#cb30-10"></a>ddf_ch_lae_ndvi &lt;-<span class="st"> </span>ddf_ch_lae_ndvi <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb30-11"><a href="data-variety.html#cb30-11"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">ndvi_splined =</span> vals_spline)</span></code></pre></div>
<p>Let’s take a look…</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="data-variety.html#cb31-1"></a>ddf_ch_lae_ndvi <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb31-2"><a href="data-variety.html#cb31-2"></a><span class="st">  </span><span class="kw">ggplot</span>() <span class="op">+</span></span>
<span id="cb31-3"><a href="data-variety.html#cb31-3"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">x =</span> date, <span class="dt">y =</span> mean)) <span class="op">+</span></span>
<span id="cb31-4"><a href="data-variety.html#cb31-4"></a><span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">x =</span> date, <span class="dt">y =</span> ndvi_splined), <span class="dt">color =</span> <span class="st">&quot;red&quot;</span>)</span></code></pre></div>
<p><img src="esds_book_files/figure-html/unnamed-chunk-19-1.png" width="672" /></p>
<p>To see how well this data correlates with measurements from the fluxnet tower, we look at the relationship of GPP vs. NDVI*PPFD.</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="data-variety.html#cb32-1"></a>ddf_ch_lae_ndvi &lt;-<span class="st"> </span>ddf_ch_lae_ndvi <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb32-2"><a href="data-variety.html#cb32-2"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">ppfd_abs =</span> ndvi_splined <span class="op">*</span><span class="st"> </span>PPFD_IN)</span></code></pre></div>
<p>Does NDVI affect the relationship between GPP and PPFD?</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb33-1"><a href="data-variety.html#cb33-1"></a>linmod1 &lt;-<span class="st"> </span><span class="kw">lm</span>(GPP_NT_VUT_REF <span class="op">~</span><span class="st"> </span>PPFD_IN, <span class="dt">data =</span> ddf_ch_lae_ndvi)</span>
<span id="cb33-2"><a href="data-variety.html#cb33-2"></a><span class="kw">summary</span>(linmod1)</span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = GPP_NT_VUT_REF ~ PPFD_IN, data = ddf_ch_lae_ndvi)
## 
## Residuals:
##      Min       1Q   Median       3Q      Max 
## -10.3749  -2.0413  -0.0137   1.9913  14.8576 
## 
## Coefficients:
##              Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept) 0.9348433  0.1097112   8.521   &lt;2e-16 ***
## PPFD_IN     0.0148270  0.0003038  48.797   &lt;2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 3.06 on 2173 degrees of freedom
##   (16 observations deleted due to missingness)
## Multiple R-squared:  0.5229, Adjusted R-squared:  0.5226 
## F-statistic:  2381 on 1 and 2173 DF,  p-value: &lt; 2.2e-16</code></pre>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb35-1"><a href="data-variety.html#cb35-1"></a>linmod2 &lt;-<span class="st"> </span><span class="kw">lm</span>(GPP_NT_VUT_REF <span class="op">~</span><span class="st"> </span>ppfd_abs, <span class="dt">data =</span> ddf_ch_lae_ndvi)</span>
<span id="cb35-2"><a href="data-variety.html#cb35-2"></a><span class="kw">summary</span>(linmod2)</span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = GPP_NT_VUT_REF ~ ppfd_abs, data = ddf_ch_lae_ndvi)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -8.9202 -1.8307 -0.0829  1.7236 14.4273 
## 
## Coefficients:
##              Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept) 1.3395678  0.0903180   14.83   &lt;2e-16 ***
## ppfd_abs    0.0180868  0.0003148   57.45   &lt;2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 2.792 on 2173 degrees of freedom
##   (16 observations deleted due to missingness)
## Multiple R-squared:  0.603,  Adjusted R-squared:  0.6028 
## F-statistic:  3301 on 1 and 2173 DF,  p-value: &lt; 2.2e-16</code></pre>
<p>Indeed, R<sup>2</sup> increased from 0.5229 to 0.603 when including considering NDVI * PPFD, instead of just PPFD. In other words, it also matters whether leaves are actually out and green for modelling the relationship between GPP and PPFD. NDVI * PPFD approximates the amount of <em>absorbed</em> incoming light (not just the incoming light) and is therefore closer to being a physiologically relevant quantity.</p>
</div>
<div id="points-on-the-globe" class="section level3">
<h3><span class="header-section-number">4.2.3</span> Points on the globe</h3>
<p>Documenting the coordinates of data as it is collected allows us to assign a precise location to that data, which can be important in further analysis when, for example, comparing location. As you all undoubtedly know coordinates come with a latitude (defining the position N or S of the equator) and longitude (defining the position E or W of the meridian). With the coordinates we can already plot our data points, remembering that the latitude is equivalent to the y-axis and longitude to the x-axis.</p>
<p>In this section, we look at the position of the Fluxnet sites. The Fluxnet network measures land-atmosphere exchanges of greenhouse gases and energy for sites across the globe using the eddy covariance technique. High-frequency measurements of vertical wind velocity and a scalar mixing ratio (CO2, H2O, temperature, etc.) provides estimates of the net exchange of the scalar. Eddy covariance is currently the standard method to measure fluxes of trace gases between ecosystems and the atmosphere (sources:
<a href="https://fluxnet.org/about/" class="uri">https://fluxnet.org/about/</a>, <a href="https://www.nature.com/articles/s41597-020-0534-3.pdf" class="uri">https://www.nature.com/articles/s41597-020-0534-3.pdf</a>).</p>
<p>Right at the beginning of this tutorial we loaded the dataset containing information on sites in Europe. We treat site locations as a geographical position. So we will extract the name, longitude and latitude of our sites.</p>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb37-1"><a href="data-variety.html#cb37-1"></a><span class="kw">head</span>(df_sites)</span></code></pre></div>
<pre><code>## # A tibble: 6 x 3
##   site     lon   lat
##   &lt;chr&gt;  &lt;dbl&gt; &lt;dbl&gt;
## 1 BE-Bra  4.52  51.3
## 2 BE-Lon  4.75  50.6
## 3 BE-Vie  6.00  50.3
## 4 CH-Cha  8.41  47.2
## 5 CH-Fru  8.54  47.1
## 6 CH-Lae  8.36  47.5</code></pre>
<p>Our dataset <em>‘df_sites’</em> contains two sites in Greenland and Siberia. We’ll focus on a smaller spatial domain, restricted to “mainland” Europe, therefore, we exclude sites RU-Cok and DK-ZaH.</p>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb39-1"><a href="data-variety.html#cb39-1"></a>df_sites &lt;-<span class="st"> </span>df_sites <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb39-2"><a href="data-variety.html#cb39-2"></a><span class="st">  </span><span class="kw">filter</span>(<span class="op">!</span>(site <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;RU-Cok&quot;</span>, <span class="st">&quot;DK-ZaH&quot;</span>)))</span></code></pre></div>
<p>Already now we can plot our data points without any further adjustments.</p>
<div class="sourceCode" id="cb40"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb40-1"><a href="data-variety.html#cb40-1"></a><span class="kw">ggplot</span>() <span class="op">+</span></span>
<span id="cb40-2"><a href="data-variety.html#cb40-2"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">data =</span> df_sites, <span class="kw">aes</span>(<span class="dt">x =</span> lon, <span class="dt">y =</span> lat), <span class="dt">color =</span> <span class="st">&quot;red&quot;</span>) <span class="op">+</span></span>
<span id="cb40-3"><a href="data-variety.html#cb40-3"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="st">&quot;Selected FLUXNET sites&quot;</span>, <span class="dt">x =</span> <span class="st">&quot;Longitude&quot;</span>, <span class="dt">y =</span> <span class="st">&quot;Latitude&quot;</span>)<span class="op">+</span></span>
<span id="cb40-4"><a href="data-variety.html#cb40-4"></a><span class="st">  </span><span class="kw">theme_bw</span>()</span></code></pre></div>
<p><img src="esds_book_files/figure-html/unnamed-chunk-25-1.png" width="672" /></p>
<p>We can make an educated guess where the points are but this plot doesn’t tell us much by itself without a map as a reference.</p>
<p>So to visualize the location of our points we plot them on a map. We use the package <code>SpData</code> to get the world map and crop it to Europe.</p>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb41-1"><a href="data-variety.html#cb41-1"></a><span class="kw">library</span>(sf)</span>
<span id="cb41-2"><a href="data-variety.html#cb41-2"></a><span class="kw">library</span>(spData)</span></code></pre></div>
<pre><code>## To access larger datasets in this package, install the spDataLarge
## package with: `install.packages(&#39;spDataLarge&#39;,
## repos=&#39;https://nowosad.github.io/drat/&#39;, type=&#39;source&#39;)`</code></pre>
<div class="sourceCode" id="cb43"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb43-1"><a href="data-variety.html#cb43-1"></a><span class="kw">ggplot</span>() <span class="op">+</span></span>
<span id="cb43-2"><a href="data-variety.html#cb43-2"></a><span class="st">  </span><span class="kw">geom_sf</span>(<span class="dt">data =</span> world) <span class="op">+</span></span>
<span id="cb43-3"><a href="data-variety.html#cb43-3"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">data =</span> df_sites, <span class="kw">aes</span>(<span class="dt">x =</span> lon, <span class="dt">y =</span> lat), <span class="dt">color =</span> <span class="st">&quot;red&quot;</span>) <span class="op">+</span></span>
<span id="cb43-4"><a href="data-variety.html#cb43-4"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;Longitude&quot;</span>, <span class="dt">y =</span> <span class="st">&quot;Latitude&quot;</span>) <span class="op">+</span></span>
<span id="cb43-5"><a href="data-variety.html#cb43-5"></a><span class="st">  </span><span class="kw">coord_sf</span>(<span class="dt">xlim =</span> <span class="kw">c</span>(<span class="op">-</span><span class="dv">30</span>,<span class="dv">40</span>), <span class="dt">ylim =</span> <span class="kw">c</span>(<span class="dv">35</span>,<span class="dv">80</span>), <span class="dt">expand =</span> <span class="ot">FALSE</span>) <span class="op">+</span></span>
<span id="cb43-6"><a href="data-variety.html#cb43-6"></a><span class="st">  </span><span class="kw">theme_bw</span>()</span></code></pre></div>
<p><img src="esds_book_files/figure-html/unnamed-chunk-26-1.png" width="672" /></p>
<div class="sourceCode" id="cb44"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb44-1"><a href="data-variety.html#cb44-1"></a>  <span class="co"># coord_sf(crs = &quot;+proj=robin&quot;)</span></span></code></pre></div>
<p>Of course, we can carry on using the data points as they are (for plotting or analysis) but for more detailed spatial analysis we will turn them into <em>SpatialPoints</em>.</p>
<p><em>SpatialPoints</em> consist of a matrix with <em>n</em> rows and 2 columns, one for each coordinate (latitude &amp; longitude). <em>n</em> is the number of points in the data. These points also have a so-called <em>‘projection string’</em> or <em>‘crs’</em> indicating the coordinate reference system in which coordinates of points are expressed.
There are different ways (formulas) to project the earth (an ellipsoid) onto a 2-dimensional map. You can only perform calculations, if the same method (projection, coordinate reference system (crs)) is used. Having points in different coordinate reference systems can cause data to look very skewed. It’s good to know which coordinate reference system your data is in, the most commonly used one is <strong>WGS84 (EPSG: 4326)</strong>. There are some useful resources to convert help you find the correct <a href="https://spatialreference.org/ref/epsg/4326/">spatial reference</a>.</p>
<p>To transform points into <em>SpatialPoints</em> we use the function <code>SpatialPoints</code> in the r package <code>sp</code>.</p>
<div class="sourceCode" id="cb45"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb45-1"><a href="data-variety.html#cb45-1"></a><span class="kw">library</span>(sp)</span>
<span id="cb45-2"><a href="data-variety.html#cb45-2"></a>sp_sites &lt;-<span class="st"> </span><span class="kw">SpatialPoints</span>(dplyr<span class="op">::</span><span class="kw">select</span>(df_sites, <span class="op">-</span>site)) <span class="co"># remove character column</span></span></code></pre></div>
<p>Below you can see how with the R-base call <code>plot()</code> you can plot the <em>SpatialPoints</em> directly. But we’ll have to also provide a map to plot them onto. The loaded shapefile of europe will also be used in the next part called Shapefiles.</p>
<div class="sourceCode" id="cb46"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb46-1"><a href="data-variety.html#cb46-1"></a><span class="kw">library</span>(rgdal)</span>
<span id="cb46-2"><a href="data-variety.html#cb46-2"></a>europe_shape &lt;-<span class="st"> </span><span class="kw">readOGR</span>(<span class="dt">dsn=</span><span class="st">&quot;./data/shapefiles&quot;</span>, <span class="dt">layer=</span><span class="st">&quot;europe_map&quot;</span>)</span></code></pre></div>
<pre><code>## OGR data source with driver: ESRI Shapefile 
## Source: &quot;/Users/pascalschneider/Polybox/Shared/Data Science Lecture Planning - shared folder/4 Datasets/shapefiles&quot;, layer: &quot;europe_map&quot;
## with 53 features
## It has 94 fields</code></pre>
<div class="sourceCode" id="cb48"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb48-1"><a href="data-variety.html#cb48-1"></a><span class="kw">plot</span>(europe_shape, <span class="dt">col=</span><span class="st">&quot;grey&quot;</span>)</span>
<span id="cb48-2"><a href="data-variety.html#cb48-2"></a><span class="kw">plot</span>(sp_sites, <span class="dt">col =</span> <span class="st">&quot;red&quot;</span>, <span class="dt">add =</span> <span class="ot">TRUE</span>, <span class="dt">pch =</span> <span class="dv">16</span>)</span></code></pre></div>
<p><img src="esds_book_files/figure-html/unnamed-chunk-28-1.png" width="672" /></p>
</div>
<div id="shapefiles" class="section level3">
<h3><span class="header-section-number">4.2.4</span> Shapefiles</h3>
<p>Above we looked at points on the globe and transformed our data to <em>SpatialPoints</em>. This was already the first example of what forms a shapefile can come in. Shapefiles basically store geographic information, meaning location and any additional information, in shape objects. Shape objects in R are defined by <em>SpatialPoints</em>, <em>SpatialLines</em>, and <em>SpatialPolygons</em> classes of the <code>sp</code> package. The corresponding <em>SpatialPointsDataFrame</em>, <em>SpatialLinesDataFrame</em>, and <em>SpatialPolygonsDataFrame</em> classes allow storing shape objects together with a dataframe. The number of rows in the dataframe corresponds to the number of points (number of rows in coordinate matrix), lines (size of the list of Lines), or polygons (size of the list of Polygons). This allows us to associate a vector of variables (a row of the dataframe) to each shape object.
In the next step, we load a shapefile containing the countries of the world provided by <a href="www.naturalearthdata.com">Natural Earth</a>, as a reference with which we can contextualize our spatial data. Since we only are looking at towers in Europe, we have cropped the raster to Europe for you.</p>
<div class="sourceCode" id="cb49"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb49-1"><a href="data-variety.html#cb49-1"></a><span class="kw">library</span>(rgdal)</span>
<span id="cb49-2"><a href="data-variety.html#cb49-2"></a>europe_shape &lt;-<span class="st"> </span><span class="kw">readOGR</span>(<span class="dt">dsn=</span><span class="st">&quot;./data/shapefiles&quot;</span>, <span class="dt">layer=</span><span class="st">&quot;europe_map&quot;</span>)</span></code></pre></div>
<pre><code>## OGR data source with driver: ESRI Shapefile 
## Source: &quot;/Users/pascalschneider/Polybox/Shared/Data Science Lecture Planning - shared folder/4 Datasets/shapefiles&quot;, layer: &quot;europe_map&quot;
## with 53 features
## It has 94 fields</code></pre>
<p>Let’s see what class <em>europe_shape</em> is:</p>
<div class="sourceCode" id="cb51"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb51-1"><a href="data-variety.html#cb51-1"></a><span class="kw">class</span>(europe_shape)</span></code></pre></div>
<pre><code>## [1] &quot;SpatialPolygonsDataFrame&quot;
## attr(,&quot;package&quot;)
## [1] &quot;sp&quot;</code></pre>
<p>Above we mentioned that <em>SpatialPolygonsDataFrame</em> contains both a list of <em>SpatialPolygons</em> and a dataframe with information on each polygon. Here’s how you can access the information in the dataframe. We’ll just display the header for now.</p>
<div class="sourceCode" id="cb53"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb53-1"><a href="data-variety.html#cb53-1"></a><span class="kw">head</span>(europe_shape<span class="op">@</span>data)</span></code></pre></div>
<pre><code>##        featurecla scalerank LABELRANK     SOVEREIGNT SOV_A3 ADM0_DIF LEVEL
## 0 Admin-0 country         6         6        Vatican    VAT        0     2
## 1 Admin-0 country         4         6 United Kingdom    GB1        1     2
## 2 Admin-0 country         4         6 United Kingdom    GB1        1     2
## 3 Admin-0 country         3         6 United Kingdom    GB1        1     2
## 4 Admin-0 country         1         2 United Kingdom    GB1        1     2
## 5 Admin-0 country         1         3        Ukraine    UKR        0     2
##                TYPE          ADMIN ADM0_A3 GEOU_DIF        GEOUNIT GU_A3 SU_DIF
## 0 Sovereign country        Vatican     VAT        0        Vatican   VAT      0
## 1           Country         Jersey     JEY        0         Jersey   JEY      0
## 2           Country       Guernsey     GGY        0       Guernsey   GGY      0
## 3           Country    Isle of Man     IMN        0    Isle of Man   IMN      0
## 4           Country United Kingdom     GBR        0 United Kingdom   GBR      0
## 5 Sovereign country        Ukraine     UKR        0        Ukraine   UKR      0
##          SUBUNIT SU_A3 BRK_DIFF           NAME      NAME_LONG BRK_A3
## 0        Vatican   VAT        0        Vatican        Vatican    VAT
## 1         Jersey   JEY        0         Jersey         Jersey    JEY
## 2       Guernsey   GGY        0       Guernsey       Guernsey    GGY
## 3    Isle of Man   IMN        0    Isle of Man    Isle of Man    IMN
## 4 United Kingdom   GBR        0 United Kingdom United Kingdom    GBR
## 5        Ukraine   UKR        0        Ukraine        Ukraine    UKR
##         BRK_NAME       BRK_GROUP ABBREV POSTAL
## 0        Vatican            &lt;NA&gt;   Vat.      V
## 1         Jersey Channel Islands   Jey.     JE
## 2       Guernsey Channel Islands Guern.     GG
## 3    Isle of Man            &lt;NA&gt;  IoMan     IM
## 4 United Kingdom            &lt;NA&gt;   U.K.     GB
## 5        Ukraine            &lt;NA&gt;   Ukr.     UA
##                                              FORMAL_EN FORMAL_FR
## 0                            State of the Vatican City      &lt;NA&gt;
## 1                                  Bailiwick of Jersey      &lt;NA&gt;
## 2                                Bailiwick of Guernsey      &lt;NA&gt;
## 3                                                 &lt;NA&gt;      &lt;NA&gt;
## 4 United Kingdom of Great Britain and Northern Ireland      &lt;NA&gt;
## 5                                              Ukraine      &lt;NA&gt;
##                NAME_CIAWF             NOTE_ADM0 NOTE_BRK          NAME_SORT
## 0 Holy See (Vatican City)                  &lt;NA&gt;     &lt;NA&gt; Vatican (Holy See)
## 1                  Jersey U.K. crown dependency     &lt;NA&gt;             Jersey
## 2                Guernsey U.K. crown dependency     &lt;NA&gt;           Guernsey
## 3             Isle of Man U.K. crown dependency     &lt;NA&gt;        Isle of Man
## 4          United Kingdom                  &lt;NA&gt;     &lt;NA&gt;     United Kingdom
## 5                 Ukraine                  &lt;NA&gt;     &lt;NA&gt;            Ukraine
##   NAME_ALT MAPCOLOR7 MAPCOLOR8 MAPCOLOR9 MAPCOLOR13  POP_EST POP_RANK
## 0 Holy See         1         3         4          2     1000        3
## 1     &lt;NA&gt;         6         6         6          3    98840        8
## 2     &lt;NA&gt;         6         6         6          3    66502        8
## 3     &lt;NA&gt;         6         6         6          3    88815        8
## 4     &lt;NA&gt;         6         6         6          3 64769452       16
## 5     &lt;NA&gt;         5         1         6          3 44033874       15
##   GDP_MD_EST POP_YEAR LASTCENSUS GDP_YEAR                    ECONOMY
## 0          0     2015        -99        0 2. Developed region: nonG7
## 1       5080     2017       2001     2015 2. Developed region: nonG7
## 2       3465     2017       2001     2015 2. Developed region: nonG7
## 3       7428     2017       2006     2014 2. Developed region: nonG7
## 4    2788000     2017       2011     2016    1. Developed region: G7
## 5     352600     2017       2001     2016       6. Developing region
##                INCOME_GRP WIKIPEDIA FIPS_10_ ISO_A2 ISO_A3 ISO_A3_EH ISO_N3
## 0 2. High income: nonOECD         0       VT     VA    VAT       VAT    336
## 1 2. High income: nonOECD       -99       JE     JE    JEY       JEY    832
## 2 2. High income: nonOECD       -99       GK     GG    GGY       GGY    831
## 3 2. High income: nonOECD       -99       IM     IM    IMN       IMN    833
## 4    1. High income: OECD       -99       UK     GB    GBR       GBR    826
## 5  4. Lower middle income       -99       UP     UA    UKR       UKR    804
##   UN_A3 WB_A2 WB_A3   WOE_ID WOE_ID_EH
## 0   336   -99   -99 23424986  23424986
## 1   832    JG   CHI 23424857  23424857
## 2   831    JG   CHI 23424827  23424827
## 3   833    IM   IMY 23424847  23424847
## 4   826    GB   GBR      -90  23424975
## 5   804    UA   UKR 23424976  23424976
##                                                                                                                                                                  WOE_NOTE
## 0                                                                                                                                              Exact WOE match as country
## 1                                                                                                                                              Exact WOE match as country
## 2                                                                                                                                              Exact WOE match as country
## 3                                                                                                                                              Exact WOE match as country
## 4 Eh ID includes Channel Islands and Isle of Man. UK constituent countries of England (24554868), Wales (12578049), Scotland (12578048), and Northern Ireland (20070563).
## 5                                                                                                                                              Exact WOE match as country
##   ADM0_A3_IS ADM0_A3_US ADM0_A3_UN ADM0_A3_WB CONTINENT REGION_UN
## 0        VAT        VAT        -99        -99    Europe    Europe
## 1        JEY        JEY        -99        -99    Europe    Europe
## 2        GGY        GGY        -99        -99    Europe    Europe
## 3        IMN        IMN        -99        -99    Europe    Europe
## 4        GBR        GBR        -99        -99    Europe    Europe
## 5        UKR        UKR        -99        -99    Europe    Europe
##         SUBREGION             REGION_WB NAME_LEN LONG_LEN ABBREV_LEN TINY
## 0 Southern Europe Europe &amp; Central Asia        7        7          4    4
## 1 Northern Europe Europe &amp; Central Asia        6        6          4  -99
## 2 Northern Europe Europe &amp; Central Asia        8        8          6  -99
## 3 Northern Europe Europe &amp; Central Asia       11       11          5  -99
## 4 Northern Europe Europe &amp; Central Asia       14       14          4  -99
## 5  Eastern Europe Europe &amp; Central Asia        7        7          4  -99
##   HOMEPART MIN_ZOOM MIN_LABEL MAX_LABEL      NE_ID WIKIDATAID         NAME_AR
## 0        1        0       5.0      10.0 1159321407       Q237       ?????????
## 1      -99        0       5.0      10.0 1159320725       Q785           ?????
## 2      -99        0       5.0      10.0 1159320715     Q25230          ??????
## 3      -99        0       5.0      10.0 1159320721      Q9676       ????? ???
## 4        1        0       1.7       6.7 1159320713       Q145 ??????? ???????
## 5        1        0       3.0       7.0 1159321345       Q212        ????????
##          NAME_BN                NAME_DE        NAME_EN             NAME_ES
## 0 ????????? ????           Vatikanstadt   Vatican City Ciudad del Vaticano
## 1         ??????                 Jersey         Jersey              Jersey
## 2           &lt;NA&gt;               Guernsey       Guernsey            Guernsey
## 3   ??? ?? ?????            Isle of Man    Isle of Man         Isla de Man
## 4     ?????????? Vereinigtes Königreich United Kingdom         Reino Unido
## 5        ???????                Ukraine        Ukraine             Ucrania
##       NAME_FR          NAME_EL         NAME_HI             NAME_HU
## 0     Vatican         ????????      ?????? ???             Vatikán
## 1      Jersey          ???????           ?????              Jersey
## 2   Guernesey         ????????       ????????? Guernsey Bailiffség
## 3  île de Man    ????? ??? ???  ?????? ?? ????                 Man
## 4 Royaume-Uni ??????? ???????? ???????? ??????  Egyesült Királyság
## 5     Ukraine         ????????         ???????             Ukrajna
##         NAME_ID            NAME_IT NAME_JA NAME_KO             NAME_NL
## 0       Vatikan Città del Vaticano    ????  ??? ??        Vaticaanstad
## 1        Jersey  Baliato di Jersey   ?????    ?? ?              Jersey
## 2      Guernsey           Guernsey   ?????    ?? ?            Guernsey
## 3     Pulau Man       Isola di Man     ???     ? ?                 Man
## 4 Britania Raya        Regno Unito    ????      ?? Verenigd Koninkrijk
## 5       Ukraina            Ucraina   ?????   ?????            Oekraïne
##           NAME_PL     NAME_PT        NAME_RU        NAME_SV          NAME_TR
## 0         Watykan    Vaticano        ???????  Vatikanstaten          Vatikan
## 1          Jersey      Jersey         ??????         Jersey           Jersey
## 2        Guernsey    Guernsey         ??????       Guernsey         Guernsey
## 3       Wyspa Man Ilha de Man     ?????? ???    Isle of Man        Man Adas?
## 4 Wielka Brytania Reino Unido ?????????????? Storbritannien Birle?ik Krall?k
## 5         Ukraina     Ucrânia        ???????        Ukraina          Ukrayna
##                                   NAME_VI NAME_ZH
## 0                           Thành Vatican     ???
## 1                                  Jersey     ???
## 2                                Guernsey     ???
## 3                                 ??o Man     ???
## 4 V??ng qu?c Liên hi?p Anh và B?c Ireland      ??
## 5                                 Ukraina     ???</code></pre>
<p>Let’s first plot our towers on this map of Europe. Remember, how when you transformed the tower locations we mentioned each point has a designated coordinate reference system? Here, we need to extract this projection from <em>europe_shape</em> using <code>proj4string()</code> and add it to our <em>SpatialPoints</em>. This way we can make sure they are in the same reference system for plotting them together.</p>
<div class="sourceCode" id="cb55"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb55-1"><a href="data-variety.html#cb55-1"></a>geo.proj &lt;-<span class="st"> </span>sp<span class="op">::</span><span class="kw">proj4string</span>(europe_shape)</span></code></pre></div>
<pre><code>## Warning in sp::proj4string(europe_shape): CRS object has comment, which is lost
## in output</code></pre>
<div class="sourceCode" id="cb57"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb57-1"><a href="data-variety.html#cb57-1"></a>pts &lt;-<span class="st"> </span>sp<span class="op">::</span><span class="kw">SpatialPoints</span>(sp_sites, <span class="dt">proj4string =</span> sp<span class="op">::</span><span class="kw">CRS</span>(geo.proj))</span></code></pre></div>
<p>Then we can take the <em>SpatialPoints</em>, now in the correct coordinate reference system, the data from <em>europe_shape</em> and bind them to our tower sites in the dataframe <em>df_sites</em>.</p>
<div class="sourceCode" id="cb58"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb58-1"><a href="data-variety.html#cb58-1"></a>df_sites_country_info &lt;-<span class="st"> </span>sp<span class="op">::</span><span class="kw">over</span>(pts, europe_shape) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb58-2"><a href="data-variety.html#cb58-2"></a><span class="st">    </span><span class="kw">as_tibble</span>() <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb58-3"><a href="data-variety.html#cb58-3"></a><span class="st">    </span><span class="kw">bind_cols</span>(df_sites, .)</span>
<span id="cb58-4"><a href="data-variety.html#cb58-4"></a></span>
<span id="cb58-5"><a href="data-variety.html#cb58-5"></a><span class="kw">head</span>(df_sites_country_info)</span></code></pre></div>
<pre><code>## # A tibble: 6 x 97
##   site    lon   lat featurecla scalerank LABELRANK SOVEREIGNT SOV_A3 ADM0_DIF
##   &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;          &lt;int&gt;     &lt;int&gt; &lt;chr&gt;      &lt;chr&gt;     &lt;int&gt;
## 1 BE-B…  4.52  51.3 Admin-0 c…         1         2 Belgium    BEL           0
## 2 BE-L…  4.75  50.6 Admin-0 c…         1         2 Belgium    BEL           0
## 3 BE-V…  6.00  50.3 Admin-0 c…         1         2 Belgium    BEL           0
## 4 CH-C…  8.41  47.2 Admin-0 c…         1         4 Switzerla… CHE           0
## 5 CH-F…  8.54  47.1 Admin-0 c…         1         4 Switzerla… CHE           0
## 6 CH-L…  8.36  47.5 Admin-0 c…         1         4 Switzerla… CHE           0
## # … with 88 more variables: LEVEL &lt;int&gt;, TYPE &lt;chr&gt;, ADMIN &lt;chr&gt;,
## #   ADM0_A3 &lt;chr&gt;, GEOU_DIF &lt;int&gt;, GEOUNIT &lt;chr&gt;, GU_A3 &lt;chr&gt;, SU_DIF &lt;int&gt;,
## #   SUBUNIT &lt;chr&gt;, SU_A3 &lt;chr&gt;, BRK_DIFF &lt;int&gt;, NAME &lt;chr&gt;, NAME_LONG &lt;chr&gt;,
## #   BRK_A3 &lt;chr&gt;, BRK_NAME &lt;chr&gt;, BRK_GROUP &lt;chr&gt;, ABBREV &lt;chr&gt;, POSTAL &lt;chr&gt;,
## #   FORMAL_EN &lt;chr&gt;, FORMAL_FR &lt;chr&gt;, NAME_CIAWF &lt;chr&gt;, NOTE_ADM0 &lt;chr&gt;,
## #   NOTE_BRK &lt;chr&gt;, NAME_SORT &lt;chr&gt;, NAME_ALT &lt;chr&gt;, MAPCOLOR7 &lt;int&gt;,
## #   MAPCOLOR8 &lt;int&gt;, MAPCOLOR9 &lt;int&gt;, MAPCOLOR13 &lt;int&gt;, POP_EST &lt;chr&gt;,
## #   POP_RANK &lt;int&gt;, GDP_MD_EST &lt;dbl&gt;, POP_YEAR &lt;int&gt;, LASTCENSUS &lt;int&gt;,
## #   GDP_YEAR &lt;int&gt;, ECONOMY &lt;chr&gt;, INCOME_GRP &lt;chr&gt;, WIKIPEDIA &lt;int&gt;,
## #   FIPS_10_ &lt;chr&gt;, ISO_A2 &lt;chr&gt;, ISO_A3 &lt;chr&gt;, ISO_A3_EH &lt;chr&gt;, ISO_N3 &lt;chr&gt;,
## #   UN_A3 &lt;chr&gt;, WB_A2 &lt;chr&gt;, WB_A3 &lt;chr&gt;, WOE_ID &lt;int&gt;, WOE_ID_EH &lt;int&gt;,
## #   WOE_NOTE &lt;chr&gt;, ADM0_A3_IS &lt;chr&gt;, ADM0_A3_US &lt;chr&gt;, ADM0_A3_UN &lt;int&gt;,
## #   ADM0_A3_WB &lt;int&gt;, CONTINENT &lt;chr&gt;, REGION_UN &lt;chr&gt;, SUBREGION &lt;chr&gt;,
## #   REGION_WB &lt;chr&gt;, NAME_LEN &lt;int&gt;, LONG_LEN &lt;int&gt;, ABBREV_LEN &lt;int&gt;,
## #   TINY &lt;int&gt;, HOMEPART &lt;int&gt;, MIN_ZOOM &lt;dbl&gt;, MIN_LABEL &lt;dbl&gt;,
## #   MAX_LABEL &lt;dbl&gt;, NE_ID &lt;chr&gt;, WIKIDATAID &lt;chr&gt;, NAME_AR &lt;chr&gt;,
## #   NAME_BN &lt;chr&gt;, NAME_DE &lt;chr&gt;, NAME_EN &lt;chr&gt;, NAME_ES &lt;chr&gt;, NAME_FR &lt;chr&gt;,
## #   NAME_EL &lt;chr&gt;, NAME_HI &lt;chr&gt;, NAME_HU &lt;chr&gt;, NAME_ID &lt;chr&gt;, NAME_IT &lt;chr&gt;,
## #   NAME_JA &lt;chr&gt;, NAME_KO &lt;chr&gt;, NAME_NL &lt;chr&gt;, NAME_PL &lt;chr&gt;, NAME_PT &lt;chr&gt;,
## #   NAME_RU &lt;chr&gt;, NAME_SV &lt;chr&gt;, NAME_TR &lt;chr&gt;, NAME_VI &lt;chr&gt;, NAME_ZH &lt;chr&gt;</code></pre>
<p>For the next part we will be using a map European with country boarders. For this, we’ll make an object called <em>shp_df</em>, this we do using the column <em>SOVEREIGNT</em>, which we saw when looking at <code>europe_shape@data</code>. This preserves only the data we need for further analysis and plotting.</p>
<div class="sourceCode" id="cb60"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb60-1"><a href="data-variety.html#cb60-1"></a><span class="kw">library</span>(maptools)</span>
<span id="cb60-2"><a href="data-variety.html#cb60-2"></a></span>
<span id="cb60-3"><a href="data-variety.html#cb60-3"></a>shp_df &lt;-<span class="st"> </span>broom<span class="op">::</span><span class="kw">tidy</span>(europe_shape, <span class="dt">region =</span> <span class="st">&quot;SOVEREIGNT&quot;</span>)</span>
<span id="cb60-4"><a href="data-variety.html#cb60-4"></a><span class="kw">head</span>(shp_df)</span></code></pre></div>
<pre><code>## # A tibble: 6 x 7
##    long   lat order hole  piece group     id     
##   &lt;dbl&gt; &lt;dbl&gt; &lt;int&gt; &lt;lgl&gt; &lt;fct&gt; &lt;fct&gt;     &lt;chr&gt;  
## 1  19.3  41.9     1 FALSE 1     Albania.1 Albania
## 2  19.3  41.9     2 FALSE 1     Albania.1 Albania
## 3  19.4  42.0     3 FALSE 1     Albania.1 Albania
## 4  19.4  42.0     4 FALSE 1     Albania.1 Albania
## 5  19.4  42.1     5 FALSE 1     Albania.1 Albania
## 6  19.3  42.1     6 FALSE 1     Albania.1 Albania</code></pre>
<div class="sourceCode" id="cb62"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb62-1"><a href="data-variety.html#cb62-1"></a><span class="kw">ggplot</span>() <span class="op">+</span><span class="st"> </span></span>
<span id="cb62-2"><a href="data-variety.html#cb62-2"></a><span class="st">  </span><span class="kw">geom_polygon</span>(<span class="dt">data =</span> shp_df, <span class="kw">aes</span>(<span class="dt">x =</span> long, <span class="dt">y =</span> lat, <span class="dt">group =</span> group, <span class="dt">fill =</span> id), <span class="dt">colour =</span> <span class="st">&quot;black&quot;</span>) <span class="op">+</span></span>
<span id="cb62-3"><a href="data-variety.html#cb62-3"></a><span class="st">  </span><span class="kw">theme_bw</span>() <span class="op">+</span></span>
<span id="cb62-4"><a href="data-variety.html#cb62-4"></a><span class="st">  </span><span class="kw">theme</span>(<span class="dt">legend.position =</span> <span class="st">&quot;none&quot;</span>)</span></code></pre></div>
<p><img src="esds_book_files/figure-html/unnamed-chunk-34-1.png" width="672" /></p>
<p>As we saw in the earlier plot of the tower locations only some countries in Europe contain towers. Therefore, we want to crop our map to include only those countries.</p>
<p>To do this we first make a vector which is a list of the country each tower is located in. We get this from <em>df_site_country_info</em>.
Then we filter out only those countries with a tower in them and voilà, plot the countries and tower locations as a result.</p>
<div class="sourceCode" id="cb63"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb63-1"><a href="data-variety.html#cb63-1"></a>countries_with_site &lt;-<span class="st"> </span>df_sites_country_info <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">pull</span>(SOVEREIGNT) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">as.character</span>()</span>
<span id="cb63-2"><a href="data-variety.html#cb63-2"></a></span>
<span id="cb63-3"><a href="data-variety.html#cb63-3"></a><span class="co"># resulting character vector (without NAs)</span></span>
<span id="cb63-4"><a href="data-variety.html#cb63-4"></a>countries_with_site <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">na.omit</span>()</span></code></pre></div>
<pre><code>##  [1] &quot;Belgium&quot;     &quot;Belgium&quot;     &quot;Belgium&quot;     &quot;Switzerland&quot; &quot;Switzerland&quot;
##  [6] &quot;Switzerland&quot; &quot;Switzerland&quot; &quot;Switzerland&quot; &quot;Switzerland&quot; &quot;Germany&quot;    
## [11] &quot;Germany&quot;     &quot;Germany&quot;     &quot;Germany&quot;     &quot;Germany&quot;     &quot;Denmark&quot;    
## [16] &quot;Finland&quot;     &quot;Finland&quot;     &quot;France&quot;      &quot;France&quot;      &quot;France&quot;     
## [21] &quot;France&quot;      &quot;Italy&quot;       &quot;Italy&quot;       &quot;Italy&quot;       &quot;Italy&quot;      
## [26] &quot;Italy&quot;       &quot;Italy&quot;       &quot;Italy&quot;       &quot;Italy&quot;       &quot;Italy&quot;      
## [31] &quot;Netherlands&quot; &quot;Czechia&quot;    
## attr(,&quot;na.action&quot;)
## [1] 33
## attr(,&quot;class&quot;)
## [1] &quot;omit&quot;</code></pre>
<div class="sourceCode" id="cb65"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb65-1"><a href="data-variety.html#cb65-1"></a><span class="co"># country with towers filtered</span></span>
<span id="cb65-2"><a href="data-variety.html#cb65-2"></a>shp_df_sub &lt;-<span class="st"> </span>shp_df <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb65-3"><a href="data-variety.html#cb65-3"></a><span class="st">  </span><span class="kw">filter</span>(id <span class="op">%in%</span><span class="st"> </span>countries_with_site)</span>
<span id="cb65-4"><a href="data-variety.html#cb65-4"></a></span>
<span id="cb65-5"><a href="data-variety.html#cb65-5"></a><span class="co"># plot result</span></span>
<span id="cb65-6"><a href="data-variety.html#cb65-6"></a><span class="kw">ggplot</span>() <span class="op">+</span><span class="st"> </span></span>
<span id="cb65-7"><a href="data-variety.html#cb65-7"></a><span class="st">  </span><span class="kw">geom_polygon</span>(<span class="dt">data =</span> shp_df_sub, <span class="kw">aes</span>(<span class="dt">x =</span> long, <span class="dt">y =</span> lat, <span class="dt">group =</span> group, <span class="dt">fill =</span> id), <span class="dt">colour =</span> <span class="st">&quot;black&quot;</span>) <span class="op">+</span></span>
<span id="cb65-8"><a href="data-variety.html#cb65-8"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">data =</span> df_sites, <span class="kw">aes</span>(<span class="dt">x =</span> lon, <span class="dt">y =</span> lat)) <span class="op">+</span></span>
<span id="cb65-9"><a href="data-variety.html#cb65-9"></a><span class="st">  </span><span class="kw">theme_bw</span>()</span></code></pre></div>
<p><img src="esds_book_files/figure-html/unnamed-chunk-35-1.png" width="672" /></p>
<p><strong>Checkpoint</strong></p>
<p>You just learnt how to plot <em>europe_shape</em> coloured by country (“SOVREIGNT”), now plot it coloured by region in europe.
Start by finding the column that gives you this information in <code>europe_shape@data</code>.</p>
<p><strong>Solution</strong></p>
<div class="sourceCode" id="cb66"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb66-1"><a href="data-variety.html#cb66-1"></a><span class="co"># take a look at the column names</span></span>
<span id="cb66-2"><a href="data-variety.html#cb66-2"></a><span class="kw">names</span>(europe_shape<span class="op">@</span>data)</span></code></pre></div>
<pre><code>##  [1] &quot;featurecla&quot; &quot;scalerank&quot;  &quot;LABELRANK&quot;  &quot;SOVEREIGNT&quot; &quot;SOV_A3&quot;    
##  [6] &quot;ADM0_DIF&quot;   &quot;LEVEL&quot;      &quot;TYPE&quot;       &quot;ADMIN&quot;      &quot;ADM0_A3&quot;   
## [11] &quot;GEOU_DIF&quot;   &quot;GEOUNIT&quot;    &quot;GU_A3&quot;      &quot;SU_DIF&quot;     &quot;SUBUNIT&quot;   
## [16] &quot;SU_A3&quot;      &quot;BRK_DIFF&quot;   &quot;NAME&quot;       &quot;NAME_LONG&quot;  &quot;BRK_A3&quot;    
## [21] &quot;BRK_NAME&quot;   &quot;BRK_GROUP&quot;  &quot;ABBREV&quot;     &quot;POSTAL&quot;     &quot;FORMAL_EN&quot; 
## [26] &quot;FORMAL_FR&quot;  &quot;NAME_CIAWF&quot; &quot;NOTE_ADM0&quot;  &quot;NOTE_BRK&quot;   &quot;NAME_SORT&quot; 
## [31] &quot;NAME_ALT&quot;   &quot;MAPCOLOR7&quot;  &quot;MAPCOLOR8&quot;  &quot;MAPCOLOR9&quot;  &quot;MAPCOLOR13&quot;
## [36] &quot;POP_EST&quot;    &quot;POP_RANK&quot;   &quot;GDP_MD_EST&quot; &quot;POP_YEAR&quot;   &quot;LASTCENSUS&quot;
## [41] &quot;GDP_YEAR&quot;   &quot;ECONOMY&quot;    &quot;INCOME_GRP&quot; &quot;WIKIPEDIA&quot;  &quot;FIPS_10_&quot;  
## [46] &quot;ISO_A2&quot;     &quot;ISO_A3&quot;     &quot;ISO_A3_EH&quot;  &quot;ISO_N3&quot;     &quot;UN_A3&quot;     
## [51] &quot;WB_A2&quot;      &quot;WB_A3&quot;      &quot;WOE_ID&quot;     &quot;WOE_ID_EH&quot;  &quot;WOE_NOTE&quot;  
## [56] &quot;ADM0_A3_IS&quot; &quot;ADM0_A3_US&quot; &quot;ADM0_A3_UN&quot; &quot;ADM0_A3_WB&quot; &quot;CONTINENT&quot; 
## [61] &quot;REGION_UN&quot;  &quot;SUBREGION&quot;  &quot;REGION_WB&quot;  &quot;NAME_LEN&quot;   &quot;LONG_LEN&quot;  
## [66] &quot;ABBREV_LEN&quot; &quot;TINY&quot;       &quot;HOMEPART&quot;   &quot;MIN_ZOOM&quot;   &quot;MIN_LABEL&quot; 
## [71] &quot;MAX_LABEL&quot;  &quot;NE_ID&quot;      &quot;WIKIDATAID&quot; &quot;NAME_AR&quot;    &quot;NAME_BN&quot;   
## [76] &quot;NAME_DE&quot;    &quot;NAME_EN&quot;    &quot;NAME_ES&quot;    &quot;NAME_FR&quot;    &quot;NAME_EL&quot;   
## [81] &quot;NAME_HI&quot;    &quot;NAME_HU&quot;    &quot;NAME_ID&quot;    &quot;NAME_IT&quot;    &quot;NAME_JA&quot;   
## [86] &quot;NAME_KO&quot;    &quot;NAME_NL&quot;    &quot;NAME_PL&quot;    &quot;NAME_PT&quot;    &quot;NAME_RU&quot;   
## [91] &quot;NAME_SV&quot;    &quot;NAME_TR&quot;    &quot;NAME_VI&quot;    &quot;NAME_ZH&quot;</code></pre>
<div class="sourceCode" id="cb68"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb68-1"><a href="data-variety.html#cb68-1"></a><span class="co"># make a df of the data needed from europe_shape</span></span>
<span id="cb68-2"><a href="data-variety.html#cb68-2"></a>shp_df_region &lt;-<span class="st"> </span>broom<span class="op">::</span><span class="kw">tidy</span>(europe_shape, <span class="dt">region =</span> <span class="st">&quot;SUBREGION&quot;</span>)</span>
<span id="cb68-3"><a href="data-variety.html#cb68-3"></a><span class="kw">head</span>(shp_df_region)</span></code></pre></div>
<pre><code>## # A tibble: 6 x 7
##    long   lat order hole  piece group            id            
##   &lt;dbl&gt; &lt;dbl&gt; &lt;int&gt; &lt;lgl&gt; &lt;fct&gt; &lt;fct&gt;            &lt;chr&gt;         
## 1  28    42.0     1 FALSE 1     Eastern Europe.1 Eastern Europe
## 2  27.9  42.0     2 FALSE 1     Eastern Europe.1 Eastern Europe
## 3  27.8  42.0     3 FALSE 1     Eastern Europe.1 Eastern Europe
## 4  27.8  42.0     4 FALSE 1     Eastern Europe.1 Eastern Europe
## 5  27.7  42.0     5 FALSE 1     Eastern Europe.1 Eastern Europe
## 6  27.7  42.0     6 FALSE 1     Eastern Europe.1 Eastern Europe</code></pre>
<div class="sourceCode" id="cb70"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb70-1"><a href="data-variety.html#cb70-1"></a><span class="co"># plot europe coloured by region</span></span>
<span id="cb70-2"><a href="data-variety.html#cb70-2"></a><span class="kw">ggplot</span>() <span class="op">+</span><span class="st"> </span></span>
<span id="cb70-3"><a href="data-variety.html#cb70-3"></a><span class="st">  </span><span class="kw">geom_polygon</span>(<span class="dt">data =</span> shp_df_region, <span class="kw">aes</span>(<span class="dt">x =</span> long, <span class="dt">y =</span> lat, <span class="dt">group =</span> group, <span class="dt">fill =</span> id), <span class="dt">colour =</span> <span class="st">&quot;black&quot;</span>) <span class="op">+</span></span>
<span id="cb70-4"><a href="data-variety.html#cb70-4"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">data =</span> df_sites, <span class="kw">aes</span>(<span class="dt">x =</span> lon, <span class="dt">y =</span> lat)) <span class="op">+</span></span>
<span id="cb70-5"><a href="data-variety.html#cb70-5"></a><span class="st">  </span><span class="kw">theme_bw</span>()</span></code></pre></div>
<p><img src="esds_book_files/figure-html/unnamed-chunk-36-1.png" width="672" /></p>
</div>
<div id="rasters" class="section level3">
<h3><span class="header-section-number">4.2.5</span> Rasters</h3>
<p>Next up are rasters. A raster is a matrix or grid of cells each of which contains information in the form of a value.</p>
<p>A <b>raster</b> object consists primarily of:</p>
<ul>
<li>A grid of <b>cells</b>;<br />
</li>
<li>A <b>coordinate reference system (CRS)</b> for the grid and its cells so that we know the location to which the grid refers;</li>
<li>A <b>variable of interest</b> for which each cell in the grid has a value, and;</li>
<li>Other information relating to the CRS, projection, resolution, etc.</li>
</ul>
<p>Let’s take a look at some rasters and get familiar with some functions to analyse them.</p>
<p>Since our goal ultimate goal is to predict productivity, we will consider different factors that might explain productivity, for example, landcover and temperature.
To start off we’ll look at some landcover data. With this data, we can investigate the surroundings of the Fluxnet towers. This data gives us the different classes of physical coverage of the Earth’s surface, such as forests, grasslands, croplands, lakes, etc. Landcover types affect fluxes measured by the tower through the vegetation that characterizes them, or by influencing the radiation budget through albedo, or water availability. Although we have some information from the overview file of the towers, we can still check whether we can confirm this information. We will load landcover data from GlobCover provided by the <a href="http://due.esrin.esa.int/page_globcover.php">European space agency (ESA)</a>. This project provides landcover maps observations of surface reflectance from the 300m MERIS sensor on board the ENVISAT satellite mission as their input.</p>
<div class="sourceCode" id="cb71"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb71-1"><a href="data-variety.html#cb71-1"></a><span class="co"># library(raster) -&gt; we have already done this but remember you need this to load rasters!</span></span>
<span id="cb71-2"><a href="data-variety.html#cb71-2"></a></span>
<span id="cb71-3"><a href="data-variety.html#cb71-3"></a>raster_landcover &lt;-<span class="st"> </span><span class="kw">raster</span>(<span class="st">&quot;./data/Globcover_EU.tif&quot;</span>)</span></code></pre></div>
<p>This landcover data consists of different categories, these GlobCover categories are based on the Land Cover Classification System (LCCS) which was
developed by the Food and Agricultural Organization of the United Nations (FAO) to provide a consistent framework for the classification of mapping land cover. They include various types of forest, shrub- and grasslands, cropland and artificial surfaces.</p>
<p>Before we look at the data, we first reduce the spatial extent that the raster covers. We crop it to a rectangle around the site location of CH-Lae (+/- 2 degrees in longitudinal direction, +/- 1 degree in latitudinal direction).</p>
<div class="sourceCode" id="cb72"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb72-1"><a href="data-variety.html#cb72-1"></a>bounding_box &lt;-<span class="st"> </span><span class="kw">extent</span>(lon_lae<span class="dv">-2</span>, lon_lae<span class="op">+</span><span class="dv">2</span>, lat_lae<span class="dv">-1</span>, lat_lae<span class="op">+</span><span class="dv">1</span>)</span>
<span id="cb72-2"><a href="data-variety.html#cb72-2"></a>raster_landcover_crop &lt;-<span class="st"> </span><span class="kw">crop</span>(raster_landcover, bounding_box)</span></code></pre></div>
<p>We can plot our raster as the region around our tower. To indicate the position of our tower, we add a red dot.</p>
<div class="sourceCode" id="cb73"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb73-1"><a href="data-variety.html#cb73-1"></a><span class="kw">plot</span>(raster_landcover_crop, <span class="dt">legend=</span><span class="ot">FALSE</span>, <span class="dt">xlab=</span><span class="st">&quot;longitude&quot;</span>, <span class="dt">ylab=</span><span class="st">&quot;latitude&quot;</span>)</span></code></pre></div>
<p><img src="esds_book_files/figure-html/unnamed-chunk-39-1.png" width="672" /></p>
<pre><code>## Warning in plot.window(...): &quot;legend&quot; is not a graphical parameter</code></pre>
<pre><code>## Warning in plot.xy(xy, type, ...): &quot;legend&quot; is not a graphical parameter</code></pre>
<pre><code>## Warning in title(...): &quot;legend&quot; is not a graphical parameter</code></pre>
<pre><code>## Warning in graphics::rasterImage(z, bb[1], bb[3], bb[2], bb[4], interpolate =
## interpolate, : &quot;legend&quot; is not a graphical parameter</code></pre>
<div class="sourceCode" id="cb78"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb78-1"><a href="data-variety.html#cb78-1"></a><span class="kw">points</span>(lon_lae, lat_lae, <span class="dt">pch =</span> <span class="dv">16</span>, <span class="dt">col =</span> <span class="st">&quot;red&quot;</span>)</span></code></pre></div>
<p><img src="esds_book_files/figure-html/unnamed-chunk-39-2.png" width="672" /></p>
<p>If we want to conduct analysis using two different rasters, we have to make sure they have the same resolution and are aligned on the same grid. Let’s read a second raster and compare the grids. We load spatio-temporal temperature rasters available from <a href="https://chelsa-climate.org">CHELSA</a> to complement our flux tower measurements for further analysis.
The temperature raster data from CHELSA provides free high-resolution climate data (temperature and precipitation) for the past and the future. The past data we use here are downscaled model output temperature and precipitation estimates of the ERA-Interim climatic reanalysis (forecast models and data assimilation systems reanalysing archived observations). While the temperature algorithm is based on statistical downscaling of atmospheric temperatures, the precipitation algorithm incorporates orographic predictors including wind fields, valley exposition, and boundary layer height, with subsequent bias correction. The data we use consists of a monthly temperature and precipitation time series over the area of Europe from 2006 to 2012 in January. To compare this new raster with the previous one we need to crop it to the same region as the tower.</p>
<div class="sourceCode" id="cb79"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb79-1"><a href="data-variety.html#cb79-1"></a>raster_chelsa &lt;-<span class="st"> </span><span class="kw">raster</span>(<span class="st">&quot;./data/Chelsa_t_mean_2006-2012.tif&quot;</span>)</span>
<span id="cb79-2"><a href="data-variety.html#cb79-2"></a>raster_chelsa_crop &lt;-<span class="st"> </span><span class="kw">crop</span>(raster_chelsa, bounding_box)</span></code></pre></div>
<p>We now plot our raster.</p>
<div class="sourceCode" id="cb80"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb80-1"><a href="data-variety.html#cb80-1"></a>pal &lt;-<span class="st"> </span><span class="kw">colorRampPalette</span>(<span class="kw">c</span>(<span class="st">&quot;purple&quot;</span>,<span class="st">&quot;blue&quot;</span>,<span class="st">&quot;cyan&quot;</span>,<span class="st">&quot;green&quot;</span>,<span class="st">&quot;yellow&quot;</span>,<span class="st">&quot;red&quot;</span>))</span>
<span id="cb80-2"><a href="data-variety.html#cb80-2"></a><span class="kw">plot</span>(raster_chelsa_crop, <span class="dt">col =</span> <span class="kw">pal</span>(<span class="dv">20</span>), <span class="dt">xlab=</span><span class="st">&quot;longitude&quot;</span>, <span class="dt">ylab=</span><span class="st">&quot;latitude&quot;</span>)</span>
<span id="cb80-3"><a href="data-variety.html#cb80-3"></a><span class="kw">points</span>(lon_lae, lat_lae, <span class="dt">pch =</span> <span class="dv">16</span>, <span class="dt">col =</span> <span class="st">&quot;red&quot;</span>)</span></code></pre></div>
<p><img src="esds_book_files/figure-html/unnamed-chunk-41-1.png" width="672" /></p>
<p>We see that the temperature units are not in a comprehensive format. To change the unit from Kelvin x10 to degree Celsius we have to divide the data by 10 and subtract 273.15.</p>
<div class="sourceCode" id="cb81"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb81-1"><a href="data-variety.html#cb81-1"></a>raster_chelsa_crop &lt;-<span class="st"> </span>raster_chelsa_crop<span class="op">/</span><span class="dv">10</span><span class="fl">-273.15</span></span></code></pre></div>
<p>We plot our raster again.</p>
<div class="sourceCode" id="cb82"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb82-1"><a href="data-variety.html#cb82-1"></a>pal &lt;-<span class="st"> </span><span class="kw">colorRampPalette</span>(<span class="kw">c</span>(<span class="st">&quot;purple&quot;</span>,<span class="st">&quot;blue&quot;</span>,<span class="st">&quot;cyan&quot;</span>,<span class="st">&quot;green&quot;</span>,<span class="st">&quot;yellow&quot;</span>,<span class="st">&quot;red&quot;</span>))</span>
<span id="cb82-2"><a href="data-variety.html#cb82-2"></a><span class="kw">plot</span>(raster_chelsa_crop, <span class="dt">col =</span> <span class="kw">pal</span>(<span class="dv">20</span>), <span class="dt">xlab=</span><span class="st">&quot;longitude&quot;</span>, <span class="dt">ylab=</span><span class="st">&quot;latitude&quot;</span>)</span>
<span id="cb82-3"><a href="data-variety.html#cb82-3"></a><span class="kw">points</span>(lon_lae, lat_lae, <span class="dt">pch =</span> <span class="dv">16</span>, <span class="dt">col =</span> <span class="st">&quot;red&quot;</span>)</span></code></pre></div>
<p><img src="esds_book_files/figure-html/unnamed-chunk-43-1.png" width="672" /></p>
<p>We have seen some of the basic functions in the package <code>raster</code>. Now we will load one more package to work with raster files. We use the package <code>rasterVis</code>. This package contains methods for enhanced visualization and interaction with raster data. It implements visualization methods for quantitative data and categorical data, both for univariate and multivariate rasters. It also provides methods to display spatiotemporal rasters, and vector fields.</p>
<div class="sourceCode" id="cb83"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb83-1"><a href="data-variety.html#cb83-1"></a><span class="kw">library</span>(rasterVis)</span>
<span id="cb83-2"><a href="data-variety.html#cb83-2"></a><span class="kw">library</span>(RColorBrewer)</span>
<span id="cb83-3"><a href="data-variety.html#cb83-3"></a></span>
<span id="cb83-4"><a href="data-variety.html#cb83-4"></a>mapTheme &lt;-<span class="st"> </span><span class="kw">rasterTheme</span>(<span class="dt">region =</span> <span class="kw">rev</span>(<span class="kw">brewer.pal</span>(<span class="dv">8</span>,<span class="st">&quot;RdYlBu&quot;</span>)))</span>
<span id="cb83-5"><a href="data-variety.html#cb83-5"></a>plt &lt;-<span class="st"> </span><span class="kw">levelplot</span>(raster_chelsa_crop, <span class="dt">margin=</span><span class="ot">FALSE</span>, <span class="dt">par.settings =</span> mapTheme)</span>
<span id="cb83-6"><a href="data-variety.html#cb83-6"></a>plt</span></code></pre></div>
<p><img src="esds_book_files/figure-html/unnamed-chunk-44-1.png" width="672" /></p>
<p><strong>Checkpoint</strong></p>
<p>Create your own small raster with 100 grid cells. Give it values, a projection (e.g. ‘+proj=utm +zone=48 +datum=WGS84’) and plot it.</p>
<p><em>Bonus</em>: If you chose the example projection provided, add <em>europe_shape</em> to your plot.</p>
<p><strong>Solution</strong></p>
<div class="sourceCode" id="cb84"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb84-1"><a href="data-variety.html#cb84-1"></a><span class="co"># create a raster</span></span>
<span id="cb84-2"><a href="data-variety.html#cb84-2"></a><span class="co"># short compact version</span></span>
<span id="cb84-3"><a href="data-variety.html#cb84-3"></a>myraster &lt;-<span class="st"> </span><span class="kw">raster</span>(<span class="dt">ncol=</span><span class="dv">10</span>, <span class="dt">nrow=</span><span class="dv">10</span>)</span>
<span id="cb84-4"><a href="data-variety.html#cb84-4"></a><span class="co"># OR </span></span>
<span id="cb84-5"><a href="data-variety.html#cb84-5"></a><span class="co"># longer version</span></span>
<span id="cb84-6"><a href="data-variety.html#cb84-6"></a>myraster &lt;-<span class="st"> </span><span class="kw">raster</span>()</span>
<span id="cb84-7"><a href="data-variety.html#cb84-7"></a><span class="kw">ncol</span>(myraster) &lt;-<span class="st"> </span><span class="dv">10</span></span>
<span id="cb84-8"><a href="data-variety.html#cb84-8"></a><span class="kw">nrow</span>(myraster) &lt;-<span class="st"> </span><span class="dv">10</span></span>
<span id="cb84-9"><a href="data-variety.html#cb84-9"></a></span>
<span id="cb84-10"><a href="data-variety.html#cb84-10"></a><span class="co"># add values to the raster, this can be done in many ways here are two examples:</span></span>
<span id="cb84-11"><a href="data-variety.html#cb84-11"></a><span class="kw">values</span>(myraster) &lt;-<span class="st"> </span><span class="dv">1</span><span class="op">:</span><span class="kw">ncell</span>(myraster)</span>
<span id="cb84-12"><a href="data-variety.html#cb84-12"></a><span class="co"># OR </span></span>
<span id="cb84-13"><a href="data-variety.html#cb84-13"></a><span class="kw">values</span>(myraster) &lt;-<span class="st"> </span><span class="kw">runif</span>(<span class="kw">ncell</span>(myraster))</span>
<span id="cb84-14"><a href="data-variety.html#cb84-14"></a></span>
<span id="cb84-15"><a href="data-variety.html#cb84-15"></a><span class="co"># add a projection</span></span>
<span id="cb84-16"><a href="data-variety.html#cb84-16"></a><span class="kw">projection</span>(myraster) &lt;-<span class="st"> &quot;+proj=utm +zone=48 +datum=WGS84&quot;</span></span>
<span id="cb84-17"><a href="data-variety.html#cb84-17"></a></span>
<span id="cb84-18"><a href="data-variety.html#cb84-18"></a><span class="co"># plot it</span></span>
<span id="cb84-19"><a href="data-variety.html#cb84-19"></a><span class="kw">plot</span>(myraster)</span>
<span id="cb84-20"><a href="data-variety.html#cb84-20"></a><span class="co"># for fun let&#39;s see where europe would be on our raster, since it has a projection...</span></span>
<span id="cb84-21"><a href="data-variety.html#cb84-21"></a><span class="kw">plot</span>(europe_shape, <span class="dt">add=</span><span class="ot">TRUE</span>)</span></code></pre></div>
<p><img src="esds_book_files/figure-html/unnamed-chunk-45-1.png" width="672" /></p>
<div id="aggregating" class="section level4">
<h4><span class="header-section-number">4.2.5.1</span> Aggregating</h4>
<p>A <strong>raster grid</strong> is uniquely defined by an <em>origin</em>, a point that one of the intersections of grid lines, and its resolution, the magnitude of each cell-side. In the R package <code>raster</code>, the origin is defined as the point closest to (0,0) that is still an intersection of grid lines. The functions <code>origin()</code> and <code>res()</code> from the R package <code>raster</code> return the origin and resolution of a raster object. So let’s see what the resolution and origin of the rasters we loaded before are.</p>
<div class="sourceCode" id="cb85"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb85-1"><a href="data-variety.html#cb85-1"></a><span class="kw">res</span>(raster_landcover)</span></code></pre></div>
<pre><code>## [1] 0.002777778 0.002777778</code></pre>
<div class="sourceCode" id="cb87"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb87-1"><a href="data-variety.html#cb87-1"></a><span class="kw">res</span>(raster_chelsa)</span></code></pre></div>
<pre><code>## [1] 0.008333333 0.008333333</code></pre>
<div class="sourceCode" id="cb89"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb89-1"><a href="data-variety.html#cb89-1"></a><span class="kw">origin</span>(raster_landcover)</span></code></pre></div>
<pre><code>## [1]  0.001388889 -0.001388889</code></pre>
<div class="sourceCode" id="cb91"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb91-1"><a href="data-variety.html#cb91-1"></a><span class="kw">origin</span>(raster_chelsa)</span></code></pre></div>
<pre><code>## [1] -0.000139609 -0.000139249</code></pre>
<p>Landcover has a much higher resolution. Let’s re-grid the Landcover raster to match the grid of the Chelsa raster. Aggregating means resampling an input raster to a coarser resolution based on a specified aggregation strategy. We now determine the aggregation factor by dividing the resolution of the landcover raster by that of the Chelsa raster. We do it both for the longitude and latitude to make sure they match.</p>
<div class="sourceCode" id="cb93"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb93-1"><a href="data-variety.html#cb93-1"></a>res_landcover &lt;-<span class="st"> </span><span class="kw">res</span>(raster_landcover)</span>
<span id="cb93-2"><a href="data-variety.html#cb93-2"></a>res_chelsa &lt;-<span class="st"> </span><span class="kw">res</span>(raster_chelsa)</span>
<span id="cb93-3"><a href="data-variety.html#cb93-3"></a>factor_agg_lon &lt;-<span class="st"> </span>res_chelsa[<span class="dv">1</span>] <span class="op">/</span><span class="st"> </span>res_landcover[<span class="dv">1</span>]</span>
<span id="cb93-4"><a href="data-variety.html#cb93-4"></a>factor_agg_lat &lt;-<span class="st"> </span>res_chelsa[<span class="dv">2</span>] <span class="op">/</span><span class="st"> </span>res_landcover[<span class="dv">2</span>]</span>
<span id="cb93-5"><a href="data-variety.html#cb93-5"></a><span class="kw">print</span>(factor_agg_lon); <span class="kw">print</span>(factor_agg_lat)</span></code></pre></div>
<pre><code>## [1] 3</code></pre>
<pre><code>## [1] 3</code></pre>
<p>First, we observed that the land cover raster has a higher resolution than the temperature raster, now we now it is 3 times higher. So we need to transform the landcover raster to make sure it has the same grid (same <em>origin</em> and <em>resolution</em>) as the temperature raster. This will allow us to combine them in a potential analysis. We achieve this using <code>aggregate()</code> from the R package <code>raster</code> to obtain a sum of edges raster at 1000m x 1000m resolution.</p>
<p>The aggregate function takes three main arguments.
* <strong><em>x</em></strong> : the raster object to aggregate,
* <strong><em>fact</em></strong> : aggregation factor, i.e. the number of current cells that will make up the side of one of the new cells, and,
* <strong><em>fun</em></strong> : the function to apply to summarize the raster values of the fact^2 (in this case 3ˆ2=9) cells.</p>
<p>We aggregate the landcover raster at 1km using the aggregation factor calculated above.</p>
<div class="sourceCode" id="cb96"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb96-1"><a href="data-variety.html#cb96-1"></a>raster_landcover_crop_agg &lt;-<span class="st"> </span><span class="kw">aggregate</span>(raster_landcover_crop, <span class="dt">fact =</span> factor_agg_lon, <span class="dt">fun =</span> modal)</span></code></pre></div>
<p>We check the resolutions and origin of the two rasters and plot our the new landcover one.</p>
<div class="sourceCode" id="cb97"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb97-1"><a href="data-variety.html#cb97-1"></a><span class="kw">res</span>(raster_landcover_crop_agg)</span></code></pre></div>
<pre><code>## [1] 0.008333333 0.008333333</code></pre>
<div class="sourceCode" id="cb99"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb99-1"><a href="data-variety.html#cb99-1"></a><span class="kw">res</span>(raster_chelsa)</span></code></pre></div>
<pre><code>## [1] 0.008333333 0.008333333</code></pre>
<div class="sourceCode" id="cb101"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb101-1"><a href="data-variety.html#cb101-1"></a><span class="kw">origin</span>(raster_landcover_crop_agg)</span></code></pre></div>
<pre><code>## [1] -0.001388889 -0.004166667</code></pre>
<div class="sourceCode" id="cb103"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb103-1"><a href="data-variety.html#cb103-1"></a><span class="kw">origin</span>(raster_chelsa)</span></code></pre></div>
<pre><code>## [1] -0.000139609 -0.000139249</code></pre>
<div class="sourceCode" id="cb105"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb105-1"><a href="data-variety.html#cb105-1"></a><span class="kw">plot</span>(raster_landcover_crop_agg, <span class="dt">legend=</span><span class="ot">FALSE</span>, <span class="dt">xlab=</span><span class="st">&quot;longitude&quot;</span>, <span class="dt">ylab=</span><span class="st">&quot;latitude&quot;</span>)</span></code></pre></div>
<p><img src="esds_book_files/figure-html/unnamed-chunk-50-1.png" width="672" /></p>
<p>We can see that the resolutions are now the same but the origin still differs. To get matching origins we must do another step: align the rasters.</p>
</div>
<div id="aligning" class="section level4">
<h4><span class="header-section-number">4.2.5.2</span> Aligning</h4>
<p>Aligning rasters is done using the function <code>resample()</code>. There are two main resampling methods: <em>Nearest Neighbour</em> or <em>Bilinear Interpolation</em>, which method is used depends upon the input data and its use after the operation is performed.</p>
<p><strong><em>Nearest Neighbour</em></strong> is best used for categorical data like land-use classification or slope classification. The values that go into the grid stay exactly the same, a 2 comes out as a 2, and 99 comes out as 99. The value of the output cell is determined by the nearest cell center on the input grid. Nearest Neighbor can be used on continuous data but the results can be blocky.</p>
<p><strong><em>Bilinear Interpolation</em></strong> uses a weighted average of the four nearest cell centers. The closer an input cell center is to the output cell center, the higher the influence of its value is on the output cell value. This means that the output value could be different than the nearest input, but is always within the same range of values as the input. Since the values can change, Bilinear is not recommended for categorical data. Instead, it should be used for continuous data like elevation and raw slope values.</p>
<div class="sourceCode" id="cb106"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb106-1"><a href="data-variety.html#cb106-1"></a>raster_landcover_crop_resampl &lt;-<span class="st"> </span><span class="kw">resample</span>(raster_landcover_crop, raster_chelsa_crop, <span class="dt">method=</span><span class="st">&quot;ngb&quot;</span>)</span>
<span id="cb106-2"><a href="data-variety.html#cb106-2"></a><span class="kw">plot</span>(raster_landcover_crop_resampl, <span class="dt">legend=</span><span class="ot">FALSE</span>, <span class="dt">xlab=</span><span class="st">&quot;longitude&quot;</span>, <span class="dt">ylab=</span><span class="st">&quot;latitude&quot;</span>)</span></code></pre></div>
<p><img src="esds_book_files/figure-html/unnamed-chunk-51-1.png" width="672" /></p>
<pre><code>## Warning in plot.window(...): &quot;legend&quot; is not a graphical parameter</code></pre>
<pre><code>## Warning in plot.xy(xy, type, ...): &quot;legend&quot; is not a graphical parameter</code></pre>
<pre><code>## Warning in title(...): &quot;legend&quot; is not a graphical parameter</code></pre>
<pre><code>## Warning in graphics::rasterImage(z, bb[1], bb[3], bb[2], bb[4], interpolate =
## interpolate, : &quot;legend&quot; is not a graphical parameter</code></pre>
<p><img src="esds_book_files/figure-html/unnamed-chunk-51-2.png" width="672" /></p>
<p>Now we check if the two rasters are aligned.</p>
<div class="sourceCode" id="cb111"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb111-1"><a href="data-variety.html#cb111-1"></a><span class="kw">res</span>(raster_landcover_crop_resampl)</span></code></pre></div>
<pre><code>## [1] 0.008333333 0.008333333</code></pre>
<div class="sourceCode" id="cb113"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb113-1"><a href="data-variety.html#cb113-1"></a><span class="kw">res</span>(raster_chelsa)</span></code></pre></div>
<pre><code>## [1] 0.008333333 0.008333333</code></pre>
<div class="sourceCode" id="cb115"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb115-1"><a href="data-variety.html#cb115-1"></a><span class="kw">origin</span>(raster_landcover_crop_resampl)</span></code></pre></div>
<pre><code>## [1] -0.000139609 -0.000139249</code></pre>
<div class="sourceCode" id="cb117"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb117-1"><a href="data-variety.html#cb117-1"></a><span class="kw">origin</span>(raster_chelsa)</span></code></pre></div>
<pre><code>## [1] -0.000139609 -0.000139249</code></pre>
<p>Now the two rasters are aligned.</p>
</div>
<div id="point-extraction" class="section level4">
<h4><span class="header-section-number">4.2.5.3</span> Point extraction</h4>
<p>In this section, we will show you how to extract data from our rasters or spatial data. We will be extracting the values for the locations of our towers. The function to extract values is aptly named <code>extract()</code>. First, we specify the raster from which the values should be extracted and then the exact sites at which the values should be extracted. Here, we combine all this into a neat dataframe.</p>
<div class="sourceCode" id="cb119"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb119-1"><a href="data-variety.html#cb119-1"></a>df_sites_temp &lt;-<span class="st"> </span><span class="kw">read_csv</span>(<span class="st">&quot;./data/fluxnet_site_info_reduced.csv&quot;</span>)</span>
<span id="cb119-2"><a href="data-variety.html#cb119-2"></a></span>
<span id="cb119-3"><a href="data-variety.html#cb119-3"></a>df_sites_temp &lt;-<span class="st"> </span><span class="kw">extract</span>(raster_chelsa, sp_sites, <span class="dt">sp =</span> <span class="ot">TRUE</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb119-4"><a href="data-variety.html#cb119-4"></a><span class="st">  </span><span class="kw">as_tibble</span>() <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb119-5"><a href="data-variety.html#cb119-5"></a><span class="st">  </span><span class="kw">right_join</span>(df_sites_temp, <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&quot;lon&quot;</span>, <span class="st">&quot;lat&quot;</span>)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb119-6"><a href="data-variety.html#cb119-6"></a><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">rename</span>(<span class="dt">temp_chelsa =</span> Chelsa_t_mean_<span class="fl">2006.2012</span>)</span></code></pre></div>
<p>In the lectures, you have already, heard that we must always be aware of modelled data and be aware of its limitations. Therefore, we don’t just want to use CHELSA temperature data. It is important to consider different models and compare them. Hence, we’ll look at another climate model. We load and plot the provided rasters showing the mean annual temperatures for the Worldclim data for the years 2006-2012. WorldClim is a set of global climate layers (gridded climate data) with a spatial resolution of about 1 km<sup>2</sup>. We extract values from Worldclim at the same tower sites and add them to the <em>df_sites</em> data frame. Now we have a tidy dataframe with the site, latitude and longitude, temperatures for Chelsa and WorldClim at each tower location.</p>
<div class="sourceCode" id="cb120"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb120-1"><a href="data-variety.html#cb120-1"></a>raster_worldclim &lt;-<span class="st"> </span><span class="kw">raster</span>(<span class="st">&quot;./data/WC_mean_t_2006-2012.tif&quot;</span>)</span>
<span id="cb120-2"><a href="data-variety.html#cb120-2"></a></span>
<span id="cb120-3"><a href="data-variety.html#cb120-3"></a>df_sites_temp &lt;-<span class="st"> </span><span class="kw">extract</span>(raster_worldclim, sp_sites, <span class="dt">sp =</span> <span class="ot">TRUE</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb120-4"><a href="data-variety.html#cb120-4"></a><span class="st">  </span><span class="kw">as_tibble</span>() <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb120-5"><a href="data-variety.html#cb120-5"></a><span class="st">  </span><span class="kw">right_join</span>(df_sites_temp, <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&quot;lon&quot;</span>, <span class="st">&quot;lat&quot;</span>)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb120-6"><a href="data-variety.html#cb120-6"></a><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">rename</span>(<span class="dt">temp_wc =</span> WC_mean_t_<span class="fl">2006.2012</span>)</span>
<span id="cb120-7"><a href="data-variety.html#cb120-7"></a></span>
<span id="cb120-8"><a href="data-variety.html#cb120-8"></a><span class="kw">head</span>(df_sites_temp)</span></code></pre></div>
<pre><code>## # A tibble: 6 x 5
##   temp_wc   lon   lat temp_chelsa site  
##     &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;       &lt;dbl&gt; &lt;chr&gt; 
## 1  -0.633  4.52  51.3        2750 BE-Bra
## 2  -1.45   4.75  50.6        2741 BE-Lon
## 3  -3.75   6.00  50.3        2716 BE-Vie
## 4  -4.76   8.41  47.2        2730 CH-Cha
## 5  -4.97   8.54  47.1        2699 CH-Fru
## 6  -5.38   8.36  47.5        2710 CH-Lae</code></pre>
<p>We get the monthly mean temperature of Jan 2006 from FLUXNET data.</p>
<div class="sourceCode" id="cb122"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb122-1"><a href="data-variety.html#cb122-1"></a><span class="kw">library</span>(lubridate)</span>
<span id="cb122-2"><a href="data-variety.html#cb122-2"></a><span class="kw">load</span>(<span class="st">&quot;./data/ddf_allsites_nested_joined.RData&quot;</span>)</span>
<span id="cb122-3"><a href="data-variety.html#cb122-3"></a></span>
<span id="cb122-4"><a href="data-variety.html#cb122-4"></a>df_sites_temp &lt;-<span class="st"> </span>ddf_allsites_nested_joined <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb122-5"><a href="data-variety.html#cb122-5"></a><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">select</span>(<span class="dt">site =</span> siteid, data) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb122-6"><a href="data-variety.html#cb122-6"></a><span class="st">  </span><span class="kw">unnest</span>(data) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb122-7"><a href="data-variety.html#cb122-7"></a><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">select</span>(site, TIMESTAMP, TA_F) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb122-8"><a href="data-variety.html#cb122-8"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">month =</span> <span class="kw">month</span>(TIMESTAMP), <span class="dt">year =</span> <span class="kw">year</span>(TIMESTAMP)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb122-9"><a href="data-variety.html#cb122-9"></a><span class="st">  </span><span class="kw">filter</span>(month <span class="op">==</span><span class="st"> </span><span class="dv">1</span>, year <span class="op">==</span><span class="st"> </span><span class="dv">2006</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb122-10"><a href="data-variety.html#cb122-10"></a><span class="st">  </span><span class="kw">group_by</span>(site) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb122-11"><a href="data-variety.html#cb122-11"></a><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">temp_fluxnet =</span> <span class="kw">mean</span>(TA_F)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb122-12"><a href="data-variety.html#cb122-12"></a><span class="st">  </span></span>
<span id="cb122-13"><a href="data-variety.html#cb122-13"></a><span class="st">  </span><span class="co"># add temp data extracted from spatial files (chelsa and worldclim)</span></span>
<span id="cb122-14"><a href="data-variety.html#cb122-14"></a><span class="st">  </span><span class="kw">left_join</span>(df_sites_temp, dplyr<span class="op">::</span><span class="kw">select</span>(site, temp_wc, temp_chelsa),</span>
<span id="cb122-15"><a href="data-variety.html#cb122-15"></a>            <span class="dt">by =</span> <span class="st">&quot;site&quot;</span>)</span></code></pre></div>
<p>We compare the climate models by showing the correlations with the tower’s data. The dotted line shows what the linear model would look like if the values of our model and the tower data overlapped. The red line shows the actual linear model of the relationship between the climate model and the tower data. The closer the red line to the dotted line the better the model is at predicting the temperatures measured by the towers.</p>
<div class="sourceCode" id="cb123"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb123-1"><a href="data-variety.html#cb123-1"></a>df_sites_temp<span class="op">$</span>temp_chelsa &lt;-<span class="st"> </span>df_sites_temp<span class="op">$</span>temp_chelsa<span class="op">/</span><span class="dv">10</span> <span class="fl">-273.15</span></span>
<span id="cb123-2"><a href="data-variety.html#cb123-2"></a></span>
<span id="cb123-3"><a href="data-variety.html#cb123-3"></a><span class="co"># we remove the sites we removed before</span></span>
<span id="cb123-4"><a href="data-variety.html#cb123-4"></a>df_sites_temp &lt;-<span class="st"> </span>df_sites_temp[<span class="op">-</span><span class="kw">c</span>(<span class="dv">16</span>, <span class="dv">34</span>), ]</span>
<span id="cb123-5"><a href="data-variety.html#cb123-5"></a></span>
<span id="cb123-6"><a href="data-variety.html#cb123-6"></a>df_sites_temp <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb123-7"><a href="data-variety.html#cb123-7"></a><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> temp_fluxnet, <span class="dt">y =</span> temp_chelsa), <span class="dt">xlim=</span><span class="kw">c</span>(<span class="op">-</span><span class="dv">10</span>,<span class="dv">5</span>)) <span class="op">+</span></span>
<span id="cb123-8"><a href="data-variety.html#cb123-8"></a><span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span></span>
<span id="cb123-9"><a href="data-variety.html#cb123-9"></a><span class="st">  </span><span class="kw">geom_abline</span>(<span class="dt">intercept=</span><span class="dv">0</span>, <span class="dt">slope=</span><span class="dv">1</span>, <span class="dt">linetype=</span><span class="st">&quot;dotted&quot;</span>) <span class="op">+</span></span>
<span id="cb123-10"><a href="data-variety.html#cb123-10"></a><span class="st">  </span><span class="kw">geom_smooth</span>(<span class="dt">method=</span><span class="st">&#39;lm&#39;</span>, <span class="dt">color=</span><span class="st">&quot;red&quot;</span>, <span class="dt">size=</span><span class="fl">0.5</span>, <span class="dt">se=</span><span class="ot">FALSE</span>) <span class="op">+</span></span>
<span id="cb123-11"><a href="data-variety.html#cb123-11"></a><span class="st">  </span><span class="kw">theme_classic</span>()</span></code></pre></div>
<p><img src="esds_book_files/figure-html/unnamed-chunk-56-1.png" width="672" /></p>
<p>We compute the mean squared error (MSE). The MSE calculates the average of the squares of errors of all the data points from a fitted line or model. Put simply this is the difference between the data points (the actual data) and the estimated points given by the line or model. The values are squared to get positive values even if the difference is negative. Smaller values reflect less variation of the data. In a model you want to minimise the MSE, as this reflects that the model’s predicted or estimated points are closer to your actual data.</p>
<div class="sourceCode" id="cb124"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb124-1"><a href="data-variety.html#cb124-1"></a><span class="kw">library</span>(Metrics)</span>
<span id="cb124-2"><a href="data-variety.html#cb124-2"></a><span class="kw">mse</span>(df_sites_temp<span class="op">$</span>temp_fluxnet, df_sites_temp<span class="op">$</span>temp_chelsa)</span></code></pre></div>
<pre><code>## [1] 2.314917</code></pre>
<div class="sourceCode" id="cb126"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb126-1"><a href="data-variety.html#cb126-1"></a>df_sites_temp <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb126-2"><a href="data-variety.html#cb126-2"></a><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> temp_fluxnet, <span class="dt">y =</span> temp_wc), <span class="dt">xlim=</span><span class="kw">c</span>(<span class="op">-</span><span class="dv">10</span>,<span class="dv">5</span>)) <span class="op">+</span></span>
<span id="cb126-3"><a href="data-variety.html#cb126-3"></a><span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span></span>
<span id="cb126-4"><a href="data-variety.html#cb126-4"></a><span class="st">  </span><span class="kw">geom_abline</span>(<span class="dt">intercept=</span><span class="dv">0</span>, <span class="dt">slope=</span><span class="dv">1</span>, <span class="dt">linetype=</span><span class="st">&quot;dotted&quot;</span>) <span class="op">+</span></span>
<span id="cb126-5"><a href="data-variety.html#cb126-5"></a><span class="st">  </span><span class="kw">geom_smooth</span>(<span class="dt">method=</span><span class="st">&#39;lm&#39;</span>, <span class="dt">color=</span><span class="st">&quot;red&quot;</span>, <span class="dt">size=</span><span class="fl">0.5</span>, <span class="dt">se=</span><span class="ot">FALSE</span>) <span class="op">+</span></span>
<span id="cb126-6"><a href="data-variety.html#cb126-6"></a><span class="st">  </span><span class="kw">theme_classic</span>()</span></code></pre></div>
<p><img src="esds_book_files/figure-html/unnamed-chunk-58-1.png" width="672" /></p>
<p>We compute the mean squared error.</p>
<div class="sourceCode" id="cb127"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb127-1"><a href="data-variety.html#cb127-1"></a><span class="kw">mse</span>(df_sites_temp<span class="op">$</span>temp_fluxnet, df_sites_temp<span class="op">$</span>temp_wc)</span></code></pre></div>
<pre><code>## [1] 10.43716</code></pre>
<p>We see that Chelsa correlates better (because the mean squared error is smaller) with the temperature values at the towers. We also see that Worldclim compared to CHELSA tends to predict colder temperatures.</p>
<p><strong>Checkpoint</strong></p>
<p>Above, we compared the CHELSA temperatures with the tower temperatures. Now we want to visually see which of the two data had the higher mean for each tower location.
Plot the map of europe and add the tower locations as points. Colour the points so that for a higher CHESLA mean they are one colour and a higher tower temperature another.</p>
<p><strong>Solution</strong></p>
<div class="sourceCode" id="cb129"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb129-1"><a href="data-variety.html#cb129-1"></a><span class="co"># There are more way to do this but we used the function ifelse(). </span></span>
<span id="cb129-2"><a href="data-variety.html#cb129-2"></a><span class="co"># It takes 3 components: a condition, what to do if the condition applies and what to do if it doesn&#39;t apply.</span></span>
<span id="cb129-3"><a href="data-variety.html#cb129-3"></a></span>
<span id="cb129-4"><a href="data-variety.html#cb129-4"></a><span class="co"># So here if chelsa temperatures are higher we want the point to be purple otherwise orange:</span></span>
<span id="cb129-5"><a href="data-variety.html#cb129-5"></a>cols_chelsa_flux &lt;-<span class="st"> </span><span class="kw">ifelse</span>(df_sites_temp<span class="op">$</span>temp_chelsa <span class="op">&gt;</span><span class="st"> </span>df_sites_temp<span class="op">$</span>temp_fluxnet,<span class="st">&quot;purple&quot;</span>,<span class="st">&quot;orange&quot;</span>)</span>
<span id="cb129-6"><a href="data-variety.html#cb129-6"></a></span>
<span id="cb129-7"><a href="data-variety.html#cb129-7"></a><span class="co"># We could also do different shapes if we wanted...</span></span>
<span id="cb129-8"><a href="data-variety.html#cb129-8"></a>pch_chelsa_flux &lt;-<span class="st"> </span><span class="kw">ifelse</span>(df_sites_temp<span class="op">$</span>temp_chelsa <span class="op">&gt;</span><span class="st"> </span>df_sites_temp<span class="op">$</span>temp_fluxnet, <span class="dv">19</span> ,<span class="dv">17</span>)</span>
<span id="cb129-9"><a href="data-variety.html#cb129-9"></a></span>
<span id="cb129-10"><a href="data-variety.html#cb129-10"></a><span class="co"># Plot the result:</span></span>
<span id="cb129-11"><a href="data-variety.html#cb129-11"></a></span>
<span id="cb129-12"><a href="data-variety.html#cb129-12"></a><span class="co"># plot(europe_shape)</span></span>
<span id="cb129-13"><a href="data-variety.html#cb129-13"></a><span class="co"># points(df_sites_temp$lon,df_sites_temp$lat, pch=pch_diff, col = col_checkpoint)</span></span>
<span id="cb129-14"><a href="data-variety.html#cb129-14"></a></span>
<span id="cb129-15"><a href="data-variety.html#cb129-15"></a><span class="co"># OR with ggplot</span></span>
<span id="cb129-16"><a href="data-variety.html#cb129-16"></a></span>
<span id="cb129-17"><a href="data-variety.html#cb129-17"></a><span class="kw">ggplot</span>() <span class="op">+</span></span>
<span id="cb129-18"><a href="data-variety.html#cb129-18"></a><span class="st">  </span><span class="kw">geom_polygon</span>(<span class="dt">data =</span> europe_shape, <span class="kw">aes</span>(<span class="dt">x =</span> long, <span class="dt">y =</span> lat, <span class="dt">group =</span> group), <span class="dt">fill=</span><span class="ot">NA</span>, <span class="dt">colour =</span> <span class="st">&quot;black&quot;</span>) <span class="op">+</span></span>
<span id="cb129-19"><a href="data-variety.html#cb129-19"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">data =</span> df_sites_temp, <span class="kw">aes</span>(<span class="dt">x =</span> lon, <span class="dt">y =</span> lat), <span class="dt">color =</span> cols_chelsa_flux, <span class="dt">shape =</span> pch_chelsa_flux, <span class="dt">size=</span><span class="dv">2</span>) <span class="op">+</span></span>
<span id="cb129-20"><a href="data-variety.html#cb129-20"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;Longitude&quot;</span>, <span class="dt">y =</span> <span class="st">&quot;Latitude&quot;</span>) <span class="op">+</span></span>
<span id="cb129-21"><a href="data-variety.html#cb129-21"></a><span class="st">  </span><span class="kw">theme_classic</span>()<span class="op">+</span><span class="st"> </span></span>
<span id="cb129-22"><a href="data-variety.html#cb129-22"></a><span class="st">  </span><span class="kw">coord_quickmap</span>()</span></code></pre></div>
<p><img src="esds_book_files/figure-html/unnamed-chunk-60-1.png" width="672" /></p>
</div>
<div id="correlations-with-gpp" class="section level4">
<h4><span class="header-section-number">4.2.5.4</span> Correlations with GPP</h4>
<p>We already had a look at GPP in Chapter 2. In this section we want to correlate Chelsa temperature and landcover with GPP.</p>
<p>In models we often take multiple variables and correlate them to another variable (here GPP). By seeing if they correlate well we can see if any of the variables make good so-called <em>predictors</em>. Let’s see how well landcover and temperature correlate with GPP.</p>
<p>We start off by extracting the mean GPP at the tower sites. To do this we group our data by the <em>siteid</em> (or tower) and the year. This way we can get the GPP across a year and then an average across all years for each site.</p>
<div class="sourceCode" id="cb130"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb130-1"><a href="data-variety.html#cb130-1"></a>GPP &lt;-<span class="st"> </span>ddf_allsites_nested_joined <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb130-2"><a href="data-variety.html#cb130-2"></a><span class="st">  </span><span class="kw">unnest</span>(data) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb130-3"><a href="data-variety.html#cb130-3"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">year =</span> <span class="kw">year</span>(TIMESTAMP)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb130-4"><a href="data-variety.html#cb130-4"></a><span class="st">  </span><span class="kw">group_by</span>(siteid, year) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb130-5"><a href="data-variety.html#cb130-5"></a><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">gpp_ann =</span> <span class="kw">sum</span>(GPP_NT_VUT_REF)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb130-6"><a href="data-variety.html#cb130-6"></a><span class="st">  </span><span class="kw">ungroup</span>() <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb130-7"><a href="data-variety.html#cb130-7"></a><span class="st">  </span><span class="kw">group_by</span>(siteid) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb130-8"><a href="data-variety.html#cb130-8"></a><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">gpp_meanann =</span> <span class="kw">mean</span>(gpp_ann)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb130-9"><a href="data-variety.html#cb130-9"></a><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">select</span>(siteid, gpp_meanann)</span>
<span id="cb130-10"><a href="data-variety.html#cb130-10"></a></span>
<span id="cb130-11"><a href="data-variety.html#cb130-11"></a><span class="co"># we remove the data we don&#39;t have in the other datasets for the correlations</span></span>
<span id="cb130-12"><a href="data-variety.html#cb130-12"></a>GPP &lt;-<span class="st"> </span>GPP[<span class="op">-</span><span class="kw">c</span>(<span class="dv">14</span>, <span class="dv">16</span>, <span class="dv">34</span>), ]</span></code></pre></div>
<p>We then extract landcover data at the tower sites.</p>
<div class="sourceCode" id="cb131"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb131-1"><a href="data-variety.html#cb131-1"></a>df_sites_landcover &lt;-<span class="st"> </span><span class="kw">extract</span>(raster_landcover, sp_sites, <span class="dt">sp =</span> <span class="ot">TRUE</span>)</span>
<span id="cb131-2"><a href="data-variety.html#cb131-2"></a>df_sites_landcover &lt;-<span class="st"> </span><span class="kw">as.tibble</span>(df_sites_landcover)</span>
<span id="cb131-3"><a href="data-variety.html#cb131-3"></a></span>
<span id="cb131-4"><a href="data-variety.html#cb131-4"></a><span class="co"># we remove the sites we removed before</span></span>
<span id="cb131-5"><a href="data-variety.html#cb131-5"></a>df_sites_landcover &lt;-<span class="st"> </span>df_sites_landcover[<span class="op">-</span><span class="kw">c</span>(<span class="dv">16</span>, <span class="dv">34</span>), ]</span></code></pre></div>
<p>And create a dataframe with all the extracted data from the tower sites to then make correlations.</p>
<div class="sourceCode" id="cb132"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb132-1"><a href="data-variety.html#cb132-1"></a>landcover &lt;-<span class="st"> </span>df_sites_landcover<span class="op">$</span>Globcover_EU</span>
<span id="cb132-2"><a href="data-variety.html#cb132-2"></a>chelsa &lt;-<span class="st"> </span>df_sites_temp<span class="op">$</span>temp_chelsa</span>
<span id="cb132-3"><a href="data-variety.html#cb132-3"></a>df_corr &lt;-<span class="st"> </span><span class="kw">cbind</span>(landcover, chelsa, GPP)</span>
<span id="cb132-4"><a href="data-variety.html#cb132-4"></a>df_corr &lt;-<span class="st"> </span><span class="kw">as.data.frame</span>(df_corr)</span>
<span id="cb132-5"><a href="data-variety.html#cb132-5"></a><span class="kw">head</span>(df_corr)</span></code></pre></div>
<pre><code>##   landcover chelsa siteid gpp_meanann
## 1        50   1.85 BE-Bra          NA
## 2        20   0.95 BE-Lon    1348.667
## 3        90  -1.55 BE-Vie    1792.497
## 4       120  -0.15 CH-Cha    2478.429
## 5       140  -6.95 CH-Dav    1166.543
## 6        50  -3.25 CH-Fru    2106.319</code></pre>
<p>Though the landcover column contains numbers, it is actually categorical data. Each number represents a specific landcover type, so we add a column with the corresponding the landcover category name.</p>
<div class="sourceCode" id="cb134"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb134-1"><a href="data-variety.html#cb134-1"></a>df_corr &lt;-<span class="st"> </span>df_corr <span class="op">%&gt;%</span></span>
<span id="cb134-2"><a href="data-variety.html#cb134-2"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">landcover_cat =</span> <span class="kw">case_when</span>(landcover <span class="op">==</span><span class="st"> </span><span class="dv">14</span> <span class="op">~</span><span class="st"> &quot;cropland&quot;</span>,</span>
<span id="cb134-3"><a href="data-variety.html#cb134-3"></a>        landcover <span class="op">==</span><span class="st"> </span><span class="dv">20</span> <span class="op">~</span><span class="st"> &quot;mosaic cropland&quot;</span>,</span>
<span id="cb134-4"><a href="data-variety.html#cb134-4"></a>        landcover <span class="op">==</span><span class="st"> </span><span class="dv">50</span> <span class="op">~</span><span class="st"> &quot;deciduous forest&quot;</span>,</span>
<span id="cb134-5"><a href="data-variety.html#cb134-5"></a>        landcover <span class="op">==</span><span class="st"> </span><span class="dv">70</span> <span class="op">~</span><span class="st"> &quot;evergreen forest&quot;</span>,</span>
<span id="cb134-6"><a href="data-variety.html#cb134-6"></a>        landcover <span class="op">==</span><span class="st"> </span><span class="dv">90</span> <span class="op">~</span><span class="st"> &quot;needleleaved forest&quot;</span>,</span>
<span id="cb134-7"><a href="data-variety.html#cb134-7"></a>        landcover <span class="op">==</span><span class="st"> </span><span class="dv">110</span> <span class="op">~</span><span class="st"> &quot;mosaic forest&quot;</span>,</span>
<span id="cb134-8"><a href="data-variety.html#cb134-8"></a>        landcover <span class="op">==</span><span class="st"> </span><span class="dv">120</span> <span class="op">~</span><span class="st"> &quot;mosaic forest/shrub/grass&quot;</span>,</span>
<span id="cb134-9"><a href="data-variety.html#cb134-9"></a>        landcover <span class="op">==</span><span class="st"> </span><span class="dv">130</span> <span class="op">~</span><span class="st"> &quot;mosaic shrubland&quot;</span>,</span>
<span id="cb134-10"><a href="data-variety.html#cb134-10"></a>        landcover <span class="op">==</span><span class="st"> </span><span class="dv">140</span> <span class="op">~</span><span class="st"> &quot;mosaic grassland&quot;</span>,</span>
<span id="cb134-11"><a href="data-variety.html#cb134-11"></a>        landcover <span class="op">==</span><span class="st"> </span><span class="dv">150</span> <span class="op">~</span><span class="st"> &quot;sparse vegetation&quot;</span>))</span></code></pre></div>
<p>Back to correlations! Let’s start by correlating the Chelsa temperatures with GPP. We do this by building a simple linear model using the function <code>lm()</code>.</p>
<div class="sourceCode" id="cb135"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb135-1"><a href="data-variety.html#cb135-1"></a>reg1 &lt;-<span class="st"> </span><span class="kw">lm</span>(gpp_meanann<span class="op">~</span>chelsa, <span class="dt">data =</span> df_corr) </span></code></pre></div>
<p>To visualise the correlation we plot our temperature data with the linear model.</p>
<div class="sourceCode" id="cb136"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb136-1"><a href="data-variety.html#cb136-1"></a>df_corr <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb136-2"><a href="data-variety.html#cb136-2"></a><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> chelsa, <span class="dt">y =</span> gpp_meanann)) <span class="op">+</span></span>
<span id="cb136-3"><a href="data-variety.html#cb136-3"></a><span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span></span>
<span id="cb136-4"><a href="data-variety.html#cb136-4"></a><span class="st">  </span><span class="kw">geom_smooth</span>(<span class="dt">method=</span><span class="st">&#39;lm&#39;</span>, <span class="dt">color=</span><span class="st">&quot;red&quot;</span>, <span class="dt">size=</span><span class="fl">0.5</span>, <span class="dt">se=</span><span class="ot">FALSE</span>) <span class="op">+</span></span>
<span id="cb136-5"><a href="data-variety.html#cb136-5"></a><span class="st">  </span><span class="kw">xlab</span>(<span class="st">&quot;Chelsa temperature&quot;</span>) <span class="op">+</span></span>
<span id="cb136-6"><a href="data-variety.html#cb136-6"></a><span class="st">  </span><span class="kw">ylab</span>(<span class="st">&quot;GPP mean [µmolCO2 m-2 s-1]&quot;</span>) <span class="op">+</span></span>
<span id="cb136-7"><a href="data-variety.html#cb136-7"></a><span class="st">  </span><span class="kw">theme_classic</span>()</span></code></pre></div>
<p><img src="esds_book_files/figure-html/unnamed-chunk-66-1.png" width="672" /></p>
<p>Then we make a linear model for GPP and landcover.</p>
<div class="sourceCode" id="cb137"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb137-1"><a href="data-variety.html#cb137-1"></a>reg2 &lt;-<span class="st"> </span><span class="kw">lm</span>(gpp_meanann<span class="op">~</span>landcover, <span class="dt">data=</span>df_corr)</span></code></pre></div>
<p>… and again plot it. However, since landcover is categorical data we make a boxplot instead. We’ve also added a general trendline but remember this could be quite different if we correclated data from a specific landcover category with GPP.</p>
<div class="sourceCode" id="cb138"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb138-1"><a href="data-variety.html#cb138-1"></a><span class="kw">ggplot</span>(<span class="dt">data=</span>df_corr, <span class="kw">aes</span>(<span class="dt">x=</span>landcover_cat, <span class="dt">y=</span>gpp_meanann, <span class="dt">group=</span><span class="kw">as.factor</span>(landcover_cat)))<span class="op">+</span><span class="st"> </span></span>
<span id="cb138-2"><a href="data-variety.html#cb138-2"></a><span class="st">        </span><span class="kw">geom_boxplot</span>() <span class="op">+</span><span class="st"> </span></span>
<span id="cb138-3"><a href="data-variety.html#cb138-3"></a><span class="st">        </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;Landcover Category&quot;</span>, <span class="dt">y =</span> <span class="st">&quot;GPP mean [µmolCO2 m-2 s-1]&quot;</span>) <span class="op">+</span></span>
<span id="cb138-4"><a href="data-variety.html#cb138-4"></a><span class="st">        </span><span class="kw">theme_classic</span>() <span class="op">+</span></span>
<span id="cb138-5"><a href="data-variety.html#cb138-5"></a><span class="st">        </span><span class="kw">theme</span>(<span class="dt">axis.text.x =</span> <span class="kw">element_text</span>(<span class="dt">angle =</span> <span class="dv">90</span>, <span class="dt">size=</span><span class="dv">12</span>))</span></code></pre></div>
<p><img src="esds_book_files/figure-html/unnamed-chunk-68-1.png" width="672" /></p>
<p>We don’t see a particularly strong correlation, thus we need to consider other predictors and more complex models. You will discuss that later in the class.</p>
</div>
</div>
<div id="key-points-of-the-tutorial" class="section level3">
<h3><span class="header-section-number">4.2.6</span> Key points of the tutorial</h3>
<p>Integrating remote sensing data: we extract NDVI in the area around our eddy flux towers from the MODISTools package and conver it into a raster format.</p>
<ul>
<li>Collapse NDVI measured within an area around the eddy flux towers to calculate the mean across years</li>
<li>Merge this temporal data with our eddy flux data</li>
<li>Apply linear regression to test whether the addition of NDVI data to our model of GPP and PPFD_IN improves its accuracy</li>
</ul>
<p>Points:
the eddy flux tower sites are plotted as points on a map of Europe.</p>
<ul>
<li>Extract coordinates of the tower sites from the metadata</li>
<li>Transform the points into SpatialPoints with the sp package and plot them on a map of Europe</li>
</ul>
<p>Shapefiles: we add country and border information to our tower site plots.</p>
<ul>
<li>Extract the information about the spatial polygons in the europe_shape shapefile and apply one coordinate reference system</li>
<li>Add the SpatialPoints matrix and shapefile data europe_shape to the tower site dataframe</li>
<li>Filter out the countries with towers and visualize only them</li>
</ul>
<p>Rasters: we investigate whether the variables landcover and temperature can explain GPP.</p>
<ul>
<li>Load landcover data from Globcover temperature data from CHELSA in the form of rasters and plot them around our tower sites with the raster and rasterVis packages</li>
<li>Apply the same resolution (aggregate) and origin (align) to the climate and landcover rasters</li>
<li>Compare modeled climate data from CHELSA and Worldclim to our fluxnet data by extracting the temperatures at the tower sites and calculating the MSE</li>
<li>Finally, landcover and CHELSA modeled temperatures are plugged into a linear regression to see if they are significantly correlated with GPP</li>
</ul>
<p>Bonus: here we incorporate plant species data from GBIF to determine their effect on GPP with the help of PCA.</p>
<ul>
<li>Create a presence-absence matrix for all locations and species</li>
<li>Check species data for possible sampling biases by visualizing the number of occurrence records</li>
<li>Plot species richness on the map</li>
<li>Add species traits to our dataset with a for loop</li>
<li>Use PCA to determine which traits explain the most variation in GPP</li>
</ul>
</div>
<div id="bonus-species-occurrence-trait-data-and-pcas" class="section level3">
<h3><span class="header-section-number">4.2.7</span> Bonus: Species Occurrence, Trait Data and PCAs</h3>
<p>In functional ecology, we focus on the function that a species has in a community. This sub-discipline of ecology represents the intersection between ecological patterns and the mechanisms that underlie them and focuses on traits represented in large number of species. Here, we use plant distribution data around the fluxnet towers to investigate the plant community composition for each location. The community composition will allow us to get insights on which plant traits that are dominant. This is relevant because plant traits are both responsive to local climate and strong predictors of primary productivity. For example, Specific Leaf Area (SLA) and plant height, are linked to GPP and affected by local climate. Functional traits capture core differences in the strategies plants use to acquire and invest resources. Most woody plants have the same basic physiological function and key resource requirements, however species differ considerably in the rates at which resources are acquired, invested into different tissues, and lost via turnover. Traits for example moderate plant responses to light environment and determine shade tolerance. They have been shown to affect growth depending on plant size. In the first step, we use distribution data from the Global Biodiversity Information Facility (GBIF) to obtain the community composition in each location.</p>
<p>GBIF is an international organization that makes biodiversity data publicly available. The data are provided by many institutions from around the world and GBIF gathers these data and makes them accessible and searchable through their platform. Data available on GBIF are primarily distribution records on plants, animals, fungi, and microbes for the world, and scientific names data. This is very useful information for ecological analysis. With the “rgbif” package we can download occurrence data directly from the GBIF database to R.</p>
<div id="species-occurrences" class="section level5">
<h5><span class="header-section-number">4.2.7.0.1</span> Species Occurrences</h5>
<p>We start by to loading the relevant packages.</p>
<div class="sourceCode" id="cb139"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb139-1"><a href="data-variety.html#cb139-1"></a><span class="kw">library</span>(rgbif)</span>
<span id="cb139-2"><a href="data-variety.html#cb139-2"></a><span class="kw">library</span>(rgeos)</span></code></pre></div>
<p>In this first, section we will give you an example of how to download data from gbif for the CH-Lae site.</p>
<div class="sourceCode" id="cb140"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb140-1"><a href="data-variety.html#cb140-1"></a><span class="co"># combine the CH-Lae latitude and longitude</span></span>
<span id="cb140-2"><a href="data-variety.html#cb140-2"></a>CHLae_lonlat &lt;-<span class="st"> </span><span class="kw">as.data.frame</span>(<span class="kw">cbind</span>(<span class="dt">longitude=</span>lon_lae, <span class="dt">latitude=</span>lat_lae))</span>
<span id="cb140-3"><a href="data-variety.html#cb140-3"></a></span>
<span id="cb140-4"><a href="data-variety.html#cb140-4"></a><span class="co"># make them into &#39;SpatialPoints&#39;, this is an alternative method to the one used above</span></span>
<span id="cb140-5"><a href="data-variety.html#cb140-5"></a><span class="kw">coordinates</span>(CHLae_lonlat) &lt;-<span class="st"> </span><span class="er">~</span>longitude <span class="op">+</span><span class="st"> </span>latitude</span>
<span id="cb140-6"><a href="data-variety.html#cb140-6"></a></span>
<span id="cb140-7"><a href="data-variety.html#cb140-7"></a><span class="co"># assign a projection and coordinate reference system</span></span>
<span id="cb140-8"><a href="data-variety.html#cb140-8"></a><span class="kw">crs</span>(CHLae_lonlat) &lt;-<span class="st"> &quot;+init=epsg:4326 +proj=longlat +datum=WGS84 +no_defs&quot;</span></span>
<span id="cb140-9"><a href="data-variety.html#cb140-9"></a></span>
<span id="cb140-10"><a href="data-variety.html#cb140-10"></a><span class="co"># create a roughly 5.5km buffer around the CH-Lae tower</span></span>
<span id="cb140-11"><a href="data-variety.html#cb140-11"></a>TowerBuffer &lt;-<span class="st"> </span><span class="kw">gBuffer</span>(CHLae_lonlat, <span class="dt">width=</span><span class="fl">0.05</span>)</span>
<span id="cb140-12"><a href="data-variety.html#cb140-12"></a></span>
<span id="cb140-13"><a href="data-variety.html#cb140-13"></a><span class="co"># transform the tower buffer into polygons</span></span>
<span id="cb140-14"><a href="data-variety.html#cb140-14"></a>tower.polygon &lt;-<span class="st"> </span><span class="kw">polygons</span>(TowerBuffer)</span></code></pre></div>
<p>Then transform the polygon to wkt format which is needed for the gbif input:</p>
<div class="sourceCode" id="cb141"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb141-1"><a href="data-variety.html#cb141-1"></a>tower.polygon.wkt &lt;-<span class="st"> </span><span class="kw">writeWKT</span>(tower.polygon)</span></code></pre></div>
<p>Now we are ready to download occurrence records of plants around the CH-Lae tower from gbif with <code>occ_search()</code> function.
We add the hasCoordinate = T, to make sure we only download data with coordinates.
The <em>geometry</em> argument will be equal to our constructed polygon of the buffer.</p>
<div class="sourceCode" id="cb142"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb142-1"><a href="data-variety.html#cb142-1"></a>occ_CHlae &lt;-<span class="st"> </span><span class="kw">occ_data</span>(<span class="dt">taxonKey =</span> <span class="dv">7707728</span>, <span class="dt">hasCoordinate =</span> T, </span>
<span id="cb142-2"><a href="data-variety.html#cb142-2"></a>                     <span class="dt">geometry =</span> tower.polygon.wkt, <span class="dt">limit =</span> <span class="dv">50000</span>)</span>
<span id="cb142-3"><a href="data-variety.html#cb142-3"></a></span>
<span id="cb142-4"><a href="data-variety.html#cb142-4"></a><span class="co"># The output is a list so we extract the actual data since this is of interest</span></span>
<span id="cb142-5"><a href="data-variety.html#cb142-5"></a>occ_CHlae &lt;-<span class="st"> </span><span class="kw">as.data.frame</span>(occ_CHlae<span class="op">$</span>data)</span></code></pre></div>
<pre><code>##          key                 scientificName decimalLatitude decimalLongitude
## 1 3028451251 Berberis julianae C.K.Schneid.        47.46482         8.333900
## 2 2646869619            Corylus avellana L.        47.44893         8.356892
## 3 2649395661             Daphne laureola L.        47.48192         8.317558
## 4 2649628860                Hedera helix L.        47.50389         8.346389
## 5 2878758835       Asplenium trichomanes L.        47.46482         8.333900
## 6 2878758840            Thlaspi montanum L.        47.46482         8.333900
##         issues                           datasetKey
## 1              83fdfd3d-3a25-4705-9fbe-3db1d1892b13
## 2 cdround,cudc 14d5676a-2c54-4f94-9023-1e8dcd822aa0
## 3 cdround,cudc 14d5676a-2c54-4f94-9023-1e8dcd822aa0
## 4 cdround,cudc 14d5676a-2c54-4f94-9023-1e8dcd822aa0
## 5              83fdfd3d-3a25-4705-9fbe-3db1d1892b13
## 6              83fdfd3d-3a25-4705-9fbe-3db1d1892b13
##                       publishingOrgKey                      installationKey
## 1 64ee55c9-570a-42af-b7da-3f13c6b4e5a9 dc9d8bd0-3c20-4fba-b7ff-26d654817ea7
## 2 da86174a-a605-43a4-a5e8-53d484152cd3 fe1a98a6-82b8-4652-86d6-d0f938207f67
## 3 da86174a-a605-43a4-a5e8-53d484152cd3 fe1a98a6-82b8-4652-86d6-d0f938207f67
## 4 da86174a-a605-43a4-a5e8-53d484152cd3 fe1a98a6-82b8-4652-86d6-d0f938207f67
## 5 64ee55c9-570a-42af-b7da-3f13c6b4e5a9 dc9d8bd0-3c20-4fba-b7ff-26d654817ea7
## 6 64ee55c9-570a-42af-b7da-3f13c6b4e5a9 dc9d8bd0-3c20-4fba-b7ff-26d654817ea7
##   publishingCountry    protocol                   lastCrawled
## 1                CH DWC_ARCHIVE 2021-02-02T15:59:13.567+00:00
## 2                FR DWC_ARCHIVE 2020-12-10T14:09:16.521+00:00
## 3                FR DWC_ARCHIVE 2020-12-10T14:09:16.521+00:00
## 4                FR DWC_ARCHIVE 2020-12-10T14:09:16.521+00:00
## 5                CH DWC_ARCHIVE 2021-02-02T15:59:13.567+00:00
## 6                CH DWC_ARCHIVE 2021-02-02T15:59:13.567+00:00
##                      lastParsed crawlId               hostingOrganizationKey
## 1 2021-02-02T16:35:54.759+00:00      17 23e067c0-a255-11da-beae-b8a03c50a862
## 2 2020-12-15T17:21:35.615+00:00      22 da86174a-a605-43a4-a5e8-53d484152cd3
## 3 2020-12-15T17:22:27.362+00:00      22 da86174a-a605-43a4-a5e8-53d484152cd3
## 4 2020-12-15T17:22:28.963+00:00      22 da86174a-a605-43a4-a5e8-53d484152cd3
## 5 2021-02-02T16:36:21.675+00:00      17 23e067c0-a255-11da-beae-b8a03c50a862
## 6 2021-02-02T16:35:36.344+00:00      17 23e067c0-a255-11da-beae-b8a03c50a862
##   extensions     basisOfRecord occurrenceStatus taxonKey kingdomKey phylumKey
## 1       none HUMAN_OBSERVATION          PRESENT  3981543          6   7707728
## 2       none HUMAN_OBSERVATION          PRESENT  2875979          6   7707728
## 3       none HUMAN_OBSERVATION          PRESENT  5420853          6   7707728
## 4       none HUMAN_OBSERVATION          PRESENT  8351737          6   7707728
## 5       none HUMAN_OBSERVATION          PRESENT  8108066          6   7707728
## 6       none HUMAN_OBSERVATION          PRESENT  3045290          6   7707728
##   classKey orderKey familyKey genusKey speciesKey acceptedTaxonKey
## 1      220      399      6673  3033893    3981543          3981543
## 2      220     1354      4688  2875967    2875979          2875979
## 3      220      941      2428  3188453    5420853          5420853
## 4      220     1351      8800  3036021    8351737          8351737
## 5  7228684      392      6625  2650583    8108066          8108066
## 6      220  7225535      3112  3045219    3045261          3045261
##            acceptedScientificName kingdom       phylum        order
## 1  Berberis julianae C.K.Schneid. Plantae Tracheophyta Ranunculales
## 2             Corylus avellana L. Plantae Tracheophyta      Fagales
## 3              Daphne laureola L. Plantae Tracheophyta     Malvales
## 4                 Hedera helix L. Plantae Tracheophyta      Apiales
## 5        Asplenium trichomanes L. Plantae Tracheophyta Polypodiales
## 6 Noccaea fendleri (A.Gray) Holub Plantae Tracheophyta  Brassicales
##          family     genus               species genericName specificEpithet
## 1 Berberidaceae  Berberis     Berberis julianae    Berberis        julianae
## 2    Betulaceae   Corylus      Corylus avellana     Corylus        avellana
## 3 Thymelaeaceae    Daphne       Daphne laureola      Daphne        laureola
## 4    Araliaceae    Hedera          Hedera helix      Hedera           helix
## 5  Aspleniaceae Asplenium Asplenium trichomanes   Asplenium     trichomanes
## 6  Brassicaceae   Noccaea      Noccaea fendleri     Thlaspi        montanum
##   taxonRank taxonomicStatus coordinateUncertaintyInMeters elevation
## 1   SPECIES        ACCEPTED                          3535     366.5
## 2   SPECIES        ACCEPTED                            23        NA
## 3   SPECIES        ACCEPTED                            65        NA
## 4   SPECIES        ACCEPTED                            NA        NA
## 5   SPECIES        ACCEPTED                          3535     610.0
## 6   SPECIES         SYNONYM                          3535     550.0
##   elevationAccuracy stateProvince year month           eventDate
## 1               1.5            Ag 2021     1 2021-01-01T00:00:00
## 2                NA          &lt;NA&gt; 2020     1 2020-01-18T12:23:07
## 3                NA          &lt;NA&gt; 2020     1 2020-01-06T09:52:11
## 4                NA          &lt;NA&gt; 2020     1 2020-01-18T17:48:09
## 5                NA            Ag 2020     1 2020-01-02T00:00:00
## 6                NA            Ag 2020     1 2020-01-02T00:00:00
##                 lastInterpreted
## 1 2021-02-02T16:35:54.759+00:00
## 2 2020-12-15T17:21:35.615+00:00
## 3 2020-12-15T17:22:27.362+00:00
## 4 2020-12-15T17:22:28.963+00:00
## 5 2021-02-02T16:36:21.675+00:00
## 6 2021-02-02T16:35:36.344+00:00
##                                                license identifiers facts
## 1 http://creativecommons.org/licenses/by/4.0/legalcode        none  none
## 2 http://creativecommons.org/licenses/by/4.0/legalcode        none  none
## 3 http://creativecommons.org/licenses/by/4.0/legalcode        none  none
## 4 http://creativecommons.org/licenses/by/4.0/legalcode        none  none
## 5 http://creativecommons.org/licenses/by/4.0/legalcode        none  none
## 6 http://creativecommons.org/licenses/by/4.0/legalcode        none  none
##   relations gadm.level0.gid gadm.level0.name gadm.level1.gid gadm.level1.name
## 1      none             CHE      Switzerland         CHE.1_1           Aargau
## 2      none             CHE      Switzerland         CHE.1_1           Aargau
## 3      none             CHE      Switzerland         CHE.1_1           Aargau
## 4      none             CHE      Switzerland         CHE.1_1           Aargau
## 5      none             CHE      Switzerland         CHE.1_1           Aargau
## 6      none             CHE      Switzerland         CHE.1_1           Aargau
##   gadm.level2.gid gadm.level2.name gadm.level3.gid gadm.level3.name isInCluster
## 1       CHE.1.2_1            Baden    CHE.1.2.23_1        Wettingen       FALSE
## 2       CHE.1.2_1            Baden    CHE.1.2.26_1         Würenlos       FALSE
## 3       CHE.1.2_1            Baden     CHE.1.2.6_1       Ennetbaden       FALSE
## 4       CHE.1.2_1            Baden     CHE.1.2.5_1      Ehrendingen       FALSE
## 5       CHE.1.2_1            Baden    CHE.1.2.23_1        Wettingen       FALSE
## 6       CHE.1.2_1            Baden    CHE.1.2.23_1        Wettingen       FALSE
##   geodeticDatum          class countryCode recordedByIDs identifiedByIDs
## 1         WGS84  Magnoliopsida          CH          none            none
## 2         WGS84  Magnoliopsida          CH          none            none
## 3         WGS84  Magnoliopsida          CH          none            none
## 4         WGS84  Magnoliopsida          CH          none            none
## 5         WGS84 Polypodiopsida          CH          none            none
## 6         WGS84  Magnoliopsida          CH          none            none
##       country rightsHolder              identifier nomenclaturalCode
## 1 Switzerland   Info Flora INFOFLORA-TRAC-10029158               ICN
## 2 Switzerland         &lt;NA&gt;           q-10128206654              &lt;NA&gt;
## 3 Switzerland         &lt;NA&gt;           q-10127072482              &lt;NA&gt;
## 4 Switzerland         &lt;NA&gt;           q-10128246487              &lt;NA&gt;
## 5 Switzerland   Info Flora  INFOFLORA-TRAC-8884922               ICN
## 6 Switzerland   Info Flora  INFOFLORA-TRAC-8885363               ICN
##      georeferencedBy
## 1 observer/collector
## 2               &lt;NA&gt;
## 3               &lt;NA&gt;
## 4               &lt;NA&gt;
## 5 observer/collector
## 6 observer/collector
##                                                                                                                                                                                                                                                                        dataGeneralizations
## 1 In order to respect the currently nationally agreed ethical framework while simultaneously sharing scientifically utilizable data for large scale studies, Swiss biodiversity data is generally published generalized to 5km grid squares. Altitude information corresponds to raw data.
## 2                                                                                                                                                                                                                                                                                     &lt;NA&gt;
## 3                                                                                                                                                                                                                                                                                     &lt;NA&gt;
## 4                                                                                                                                                                                                                                                                                     &lt;NA&gt;
## 5 In order to respect the currently nationally agreed ethical framework while simultaneously sharing scientifically utilizable data for large scale studies, Swiss biodiversity data is generally published generalized to 5km grid squares. Altitude information corresponds to raw data.
## 6 In order to respect the currently nationally agreed ethical framework while simultaneously sharing scientifically utilizable data for large scale studies, Swiss biodiversity data is generally published generalized to 5km grid squares. Altitude information corresponds to raw data.
##                                  datasetName     gbifID            occurrenceID
## 1 Swiss National Databank of Vascular Plants 3028451251 INFOFLORA-TRAC-10029158
## 2                                       &lt;NA&gt; 2646869619           q-10128206654
## 3                                       &lt;NA&gt; 2649395661           q-10127072482
## 4                                       &lt;NA&gt; 2649628860           q-10128246487
## 5 Swiss National Databank of Vascular Plants 2878758835  INFOFLORA-TRAC-8884922
## 6 Swiss National Databank of Vascular Plants 2878758840  INFOFLORA-TRAC-8885363
##                           taxonID           catalogNumber       recordedBy
## 1  infospecies.ch:infoflora:59155 INFOFLORA-TRAC-10029158        anonymous
## 2                            &lt;NA&gt;                    &lt;NA&gt;             &lt;NA&gt;
## 3                            &lt;NA&gt;                    &lt;NA&gt;             &lt;NA&gt;
## 4                            &lt;NA&gt;                    &lt;NA&gt;             &lt;NA&gt;
## 5  infospecies.ch:infoflora:51400  INFOFLORA-TRAC-8884922 Werner Christian
## 6 infospecies.ch:infoflora:418700  INFOFLORA-TRAC-8885363 Werner Christian
##   institutionCode      datasetID
## 1       INFOFLORA INFOFLORA-TRAC
## 2            &lt;NA&gt;           &lt;NA&gt;
## 3            &lt;NA&gt;           &lt;NA&gt;
## 4            &lt;NA&gt;           &lt;NA&gt;
## 5       INFOFLORA INFOFLORA-TRAC
## 6       INFOFLORA INFOFLORA-TRAC
##                                                                   bibliographicCitation
## 1      Info Flora (2021-02-01) INFOFLORA-TRAC-10029158. Plantes vasculaires, Info Flora
## 2                                                                                  &lt;NA&gt;
## 3                                                                                  &lt;NA&gt;
## 4                                                                                  &lt;NA&gt;
## 5 Christian Werner (2021-02-01) INFOFLORA-TRAC-8884922. Plantes vasculaires, Info Flora
## 6 Christian Werner (2021-02-01) INFOFLORA-TRAC-8885363. Plantes vasculaires, Info Flora
##                             name projectId individualCount day fieldNumber
## 1 Berberis julianae C.K.Schneid.      &lt;NA&gt;              NA  NA        &lt;NA&gt;
## 2            Corylus avellana L.   queries               1  18        &lt;NA&gt;
## 3             Daphne laureola L.   queries               1   6        &lt;NA&gt;
## 4                Hedera helix L.   queries               1  18        &lt;NA&gt;
## 5       Asplenium trichomanes L.      &lt;NA&gt;              NA   2        &lt;NA&gt;
## 6            Thlaspi montanum L.      &lt;NA&gt;              NA   2        &lt;NA&gt;
##   extensions.http...rs.gbif.org.terms.1.0.Multimedia.http...purl.org.dc.terms.rightsHolder
## 1                                                                                     &lt;NA&gt;
## 2                                                                                     &lt;NA&gt;
## 3                                                                                     &lt;NA&gt;
## 4                                                                                     &lt;NA&gt;
## 5                                                                                     &lt;NA&gt;
## 6                                                                                     &lt;NA&gt;
##   extensions.http...rs.gbif.org.terms.1.0.Multimedia.http...purl.org.dc.terms.identifier
## 1                                                                                   &lt;NA&gt;
## 2                                                                                   &lt;NA&gt;
## 3                                                                                   &lt;NA&gt;
## 4                                                                                   &lt;NA&gt;
## 5                                                                                   &lt;NA&gt;
## 6                                                                                   &lt;NA&gt;
##   extensions.http...rs.gbif.org.terms.1.0.Multimedia.http...purl.org.dc.terms.type
## 1                                                                             &lt;NA&gt;
## 2                                                                             &lt;NA&gt;
## 3                                                                             &lt;NA&gt;
## 4                                                                             &lt;NA&gt;
## 5                                                                             &lt;NA&gt;
## 6                                                                             &lt;NA&gt;
##   extensions.http...rs.gbif.org.terms.1.0.Multimedia.http...rs.tdwg.org.dwc.terms.catalogNumber
## 1                                                                                          &lt;NA&gt;
## 2                                                                                          &lt;NA&gt;
## 3                                                                                          &lt;NA&gt;
## 4                                                                                          &lt;NA&gt;
## 5                                                                                          &lt;NA&gt;
## 6                                                                                          &lt;NA&gt;
##   extensions.http...rs.gbif.org.terms.1.0.Multimedia.http...purl.org.dc.terms.publisher
## 1                                                                                  &lt;NA&gt;
## 2                                                                                  &lt;NA&gt;
## 3                                                                                  &lt;NA&gt;
## 4                                                                                  &lt;NA&gt;
## 5                                                                                  &lt;NA&gt;
## 6                                                                                  &lt;NA&gt;
##   extensions.http...rs.gbif.org.terms.1.0.Multimedia.http...purl.org.dc.terms.license
## 1                                                                                &lt;NA&gt;
## 2                                                                                &lt;NA&gt;
## 3                                                                                &lt;NA&gt;
## 4                                                                                &lt;NA&gt;
## 5                                                                                &lt;NA&gt;
## 6                                                                                &lt;NA&gt;
##   extensions.http...rs.gbif.org.terms.1.0.Multimedia.http...purl.org.dc.terms.created
## 1                                                                                &lt;NA&gt;
## 2                                                                                &lt;NA&gt;
## 3                                                                                &lt;NA&gt;
## 4                                                                                &lt;NA&gt;
## 5                                                                                &lt;NA&gt;
## 6                                                                                &lt;NA&gt;
##   extensions.http...rs.gbif.org.terms.1.0.Multimedia.http...purl.org.dc.terms.format
## 1                                                                               &lt;NA&gt;
## 2                                                                               &lt;NA&gt;
## 3                                                                               &lt;NA&gt;
## 4                                                                               &lt;NA&gt;
## 5                                                                               &lt;NA&gt;
## 6                                                                               &lt;NA&gt;
##   extensions.http...rs.gbif.org.terms.1.0.Multimedia.http...purl.org.dc.terms.references
## 1                                                                                   &lt;NA&gt;
## 2                                                                                   &lt;NA&gt;
## 3                                                                                   &lt;NA&gt;
## 4                                                                                   &lt;NA&gt;
## 5                                                                                   &lt;NA&gt;
## 6                                                                                   &lt;NA&gt;
##   extensions.http...rs.gbif.org.terms.1.0.Multimedia.http...purl.org.dc.terms.creator
## 1                                                                                &lt;NA&gt;
## 2                                                                                &lt;NA&gt;
## 3                                                                                &lt;NA&gt;
## 4                                                                                &lt;NA&gt;
## 5                                                                                &lt;NA&gt;
## 6                                                                                &lt;NA&gt;
##   extensions.http...rs.gbif.org.terms.1.0.Multimedia.http...purl.org.dc.terms.rightsHolder.1
## 1                                                                                       &lt;NA&gt;
## 2                                                                                       &lt;NA&gt;
## 3                                                                                       &lt;NA&gt;
## 4                                                                                       &lt;NA&gt;
## 5                                                                                       &lt;NA&gt;
## 6                                                                                       &lt;NA&gt;
##   extensions.http...rs.gbif.org.terms.1.0.Multimedia.http...purl.org.dc.terms.identifier.1
## 1                                                                                     &lt;NA&gt;
## 2                                                                                     &lt;NA&gt;
## 3                                                                                     &lt;NA&gt;
## 4                                                                                     &lt;NA&gt;
## 5                                                                                     &lt;NA&gt;
## 6                                                                                     &lt;NA&gt;
##   extensions.http...rs.gbif.org.terms.1.0.Multimedia.http...purl.org.dc.terms.type.1
## 1                                                                               &lt;NA&gt;
## 2                                                                               &lt;NA&gt;
## 3                                                                               &lt;NA&gt;
## 4                                                                               &lt;NA&gt;
## 5                                                                               &lt;NA&gt;
## 6                                                                               &lt;NA&gt;
##   extensions.http...rs.gbif.org.terms.1.0.Multimedia.http...rs.tdwg.org.dwc.terms.catalogNumber.1
## 1                                                                                            &lt;NA&gt;
## 2                                                                                            &lt;NA&gt;
## 3                                                                                            &lt;NA&gt;
## 4                                                                                            &lt;NA&gt;
## 5                                                                                            &lt;NA&gt;
## 6                                                                                            &lt;NA&gt;
##   extensions.http...rs.gbif.org.terms.1.0.Multimedia.http...purl.org.dc.terms.publisher.1
## 1                                                                                    &lt;NA&gt;
## 2                                                                                    &lt;NA&gt;
## 3                                                                                    &lt;NA&gt;
## 4                                                                                    &lt;NA&gt;
## 5                                                                                    &lt;NA&gt;
## 6                                                                                    &lt;NA&gt;
##   extensions.http...rs.gbif.org.terms.1.0.Multimedia.http...purl.org.dc.terms.license.1
## 1                                                                                  &lt;NA&gt;
## 2                                                                                  &lt;NA&gt;
## 3                                                                                  &lt;NA&gt;
## 4                                                                                  &lt;NA&gt;
## 5                                                                                  &lt;NA&gt;
## 6                                                                                  &lt;NA&gt;
##   extensions.http...rs.gbif.org.terms.1.0.Multimedia.http...purl.org.dc.terms.created.1
## 1                                                                                  &lt;NA&gt;
## 2                                                                                  &lt;NA&gt;
## 3                                                                                  &lt;NA&gt;
## 4                                                                                  &lt;NA&gt;
## 5                                                                                  &lt;NA&gt;
## 6                                                                                  &lt;NA&gt;
##   extensions.http...rs.gbif.org.terms.1.0.Multimedia.http...purl.org.dc.terms.format.1
## 1                                                                                 &lt;NA&gt;
## 2                                                                                 &lt;NA&gt;
## 3                                                                                 &lt;NA&gt;
## 4                                                                                 &lt;NA&gt;
## 5                                                                                 &lt;NA&gt;
## 6                                                                                 &lt;NA&gt;
##   extensions.http...rs.gbif.org.terms.1.0.Multimedia.http...purl.org.dc.terms.references.1
## 1                                                                                     &lt;NA&gt;
## 2                                                                                     &lt;NA&gt;
## 3                                                                                     &lt;NA&gt;
## 4                                                                                     &lt;NA&gt;
## 5                                                                                     &lt;NA&gt;
## 6                                                                                     &lt;NA&gt;
##   extensions.http...rs.gbif.org.terms.1.0.Multimedia.http...purl.org.dc.terms.creator.1
## 1                                                                                  &lt;NA&gt;
## 2                                                                                  &lt;NA&gt;
## 3                                                                                  &lt;NA&gt;
## 4                                                                                  &lt;NA&gt;
## 5                                                                                  &lt;NA&gt;
## 6                                                                                  &lt;NA&gt;
##   extensions.http...rs.gbif.org.terms.1.0.Multimedia.http...purl.org.dc.terms.rightsHolder.2
## 1                                                                                       &lt;NA&gt;
## 2                                                                                       &lt;NA&gt;
## 3                                                                                       &lt;NA&gt;
## 4                                                                                       &lt;NA&gt;
## 5                                                                                       &lt;NA&gt;
## 6                                                                                       &lt;NA&gt;
##   extensions.http...rs.gbif.org.terms.1.0.Multimedia.http...purl.org.dc.terms.identifier.2
## 1                                                                                     &lt;NA&gt;
## 2                                                                                     &lt;NA&gt;
## 3                                                                                     &lt;NA&gt;
## 4                                                                                     &lt;NA&gt;
## 5                                                                                     &lt;NA&gt;
## 6                                                                                     &lt;NA&gt;
##   extensions.http...rs.gbif.org.terms.1.0.Multimedia.http...purl.org.dc.terms.type.2
## 1                                                                               &lt;NA&gt;
## 2                                                                               &lt;NA&gt;
## 3                                                                               &lt;NA&gt;
## 4                                                                               &lt;NA&gt;
## 5                                                                               &lt;NA&gt;
## 6                                                                               &lt;NA&gt;
##   extensions.http...rs.gbif.org.terms.1.0.Multimedia.http...rs.tdwg.org.dwc.terms.catalogNumber.2
## 1                                                                                            &lt;NA&gt;
## 2                                                                                            &lt;NA&gt;
## 3                                                                                            &lt;NA&gt;
## 4                                                                                            &lt;NA&gt;
## 5                                                                                            &lt;NA&gt;
## 6                                                                                            &lt;NA&gt;
##   extensions.http...rs.gbif.org.terms.1.0.Multimedia.http...purl.org.dc.terms.publisher.2
## 1                                                                                    &lt;NA&gt;
## 2                                                                                    &lt;NA&gt;
## 3                                                                                    &lt;NA&gt;
## 4                                                                                    &lt;NA&gt;
## 5                                                                                    &lt;NA&gt;
## 6                                                                                    &lt;NA&gt;
##   extensions.http...rs.gbif.org.terms.1.0.Multimedia.http...purl.org.dc.terms.license.2
## 1                                                                                  &lt;NA&gt;
## 2                                                                                  &lt;NA&gt;
## 3                                                                                  &lt;NA&gt;
## 4                                                                                  &lt;NA&gt;
## 5                                                                                  &lt;NA&gt;
## 6                                                                                  &lt;NA&gt;
##   extensions.http...rs.gbif.org.terms.1.0.Multimedia.http...purl.org.dc.terms.created.2
## 1                                                                                  &lt;NA&gt;
## 2                                                                                  &lt;NA&gt;
## 3                                                                                  &lt;NA&gt;
## 4                                                                                  &lt;NA&gt;
## 5                                                                                  &lt;NA&gt;
## 6                                                                                  &lt;NA&gt;
##   extensions.http...rs.gbif.org.terms.1.0.Multimedia.http...purl.org.dc.terms.format.2
## 1                                                                                 &lt;NA&gt;
## 2                                                                                 &lt;NA&gt;
## 3                                                                                 &lt;NA&gt;
## 4                                                                                 &lt;NA&gt;
## 5                                                                                 &lt;NA&gt;
## 6                                                                                 &lt;NA&gt;
##   extensions.http...rs.gbif.org.terms.1.0.Multimedia.http...purl.org.dc.terms.references.2
## 1                                                                                     &lt;NA&gt;
## 2                                                                                     &lt;NA&gt;
## 3                                                                                     &lt;NA&gt;
## 4                                                                                     &lt;NA&gt;
## 5                                                                                     &lt;NA&gt;
## 6                                                                                     &lt;NA&gt;
##   extensions.http...rs.gbif.org.terms.1.0.Multimedia.http...purl.org.dc.terms.creator.2
## 1                                                                                  &lt;NA&gt;
## 2                                                                                  &lt;NA&gt;
## 3                                                                                  &lt;NA&gt;
## 4                                                                                  &lt;NA&gt;
## 5                                                                                  &lt;NA&gt;
## 6                                                                                  &lt;NA&gt;
##   extensions.http...rs.gbif.org.terms.1.0.Multimedia.http...purl.org.dc.terms.rightsHolder.3
## 1                                                                                       &lt;NA&gt;
## 2                                                                                       &lt;NA&gt;
## 3                                                                                       &lt;NA&gt;
## 4                                                                                       &lt;NA&gt;
## 5                                                                                       &lt;NA&gt;
## 6                                                                                       &lt;NA&gt;
##   extensions.http...rs.gbif.org.terms.1.0.Multimedia.http...purl.org.dc.terms.identifier.3
## 1                                                                                     &lt;NA&gt;
## 2                                                                                     &lt;NA&gt;
## 3                                                                                     &lt;NA&gt;
## 4                                                                                     &lt;NA&gt;
## 5                                                                                     &lt;NA&gt;
## 6                                                                                     &lt;NA&gt;
##   extensions.http...rs.gbif.org.terms.1.0.Multimedia.http...purl.org.dc.terms.type.3
## 1                                                                               &lt;NA&gt;
## 2                                                                               &lt;NA&gt;
## 3                                                                               &lt;NA&gt;
## 4                                                                               &lt;NA&gt;
## 5                                                                               &lt;NA&gt;
## 6                                                                               &lt;NA&gt;
##   extensions.http...rs.gbif.org.terms.1.0.Multimedia.http...rs.tdwg.org.dwc.terms.catalogNumber.3
## 1                                                                                            &lt;NA&gt;
## 2                                                                                            &lt;NA&gt;
## 3                                                                                            &lt;NA&gt;
## 4                                                                                            &lt;NA&gt;
## 5                                                                                            &lt;NA&gt;
## 6                                                                                            &lt;NA&gt;
##   extensions.http...rs.gbif.org.terms.1.0.Multimedia.http...purl.org.dc.terms.publisher.3
## 1                                                                                    &lt;NA&gt;
## 2                                                                                    &lt;NA&gt;
## 3                                                                                    &lt;NA&gt;
## 4                                                                                    &lt;NA&gt;
## 5                                                                                    &lt;NA&gt;
## 6                                                                                    &lt;NA&gt;
##   extensions.http...rs.gbif.org.terms.1.0.Multimedia.http...purl.org.dc.terms.license.3
## 1                                                                                  &lt;NA&gt;
## 2                                                                                  &lt;NA&gt;
## 3                                                                                  &lt;NA&gt;
## 4                                                                                  &lt;NA&gt;
## 5                                                                                  &lt;NA&gt;
## 6                                                                                  &lt;NA&gt;
##   extensions.http...rs.gbif.org.terms.1.0.Multimedia.http...purl.org.dc.terms.created.3
## 1                                                                                  &lt;NA&gt;
## 2                                                                                  &lt;NA&gt;
## 3                                                                                  &lt;NA&gt;
## 4                                                                                  &lt;NA&gt;
## 5                                                                                  &lt;NA&gt;
## 6                                                                                  &lt;NA&gt;
##   extensions.http...rs.gbif.org.terms.1.0.Multimedia.http...purl.org.dc.terms.format.3
## 1                                                                                 &lt;NA&gt;
## 2                                                                                 &lt;NA&gt;
## 3                                                                                 &lt;NA&gt;
## 4                                                                                 &lt;NA&gt;
## 5                                                                                 &lt;NA&gt;
## 6                                                                                 &lt;NA&gt;
##   extensions.http...rs.gbif.org.terms.1.0.Multimedia.http...purl.org.dc.terms.references.3
## 1                                                                                     &lt;NA&gt;
## 2                                                                                     &lt;NA&gt;
## 3                                                                                     &lt;NA&gt;
## 4                                                                                     &lt;NA&gt;
## 5                                                                                     &lt;NA&gt;
## 6                                                                                     &lt;NA&gt;
##   extensions.http...rs.gbif.org.terms.1.0.Multimedia.http...purl.org.dc.terms.creator.3
## 1                                                                                  &lt;NA&gt;
## 2                                                                                  &lt;NA&gt;
## 3                                                                                  &lt;NA&gt;
## 4                                                                                  &lt;NA&gt;
## 5                                                                                  &lt;NA&gt;
## 6                                                                                  &lt;NA&gt;
##   extensions.http...rs.gbif.org.terms.1.0.Multimedia.http...purl.org.dc.terms.rightsHolder.4
## 1                                                                                       &lt;NA&gt;
## 2                                                                                       &lt;NA&gt;
## 3                                                                                       &lt;NA&gt;
## 4                                                                                       &lt;NA&gt;
## 5                                                                                       &lt;NA&gt;
## 6                                                                                       &lt;NA&gt;
##   extensions.http...rs.gbif.org.terms.1.0.Multimedia.http...purl.org.dc.terms.identifier.4
## 1                                                                                     &lt;NA&gt;
## 2                                                                                     &lt;NA&gt;
## 3                                                                                     &lt;NA&gt;
## 4                                                                                     &lt;NA&gt;
## 5                                                                                     &lt;NA&gt;
## 6                                                                                     &lt;NA&gt;
##   extensions.http...rs.gbif.org.terms.1.0.Multimedia.http...purl.org.dc.terms.type.4
## 1                                                                               &lt;NA&gt;
## 2                                                                               &lt;NA&gt;
## 3                                                                               &lt;NA&gt;
## 4                                                                               &lt;NA&gt;
## 5                                                                               &lt;NA&gt;
## 6                                                                               &lt;NA&gt;
##   extensions.http...rs.gbif.org.terms.1.0.Multimedia.http...rs.tdwg.org.dwc.terms.catalogNumber.4
## 1                                                                                            &lt;NA&gt;
## 2                                                                                            &lt;NA&gt;
## 3                                                                                            &lt;NA&gt;
## 4                                                                                            &lt;NA&gt;
## 5                                                                                            &lt;NA&gt;
## 6                                                                                            &lt;NA&gt;
##   extensions.http...rs.gbif.org.terms.1.0.Multimedia.http...purl.org.dc.terms.publisher.4
## 1                                                                                    &lt;NA&gt;
## 2                                                                                    &lt;NA&gt;
## 3                                                                                    &lt;NA&gt;
## 4                                                                                    &lt;NA&gt;
## 5                                                                                    &lt;NA&gt;
## 6                                                                                    &lt;NA&gt;
##   extensions.http...rs.gbif.org.terms.1.0.Multimedia.http...purl.org.dc.terms.license.4
## 1                                                                                  &lt;NA&gt;
## 2                                                                                  &lt;NA&gt;
## 3                                                                                  &lt;NA&gt;
## 4                                                                                  &lt;NA&gt;
## 5                                                                                  &lt;NA&gt;
## 6                                                                                  &lt;NA&gt;
##   extensions.http...rs.gbif.org.terms.1.0.Multimedia.http...purl.org.dc.terms.created.4
## 1                                                                                  &lt;NA&gt;
## 2                                                                                  &lt;NA&gt;
## 3                                                                                  &lt;NA&gt;
## 4                                                                                  &lt;NA&gt;
## 5                                                                                  &lt;NA&gt;
## 6                                                                                  &lt;NA&gt;
##   extensions.http...rs.gbif.org.terms.1.0.Multimedia.http...purl.org.dc.terms.format.4
## 1                                                                                 &lt;NA&gt;
## 2                                                                                 &lt;NA&gt;
## 3                                                                                 &lt;NA&gt;
## 4                                                                                 &lt;NA&gt;
## 5                                                                                 &lt;NA&gt;
## 6                                                                                 &lt;NA&gt;
##   extensions.http...rs.gbif.org.terms.1.0.Multimedia.http...purl.org.dc.terms.references.4
## 1                                                                                     &lt;NA&gt;
## 2                                                                                     &lt;NA&gt;
## 3                                                                                     &lt;NA&gt;
## 4                                                                                     &lt;NA&gt;
## 5                                                                                     &lt;NA&gt;
## 6                                                                                     &lt;NA&gt;
##   extensions.http...rs.gbif.org.terms.1.0.Multimedia.http...purl.org.dc.terms.creator.4
## 1                                                                                  &lt;NA&gt;
## 2                                                                                  &lt;NA&gt;
## 3                                                                                  &lt;NA&gt;
## 4                                                                                  &lt;NA&gt;
## 5                                                                                  &lt;NA&gt;
## 6                                                                                  &lt;NA&gt;
##   extensions.http...rs.gbif.org.terms.1.0.Multimedia.http...purl.org.dc.terms.rightsHolder.5
## 1                                                                                       &lt;NA&gt;
## 2                                                                                       &lt;NA&gt;
## 3                                                                                       &lt;NA&gt;
## 4                                                                                       &lt;NA&gt;
## 5                                                                                       &lt;NA&gt;
## 6                                                                                       &lt;NA&gt;
##   extensions.http...rs.gbif.org.terms.1.0.Multimedia.http...purl.org.dc.terms.identifier.5
## 1                                                                                     &lt;NA&gt;
## 2                                                                                     &lt;NA&gt;
## 3                                                                                     &lt;NA&gt;
## 4                                                                                     &lt;NA&gt;
## 5                                                                                     &lt;NA&gt;
## 6                                                                                     &lt;NA&gt;
##   extensions.http...rs.gbif.org.terms.1.0.Multimedia.http...purl.org.dc.terms.type.5
## 1                                                                               &lt;NA&gt;
## 2                                                                               &lt;NA&gt;
## 3                                                                               &lt;NA&gt;
## 4                                                                               &lt;NA&gt;
## 5                                                                               &lt;NA&gt;
## 6                                                                               &lt;NA&gt;
##   extensions.http...rs.gbif.org.terms.1.0.Multimedia.http...rs.tdwg.org.dwc.terms.catalogNumber.5
## 1                                                                                            &lt;NA&gt;
## 2                                                                                            &lt;NA&gt;
## 3                                                                                            &lt;NA&gt;
## 4                                                                                            &lt;NA&gt;
## 5                                                                                            &lt;NA&gt;
## 6                                                                                            &lt;NA&gt;
##   extensions.http...rs.gbif.org.terms.1.0.Multimedia.http...purl.org.dc.terms.publisher.5
## 1                                                                                    &lt;NA&gt;
## 2                                                                                    &lt;NA&gt;
## 3                                                                                    &lt;NA&gt;
## 4                                                                                    &lt;NA&gt;
## 5                                                                                    &lt;NA&gt;
## 6                                                                                    &lt;NA&gt;
##   extensions.http...rs.gbif.org.terms.1.0.Multimedia.http...purl.org.dc.terms.license.5
## 1                                                                                  &lt;NA&gt;
## 2                                                                                  &lt;NA&gt;
## 3                                                                                  &lt;NA&gt;
## 4                                                                                  &lt;NA&gt;
## 5                                                                                  &lt;NA&gt;
## 6                                                                                  &lt;NA&gt;
##   extensions.http...rs.gbif.org.terms.1.0.Multimedia.http...purl.org.dc.terms.created.5
## 1                                                                                  &lt;NA&gt;
## 2                                                                                  &lt;NA&gt;
## 3                                                                                  &lt;NA&gt;
## 4                                                                                  &lt;NA&gt;
## 5                                                                                  &lt;NA&gt;
## 6                                                                                  &lt;NA&gt;
##   extensions.http...rs.gbif.org.terms.1.0.Multimedia.http...purl.org.dc.terms.format.5
## 1                                                                                 &lt;NA&gt;
## 2                                                                                 &lt;NA&gt;
## 3                                                                                 &lt;NA&gt;
## 4                                                                                 &lt;NA&gt;
## 5                                                                                 &lt;NA&gt;
## 6                                                                                 &lt;NA&gt;
##   extensions.http...rs.gbif.org.terms.1.0.Multimedia.http...purl.org.dc.terms.references.5
## 1                                                                                     &lt;NA&gt;
## 2                                                                                     &lt;NA&gt;
## 3                                                                                     &lt;NA&gt;
## 4                                                                                     &lt;NA&gt;
## 5                                                                                     &lt;NA&gt;
## 6                                                                                     &lt;NA&gt;
##   extensions.http...rs.gbif.org.terms.1.0.Multimedia.http...purl.org.dc.terms.creator.5
## 1                                                                                  &lt;NA&gt;
## 2                                                                                  &lt;NA&gt;
## 3                                                                                  &lt;NA&gt;
## 4                                                                                  &lt;NA&gt;
## 5                                                                                  &lt;NA&gt;
## 6                                                                                  &lt;NA&gt;
##   dateIdentified modified references http...unknown.org.nick verbatimEventDate
## 1           &lt;NA&gt;     &lt;NA&gt;       &lt;NA&gt;                    &lt;NA&gt;              &lt;NA&gt;
## 2           &lt;NA&gt;     &lt;NA&gt;       &lt;NA&gt;                    &lt;NA&gt;              &lt;NA&gt;
## 3           &lt;NA&gt;     &lt;NA&gt;       &lt;NA&gt;                    &lt;NA&gt;              &lt;NA&gt;
## 4           &lt;NA&gt;     &lt;NA&gt;       &lt;NA&gt;                    &lt;NA&gt;              &lt;NA&gt;
## 5           &lt;NA&gt;     &lt;NA&gt;       &lt;NA&gt;                    &lt;NA&gt;              &lt;NA&gt;
## 6           &lt;NA&gt;     &lt;NA&gt;       &lt;NA&gt;                    &lt;NA&gt;              &lt;NA&gt;
##   verbatimLocality collectionCode http...unknown.org.occurrenceDetails rights
## 1             &lt;NA&gt;           &lt;NA&gt;                                 &lt;NA&gt;   &lt;NA&gt;
## 2             &lt;NA&gt;           &lt;NA&gt;                                 &lt;NA&gt;   &lt;NA&gt;
## 3             &lt;NA&gt;           &lt;NA&gt;                                 &lt;NA&gt;   &lt;NA&gt;
## 4             &lt;NA&gt;           &lt;NA&gt;                                 &lt;NA&gt;   &lt;NA&gt;
## 5             &lt;NA&gt;           &lt;NA&gt;                                 &lt;NA&gt;   &lt;NA&gt;
## 6             &lt;NA&gt;           &lt;NA&gt;                                 &lt;NA&gt;   &lt;NA&gt;
##   eventTime identifiedBy identificationID
## 1      &lt;NA&gt;         &lt;NA&gt;             &lt;NA&gt;
## 2      &lt;NA&gt;         &lt;NA&gt;             &lt;NA&gt;
## 3      &lt;NA&gt;         &lt;NA&gt;             &lt;NA&gt;
## 4      &lt;NA&gt;         &lt;NA&gt;             &lt;NA&gt;
## 5      &lt;NA&gt;         &lt;NA&gt;             &lt;NA&gt;
## 6      &lt;NA&gt;         &lt;NA&gt;             &lt;NA&gt;
##   extensions.http...rs.gbif.org.terms.1.0.Multimedia.http...purl.org.dc.terms.rightsHolder.6
## 1                                                                                       &lt;NA&gt;
## 2                                                                                       &lt;NA&gt;
## 3                                                                                       &lt;NA&gt;
## 4                                                                                       &lt;NA&gt;
## 5                                                                                       &lt;NA&gt;
## 6                                                                                       &lt;NA&gt;
##   extensions.http...rs.gbif.org.terms.1.0.Multimedia.http...purl.org.dc.terms.identifier.6
## 1                                                                                     &lt;NA&gt;
## 2                                                                                     &lt;NA&gt;
## 3                                                                                     &lt;NA&gt;
## 4                                                                                     &lt;NA&gt;
## 5                                                                                     &lt;NA&gt;
## 6                                                                                     &lt;NA&gt;
##   extensions.http...rs.gbif.org.terms.1.0.Multimedia.http...purl.org.dc.terms.type.6
## 1                                                                               &lt;NA&gt;
## 2                                                                               &lt;NA&gt;
## 3                                                                               &lt;NA&gt;
## 4                                                                               &lt;NA&gt;
## 5                                                                               &lt;NA&gt;
## 6                                                                               &lt;NA&gt;
##   extensions.http...rs.gbif.org.terms.1.0.Multimedia.http...rs.tdwg.org.dwc.terms.catalogNumber.6
## 1                                                                                            &lt;NA&gt;
## 2                                                                                            &lt;NA&gt;
## 3                                                                                            &lt;NA&gt;
## 4                                                                                            &lt;NA&gt;
## 5                                                                                            &lt;NA&gt;
## 6                                                                                            &lt;NA&gt;
##   extensions.http...rs.gbif.org.terms.1.0.Multimedia.http...purl.org.dc.terms.publisher.6
## 1                                                                                    &lt;NA&gt;
## 2                                                                                    &lt;NA&gt;
## 3                                                                                    &lt;NA&gt;
## 4                                                                                    &lt;NA&gt;
## 5                                                                                    &lt;NA&gt;
## 6                                                                                    &lt;NA&gt;
##   extensions.http...rs.gbif.org.terms.1.0.Multimedia.http...purl.org.dc.terms.license.6
## 1                                                                                  &lt;NA&gt;
## 2                                                                                  &lt;NA&gt;
## 3                                                                                  &lt;NA&gt;
## 4                                                                                  &lt;NA&gt;
## 5                                                                                  &lt;NA&gt;
## 6                                                                                  &lt;NA&gt;
##   extensions.http...rs.gbif.org.terms.1.0.Multimedia.http...purl.org.dc.terms.created.6
## 1                                                                                  &lt;NA&gt;
## 2                                                                                  &lt;NA&gt;
## 3                                                                                  &lt;NA&gt;
## 4                                                                                  &lt;NA&gt;
## 5                                                                                  &lt;NA&gt;
## 6                                                                                  &lt;NA&gt;
##   extensions.http...rs.gbif.org.terms.1.0.Multimedia.http...purl.org.dc.terms.format.6
## 1                                                                                 &lt;NA&gt;
## 2                                                                                 &lt;NA&gt;
## 3                                                                                 &lt;NA&gt;
## 4                                                                                 &lt;NA&gt;
## 5                                                                                 &lt;NA&gt;
## 6                                                                                 &lt;NA&gt;
##   extensions.http...rs.gbif.org.terms.1.0.Multimedia.http...purl.org.dc.terms.references.6
## 1                                                                                     &lt;NA&gt;
## 2                                                                                     &lt;NA&gt;
## 3                                                                                     &lt;NA&gt;
## 4                                                                                     &lt;NA&gt;
## 5                                                                                     &lt;NA&gt;
## 6                                                                                     &lt;NA&gt;
##   extensions.http...rs.gbif.org.terms.1.0.Multimedia.http...purl.org.dc.terms.creator.6
## 1                                                                                  &lt;NA&gt;
## 2                                                                                  &lt;NA&gt;
## 3                                                                                  &lt;NA&gt;
## 4                                                                                  &lt;NA&gt;
## 5                                                                                  &lt;NA&gt;
## 6                                                                                  &lt;NA&gt;
##   extensions.http...rs.gbif.org.terms.1.0.Multimedia.http...purl.org.dc.terms.rightsHolder.7
## 1                                                                                       &lt;NA&gt;
## 2                                                                                       &lt;NA&gt;
## 3                                                                                       &lt;NA&gt;
## 4                                                                                       &lt;NA&gt;
## 5                                                                                       &lt;NA&gt;
## 6                                                                                       &lt;NA&gt;
##   extensions.http...rs.gbif.org.terms.1.0.Multimedia.http...purl.org.dc.terms.identifier.7
## 1                                                                                     &lt;NA&gt;
## 2                                                                                     &lt;NA&gt;
## 3                                                                                     &lt;NA&gt;
## 4                                                                                     &lt;NA&gt;
## 5                                                                                     &lt;NA&gt;
## 6                                                                                     &lt;NA&gt;
##   extensions.http...rs.gbif.org.terms.1.0.Multimedia.http...purl.org.dc.terms.type.7
## 1                                                                               &lt;NA&gt;
## 2                                                                               &lt;NA&gt;
## 3                                                                               &lt;NA&gt;
## 4                                                                               &lt;NA&gt;
## 5                                                                               &lt;NA&gt;
## 6                                                                               &lt;NA&gt;
##   extensions.http...rs.gbif.org.terms.1.0.Multimedia.http...rs.tdwg.org.dwc.terms.catalogNumber.7
## 1                                                                                            &lt;NA&gt;
## 2                                                                                            &lt;NA&gt;
## 3                                                                                            &lt;NA&gt;
## 4                                                                                            &lt;NA&gt;
## 5                                                                                            &lt;NA&gt;
## 6                                                                                            &lt;NA&gt;
##   extensions.http...rs.gbif.org.terms.1.0.Multimedia.http...purl.org.dc.terms.publisher.7
## 1                                                                                    &lt;NA&gt;
## 2                                                                                    &lt;NA&gt;
## 3                                                                                    &lt;NA&gt;
## 4                                                                                    &lt;NA&gt;
## 5                                                                                    &lt;NA&gt;
## 6                                                                                    &lt;NA&gt;
##   extensions.http...rs.gbif.org.terms.1.0.Multimedia.http...purl.org.dc.terms.license.7
## 1                                                                                  &lt;NA&gt;
## 2                                                                                  &lt;NA&gt;
## 3                                                                                  &lt;NA&gt;
## 4                                                                                  &lt;NA&gt;
## 5                                                                                  &lt;NA&gt;
## 6                                                                                  &lt;NA&gt;
##   extensions.http...rs.gbif.org.terms.1.0.Multimedia.http...purl.org.dc.terms.created.7
## 1                                                                                  &lt;NA&gt;
## 2                                                                                  &lt;NA&gt;
## 3                                                                                  &lt;NA&gt;
## 4                                                                                  &lt;NA&gt;
## 5                                                                                  &lt;NA&gt;
## 6                                                                                  &lt;NA&gt;
##   extensions.http...rs.gbif.org.terms.1.0.Multimedia.http...purl.org.dc.terms.format.7
## 1                                                                                 &lt;NA&gt;
## 2                                                                                 &lt;NA&gt;
## 3                                                                                 &lt;NA&gt;
## 4                                                                                 &lt;NA&gt;
## 5                                                                                 &lt;NA&gt;
## 6                                                                                 &lt;NA&gt;
##   extensions.http...rs.gbif.org.terms.1.0.Multimedia.http...purl.org.dc.terms.references.7
## 1                                                                                     &lt;NA&gt;
## 2                                                                                     &lt;NA&gt;
## 3                                                                                     &lt;NA&gt;
## 4                                                                                     &lt;NA&gt;
## 5                                                                                     &lt;NA&gt;
## 6                                                                                     &lt;NA&gt;
##   extensions.http...rs.gbif.org.terms.1.0.Multimedia.http...purl.org.dc.terms.creator.7
## 1                                                                                  &lt;NA&gt;
## 2                                                                                  &lt;NA&gt;
## 3                                                                                  &lt;NA&gt;
## 4                                                                                  &lt;NA&gt;
## 5                                                                                  &lt;NA&gt;
## 6                                                                                  &lt;NA&gt;
##   extensions.http...rs.gbif.org.terms.1.0.Multimedia.http...purl.org.dc.terms.rightsHolder.8
## 1                                                                                       &lt;NA&gt;
## 2                                                                                       &lt;NA&gt;
## 3                                                                                       &lt;NA&gt;
## 4                                                                                       &lt;NA&gt;
## 5                                                                                       &lt;NA&gt;
## 6                                                                                       &lt;NA&gt;
##   extensions.http...rs.gbif.org.terms.1.0.Multimedia.http...purl.org.dc.terms.identifier.8
## 1                                                                                     &lt;NA&gt;
## 2                                                                                     &lt;NA&gt;
## 3                                                                                     &lt;NA&gt;
## 4                                                                                     &lt;NA&gt;
## 5                                                                                     &lt;NA&gt;
## 6                                                                                     &lt;NA&gt;
##   extensions.http...rs.gbif.org.terms.1.0.Multimedia.http...purl.org.dc.terms.type.8
## 1                                                                               &lt;NA&gt;
## 2                                                                               &lt;NA&gt;
## 3                                                                               &lt;NA&gt;
## 4                                                                               &lt;NA&gt;
## 5                                                                               &lt;NA&gt;
## 6                                                                               &lt;NA&gt;
##   extensions.http...rs.gbif.org.terms.1.0.Multimedia.http...rs.tdwg.org.dwc.terms.catalogNumber.8
## 1                                                                                            &lt;NA&gt;
## 2                                                                                            &lt;NA&gt;
## 3                                                                                            &lt;NA&gt;
## 4                                                                                            &lt;NA&gt;
## 5                                                                                            &lt;NA&gt;
## 6                                                                                            &lt;NA&gt;
##   extensions.http...rs.gbif.org.terms.1.0.Multimedia.http...purl.org.dc.terms.publisher.8
## 1                                                                                    &lt;NA&gt;
## 2                                                                                    &lt;NA&gt;
## 3                                                                                    &lt;NA&gt;
## 4                                                                                    &lt;NA&gt;
## 5                                                                                    &lt;NA&gt;
## 6                                                                                    &lt;NA&gt;
##   extensions.http...rs.gbif.org.terms.1.0.Multimedia.http...purl.org.dc.terms.license.8
## 1                                                                                  &lt;NA&gt;
## 2                                                                                  &lt;NA&gt;
## 3                                                                                  &lt;NA&gt;
## 4                                                                                  &lt;NA&gt;
## 5                                                                                  &lt;NA&gt;
## 6                                                                                  &lt;NA&gt;
##   extensions.http...rs.gbif.org.terms.1.0.Multimedia.http...purl.org.dc.terms.created.8
## 1                                                                                  &lt;NA&gt;
## 2                                                                                  &lt;NA&gt;
## 3                                                                                  &lt;NA&gt;
## 4                                                                                  &lt;NA&gt;
## 5                                                                                  &lt;NA&gt;
## 6                                                                                  &lt;NA&gt;
##   extensions.http...rs.gbif.org.terms.1.0.Multimedia.http...purl.org.dc.terms.format.8
## 1                                                                                 &lt;NA&gt;
## 2                                                                                 &lt;NA&gt;
## 3                                                                                 &lt;NA&gt;
## 4                                                                                 &lt;NA&gt;
## 5                                                                                 &lt;NA&gt;
## 6                                                                                 &lt;NA&gt;
##   extensions.http...rs.gbif.org.terms.1.0.Multimedia.http...purl.org.dc.terms.references.8
## 1                                                                                     &lt;NA&gt;
## 2                                                                                     &lt;NA&gt;
## 3                                                                                     &lt;NA&gt;
## 4                                                                                     &lt;NA&gt;
## 5                                                                                     &lt;NA&gt;
## 6                                                                                     &lt;NA&gt;
##   extensions.http...rs.gbif.org.terms.1.0.Multimedia.http...purl.org.dc.terms.creator.8
## 1                                                                                  &lt;NA&gt;
## 2                                                                                  &lt;NA&gt;
## 3                                                                                  &lt;NA&gt;
## 4                                                                                  &lt;NA&gt;
## 5                                                                                  &lt;NA&gt;
## 6                                                                                  &lt;NA&gt;
##   extensions.http...rs.gbif.org.terms.1.0.Multimedia.http...purl.org.dc.terms.rightsHolder.9
## 1                                                                                       &lt;NA&gt;
## 2                                                                                       &lt;NA&gt;
## 3                                                                                       &lt;NA&gt;
## 4                                                                                       &lt;NA&gt;
## 5                                                                                       &lt;NA&gt;
## 6                                                                                       &lt;NA&gt;
##   extensions.http...rs.gbif.org.terms.1.0.Multimedia.http...purl.org.dc.terms.identifier.9
## 1                                                                                     &lt;NA&gt;
## 2                                                                                     &lt;NA&gt;
## 3                                                                                     &lt;NA&gt;
## 4                                                                                     &lt;NA&gt;
## 5                                                                                     &lt;NA&gt;
## 6                                                                                     &lt;NA&gt;
##   extensions.http...rs.gbif.org.terms.1.0.Multimedia.http...purl.org.dc.terms.type.9
## 1                                                                               &lt;NA&gt;
## 2                                                                               &lt;NA&gt;
## 3                                                                               &lt;NA&gt;
## 4                                                                               &lt;NA&gt;
## 5                                                                               &lt;NA&gt;
## 6                                                                               &lt;NA&gt;
##   extensions.http...rs.gbif.org.terms.1.0.Multimedia.http...rs.tdwg.org.dwc.terms.catalogNumber.9
## 1                                                                                            &lt;NA&gt;
## 2                                                                                            &lt;NA&gt;
## 3                                                                                            &lt;NA&gt;
## 4                                                                                            &lt;NA&gt;
## 5                                                                                            &lt;NA&gt;
## 6                                                                                            &lt;NA&gt;
##   extensions.http...rs.gbif.org.terms.1.0.Multimedia.http...purl.org.dc.terms.publisher.9
## 1                                                                                    &lt;NA&gt;
## 2                                                                                    &lt;NA&gt;
## 3                                                                                    &lt;NA&gt;
## 4                                                                                    &lt;NA&gt;
## 5                                                                                    &lt;NA&gt;
## 6                                                                                    &lt;NA&gt;
##   extensions.http...rs.gbif.org.terms.1.0.Multimedia.http...purl.org.dc.terms.license.9
## 1                                                                                  &lt;NA&gt;
## 2                                                                                  &lt;NA&gt;
## 3                                                                                  &lt;NA&gt;
## 4                                                                                  &lt;NA&gt;
## 5                                                                                  &lt;NA&gt;
## 6                                                                                  &lt;NA&gt;
##   extensions.http...rs.gbif.org.terms.1.0.Multimedia.http...purl.org.dc.terms.created.9
## 1                                                                                  &lt;NA&gt;
## 2                                                                                  &lt;NA&gt;
## 3                                                                                  &lt;NA&gt;
## 4                                                                                  &lt;NA&gt;
## 5                                                                                  &lt;NA&gt;
## 6                                                                                  &lt;NA&gt;
##   extensions.http...rs.gbif.org.terms.1.0.Multimedia.http...purl.org.dc.terms.format.9
## 1                                                                                 &lt;NA&gt;
## 2                                                                                 &lt;NA&gt;
## 3                                                                                 &lt;NA&gt;
## 4                                                                                 &lt;NA&gt;
## 5                                                                                 &lt;NA&gt;
## 6                                                                                 &lt;NA&gt;
##   extensions.http...rs.gbif.org.terms.1.0.Multimedia.http...purl.org.dc.terms.references.9
## 1                                                                                     &lt;NA&gt;
## 2                                                                                     &lt;NA&gt;
## 3                                                                                     &lt;NA&gt;
## 4                                                                                     &lt;NA&gt;
## 5                                                                                     &lt;NA&gt;
## 6                                                                                     &lt;NA&gt;
##   extensions.http...rs.gbif.org.terms.1.0.Multimedia.http...purl.org.dc.terms.creator.9
## 1                                                                                  &lt;NA&gt;
## 2                                                                                  &lt;NA&gt;
## 3                                                                                  &lt;NA&gt;
## 4                                                                                  &lt;NA&gt;
## 5                                                                                  &lt;NA&gt;
## 6                                                                                  &lt;NA&gt;
##   extensions.http...rs.tdwg.org.ac.terms.Multimedia.http...purl.org.dc.terms.identifier
## 1                                                                                  &lt;NA&gt;
## 2                                                                                  &lt;NA&gt;
## 3                                                                                  &lt;NA&gt;
## 4                                                                                  &lt;NA&gt;
## 5                                                                                  &lt;NA&gt;
## 6                                                                                  &lt;NA&gt;
##   extensions.http...rs.tdwg.org.ac.terms.Multimedia.http...rs.tdwg.org.ac.terms.taxonCoverage
## 1                                                                                        &lt;NA&gt;
## 2                                                                                        &lt;NA&gt;
## 3                                                                                        &lt;NA&gt;
## 4                                                                                        &lt;NA&gt;
## 5                                                                                        &lt;NA&gt;
## 6                                                                                        &lt;NA&gt;
##   extensions.http...rs.tdwg.org.ac.terms.Multimedia.http...purl.org.dc.terms.modified
## 1                                                                                &lt;NA&gt;
## 2                                                                                &lt;NA&gt;
## 3                                                                                &lt;NA&gt;
## 4                                                                                &lt;NA&gt;
## 5                                                                                &lt;NA&gt;
## 6                                                                                &lt;NA&gt;
##   extensions.http...rs.tdwg.org.ac.terms.Multimedia.http...purl.org.dc.elements.1.1.type
## 1                                                                                   &lt;NA&gt;
## 2                                                                                   &lt;NA&gt;
## 3                                                                                   &lt;NA&gt;
## 4                                                                                   &lt;NA&gt;
## 5                                                                                   &lt;NA&gt;
## 6                                                                                   &lt;NA&gt;
##   extensions.http...rs.tdwg.org.ac.terms.Multimedia.http...rs.tdwg.org.ac.terms.subjectPart
## 1                                                                                      &lt;NA&gt;
## 2                                                                                      &lt;NA&gt;
## 3                                                                                      &lt;NA&gt;
## 4                                                                                      &lt;NA&gt;
## 5                                                                                      &lt;NA&gt;
## 6                                                                                      &lt;NA&gt;
##   extensions.http...rs.tdwg.org.ac.terms.Multimedia.http...rs.tdwg.org.ac.terms.associatedObservationReference
## 1                                                                                                         &lt;NA&gt;
## 2                                                                                                         &lt;NA&gt;
## 3                                                                                                         &lt;NA&gt;
## 4                                                                                                         &lt;NA&gt;
## 5                                                                                                         &lt;NA&gt;
## 6                                                                                                         &lt;NA&gt;
##   extensions.http...rs.tdwg.org.ac.terms.Multimedia.http...ns.adobe.com.xap.1.0.rights.UsageTerms
## 1                                                                                            &lt;NA&gt;
## 2                                                                                            &lt;NA&gt;
## 3                                                                                            &lt;NA&gt;
## 4                                                                                            &lt;NA&gt;
## 5                                                                                            &lt;NA&gt;
## 6                                                                                            &lt;NA&gt;
##   extensions.http...rs.tdwg.org.ac.terms.Multimedia.http...rs.tdwg.org.ac.terms.taxonCount
## 1                                                                                     &lt;NA&gt;
## 2                                                                                     &lt;NA&gt;
## 3                                                                                     &lt;NA&gt;
## 4                                                                                     &lt;NA&gt;
## 5                                                                                     &lt;NA&gt;
## 6                                                                                     &lt;NA&gt;
##   extensions.http...rs.tdwg.org.ac.terms.Multimedia.http...purl.org.dc.terms.creator
## 1                                                                               &lt;NA&gt;
## 2                                                                               &lt;NA&gt;
## 3                                                                               &lt;NA&gt;
## 4                                                                               &lt;NA&gt;
## 5                                                                               &lt;NA&gt;
## 6                                                                               &lt;NA&gt;
##   extensions.http...rs.tdwg.org.ac.terms.Multimedia.http...purl.org.dc.elements.1.1.rights
## 1                                                                                     &lt;NA&gt;
## 2                                                                                     &lt;NA&gt;
## 3                                                                                     &lt;NA&gt;
## 4                                                                                     &lt;NA&gt;
## 5                                                                                     &lt;NA&gt;
## 6                                                                                     &lt;NA&gt;
##   extensions.http...rs.tdwg.org.ac.terms.Multimedia.http...rs.tdwg.org.ac.terms.tag
## 1                                                                              &lt;NA&gt;
## 2                                                                              &lt;NA&gt;
## 3                                                                              &lt;NA&gt;
## 4                                                                              &lt;NA&gt;
## 5                                                                              &lt;NA&gt;
## 6                                                                              &lt;NA&gt;
##   extensions.http...rs.tdwg.org.ac.terms.Multimedia.http...ns.adobe.com.xap.1.0.rights.Owner
## 1                                                                                       &lt;NA&gt;
## 2                                                                                       &lt;NA&gt;
## 3                                                                                       &lt;NA&gt;
## 4                                                                                       &lt;NA&gt;
## 5                                                                                       &lt;NA&gt;
## 6                                                                                       &lt;NA&gt;
##   extensions.http...rs.tdwg.org.ac.terms.Multimedia.http...purl.org.dc.elements.1.1.format
## 1                                                                                     &lt;NA&gt;
## 2                                                                                     &lt;NA&gt;
## 3                                                                                     &lt;NA&gt;
## 4                                                                                     &lt;NA&gt;
## 5                                                                                     &lt;NA&gt;
## 6                                                                                     &lt;NA&gt;
##   extensions.http...rs.tdwg.org.ac.terms.Multimedia.http...ns.adobe.com.photoshop.1.0.Credit
## 1                                                                                       &lt;NA&gt;
## 2                                                                                       &lt;NA&gt;
## 3                                                                                       &lt;NA&gt;
## 4                                                                                       &lt;NA&gt;
## 5                                                                                       &lt;NA&gt;
## 6                                                                                       &lt;NA&gt;
##   extensions.http...rs.tdwg.org.ac.terms.Multimedia.http...purl.org.dc.elements.1.1.creator
## 1                                                                                      &lt;NA&gt;
## 2                                                                                      &lt;NA&gt;
## 3                                                                                      &lt;NA&gt;
## 4                                                                                      &lt;NA&gt;
## 5                                                                                      &lt;NA&gt;
## 6                                                                                      &lt;NA&gt;
##   extensions.http...rs.tdwg.org.ac.terms.Multimedia.http...ns.adobe.com.xap.1.0.CreateDate
## 1                                                                                     &lt;NA&gt;
## 2                                                                                     &lt;NA&gt;
## 3                                                                                     &lt;NA&gt;
## 4                                                                                     &lt;NA&gt;
## 5                                                                                     &lt;NA&gt;
## 6                                                                                     &lt;NA&gt;
##   extensions.http...rs.tdwg.org.ac.terms.Multimedia.http...rs.tdwg.org.ac.terms.caption
## 1                                                                                  &lt;NA&gt;
## 2                                                                                  &lt;NA&gt;
## 3                                                                                  &lt;NA&gt;
## 4                                                                                  &lt;NA&gt;
## 5                                                                                  &lt;NA&gt;
## 6                                                                                  &lt;NA&gt;
##   extensions.http...rs.tdwg.org.ac.terms.Multimedia.http...purl.org.dc.terms.title
## 1                                                                             &lt;NA&gt;
## 2                                                                             &lt;NA&gt;
## 3                                                                             &lt;NA&gt;
## 4                                                                             &lt;NA&gt;
## 5                                                                             &lt;NA&gt;
## 6                                                                             &lt;NA&gt;
##   extensions.http...rs.tdwg.org.ac.terms.Multimedia.http...rs.tdwg.org.ac.terms.accessURI
## 1                                                                                    &lt;NA&gt;
## 2                                                                                    &lt;NA&gt;
## 3                                                                                    &lt;NA&gt;
## 4                                                                                    &lt;NA&gt;
## 5                                                                                    &lt;NA&gt;
## 6                                                                                    &lt;NA&gt;
##   extensions.http...rs.tdwg.org.ac.terms.Multimedia.http...purl.org.dc.elements.1.1.source
## 1                                                                                     &lt;NA&gt;
## 2                                                                                     &lt;NA&gt;
## 3                                                                                     &lt;NA&gt;
## 4                                                                                     &lt;NA&gt;
## 5                                                                                     &lt;NA&gt;
## 6                                                                                     &lt;NA&gt;
##   extensions.http...rs.tdwg.org.ac.terms.Multimedia.http...purl.org.dc.terms.rights
## 1                                                                              &lt;NA&gt;
## 2                                                                              &lt;NA&gt;
## 3                                                                              &lt;NA&gt;
## 4                                                                              &lt;NA&gt;
## 5                                                                              &lt;NA&gt;
## 6                                                                              &lt;NA&gt;
##   extensions.http...rs.tdwg.org.ac.terms.Multimedia.http...purl.org.dc.terms.source
## 1                                                                              &lt;NA&gt;
## 2                                                                              &lt;NA&gt;
## 3                                                                              &lt;NA&gt;
## 4                                                                              &lt;NA&gt;
## 5                                                                              &lt;NA&gt;
## 6                                                                              &lt;NA&gt;
##   extensions.http...rs.tdwg.org.ac.terms.Multimedia.http...purl.org.dc.terms.type
## 1                                                                            &lt;NA&gt;
## 2                                                                            &lt;NA&gt;
## 3                                                                            &lt;NA&gt;
## 4                                                                            &lt;NA&gt;
## 5                                                                            &lt;NA&gt;
## 6                                                                            &lt;NA&gt;
##   extensions.http...rs.tdwg.org.ac.terms.Multimedia.http...purl.org.dc.terms.format
## 1                                                                              &lt;NA&gt;
## 2                                                                              &lt;NA&gt;
## 3                                                                              &lt;NA&gt;
## 4                                                                              &lt;NA&gt;
## 5                                                                              &lt;NA&gt;
## 6                                                                              &lt;NA&gt;
##   infraspecificEpithet
## 1                 &lt;NA&gt;
## 2                 &lt;NA&gt;
## 3                 &lt;NA&gt;
## 4                 &lt;NA&gt;
## 5                 &lt;NA&gt;
## 6                 &lt;NA&gt;
##   extensions.http...rs.tdwg.org.ac.terms.Multimedia.http...purl.org.dc.terms.identifier.1
## 1                                                                                    &lt;NA&gt;
## 2                                                                                    &lt;NA&gt;
## 3                                                                                    &lt;NA&gt;
## 4                                                                                    &lt;NA&gt;
## 5                                                                                    &lt;NA&gt;
## 6                                                                                    &lt;NA&gt;
##   extensions.http...rs.tdwg.org.ac.terms.Multimedia.http...rs.tdwg.org.ac.terms.taxonCoverage.1
## 1                                                                                          &lt;NA&gt;
## 2                                                                                          &lt;NA&gt;
## 3                                                                                          &lt;NA&gt;
## 4                                                                                          &lt;NA&gt;
## 5                                                                                          &lt;NA&gt;
## 6                                                                                          &lt;NA&gt;
##   extensions.http...rs.tdwg.org.ac.terms.Multimedia.http...purl.org.dc.terms.modified.1
## 1                                                                                  &lt;NA&gt;
## 2                                                                                  &lt;NA&gt;
## 3                                                                                  &lt;NA&gt;
## 4                                                                                  &lt;NA&gt;
## 5                                                                                  &lt;NA&gt;
## 6                                                                                  &lt;NA&gt;
##   extensions.http...rs.tdwg.org.ac.terms.Multimedia.http...purl.org.dc.elements.1.1.type.1
## 1                                                                                     &lt;NA&gt;
## 2                                                                                     &lt;NA&gt;
## 3                                                                                     &lt;NA&gt;
## 4                                                                                     &lt;NA&gt;
## 5                                                                                     &lt;NA&gt;
## 6                                                                                     &lt;NA&gt;
##   extensions.http...rs.tdwg.org.ac.terms.Multimedia.http...rs.tdwg.org.ac.terms.subjectPart.1
## 1                                                                                        &lt;NA&gt;
## 2                                                                                        &lt;NA&gt;
## 3                                                                                        &lt;NA&gt;
## 4                                                                                        &lt;NA&gt;
## 5                                                                                        &lt;NA&gt;
## 6                                                                                        &lt;NA&gt;
##   extensions.http...rs.tdwg.org.ac.terms.Multimedia.http...rs.tdwg.org.ac.terms.associatedObservationReference.1
## 1                                                                                                           &lt;NA&gt;
## 2                                                                                                           &lt;NA&gt;
## 3                                                                                                           &lt;NA&gt;
## 4                                                                                                           &lt;NA&gt;
## 5                                                                                                           &lt;NA&gt;
## 6                                                                                                           &lt;NA&gt;
##   extensions.http...rs.tdwg.org.ac.terms.Multimedia.http...ns.adobe.com.xap.1.0.rights.UsageTerms.1
## 1                                                                                              &lt;NA&gt;
## 2                                                                                              &lt;NA&gt;
## 3                                                                                              &lt;NA&gt;
## 4                                                                                              &lt;NA&gt;
## 5                                                                                              &lt;NA&gt;
## 6                                                                                              &lt;NA&gt;
##   extensions.http...rs.tdwg.org.ac.terms.Multimedia.http...rs.tdwg.org.ac.terms.taxonCount.1
## 1                                                                                       &lt;NA&gt;
## 2                                                                                       &lt;NA&gt;
## 3                                                                                       &lt;NA&gt;
## 4                                                                                       &lt;NA&gt;
## 5                                                                                       &lt;NA&gt;
## 6                                                                                       &lt;NA&gt;
##   extensions.http...rs.tdwg.org.ac.terms.Multimedia.http...purl.org.dc.terms.creator.1
## 1                                                                                 &lt;NA&gt;
## 2                                                                                 &lt;NA&gt;
## 3                                                                                 &lt;NA&gt;
## 4                                                                                 &lt;NA&gt;
## 5                                                                                 &lt;NA&gt;
## 6                                                                                 &lt;NA&gt;
##   extensions.http...rs.tdwg.org.ac.terms.Multimedia.http...purl.org.dc.elements.1.1.rights.1
## 1                                                                                       &lt;NA&gt;
## 2                                                                                       &lt;NA&gt;
## 3                                                                                       &lt;NA&gt;
## 4                                                                                       &lt;NA&gt;
## 5                                                                                       &lt;NA&gt;
## 6                                                                                       &lt;NA&gt;
##   extensions.http...rs.tdwg.org.ac.terms.Multimedia.http...rs.tdwg.org.ac.terms.tag.1
## 1                                                                                &lt;NA&gt;
## 2                                                                                &lt;NA&gt;
## 3                                                                                &lt;NA&gt;
## 4                                                                                &lt;NA&gt;
## 5                                                                                &lt;NA&gt;
## 6                                                                                &lt;NA&gt;
##   extensions.http...rs.tdwg.org.ac.terms.Multimedia.http...ns.adobe.com.xap.1.0.rights.Owner.1
## 1                                                                                         &lt;NA&gt;
## 2                                                                                         &lt;NA&gt;
## 3                                                                                         &lt;NA&gt;
## 4                                                                                         &lt;NA&gt;
## 5                                                                                         &lt;NA&gt;
## 6                                                                                         &lt;NA&gt;
##   extensions.http...rs.tdwg.org.ac.terms.Multimedia.http...purl.org.dc.elements.1.1.format.1
## 1                                                                                       &lt;NA&gt;
## 2                                                                                       &lt;NA&gt;
## 3                                                                                       &lt;NA&gt;
## 4                                                                                       &lt;NA&gt;
## 5                                                                                       &lt;NA&gt;
## 6                                                                                       &lt;NA&gt;
##   extensions.http...rs.tdwg.org.ac.terms.Multimedia.http...ns.adobe.com.photoshop.1.0.Credit.1
## 1                                                                                         &lt;NA&gt;
## 2                                                                                         &lt;NA&gt;
## 3                                                                                         &lt;NA&gt;
## 4                                                                                         &lt;NA&gt;
## 5                                                                                         &lt;NA&gt;
## 6                                                                                         &lt;NA&gt;
##   extensions.http...rs.tdwg.org.ac.terms.Multimedia.http...purl.org.dc.elements.1.1.creator.1
## 1                                                                                        &lt;NA&gt;
## 2                                                                                        &lt;NA&gt;
## 3                                                                                        &lt;NA&gt;
## 4                                                                                        &lt;NA&gt;
## 5                                                                                        &lt;NA&gt;
## 6                                                                                        &lt;NA&gt;
##   extensions.http...rs.tdwg.org.ac.terms.Multimedia.http...ns.adobe.com.xap.1.0.CreateDate.1
## 1                                                                                       &lt;NA&gt;
## 2                                                                                       &lt;NA&gt;
## 3                                                                                       &lt;NA&gt;
## 4                                                                                       &lt;NA&gt;
## 5                                                                                       &lt;NA&gt;
## 6                                                                                       &lt;NA&gt;
##   extensions.http...rs.tdwg.org.ac.terms.Multimedia.http...rs.tdwg.org.ac.terms.caption.1
## 1                                                                                    &lt;NA&gt;
## 2                                                                                    &lt;NA&gt;
## 3                                                                                    &lt;NA&gt;
## 4                                                                                    &lt;NA&gt;
## 5                                                                                    &lt;NA&gt;
## 6                                                                                    &lt;NA&gt;
##   extensions.http...rs.tdwg.org.ac.terms.Multimedia.http...purl.org.dc.terms.title.1
## 1                                                                               &lt;NA&gt;
## 2                                                                               &lt;NA&gt;
## 3                                                                               &lt;NA&gt;
## 4                                                                               &lt;NA&gt;
## 5                                                                               &lt;NA&gt;
## 6                                                                               &lt;NA&gt;
##   extensions.http...rs.tdwg.org.ac.terms.Multimedia.http...rs.tdwg.org.ac.terms.accessURI.1
## 1                                                                                      &lt;NA&gt;
## 2                                                                                      &lt;NA&gt;
## 3                                                                                      &lt;NA&gt;
## 4                                                                                      &lt;NA&gt;
## 5                                                                                      &lt;NA&gt;
## 6                                                                                      &lt;NA&gt;
##   extensions.http...rs.tdwg.org.ac.terms.Multimedia.http...purl.org.dc.elements.1.1.source.1
## 1                                                                                       &lt;NA&gt;
## 2                                                                                       &lt;NA&gt;
## 3                                                                                       &lt;NA&gt;
## 4                                                                                       &lt;NA&gt;
## 5                                                                                       &lt;NA&gt;
## 6                                                                                       &lt;NA&gt;
##   extensions.http...rs.tdwg.org.ac.terms.Multimedia.http...purl.org.dc.terms.rights.1
## 1                                                                                &lt;NA&gt;
## 2                                                                                &lt;NA&gt;
## 3                                                                                &lt;NA&gt;
## 4                                                                                &lt;NA&gt;
## 5                                                                                &lt;NA&gt;
## 6                                                                                &lt;NA&gt;
##   extensions.http...rs.tdwg.org.ac.terms.Multimedia.http...purl.org.dc.terms.source.1
## 1                                                                                &lt;NA&gt;
## 2                                                                                &lt;NA&gt;
## 3                                                                                &lt;NA&gt;
## 4                                                                                &lt;NA&gt;
## 5                                                                                &lt;NA&gt;
## 6                                                                                &lt;NA&gt;
##   extensions.http...rs.tdwg.org.ac.terms.Multimedia.http...purl.org.dc.terms.type.1
## 1                                                                              &lt;NA&gt;
## 2                                                                              &lt;NA&gt;
## 3                                                                              &lt;NA&gt;
## 4                                                                              &lt;NA&gt;
## 5                                                                              &lt;NA&gt;
## 6                                                                              &lt;NA&gt;
##   extensions.http...rs.tdwg.org.ac.terms.Multimedia.http...purl.org.dc.terms.format.1
## 1                                                                                &lt;NA&gt;
## 2                                                                                &lt;NA&gt;
## 3                                                                                &lt;NA&gt;
## 4                                                                                &lt;NA&gt;
## 5                                                                                &lt;NA&gt;
## 6                                                                                &lt;NA&gt;
##   informationWithheld
## 1                &lt;NA&gt;
## 2                &lt;NA&gt;
## 3                &lt;NA&gt;
## 4                &lt;NA&gt;
## 5                &lt;NA&gt;
## 6                &lt;NA&gt;
##   extensions.http...rs.tdwg.org.ac.terms.Multimedia.http...purl.org.dc.terms.identifier.2
## 1                                                                                    &lt;NA&gt;
## 2                                                                                    &lt;NA&gt;
## 3                                                                                    &lt;NA&gt;
## 4                                                                                    &lt;NA&gt;
## 5                                                                                    &lt;NA&gt;
## 6                                                                                    &lt;NA&gt;
##   extensions.http...rs.tdwg.org.ac.terms.Multimedia.http...rs.tdwg.org.ac.terms.taxonCoverage.2
## 1                                                                                          &lt;NA&gt;
## 2                                                                                          &lt;NA&gt;
## 3                                                                                          &lt;NA&gt;
## 4                                                                                          &lt;NA&gt;
## 5                                                                                          &lt;NA&gt;
## 6                                                                                          &lt;NA&gt;
##   extensions.http...rs.tdwg.org.ac.terms.Multimedia.http...purl.org.dc.terms.modified.2
## 1                                                                                  &lt;NA&gt;
## 2                                                                                  &lt;NA&gt;
## 3                                                                                  &lt;NA&gt;
## 4                                                                                  &lt;NA&gt;
## 5                                                                                  &lt;NA&gt;
## 6                                                                                  &lt;NA&gt;
##   extensions.http...rs.tdwg.org.ac.terms.Multimedia.http...purl.org.dc.elements.1.1.type.2
## 1                                                                                     &lt;NA&gt;
## 2                                                                                     &lt;NA&gt;
## 3                                                                                     &lt;NA&gt;
## 4                                                                                     &lt;NA&gt;
## 5                                                                                     &lt;NA&gt;
## 6                                                                                     &lt;NA&gt;
##   extensions.http...rs.tdwg.org.ac.terms.Multimedia.http...rs.tdwg.org.ac.terms.subjectPart.2
## 1                                                                                        &lt;NA&gt;
## 2                                                                                        &lt;NA&gt;
## 3                                                                                        &lt;NA&gt;
## 4                                                                                        &lt;NA&gt;
## 5                                                                                        &lt;NA&gt;
## 6                                                                                        &lt;NA&gt;
##   extensions.http...rs.tdwg.org.ac.terms.Multimedia.http...rs.tdwg.org.ac.terms.associatedObservationReference.2
## 1                                                                                                           &lt;NA&gt;
## 2                                                                                                           &lt;NA&gt;
## 3                                                                                                           &lt;NA&gt;
## 4                                                                                                           &lt;NA&gt;
## 5                                                                                                           &lt;NA&gt;
## 6                                                                                                           &lt;NA&gt;
##   extensions.http...rs.tdwg.org.ac.terms.Multimedia.http...ns.adobe.com.xap.1.0.rights.UsageTerms.2
## 1                                                                                              &lt;NA&gt;
## 2                                                                                              &lt;NA&gt;
## 3                                                                                              &lt;NA&gt;
## 4                                                                                              &lt;NA&gt;
## 5                                                                                              &lt;NA&gt;
## 6                                                                                              &lt;NA&gt;
##   extensions.http...rs.tdwg.org.ac.terms.Multimedia.http...rs.tdwg.org.ac.terms.taxonCount.2
## 1                                                                                       &lt;NA&gt;
## 2                                                                                       &lt;NA&gt;
## 3                                                                                       &lt;NA&gt;
## 4                                                                                       &lt;NA&gt;
## 5                                                                                       &lt;NA&gt;
## 6                                                                                       &lt;NA&gt;
##   extensions.http...rs.tdwg.org.ac.terms.Multimedia.http...purl.org.dc.terms.creator.2
## 1                                                                                 &lt;NA&gt;
## 2                                                                                 &lt;NA&gt;
## 3                                                                                 &lt;NA&gt;
## 4                                                                                 &lt;NA&gt;
## 5                                                                                 &lt;NA&gt;
## 6                                                                                 &lt;NA&gt;
##   extensions.http...rs.tdwg.org.ac.terms.Multimedia.http...purl.org.dc.elements.1.1.rights.2
## 1                                                                                       &lt;NA&gt;
## 2                                                                                       &lt;NA&gt;
## 3                                                                                       &lt;NA&gt;
## 4                                                                                       &lt;NA&gt;
## 5                                                                                       &lt;NA&gt;
## 6                                                                                       &lt;NA&gt;
##   extensions.http...rs.tdwg.org.ac.terms.Multimedia.http...rs.tdwg.org.ac.terms.tag.2
## 1                                                                                &lt;NA&gt;
## 2                                                                                &lt;NA&gt;
## 3                                                                                &lt;NA&gt;
## 4                                                                                &lt;NA&gt;
## 5                                                                                &lt;NA&gt;
## 6                                                                                &lt;NA&gt;
##   extensions.http...rs.tdwg.org.ac.terms.Multimedia.http...ns.adobe.com.xap.1.0.rights.Owner.2
## 1                                                                                         &lt;NA&gt;
## 2                                                                                         &lt;NA&gt;
## 3                                                                                         &lt;NA&gt;
## 4                                                                                         &lt;NA&gt;
## 5                                                                                         &lt;NA&gt;
## 6                                                                                         &lt;NA&gt;
##   extensions.http...rs.tdwg.org.ac.terms.Multimedia.http...purl.org.dc.elements.1.1.format.2
## 1                                                                                       &lt;NA&gt;
## 2                                                                                       &lt;NA&gt;
## 3                                                                                       &lt;NA&gt;
## 4                                                                                       &lt;NA&gt;
## 5                                                                                       &lt;NA&gt;
## 6                                                                                       &lt;NA&gt;
##   extensions.http...rs.tdwg.org.ac.terms.Multimedia.http...ns.adobe.com.photoshop.1.0.Credit.2
## 1                                                                                         &lt;NA&gt;
## 2                                                                                         &lt;NA&gt;
## 3                                                                                         &lt;NA&gt;
## 4                                                                                         &lt;NA&gt;
## 5                                                                                         &lt;NA&gt;
## 6                                                                                         &lt;NA&gt;
##   extensions.http...rs.tdwg.org.ac.terms.Multimedia.http...purl.org.dc.elements.1.1.creator.2
## 1                                                                                        &lt;NA&gt;
## 2                                                                                        &lt;NA&gt;
## 3                                                                                        &lt;NA&gt;
## 4                                                                                        &lt;NA&gt;
## 5                                                                                        &lt;NA&gt;
## 6                                                                                        &lt;NA&gt;
##   extensions.http...rs.tdwg.org.ac.terms.Multimedia.http...ns.adobe.com.xap.1.0.CreateDate.2
## 1                                                                                       &lt;NA&gt;
## 2                                                                                       &lt;NA&gt;
## 3                                                                                       &lt;NA&gt;
## 4                                                                                       &lt;NA&gt;
## 5                                                                                       &lt;NA&gt;
## 6                                                                                       &lt;NA&gt;
##   extensions.http...rs.tdwg.org.ac.terms.Multimedia.http...rs.tdwg.org.ac.terms.caption.2
## 1                                                                                    &lt;NA&gt;
## 2                                                                                    &lt;NA&gt;
## 3                                                                                    &lt;NA&gt;
## 4                                                                                    &lt;NA&gt;
## 5                                                                                    &lt;NA&gt;
## 6                                                                                    &lt;NA&gt;
##   extensions.http...rs.tdwg.org.ac.terms.Multimedia.http...purl.org.dc.terms.title.2
## 1                                                                               &lt;NA&gt;
## 2                                                                               &lt;NA&gt;
## 3                                                                               &lt;NA&gt;
## 4                                                                               &lt;NA&gt;
## 5                                                                               &lt;NA&gt;
## 6                                                                               &lt;NA&gt;
##   extensions.http...rs.tdwg.org.ac.terms.Multimedia.http...rs.tdwg.org.ac.terms.accessURI.2
## 1                                                                                      &lt;NA&gt;
## 2                                                                                      &lt;NA&gt;
## 3                                                                                      &lt;NA&gt;
## 4                                                                                      &lt;NA&gt;
## 5                                                                                      &lt;NA&gt;
## 6                                                                                      &lt;NA&gt;
##   extensions.http...rs.tdwg.org.ac.terms.Multimedia.http...purl.org.dc.elements.1.1.source.2
## 1                                                                                       &lt;NA&gt;
## 2                                                                                       &lt;NA&gt;
## 3                                                                                       &lt;NA&gt;
## 4                                                                                       &lt;NA&gt;
## 5                                                                                       &lt;NA&gt;
## 6                                                                                       &lt;NA&gt;
##   extensions.http...rs.tdwg.org.ac.terms.Multimedia.http...purl.org.dc.terms.rights.2
## 1                                                                                &lt;NA&gt;
## 2                                                                                &lt;NA&gt;
## 3                                                                                &lt;NA&gt;
## 4                                                                                &lt;NA&gt;
## 5                                                                                &lt;NA&gt;
## 6                                                                                &lt;NA&gt;
##   extensions.http...rs.tdwg.org.ac.terms.Multimedia.http...purl.org.dc.terms.source.2
## 1                                                                                &lt;NA&gt;
## 2                                                                                &lt;NA&gt;
## 3                                                                                &lt;NA&gt;
## 4                                                                                &lt;NA&gt;
## 5                                                                                &lt;NA&gt;
## 6                                                                                &lt;NA&gt;
##   extensions.http...rs.tdwg.org.ac.terms.Multimedia.http...purl.org.dc.terms.type.2
## 1                                                                              &lt;NA&gt;
## 2                                                                              &lt;NA&gt;
## 3                                                                              &lt;NA&gt;
## 4                                                                              &lt;NA&gt;
## 5                                                                              &lt;NA&gt;
## 6                                                                              &lt;NA&gt;
##   extensions.http...rs.tdwg.org.ac.terms.Multimedia.http...purl.org.dc.terms.format.2
## 1                                                                                &lt;NA&gt;
## 2                                                                                &lt;NA&gt;
## 3                                                                                &lt;NA&gt;
## 4                                                                                &lt;NA&gt;
## 5                                                                                &lt;NA&gt;
## 6                                                                                &lt;NA&gt;
##   extensions.http...rs.tdwg.org.ac.terms.Multimedia.http...rs.tdwg.org.ac.terms.variantLiteral
## 1                                                                                         &lt;NA&gt;
## 2                                                                                         &lt;NA&gt;
## 3                                                                                         &lt;NA&gt;
## 4                                                                                         &lt;NA&gt;
## 5                                                                                         &lt;NA&gt;
## 6                                                                                         &lt;NA&gt;
##   lifeStage continent vernacularName locality samplingProtocol
## 1      &lt;NA&gt;      &lt;NA&gt;           &lt;NA&gt;     &lt;NA&gt;             &lt;NA&gt;
## 2      &lt;NA&gt;      &lt;NA&gt;           &lt;NA&gt;     &lt;NA&gt;             &lt;NA&gt;
## 3      &lt;NA&gt;      &lt;NA&gt;           &lt;NA&gt;     &lt;NA&gt;             &lt;NA&gt;
## 4      &lt;NA&gt;      &lt;NA&gt;           &lt;NA&gt;     &lt;NA&gt;             &lt;NA&gt;
## 5      &lt;NA&gt;      &lt;NA&gt;           &lt;NA&gt;     &lt;NA&gt;             &lt;NA&gt;
## 6      &lt;NA&gt;      &lt;NA&gt;           &lt;NA&gt;     &lt;NA&gt;             &lt;NA&gt;
##   higherClassification footprintWKT ownerInstitutionCode verbatimElevation
## 1                 &lt;NA&gt;         &lt;NA&gt;                 &lt;NA&gt;              &lt;NA&gt;
## 2                 &lt;NA&gt;         &lt;NA&gt;                 &lt;NA&gt;              &lt;NA&gt;
## 3                 &lt;NA&gt;         &lt;NA&gt;                 &lt;NA&gt;              &lt;NA&gt;
## 4                 &lt;NA&gt;         &lt;NA&gt;                 &lt;NA&gt;              &lt;NA&gt;
## 5                 &lt;NA&gt;         &lt;NA&gt;                 &lt;NA&gt;              &lt;NA&gt;
## 6                 &lt;NA&gt;         &lt;NA&gt;                 &lt;NA&gt;              &lt;NA&gt;
##   recordNumber associatedReferences
## 1         &lt;NA&gt;                 &lt;NA&gt;
## 2         &lt;NA&gt;                 &lt;NA&gt;
## 3         &lt;NA&gt;                 &lt;NA&gt;
## 4         &lt;NA&gt;                 &lt;NA&gt;
## 5         &lt;NA&gt;                 &lt;NA&gt;
## 6         &lt;NA&gt;                 &lt;NA&gt;
##   extensions.http...rs.tdwg.org.ac.terms.Multimedia.http...rs.tdwg.org.ac.terms.variantLiteral.1
## 1                                                                                           &lt;NA&gt;
## 2                                                                                           &lt;NA&gt;
## 3                                                                                           &lt;NA&gt;
## 4                                                                                           &lt;NA&gt;
## 5                                                                                           &lt;NA&gt;
## 6                                                                                           &lt;NA&gt;
##   extensions.http...rs.tdwg.org.ac.terms.Multimedia.http...rs.tdwg.org.ac.terms.variantLiteral.2
## 1                                                                                           &lt;NA&gt;
## 2                                                                                           &lt;NA&gt;
## 3                                                                                           &lt;NA&gt;
## 4                                                                                           &lt;NA&gt;
## 5                                                                                           &lt;NA&gt;
## 6                                                                                           &lt;NA&gt;
##   extensions.http...rs.tdwg.org.ac.terms.Multimedia.http...purl.org.dc.terms.identifier.3
## 1                                                                                    &lt;NA&gt;
## 2                                                                                    &lt;NA&gt;
## 3                                                                                    &lt;NA&gt;
## 4                                                                                    &lt;NA&gt;
## 5                                                                                    &lt;NA&gt;
## 6                                                                                    &lt;NA&gt;
##   extensions.http...rs.tdwg.org.ac.terms.Multimedia.http...ns.adobe.com.xap.1.0.rights.Owner.3
## 1                                                                                         &lt;NA&gt;
## 2                                                                                         &lt;NA&gt;
## 3                                                                                         &lt;NA&gt;
## 4                                                                                         &lt;NA&gt;
## 5                                                                                         &lt;NA&gt;
## 6                                                                                         &lt;NA&gt;
##   extensions.http...rs.tdwg.org.ac.terms.Multimedia.http...purl.org.dc.terms.rights.3
## 1                                                                                &lt;NA&gt;
## 2                                                                                &lt;NA&gt;
## 3                                                                                &lt;NA&gt;
## 4                                                                                &lt;NA&gt;
## 5                                                                                &lt;NA&gt;
## 6                                                                                &lt;NA&gt;
##   extensions.http...rs.tdwg.org.ac.terms.Multimedia.http...purl.org.dc.elements.1.1.type.3
## 1                                                                                     &lt;NA&gt;
## 2                                                                                     &lt;NA&gt;
## 3                                                                                     &lt;NA&gt;
## 4                                                                                     &lt;NA&gt;
## 5                                                                                     &lt;NA&gt;
## 6                                                                                     &lt;NA&gt;
##   extensions.http...rs.tdwg.org.ac.terms.Multimedia.http...purl.org.dc.elements.1.1.creator.3
## 1                                                                                        &lt;NA&gt;
## 2                                                                                        &lt;NA&gt;
## 3                                                                                        &lt;NA&gt;
## 4                                                                                        &lt;NA&gt;
## 5                                                                                        &lt;NA&gt;
## 6                                                                                        &lt;NA&gt;
##   extensions.http...rs.tdwg.org.ac.terms.Multimedia.http...purl.org.dc.terms.format.3
## 1                                                                                &lt;NA&gt;
## 2                                                                                &lt;NA&gt;
## 3                                                                                &lt;NA&gt;
## 4                                                                                &lt;NA&gt;
## 5                                                                                &lt;NA&gt;
## 6                                                                                &lt;NA&gt;
##   extensions.http...rs.tdwg.org.ac.terms.Multimedia.http...rs.tdwg.org.ac.terms.variantLiteral.3
## 1                                                                                           &lt;NA&gt;
## 2                                                                                           &lt;NA&gt;
## 3                                                                                           &lt;NA&gt;
## 4                                                                                           &lt;NA&gt;
## 5                                                                                           &lt;NA&gt;
## 6                                                                                           &lt;NA&gt;
##   extensions.http...rs.tdwg.org.ac.terms.Multimedia.http...rs.tdwg.org.ac.terms.accessURI.3
## 1                                                                                      &lt;NA&gt;
## 2                                                                                      &lt;NA&gt;
## 3                                                                                      &lt;NA&gt;
## 4                                                                                      &lt;NA&gt;
## 5                                                                                      &lt;NA&gt;
## 6                                                                                      &lt;NA&gt;
##   extensions.http...rs.tdwg.org.ac.terms.Multimedia.http...purl.org.dc.terms.identifier.4
## 1                                                                                    &lt;NA&gt;
## 2                                                                                    &lt;NA&gt;
## 3                                                                                    &lt;NA&gt;
## 4                                                                                    &lt;NA&gt;
## 5                                                                                    &lt;NA&gt;
## 6                                                                                    &lt;NA&gt;
##   extensions.http...rs.tdwg.org.ac.terms.Multimedia.http...ns.adobe.com.xap.1.0.rights.Owner.4
## 1                                                                                         &lt;NA&gt;
## 2                                                                                         &lt;NA&gt;
## 3                                                                                         &lt;NA&gt;
## 4                                                                                         &lt;NA&gt;
## 5                                                                                         &lt;NA&gt;
## 6                                                                                         &lt;NA&gt;
##   extensions.http...rs.tdwg.org.ac.terms.Multimedia.http...purl.org.dc.terms.rights.4
## 1                                                                                &lt;NA&gt;
## 2                                                                                &lt;NA&gt;
## 3                                                                                &lt;NA&gt;
## 4                                                                                &lt;NA&gt;
## 5                                                                                &lt;NA&gt;
## 6                                                                                &lt;NA&gt;
##   extensions.http...rs.tdwg.org.ac.terms.Multimedia.http...purl.org.dc.elements.1.1.type.4
## 1                                                                                     &lt;NA&gt;
## 2                                                                                     &lt;NA&gt;
## 3                                                                                     &lt;NA&gt;
## 4                                                                                     &lt;NA&gt;
## 5                                                                                     &lt;NA&gt;
## 6                                                                                     &lt;NA&gt;
##   extensions.http...rs.tdwg.org.ac.terms.Multimedia.http...purl.org.dc.elements.1.1.creator.4
## 1                                                                                        &lt;NA&gt;
## 2                                                                                        &lt;NA&gt;
## 3                                                                                        &lt;NA&gt;
## 4                                                                                        &lt;NA&gt;
## 5                                                                                        &lt;NA&gt;
## 6                                                                                        &lt;NA&gt;
##   extensions.http...rs.tdwg.org.ac.terms.Multimedia.http...purl.org.dc.terms.format.4
## 1                                                                                &lt;NA&gt;
## 2                                                                                &lt;NA&gt;
## 3                                                                                &lt;NA&gt;
## 4                                                                                &lt;NA&gt;
## 5                                                                                &lt;NA&gt;
## 6                                                                                &lt;NA&gt;
##   extensions.http...rs.tdwg.org.ac.terms.Multimedia.http...rs.tdwg.org.ac.terms.variantLiteral.4
## 1                                                                                           &lt;NA&gt;
## 2                                                                                           &lt;NA&gt;
## 3                                                                                           &lt;NA&gt;
## 4                                                                                           &lt;NA&gt;
## 5                                                                                           &lt;NA&gt;
## 6                                                                                           &lt;NA&gt;
##   extensions.http...rs.tdwg.org.ac.terms.Multimedia.http...rs.tdwg.org.ac.terms.accessURI.4
## 1                                                                                      &lt;NA&gt;
## 2                                                                                      &lt;NA&gt;
## 3                                                                                      &lt;NA&gt;
## 4                                                                                      &lt;NA&gt;
## 5                                                                                      &lt;NA&gt;
## 6                                                                                      &lt;NA&gt;
##   institutionKey institutionID county verbatimCoordinateSystem
## 1           &lt;NA&gt;          &lt;NA&gt;   &lt;NA&gt;                     &lt;NA&gt;
## 2           &lt;NA&gt;          &lt;NA&gt;   &lt;NA&gt;                     &lt;NA&gt;
## 3           &lt;NA&gt;          &lt;NA&gt;   &lt;NA&gt;                     &lt;NA&gt;
## 4           &lt;NA&gt;          &lt;NA&gt;   &lt;NA&gt;                     &lt;NA&gt;
## 5           &lt;NA&gt;          &lt;NA&gt;   &lt;NA&gt;                     &lt;NA&gt;
## 6           &lt;NA&gt;          &lt;NA&gt;   &lt;NA&gt;                     &lt;NA&gt;</code></pre>
<p>Let’s have a quick look at the orders of the species in the polygon around our tower.</p>
<div class="sourceCode" id="cb144"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb144-1"><a href="data-variety.html#cb144-1"></a><span class="co"># first we make the maine plot of the points coloured by order with the buffer polygon around them</span></span>
<span id="cb144-2"><a href="data-variety.html#cb144-2"></a>plot_sp_occ &lt;-<span class="st"> </span><span class="kw">ggplot</span>()<span class="op">+</span></span>
<span id="cb144-3"><a href="data-variety.html#cb144-3"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">data=</span>occ_CHlae, <span class="kw">aes</span>(<span class="dt">x=</span>decimalLongitude, <span class="dt">y=</span>decimalLatitude, <span class="dt">color=</span>order))<span class="op">+</span></span>
<span id="cb144-4"><a href="data-variety.html#cb144-4"></a><span class="st">  </span><span class="kw">geom_polygon</span>(<span class="dt">data=</span>tower.polygon, </span>
<span id="cb144-5"><a href="data-variety.html#cb144-5"></a>               <span class="kw">aes</span>(<span class="dt">x=</span>tower.polygon<span class="op">@</span>polygons[[<span class="dv">1</span>]]<span class="op">@</span>Polygons[[<span class="dv">1</span>]]<span class="op">@</span>coords[,<span class="dv">1</span>], <span class="dt">y=</span>tower.polygon<span class="op">@</span>polygons[[<span class="dv">1</span>]]<span class="op">@</span>Polygons[[<span class="dv">1</span>]]<span class="op">@</span>coords[,<span class="dv">2</span>]), <span class="dt">fill =</span> <span class="ot">NA</span>, <span class="dt">colour =</span> <span class="st">&quot;black&quot;</span>)<span class="op">+</span></span>
<span id="cb144-6"><a href="data-variety.html#cb144-6"></a><span class="st">  </span><span class="kw">theme_classic</span>() <span class="op">+</span><span class="st"> </span></span>
<span id="cb144-7"><a href="data-variety.html#cb144-7"></a><span class="st">  </span><span class="kw">xlab</span>(<span class="st">&quot;Longitude&quot;</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb144-8"><a href="data-variety.html#cb144-8"></a><span class="st">  </span><span class="kw">ylab</span>(<span class="st">&quot;Latitude&quot;</span>) <span class="op">+</span></span>
<span id="cb144-9"><a href="data-variety.html#cb144-9"></a><span class="st">  </span><span class="kw">theme</span>(<span class="dt">legend.position =</span> <span class="st">&quot;none&quot;</span>)</span>
<span id="cb144-10"><a href="data-variety.html#cb144-10"></a></span>
<span id="cb144-11"><a href="data-variety.html#cb144-11"></a><span class="co"># then we add the CH-Lae tower in the middle in red</span></span>
<span id="cb144-12"><a href="data-variety.html#cb144-12"></a>plot_sp_occ <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">x=</span>lon_lae, <span class="dt">y=</span>lat_lae, <span class="dt">fill=</span><span class="st">&quot;#FC717F&quot;</span>), <span class="dt">size=</span><span class="dv">5</span>, <span class="dt">colour=</span><span class="st">&quot;black&quot;</span>, <span class="dt">shape=</span><span class="dv">21</span>, <span class="dt">stroke=</span><span class="dv">1</span>)</span></code></pre></div>
<p><img src="esds_book_files/figure-html/unnamed-chunk-74-1.png" width="672" /></p>
<p>To make a species list and calculate the species richness for that tower we simply extract the unique species</p>
<div class="sourceCode" id="cb145"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb145-1"><a href="data-variety.html#cb145-1"></a>sp.list &lt;-<span class="st"> </span><span class="kw">unique</span>(occ_CHlae<span class="op">$</span>scientificName)</span>
<span id="cb145-2"><a href="data-variety.html#cb145-2"></a><span class="kw">length</span>(<span class="kw">unique</span>(occ_CHlae<span class="op">$</span>scientificName))</span></code></pre></div>
<pre><code>## [1] 1254</code></pre>
<p>Normally at this point a species name filtration step would be done. That means the plant names from our species list would be compared to that of ‘The Plant List’ (TPL) using the package <code>Taxonstand</code>.
This is quite time consuming, so we have already done it for the species lists of each tower.
Below is the example code:</p>
<div class="sourceCode" id="cb147"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb147-1"><a href="data-variety.html#cb147-1"></a><span class="co"># We retrieve name from taxonstand. To specify how much difference in the names we want to allow we specify diffchar=.</span></span>
<span id="cb147-2"><a href="data-variety.html#cb147-2"></a><span class="kw">library</span>(Taxonstand)</span>
<span id="cb147-3"><a href="data-variety.html#cb147-3"></a>name &lt;-<span class="st"> </span><span class="kw">TPL</span>(sp.list.final, <span class="dt">diffchar =</span> <span class="dv">4</span>, <span class="dt">drop.lower.level =</span> T)</span>
<span id="cb147-4"><a href="data-variety.html#cb147-4"></a></span>
<span id="cb147-5"><a href="data-variety.html#cb147-5"></a><span class="co"># select columns of interest</span></span>
<span id="cb147-6"><a href="data-variety.html#cb147-6"></a>name &lt;-<span class="st"> </span>name[, <span class="kw">c</span>(<span class="st">&quot;Taxon&quot;</span>, <span class="st">&quot;New.Genus&quot;</span>, <span class="st">&quot;New.Species&quot;</span>, <span class="st">&quot;New.Taxonomic.status&quot;</span>, <span class="st">&quot;Typo&quot;</span>)]</span>
<span id="cb147-7"><a href="data-variety.html#cb147-7"></a></span>
<span id="cb147-8"><a href="data-variety.html#cb147-8"></a><span class="co"># create column with new species name</span></span>
<span id="cb147-9"><a href="data-variety.html#cb147-9"></a>name<span class="op">$</span>autocorrected &lt;-<span class="st"> </span><span class="kw">paste</span>(name<span class="op">$</span>New.Genus, name<span class="op">$</span>New.Species)</span>
<span id="cb147-10"><a href="data-variety.html#cb147-10"></a></span>
<span id="cb147-11"><a href="data-variety.html#cb147-11"></a><span class="co"># drop new.species and new.genus column</span></span>
<span id="cb147-12"><a href="data-variety.html#cb147-12"></a>name &lt;-<span class="st"> </span>name[, <span class="kw">c</span>(<span class="st">&quot;Taxon&quot;</span>, <span class="st">&quot;autocorrected&quot;</span>, <span class="st">&quot;New.Taxonomic.status&quot;</span>, <span class="st">&quot;Typo&quot;</span>)]</span>
<span id="cb147-13"><a href="data-variety.html#cb147-13"></a></span>
<span id="cb147-14"><a href="data-variety.html#cb147-14"></a><span class="co"># change column names</span></span>
<span id="cb147-15"><a href="data-variety.html#cb147-15"></a><span class="kw">colnames</span>(name) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;submittedname&quot;</span>, <span class="st">&quot;autocorrected&quot;</span>, <span class="st">&quot;taxo_status&quot;</span>, <span class="st">&quot;typo&quot;</span>)</span>
<span id="cb147-16"><a href="data-variety.html#cb147-16"></a></span>
<span id="cb147-17"><a href="data-variety.html#cb147-17"></a><span class="co"># Finally, we can drop all species for which we did not find a matching scientific name.</span></span>
<span id="cb147-18"><a href="data-variety.html#cb147-18"></a>names.accepted &lt;-<span class="st"> </span><span class="kw">unique</span>(name[name<span class="op">$</span>taxo_status<span class="op">==</span><span class="st">&quot;Accepted&quot;</span>,])</span></code></pre></div>
<div class="sourceCode" id="cb148"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb148-1"><a href="data-variety.html#cb148-1"></a><span class="co"># read in the resolved species names .csv</span></span>
<span id="cb148-2"><a href="data-variety.html#cb148-2"></a>species_list_full &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;./data/resolved_species_names.csv&quot;</span>,<span class="dt">sep=</span><span class="st">&quot;;&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb149"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb149-1"><a href="data-variety.html#cb149-1"></a><span class="co"># check how many species are in the list</span></span>
<span id="cb149-2"><a href="data-variety.html#cb149-2"></a><span class="kw">dim</span>(species_list_full)</span></code></pre></div>
<pre><code>## [1] 7480    1</code></pre>
<p>Next, we can use this information to build a presence-absence matrix for all locations and species, this will allow us to see where each species is found. This can be the basis for many community ecology calculations or species distribution models linking the environmental variables to species’ occurrences to see which are most correlated with certain factors.</p>
<div class="sourceCode" id="cb151"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb151-1"><a href="data-variety.html#cb151-1"></a><span class="co"># select all files with resolved in their name</span></span>
<span id="cb151-2"><a href="data-variety.html#cb151-2"></a>paths &lt;-<span class="st"> </span><span class="kw">list.files</span>(<span class="kw">file.path</span>(<span class="st">&quot;./data/&quot;</span>, <span class="st">&quot;species_occurrences&quot;</span>), <span class="dt">pattern=</span><span class="st">&#39;resolved_*&#39;</span>, <span class="dt">recursive =</span> F, <span class="dt">full.names =</span> T)</span>
<span id="cb151-3"><a href="data-variety.html#cb151-3"></a></span>
<span id="cb151-4"><a href="data-variety.html#cb151-4"></a><span class="co"># create a function to read them all in</span></span>
<span id="cb151-5"><a href="data-variety.html#cb151-5"></a>read_species =<span class="st"> </span><span class="cf">function</span>(file_path){</span>
<span id="cb151-6"><a href="data-variety.html#cb151-6"></a>  <span class="kw">return</span>(<span class="kw">read.csv</span>(file_path,<span class="dt">sep=</span><span class="st">&quot;;&quot;</span>))</span>
<span id="cb151-7"><a href="data-variety.html#cb151-7"></a>}</span>
<span id="cb151-8"><a href="data-variety.html#cb151-8"></a></span>
<span id="cb151-9"><a href="data-variety.html#cb151-9"></a><span class="co"># read all the files in paths in using the function read_species</span></span>
<span id="cb151-10"><a href="data-variety.html#cb151-10"></a>species_occurrences &lt;-<span class="st"> </span><span class="kw">lapply</span>(paths, read_species)</span>
<span id="cb151-11"><a href="data-variety.html#cb151-11"></a></span>
<span id="cb151-12"><a href="data-variety.html#cb151-12"></a><span class="co"># bind them into a df and give an identifier with .id=</span></span>
<span id="cb151-13"><a href="data-variety.html#cb151-13"></a>species_occ_df &lt;-<span class="st"> </span><span class="kw">bind_rows</span>(species_occurrences, <span class="dt">.id=</span><span class="st">&quot;id&quot;</span>)</span>
<span id="cb151-14"><a href="data-variety.html#cb151-14"></a></span>
<span id="cb151-15"><a href="data-variety.html#cb151-15"></a><span class="co"># make a species occurrence (or presence-absence) matrix</span></span>
<span id="cb151-16"><a href="data-variety.html#cb151-16"></a>species_occ_mat &lt;-<span class="st"> </span>species_occ_df <span class="op">%&gt;%</span></span>
<span id="cb151-17"><a href="data-variety.html#cb151-17"></a><span class="st">  </span><span class="kw">group_by</span>(id)<span class="op">%&gt;%</span><span class="st">                                                                     </span><span class="co"># group the species lists by the sites</span></span>
<span id="cb151-18"><a href="data-variety.html#cb151-18"></a><span class="st">  </span><span class="kw">distinct</span>() <span class="op">%&gt;%</span><span class="st">                                                                      </span><span class="co"># select only unique species names since some occur multiple times</span></span>
<span id="cb151-19"><a href="data-variety.html#cb151-19"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">present =</span> <span class="dv">1</span>) <span class="op">%&gt;%</span><span class="st">                                                             </span><span class="co"># create a column where all the species get a 1 (for presence)</span></span>
<span id="cb151-20"><a href="data-variety.html#cb151-20"></a><span class="st">  </span><span class="kw">pivot_wider</span>(<span class="dt">names_from =</span> names.accepted.autocorrected, <span class="dt">values_from =</span> present) <span class="op">%&gt;%</span><span class="st">   </span><span class="co"># turn (spread) the column of species names to the column names</span></span>
<span id="cb151-21"><a href="data-variety.html#cb151-21"></a><span class="st">  </span><span class="kw">mutate_all</span>(<span class="kw">funs</span>(<span class="kw">ifelse</span>(<span class="kw">is.na</span>(.), <span class="dv">0</span>, .)))                                            <span class="co"># replace the missing values with 0</span></span></code></pre></div>
<div class="sourceCode" id="cb152"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb152-1"><a href="data-variety.html#cb152-1"></a><span class="kw">head</span>(species_occ_mat)</span></code></pre></div>
<pre><code>## # A tibble: 6 x 6,651
## # Groups:   id [6]
##   id    `Hedera helix` `Arum italicum` `Asplenium ruta… `Ceterach offic…
##   &lt;chr&gt;          &lt;dbl&gt;           &lt;dbl&gt;            &lt;dbl&gt;            &lt;dbl&gt;
## 1 1                  1               1                1                1
## 2 2                  1               1                1                1
## 3 3                  1               1                1                1
## 4 4                  1               1                1                1
## 5 5                  1               1                1                1
## 6 6                  1               1                1                1
## # … with 6,646 more variables: `Artemisia vulgaris` &lt;dbl&gt;, `Corylus
## #   avellana` &lt;dbl&gt;, `Teucrium scorodonia` &lt;dbl&gt;, `Glechoma hederacea` &lt;dbl&gt;,
## #   `Alliaria petiolata` &lt;dbl&gt;, `Plantago lanceolata` &lt;dbl&gt;, `Ficaria
## #   verna` &lt;dbl&gt;, `Trifolium pratense` &lt;dbl&gt;, `Erodium cicutarium` &lt;dbl&gt;,
## #   `Urtica dioica` &lt;dbl&gt;, `Achillea millefolium` &lt;dbl&gt;, `Cirsium
## #   vulgare` &lt;dbl&gt;, `Stellaria media` &lt;dbl&gt;, `Betula pendula` &lt;dbl&gt;,
## #   `Symphoricarpos albus` &lt;dbl&gt;, `Equisetum telmateia` &lt;dbl&gt;, `Euphorbia
## #   peplus` &lt;dbl&gt;, `Aphanes arvensis` &lt;dbl&gt;, `Geranium robertianum` &lt;dbl&gt;,
## #   `Clematis vitalba` &lt;dbl&gt;, `Lamium purpureum` &lt;dbl&gt;, `Lamium album` &lt;dbl&gt;,
## #   `Bellis perennis` &lt;dbl&gt;, `Geum urbanum` &lt;dbl&gt;, `Juncus effusus` &lt;dbl&gt;,
## #   `Chelidonium majus` &lt;dbl&gt;, `Ilex aquifolium` &lt;dbl&gt;, `Daucus carota` &lt;dbl&gt;,
## #   `Lonicera ligustrina` &lt;dbl&gt;, `Senecio vulgaris` &lt;dbl&gt;, `Oxalis
## #   pes-caprae` &lt;dbl&gt;, `Asplenium scolopendrium` &lt;dbl&gt;, `Galium aparine` &lt;dbl&gt;,
## #   `Ranunculus repens` &lt;dbl&gt;, `Calluna vulgaris` &lt;dbl&gt;, `Solanum
## #   dulcamara` &lt;dbl&gt;, `Carex pendula` &lt;dbl&gt;, `Cerastium glomeratum` &lt;dbl&gt;,
## #   `Dipsacus pilosus` &lt;dbl&gt;, `Buddleja davidii` &lt;dbl&gt;, `Pseudosasa
## #   japonica` &lt;dbl&gt;, `Epipactis helleborine` &lt;dbl&gt;, `Lunaria annua` &lt;dbl&gt;,
## #   `Dryopteris carthusiana` &lt;dbl&gt;, `Senecio inaequidens` &lt;dbl&gt;, `Eranthis
## #   hyemalis` &lt;dbl&gt;, `Aesculus hippocastanum` &lt;dbl&gt;, `Geranium molle` &lt;dbl&gt;,
## #   `Polypodium vulgare` &lt;dbl&gt;, `Humulus lupulus` &lt;dbl&gt;, `Arum
## #   maculatum` &lt;dbl&gt;, `Alnus glutinosa` &lt;dbl&gt;, `Tanacetum vulgare` &lt;dbl&gt;,
## #   `Verbascum thapsus` &lt;dbl&gt;, `Capsella bursa-pastoris` &lt;dbl&gt;, `Jasminum
## #   nudiflorum` &lt;dbl&gt;, `Galanthus nivalis` &lt;dbl&gt;, `Acer platanoides` &lt;dbl&gt;,
## #   `Crataegus monogyna` &lt;dbl&gt;, `Pinus sylvestris` &lt;dbl&gt;, `Prunus
## #   laurocerasus` &lt;dbl&gt;, `Quercus robur` &lt;dbl&gt;, `Scrophularia nodosa` &lt;dbl&gt;,
## #   `Erophila verna` &lt;dbl&gt;, `Cardamine hirsuta` &lt;dbl&gt;, `Epilobium
## #   angustifolium` &lt;dbl&gt;, `Rumex obtusifolius` &lt;dbl&gt;, `Anthriscus
## #   sylvestris` &lt;dbl&gt;, `Claytonia perfoliata` &lt;dbl&gt;, `Sonchus oleraceus` &lt;dbl&gt;,
## #   `Cirsium arvense` &lt;dbl&gt;, `Borago officinalis` &lt;dbl&gt;, `Poa annua` &lt;dbl&gt;,
## #   `Alnus rubra` &lt;dbl&gt;, `Viburnum tinus` &lt;dbl&gt;, `Phragmites australis` &lt;dbl&gt;,
## #   `Larix decidua` &lt;dbl&gt;, `Veronica beccabunga` &lt;dbl&gt;, `Lepidium
## #   virginicum` &lt;dbl&gt;, `Mercurialis annua` &lt;dbl&gt;, `Euphorbia
## #   helioscopia` &lt;dbl&gt;, `Cytisus scoparius` &lt;dbl&gt;, `Tripleurospermum
## #   inodorum` &lt;dbl&gt;, `Castanea sativa` &lt;dbl&gt;, `Veronica persica` &lt;dbl&gt;, `Rumex
## #   acetosa` &lt;dbl&gt;, `Sambucus nigra` &lt;dbl&gt;, `Phacelia tanacetifolia` &lt;dbl&gt;,
## #   `Veronica hederifolia` &lt;dbl&gt;, `Taxus baccata` &lt;dbl&gt;, `Silene dioica` &lt;dbl&gt;,
## #   `Asplenium trichomanes` &lt;dbl&gt;, `Oenothera biennis` &lt;dbl&gt;, `Fraxinus
## #   excelsior` &lt;dbl&gt;, `Chenopodium album` &lt;dbl&gt;, `Aucuba japonica` &lt;dbl&gt;,
## #   `Euonymus europaeus` &lt;dbl&gt;, `Taraxacum campylodes` &lt;dbl&gt;, `Solidago
## #   gigantea` &lt;dbl&gt;, `Rhododendron ponticum` &lt;dbl&gt;, …</code></pre>
<p>GBIF is a great source for species occurrences. However, we have to keep in mind that the data collection is biased by regions. For example, we find much fewer plant records in Africa than in Europe. But also within Europe, there are some biases. Therefore we need to be careful with the interpretation.</p>
<div class="sourceCode" id="cb154"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb154-1"><a href="data-variety.html#cb154-1"></a>nr_occurrences &lt;-<span class="st"> </span><span class="kw">read_csv</span>(<span class="st">&quot;./data/flx_tower_occurrences.csv&quot;</span>)</span>
<span id="cb154-2"><a href="data-variety.html#cb154-2"></a></span>
<span id="cb154-3"><a href="data-variety.html#cb154-3"></a>occurrences &lt;-<span class="st"> </span>nr_occurrences<span class="op">$</span>nr_occurrences</span></code></pre></div>
<div class="sourceCode" id="cb155"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb155-1"><a href="data-variety.html#cb155-1"></a><span class="kw">ggplot</span>() <span class="op">+</span></span>
<span id="cb155-2"><a href="data-variety.html#cb155-2"></a><span class="st">  </span><span class="kw">geom_polygon</span>(<span class="dt">data =</span> europe_shape,</span>
<span id="cb155-3"><a href="data-variety.html#cb155-3"></a>               <span class="kw">aes</span>(<span class="dt">x =</span> long, <span class="dt">y =</span> lat, <span class="dt">group =</span> group), <span class="dt">fill =</span> <span class="ot">NA</span>, <span class="dt">colour =</span> <span class="st">&quot;black&quot;</span>) <span class="op">+</span></span>
<span id="cb155-4"><a href="data-variety.html#cb155-4"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">colour =</span> occurrences, <span class="dt">x =</span> df_sites<span class="op">$</span>lon,</span>
<span id="cb155-5"><a href="data-variety.html#cb155-5"></a>                              <span class="dt">y =</span> df_sites<span class="op">$</span>lat)) <span class="op">+</span></span>
<span id="cb155-6"><a href="data-variety.html#cb155-6"></a><span class="st">  </span><span class="kw">scale_colour_gradient</span>(<span class="dt">low =</span> <span class="st">&quot;yellow&quot;</span>, <span class="dt">high =</span> <span class="st">&quot;red&quot;</span>, <span class="dt">na.value =</span> <span class="ot">NA</span>) <span class="op">+</span></span>
<span id="cb155-7"><a href="data-variety.html#cb155-7"></a><span class="st">  </span><span class="kw">theme_classic</span>() <span class="op">+</span><span class="st"> </span><span class="kw">xlab</span>(<span class="st">&quot;Longitude&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">ylab</span>(<span class="st">&quot;Latitude&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">coord_quickmap</span>()</span></code></pre></div>
<p><img src="esds_book_files/figure-html/unnamed-chunk-83-1.png" width="672" /></p>
<p>We see that the numbers of occurrence records in southern Europe are lower than in central Europe. This suggests there is a sampling bias, with a higher sampling effort in central European countries.</p>
<p>Knowing the species richness of the different sites can help us learn more about the ecological context the towers are located in. We made the occurrence matrix above and now we’ll use that to plot the richness. The richness is the number of species at each site. Since each row in the matrix is a site we can just sum the rows and we’ll get the number of species per site. We don’t have data for all our towers in <em>df_sites</em> so we will make a new dataframe with only the relevant sites and call it <em>df_sp_sites</em>.</p>
<div class="sourceCode" id="cb156"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb156-1"><a href="data-variety.html#cb156-1"></a><span class="co"># remove the sites for which we have no species lists</span></span>
<span id="cb156-2"><a href="data-variety.html#cb156-2"></a>df_sp_sites &lt;-<span class="st"> </span>df_sites <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb156-3"><a href="data-variety.html#cb156-3"></a><span class="st">  </span><span class="kw">filter</span>(<span class="op">!</span>(site <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;CH-Oe1&quot;</span>, <span class="st">&quot;DE-Obe&quot;</span>, <span class="st">&quot;FR-LBr&quot;</span>, <span class="st">&quot;IT-Cpz&quot;</span>, <span class="st">&quot;IT-Ro1&quot;</span>)))</span>
<span id="cb156-4"><a href="data-variety.html#cb156-4"></a></span>
<span id="cb156-5"><a href="data-variety.html#cb156-5"></a><span class="co"># the first column is the &#39;id&#39;, so we exclude that</span></span>
<span id="cb156-6"><a href="data-variety.html#cb156-6"></a>richness &lt;-<span class="st"> </span><span class="kw">rowSums</span>(species_occ_mat[,<span class="op">-</span><span class="dv">1</span>])</span>
<span id="cb156-7"><a href="data-variety.html#cb156-7"></a></span>
<span id="cb156-8"><a href="data-variety.html#cb156-8"></a><span class="kw">ggplot</span>() <span class="op">+</span></span>
<span id="cb156-9"><a href="data-variety.html#cb156-9"></a><span class="st">  </span><span class="kw">geom_polygon</span>(<span class="dt">data =</span> europe_shape,</span>
<span id="cb156-10"><a href="data-variety.html#cb156-10"></a>               <span class="kw">aes</span>(<span class="dt">x =</span> long, <span class="dt">y =</span> lat, <span class="dt">group =</span> group), <span class="dt">fill =</span> <span class="ot">NA</span>, <span class="dt">colour =</span> <span class="st">&quot;black&quot;</span>) <span class="op">+</span></span>
<span id="cb156-11"><a href="data-variety.html#cb156-11"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">colour =</span> richness, <span class="dt">x =</span> df_sp_sites<span class="op">$</span>lon,</span>
<span id="cb156-12"><a href="data-variety.html#cb156-12"></a>                              <span class="dt">y =</span> df_sp_sites<span class="op">$</span>lat)) <span class="op">+</span></span>
<span id="cb156-13"><a href="data-variety.html#cb156-13"></a><span class="st">  </span><span class="kw">scale_colour_gradient</span>(<span class="dt">low =</span> <span class="st">&quot;yellow&quot;</span>, <span class="dt">high =</span> <span class="st">&quot;red&quot;</span>, <span class="dt">na.value =</span> <span class="ot">NA</span>) <span class="op">+</span></span>
<span id="cb156-14"><a href="data-variety.html#cb156-14"></a><span class="st">  </span><span class="kw">theme_classic</span>() <span class="op">+</span><span class="st"> </span><span class="kw">xlab</span>(<span class="st">&quot;Longitude&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">ylab</span>(<span class="st">&quot;Latitude&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">coord_quickmap</span>()</span></code></pre></div>
<p><img src="esds_book_files/figure-html/unnamed-chunk-84-1.png" width="672" /></p>
</div>
<div id="species-traits" class="section level4">
<h4><span class="header-section-number">4.2.7.1</span> Species Traits</h4>
<p>In the next step, we will study the relationship between plant traits, GPP, and climatic variables for our fluxnet towers. We obtained data from the TRY database, which is a database containing plant trait data. You can make data requests on <a href="www.https://www.try-db.org">their website</a>. You can select the traits that you are interested in and the species for which you would like to look at the traits.
For this tutorial we already requested a dataset, because usually, it takes time to receive the data. We downloaded data on 9 different traits for all species available. We extracted the trait data for all the species we have in our species list (and therefore also in our species occurrence matrix).</p>
<p>Let’s load the data.</p>
<div class="sourceCode" id="cb157"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb157-1"><a href="data-variety.html#cb157-1"></a>trait_df &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;./data/Trait_df.csv&quot;</span>)</span>
<span id="cb157-2"><a href="data-variety.html#cb157-2"></a><span class="kw">head</span>(trait_df)</span></code></pre></div>
<pre><code>##   X.1 X         SpeciesName
## 1   1 1      Acer campestre
## 2   2 2      Acer campestre
## 3   3 3 Acer pseudoplatanus
## 4   4 4 Acer pseudoplatanus
## 5   5 5     Alnus glutinosa
## 6   6 6     Alnus glutinosa
##                                                   TraitName TraitID
## 1                                            Leaf thickness      46
## 2 Leaf texture (sclerophylly, physical strength, toughness)       2
## 3                                            Leaf thickness      46
## 4 Leaf texture (sclerophylly, physical strength, toughness)       2
## 5                                            Leaf thickness      46
## 6 Leaf texture (sclerophylly, physical strength, toughness)       2
##   OrigValueStr OrigUnitStr OrigUncertaintyStr UncertaintyName
## 1   0.14400000          mm         0.00400000  Standard Error
## 2   0.04511078   (N/10)/mm         0.01426528  Standard Error
## 3   0.17800000          mm         0.01655295  Standard Error
## 4   0.06038498   (N/10)/mm         0.01909541  Standard Error
## 5   0.13600000          mm         0.00509902  Standard Error
## 6   0.06667092   (N/10)/mm         0.02108320  Standard Error</code></pre>
<p>Some examples of traits are are leaf texture, leaf thickness, eaf chlorophyll content per leaf area, specific leaf area, etc.</p>
<p>As a next step, we can combine the species occurrence data with the trait data. The presence/absence matrix (<em>species_occ_mat</em>) we made earlier, gives us the species present at each site. From that we can then extract these species and their respective trait values from the trait dataframe (<em>trait_df</em>). Then we go on to summarise this data by calculating the mean value for each trait across all the species at the tower sites.</p>
<p>We start by doing this for one site.</p>
<div class="sourceCode" id="cb159"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb159-1"><a href="data-variety.html#cb159-1"></a>ba &lt;-<span class="st"> </span>trait_df</span>
<span id="cb159-2"><a href="data-variety.html#cb159-2"></a></span>
<span id="cb159-3"><a href="data-variety.html#cb159-3"></a><span class="co"># select all the species (species names= column names) which are present (so ==1)</span></span>
<span id="cb159-4"><a href="data-variety.html#cb159-4"></a>species_present &lt;-<span class="st"> </span><span class="kw">colnames</span>(species_occ_mat)[<span class="kw">which</span>(species_occ_mat[<span class="dv">1</span>, ] <span class="op">==</span><span class="st"> </span><span class="dv">1</span>)]</span>
<span id="cb159-5"><a href="data-variety.html#cb159-5"></a></span>
<span id="cb159-6"><a href="data-variety.html#cb159-6"></a><span class="co"># filter out the trait data for the species present at that site</span></span>
<span id="cb159-7"><a href="data-variety.html#cb159-7"></a>trait_subset &lt;-<span class="st"> </span>ba[ba<span class="op">$</span>SpeciesName <span class="op">%in%</span><span class="st"> </span>species_present,]</span>
<span id="cb159-8"><a href="data-variety.html#cb159-8"></a></span>
<span id="cb159-9"><a href="data-variety.html#cb159-9"></a><span class="co"># calculate the mean of each trait across all species present</span></span>
<span id="cb159-10"><a href="data-variety.html#cb159-10"></a>bac &lt;-<span class="st"> </span><span class="kw">aggregate</span>(trait_subset<span class="op">$</span>OrigValueStr, <span class="kw">list</span>(trait_subset<span class="op">$</span>TraitID), mean, <span class="dt">na.rm=</span>T)</span></code></pre></div>
<p>To finish preparing the data for the PCA, we do the above steps for all the remaining sites by using a <em>‘for loop’</em>.</p>
<div class="sourceCode" id="cb160"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb160-1"><a href="data-variety.html#cb160-1"></a>df_pca &lt;-<span class="st"> </span>bac<span class="op">$</span>x</span>
<span id="cb160-2"><a href="data-variety.html#cb160-2"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="kw">c</span>(<span class="dv">2</span><span class="op">:</span><span class="dv">28</span>)){</span>
<span id="cb160-3"><a href="data-variety.html#cb160-3"></a>    species_present &lt;-<span class="st"> </span><span class="kw">colnames</span>(species_occ_mat)[<span class="kw">which</span>(species_occ_mat[i, ] <span class="op">==</span><span class="st"> </span><span class="dv">1</span>)]</span>
<span id="cb160-4"><a href="data-variety.html#cb160-4"></a>    trait_subset &lt;-<span class="st"> </span>ba[ba<span class="op">$</span>SpeciesName <span class="op">%in%</span><span class="st"> </span>species_present,]</span>
<span id="cb160-5"><a href="data-variety.html#cb160-5"></a>    bac &lt;-<span class="st"> </span><span class="kw">aggregate</span>(trait_subset<span class="op">$</span>OrigValueStr, <span class="kw">list</span>(trait_subset<span class="op">$</span>TraitID), mean, <span class="dt">na.rm=</span>T)</span>
<span id="cb160-6"><a href="data-variety.html#cb160-6"></a>    df_pca &lt;-<span class="st"> </span><span class="kw">rbind</span>(df_pca, bac<span class="op">$</span>x)</span>
<span id="cb160-7"><a href="data-variety.html#cb160-7"></a>}</span></code></pre></div>
<p>For the PCA we use only the traits with traitIDs: 46, 47, 3106 and 3117. This is because the other traits are just slightly modified versions of these four traits. These four traitIDs correspond to the traits: <em>leaf thickness</em>, <em>leaf dry matter content (LDMC)</em>, <em>plant height</em> and <em>specific leaf area (SLA)</em>. <em>Leaf dry matter content</em> is calculated as leaf dry mass per leaf fresh mass and <em>specific leaf area</em> is defined as leaf area per leaf dry mass.</p>
<div class="sourceCode" id="cb161"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb161-1"><a href="data-variety.html#cb161-1"></a><span class="co"># we select the columns corresponding to our desired traits</span></span>
<span id="cb161-2"><a href="data-variety.html#cb161-2"></a>df_pca &lt;-<span class="st"> </span><span class="kw">cbind</span>(df_pca[,<span class="dv">2</span>],df_pca[,<span class="dv">3</span>],df_pca[,<span class="dv">5</span>],df_pca[,<span class="dv">9</span>])</span>
<span id="cb161-3"><a href="data-variety.html#cb161-3"></a></span>
<span id="cb161-4"><a href="data-variety.html#cb161-4"></a><span class="co"># to make the data easier to understand we name the columns after the trait</span></span>
<span id="cb161-5"><a href="data-variety.html#cb161-5"></a><span class="kw">colnames</span>(df_pca) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;leaf thickness&quot;</span>, <span class="st">&quot;leaf dry matter content (LDMC)&quot;</span>, <span class="st">&quot;plant height vegetative&quot;</span>, <span class="st">&quot;specific leaf area (SLA)&quot;</span>)</span>
<span id="cb161-6"><a href="data-variety.html#cb161-6"></a></span>
<span id="cb161-7"><a href="data-variety.html#cb161-7"></a><span class="kw">head</span>(df_pca)</span></code></pre></div>
<pre><code>##        leaf thickness leaf dry matter content (LDMC) plant height vegetative
## df_pca       18.38967                       142.1853                80.59372
##              19.11832                       144.8715                80.23070
##              19.32090                       176.7112                80.68073
##              21.47128                       144.4585                73.76227
##              22.30091                       148.8697                70.61044
##              22.17279                       144.7945                73.61253
##        specific leaf area (SLA)
## df_pca                 77.28056
##                        78.31965
##                        81.82512
##                        78.28065
##                        76.57826
##                        76.61992</code></pre>
<p>Principal Component Analysis (PCA) is one of famous techniques for dimension reduction, feature extraction, and data visualization. In general, PCA is defined as the transformation of a high dimensional vector space to a low dimensional space. Just imagine having to visualise data with 10 dimensions… we often stuggle already with three. It’s almost impossible to effectively show the shape of such a high dimensional data distribution. PCA provides an efficient way to reduce the dimensionalty (i.e. from 10 to 2), so it is much easier to visualize the shape of data distribution. In a nutshell, this reduction happens by the PCA taking the two axes that best explain the variation in the data.</p>
<p>PCA is also useful in the modeling a robust classifier where considerably small number of high dimensional training data is provided. By reducing the dimensions of learning data sets, PCA provides an effective and efficient method for data description and classification.
For a more mathematical description of PCA you can check <a href="https://www.projectrhea.org/rhea/index.php/PCA_Theory_Examples" class="uri">https://www.projectrhea.org/rhea/index.php/PCA_Theory_Examples</a>.</p>
<p>So now let’s reduce the dimensions of our trait data as an example… For this we use the function <code>prcomp()</code>.</p>
<div class="sourceCode" id="cb163"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb163-1"><a href="data-variety.html#cb163-1"></a>traits_pca &lt;-<span class="st"> </span><span class="kw">prcomp</span>(df_pca, <span class="dt">center =</span> <span class="ot">TRUE</span>, <span class="dt">scale =</span> <span class="ot">TRUE</span>)</span>
<span id="cb163-2"><a href="data-variety.html#cb163-2"></a><span class="kw">summary</span>(traits_pca)</span></code></pre></div>
<pre><code>## Importance of components:
##                           PC1    PC2    PC3     PC4
## Standard deviation     1.5372 0.9280 0.6972 0.53830
## Proportion of Variance 0.5907 0.2153 0.1215 0.07244
## Cumulative Proportion  0.5907 0.8060 0.9276 1.00000</code></pre>
<p>From the information above we can see how much of the variation in the data is explained by each axis or dimensionality. Ideally, you want the first to axes to explain the vast majority of the variation, while the subsequent ones are much less important.
But what do all these numbers mean and how does the data look. It’s time to visualise the PCA.</p>
<div class="sourceCode" id="cb165"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb165-1"><a href="data-variety.html#cb165-1"></a><span class="kw">library</span>(ggfortify)</span>
<span id="cb165-2"><a href="data-variety.html#cb165-2"></a><span class="kw">autoplot</span>(traits_pca, <span class="dt">data =</span> df_pca, <span class="dt">col =</span><span class="st">&quot;#138D37&quot;</span>, <span class="dt">loadings =</span> <span class="ot">TRUE</span>, <span class="dt">loadings.colour =</span> <span class="st">&#39;blue&#39;</span>, <span class="dt">loadings.label =</span> <span class="ot">TRUE</span>, <span class="dt">loadings.label.size =</span> <span class="dv">3</span>) <span class="op">+</span><span class="st"> </span><span class="kw">theme_classic</span>()</span></code></pre></div>
<pre><code>## Warning: `select_()` is deprecated as of dplyr 0.7.0.
## Please use `select()` instead.
## This warning is displayed once every 8 hours.
## Call `lifecycle::last_warnings()` to see where this warning was generated.</code></pre>
<p><img src="esds_book_files/figure-html/unnamed-chunk-90-1.png" width="672" /></p>
<p>We have successfully reduced the dimensionality of our data! We started with four traits and now we have reduced the variation to two main axes. We see that PC1 is mainly associated to leaf dry matter content, and plant height, while PC2 is associated with specific leaf area and leaf thickness.</p>
<p>It can be interesting to see how the points relate spatially, this could, for example, allow us to identify clusters. Therefore, we will visualise our tower sites coloured by the corresponding position (positive or negative) on the PC1 axes.</p>
<div class="sourceCode" id="cb167"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb167-1"><a href="data-variety.html#cb167-1"></a><span class="co"># start by designating trait and axis values to vector objects</span></span>
<span id="cb167-2"><a href="data-variety.html#cb167-2"></a>tr1 &lt;-<span class="st"> </span>df_pca[,<span class="dv">1</span>] <span class="co"># these are the traits</span></span>
<span id="cb167-3"><a href="data-variety.html#cb167-3"></a>tr2 &lt;-<span class="st"> </span>df_pca[,<span class="dv">2</span>] <span class="co"># these are the traits</span></span>
<span id="cb167-4"><a href="data-variety.html#cb167-4"></a></span>
<span id="cb167-5"><a href="data-variety.html#cb167-5"></a>pc1 &lt;-<span class="st"> </span>traits_pca<span class="op">$</span>x[,<span class="dv">1</span>] <span class="co"># these are the axis values</span></span>
<span id="cb167-6"><a href="data-variety.html#cb167-6"></a>pc2 &lt;-<span class="st"> </span>traits_pca<span class="op">$</span>x[,<span class="dv">2</span>] <span class="co"># these are the axis values</span></span></code></pre></div>
<div class="sourceCode" id="cb168"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb168-1"><a href="data-variety.html#cb168-1"></a><span class="co"># specify the colour palettes for positive and negative values</span></span>
<span id="cb168-2"><a href="data-variety.html#cb168-2"></a>pospal &lt;-<span class="st"> </span><span class="kw">colorRampPalette</span>(<span class="kw">c</span>(<span class="st">&quot;#E9E15C&quot;</span>, <span class="st">&quot;#CF2B1E&quot;</span>))</span>
<span id="cb168-3"><a href="data-variety.html#cb168-3"></a>negpal &lt;-<span class="st"> </span><span class="kw">colorRampPalette</span>(<span class="kw">c</span>(<span class="st">&quot;#1E3498&quot;</span>, <span class="st">&quot;#95D7DB&quot;</span>))</span>
<span id="cb168-4"><a href="data-variety.html#cb168-4"></a></span>
<span id="cb168-5"><a href="data-variety.html#cb168-5"></a><span class="co"># we separate positive from negative values for visualization</span></span>
<span id="cb168-6"><a href="data-variety.html#cb168-6"></a>neg_pc1 &lt;-<span class="st"> </span>pc1 </span>
<span id="cb168-7"><a href="data-variety.html#cb168-7"></a>neg_pc1[neg_pc1 <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span> ] &lt;-<span class="st"> </span><span class="ot">NA</span></span>
<span id="cb168-8"><a href="data-variety.html#cb168-8"></a>pos_pc1 &lt;-<span class="st"> </span>pc1 </span>
<span id="cb168-9"><a href="data-variety.html#cb168-9"></a>pos_pc1[pos_pc1 <span class="op">&lt;</span><span class="st"> </span><span class="dv">0</span> ] &lt;-<span class="st"> </span><span class="ot">NA</span></span>
<span id="cb168-10"><a href="data-variety.html#cb168-10"></a></span>
<span id="cb168-11"><a href="data-variety.html#cb168-11"></a>datColpos &lt;-<span class="st"> </span><span class="kw">pospal</span>(<span class="dv">100</span>)[<span class="kw">as.numeric</span>(<span class="kw">cut</span>(pos_pc1,<span class="dt">breaks =</span> <span class="dv">100</span>))] </span>
<span id="cb168-12"><a href="data-variety.html#cb168-12"></a>datColneg &lt;-<span class="st"> </span><span class="kw">negpal</span>(<span class="dv">100</span>)[<span class="kw">as.numeric</span>(<span class="kw">cut</span>(neg_pc1,<span class="dt">breaks =</span> <span class="dv">100</span>))]</span></code></pre></div>
<p>Once the colours are defined, we can plot PC1.</p>
<div class="sourceCode" id="cb169"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb169-1"><a href="data-variety.html#cb169-1"></a><span class="co">#PC1 </span></span>
<span id="cb169-2"><a href="data-variety.html#cb169-2"></a><span class="kw">plot</span>(europe_shape)</span>
<span id="cb169-3"><a href="data-variety.html#cb169-3"></a><span class="kw">points</span>(df_sp_sites<span class="op">$</span>lon, df_sp_sites<span class="op">$</span>lat, <span class="dt">col=</span>datColpos,<span class="dt">cex=</span><span class="dv">1</span>, <span class="dt">pch =</span> <span class="dv">19</span>) </span>
<span id="cb169-4"><a href="data-variety.html#cb169-4"></a><span class="kw">points</span>(df_sp_sites<span class="op">$</span>lon, df_sp_sites<span class="op">$</span>lat, <span class="dt">col=</span>datColneg,<span class="dt">cex=</span><span class="dv">1</span>, <span class="dt">pch =</span> <span class="dv">19</span>)</span></code></pre></div>
<p><img src="esds_book_files/figure-html/unnamed-chunk-93-1.png" width="672" /></p>
<p>And then repeat the process for PC2:</p>
<div class="sourceCode" id="cb170"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb170-1"><a href="data-variety.html#cb170-1"></a><span class="co"># PC2</span></span>
<span id="cb170-2"><a href="data-variety.html#cb170-2"></a>neg_pc2 &lt;-<span class="st"> </span>pc2 </span>
<span id="cb170-3"><a href="data-variety.html#cb170-3"></a>neg_pc2[neg_pc2 <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span> ] &lt;-<span class="st"> </span><span class="ot">NA</span></span>
<span id="cb170-4"><a href="data-variety.html#cb170-4"></a>pos_pc2 &lt;-<span class="st"> </span>pc2 </span>
<span id="cb170-5"><a href="data-variety.html#cb170-5"></a>pos_pc2[pos_pc2 <span class="op">&lt;</span><span class="st"> </span><span class="dv">0</span> ] &lt;-<span class="st"> </span><span class="ot">NA</span></span>
<span id="cb170-6"><a href="data-variety.html#cb170-6"></a></span>
<span id="cb170-7"><a href="data-variety.html#cb170-7"></a>datColpos &lt;-<span class="st"> </span><span class="kw">pospal</span>(<span class="dv">100</span>)[<span class="kw">as.numeric</span>(<span class="kw">cut</span>(pos_pc2,<span class="dt">breaks =</span> <span class="dv">100</span>))] </span>
<span id="cb170-8"><a href="data-variety.html#cb170-8"></a>datColneg &lt;-<span class="st"> </span><span class="kw">negpal</span>(<span class="dv">100</span>)[<span class="kw">as.numeric</span>(<span class="kw">cut</span>(neg_pc2,<span class="dt">breaks =</span> <span class="dv">100</span>))]</span>
<span id="cb170-9"><a href="data-variety.html#cb170-9"></a></span>
<span id="cb170-10"><a href="data-variety.html#cb170-10"></a><span class="co"># and plot it on the map</span></span>
<span id="cb170-11"><a href="data-variety.html#cb170-11"></a><span class="kw">plot</span>(europe_shape)</span>
<span id="cb170-12"><a href="data-variety.html#cb170-12"></a><span class="kw">points</span>(df_sp_sites<span class="op">$</span>lon, df_sp_sites<span class="op">$</span>lat, <span class="dt">col=</span>datColpos,<span class="dt">cex=</span><span class="dv">1</span>, <span class="dt">pch =</span> <span class="dv">19</span>)</span>
<span id="cb170-13"><a href="data-variety.html#cb170-13"></a><span class="kw">points</span>(df_sp_sites<span class="op">$</span>lon, df_sp_sites<span class="op">$</span>lat, <span class="dt">col=</span>datColneg,<span class="dt">cex=</span><span class="dv">1</span>, <span class="dt">pch =</span> <span class="dv">19</span>)</span></code></pre></div>
<p><img src="esds_book_files/figure-html/unnamed-chunk-94-1.png" width="672" /></p>
<p>The last step in our trait data PCA is to compare the results with GPP. Since GPP has more sites than we used for this analysis we start by removing these sites.</p>
<div class="sourceCode" id="cb171"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb171-1"><a href="data-variety.html#cb171-1"></a>GPP_pca &lt;-<span class="st"> </span>GPP <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb171-2"><a href="data-variety.html#cb171-2"></a><span class="st">  </span><span class="kw">filter</span>(<span class="op">!</span>(siteid <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;CH-Oe1&quot;</span>, <span class="st">&quot;DE-Obe&quot;</span>, <span class="st">&quot;FR-LBr&quot;</span>, <span class="st">&quot;IT-Cpz&quot;</span>, <span class="st">&quot;IT-Ro1&quot;</span>)))</span></code></pre></div>
<p>Then we make a linear model for PC1 and GPP and plot it.</p>
<div class="sourceCode" id="cb172"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb172-1"><a href="data-variety.html#cb172-1"></a>reg_gpp_pc1 &lt;-<span class="st"> </span><span class="kw">lm</span>(gpp_meanann<span class="op">~</span>pc1, <span class="dt">data =</span> GPP_pca)</span>
<span id="cb172-2"><a href="data-variety.html#cb172-2"></a></span>
<span id="cb172-3"><a href="data-variety.html#cb172-3"></a>GPP_pca <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb172-4"><a href="data-variety.html#cb172-4"></a><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> pc1, <span class="dt">y =</span> gpp_meanann)) <span class="op">+</span></span>
<span id="cb172-5"><a href="data-variety.html#cb172-5"></a><span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span></span>
<span id="cb172-6"><a href="data-variety.html#cb172-6"></a><span class="st">  </span><span class="kw">geom_smooth</span>(<span class="dt">method=</span><span class="st">&#39;lm&#39;</span>, <span class="dt">color=</span><span class="st">&quot;red&quot;</span>, <span class="dt">size=</span><span class="fl">0.5</span>, <span class="dt">se=</span><span class="ot">FALSE</span>) <span class="op">+</span></span>
<span id="cb172-7"><a href="data-variety.html#cb172-7"></a><span class="st">  </span><span class="kw">xlab</span>(<span class="st">&quot;PC1&quot;</span>) <span class="op">+</span></span>
<span id="cb172-8"><a href="data-variety.html#cb172-8"></a><span class="st">  </span><span class="kw">ylab</span>(<span class="st">&quot;GPP mean [µmolCO2 m-2 s-1]&quot;</span>) <span class="op">+</span></span>
<span id="cb172-9"><a href="data-variety.html#cb172-9"></a><span class="st">  </span><span class="kw">theme_classic</span>()</span></code></pre></div>
<p><img src="esds_book_files/figure-html/unnamed-chunk-96-1.png" width="672" /></p>
<p>We repeat this for GPP and PC2.</p>
<div class="sourceCode" id="cb173"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb173-1"><a href="data-variety.html#cb173-1"></a>reg_gpp_pc2 &lt;-<span class="st"> </span><span class="kw">lm</span>(gpp_meanann<span class="op">~</span>pc2, <span class="dt">data =</span> GPP_pca)</span>
<span id="cb173-2"><a href="data-variety.html#cb173-2"></a></span>
<span id="cb173-3"><a href="data-variety.html#cb173-3"></a>GPP_pca <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb173-4"><a href="data-variety.html#cb173-4"></a><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> pc2, <span class="dt">y =</span> gpp_meanann)) <span class="op">+</span></span>
<span id="cb173-5"><a href="data-variety.html#cb173-5"></a><span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span></span>
<span id="cb173-6"><a href="data-variety.html#cb173-6"></a><span class="st">  </span><span class="kw">geom_smooth</span>(<span class="dt">method=</span><span class="st">&#39;lm&#39;</span>, <span class="dt">color=</span><span class="st">&quot;red&quot;</span>, <span class="dt">size=</span><span class="fl">0.5</span>, <span class="dt">se=</span><span class="ot">FALSE</span>) <span class="op">+</span></span>
<span id="cb173-7"><a href="data-variety.html#cb173-7"></a><span class="st">  </span><span class="kw">xlab</span>(<span class="st">&quot;PC2&quot;</span>) <span class="op">+</span></span>
<span id="cb173-8"><a href="data-variety.html#cb173-8"></a><span class="st">  </span><span class="kw">ylab</span>(<span class="st">&quot;GPP mean [µmolCO2 m-2 s-1]&quot;</span>) <span class="op">+</span></span>
<span id="cb173-9"><a href="data-variety.html#cb173-9"></a><span class="st">  </span><span class="kw">theme_classic</span>() </span></code></pre></div>
<p><img src="esds_book_files/figure-html/unnamed-chunk-97-1.png" width="672" /></p>
<p>Once again we see weak correlations with GPP. Therefore, we can conclude that this further search for predictors that explain the variation in GPP has not yielded any good results. We will have to continue looking for better predictors, which explain this variation in GPP between the sites.</p>
<p><strong>Checkpoint</strong></p>
<p>Plot the spatial distribution of the trait ‘leaf thickness’, make the colour or size related to the leaf thickness values. Describe what you can gather from this plot.</p>
<p><strong>Solution</strong></p>
<div class="sourceCode" id="cb174"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb174-1"><a href="data-variety.html#cb174-1"></a>leaf_t &lt;-<span class="st"> </span>df_pca[,<span class="dv">1</span>]</span>
<span id="cb174-2"><a href="data-variety.html#cb174-2"></a></span>
<span id="cb174-3"><a href="data-variety.html#cb174-3"></a>leavepal &lt;-<span class="st"> </span><span class="kw">colorRampPalette</span>(<span class="kw">c</span>(<span class="st">&quot;#E2C151&quot;</span>,<span class="st">&quot;#138D37&quot;</span>))</span>
<span id="cb174-4"><a href="data-variety.html#cb174-4"></a></span>
<span id="cb174-5"><a href="data-variety.html#cb174-5"></a>datColleaves &lt;-<span class="st"> </span><span class="kw">leavepal</span>(<span class="dv">10</span>)[<span class="kw">as.numeric</span>(<span class="kw">cut</span>(leaf_t,<span class="dt">breaks =</span> <span class="dv">10</span>))]</span>
<span id="cb174-6"><a href="data-variety.html#cb174-6"></a></span>
<span id="cb174-7"><a href="data-variety.html#cb174-7"></a><span class="kw">plot</span>(europe_shape)</span>
<span id="cb174-8"><a href="data-variety.html#cb174-8"></a><span class="kw">points</span>(df_sp_sites<span class="op">$</span>lon, df_sp_sites<span class="op">$</span>lat, <span class="dt">col=</span>datColleaves,<span class="dt">cex=</span>leaf_t<span class="op">/</span><span class="dv">18</span>, <span class="dt">pch =</span> <span class="dv">19</span>) </span></code></pre></div>
<p><img src="esds_book_files/figure-html/unnamed-chunk-98-1.png" width="672" /></p>
<p>The distribution of leaf thickness seems to depend on latitude. In Southern regions, leaves are generally thinner than in Northern regions. To confirm this we would have to make a model and test our observation.</p>

</div>
</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="data-wrangling.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="data-scraping.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["esds_book.pdf", "esds_book.epub"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
